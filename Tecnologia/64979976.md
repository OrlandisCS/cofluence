Suport Tècnic : Monitor S.T. - e-TRAM 2.0 - Tràmits no generats  

1.  [Suport Tècnic](index.html)
2.  [Suport Tècnic](13893782.html)
3.  [03 - Monitorització - Revisions globals](26313327.html)
4.  [Monitors S.T.](Monitors-S.T._41522177.html)
5.  [Monitors S.T. - e-TRAM](Monitors-S.T.---e-TRAM_128647227.html)

Suport Tècnic : Monitor S.T. - e-TRAM 2.0 - Tràmits no generats
===============================================================

Created by Unknown User (otecobernal), last modified by OTEC ST Alessandro Trombin Martinez on 15 May 2024

Què mesura aquest monitor?

Monitor que revisa els tràmits de l'e-TRAM 2.0 que no s'han generat correctament.

  

**Consulta**
============

* * *

SELECT COUNT(ID) "Tràmits"
  FROM ETRAM20PCI.ETRAM\_TRAMIT
 WHERE REBUT = 0
   AND DATA\_ACTUALITZACIO < SYSDATE - 1 / 24;

**Procediment**
===============

* * *

Haurem de revisar els registres que aparèixen:

SELECT \*
  FROM ETRAM20PCI.ETRAM\_TRAMIT
 WHERE REBUT = 0
   AND DATA\_ACTUALITZACIO < SYSDATE - 1 / 24;

  

**Tràmits amb 5 reintents**

Pels casos on els tràmits hagin arribat a 5 reintents, podrem intentar baixar-los:

UPDATE ETRAM20PCI.ETRAM\_TRAMIT
   SET REINTENTS = 4
 WHERE REBUT = 0
   AND DATA\_ACTUALITZACIO < SYSDATE - 1 / 24
   AND REINTENTS >= 5;

Un cop realitzat, haurem de revisar que l'RDBMS processa els registres i els tràmits es generen.

Revisar abans de tancar tiquet JIRA

Si veiem amb la sonda que tots els tràmits estan a reintents 5 i després de realitzar l'update massiu de baixada de reintents, revisem si s'han processat correctament els registres:

SELECT \*
  FROM ETRAM20PCI.ETRAM\_TRAMIT
 WHERE REINTENTS >= 5;

Al realitzar l'update massiu, el camp DATA\_ACTUALITZACIO es canvia al dia d'avui i per això fins el dia següent no surten registres a la sonda, per la condició **DATA\_ACTUALITZACIO < SYSDATE - 1 / 24**.

Per evitar que tinguem tràmits amb més d'un dia sense haver-se generat haurem de revisar-ho abans de tancar la sonda.

En cas que els tràmits torni a pujar a 5 reintents haurem de revisar els logs de l'aplicació:

*   **/apps/tomcat8/logs/etram.log**
*   **/apps/aoc/APP/logs/MC-ETRAM\_APPNODO?\_SOA.log**

  

  

**Tràmits amb rebut = -1**

Pels casos on els tràmits tinguin l'estat de REBUT=-1, els haurem de modificar en REBUT=0

UPDATE ETRAM20PCI.ETRAM\_TRAMIT
   SET REBUT = 0
 WHERE REBUT = -1
   AND DATA\_ACTUALITZACIO < SYSDATE - 1 / 24
   AND REBUT = -1;

Un cop realitzat, haurem de revisar que l'RDBMS processa els registres i els tràmits es generen.

En cas que el tràmit es torni a quedar en rebut=-1, o els reintents pugin a 5 (cas anterior) haurem de revisar els logs de l'aplicació:

*   **/apps/tomcat8/logs/etram.log**

**Informació addicional**
=========================

* * *

### 1) Revisió de logs

#### **1.1) Tomcat8 - Mygov**

Podrem trobar els logs a les rutes:

*   **/apps/tomcat8/logs/etram.log**

  

**Servidors** 
==============

**

*   Node1: **aoc-l-mygov-01 → 10.120.1.37 [](https://pam.aoc.cat/SecretServer/app/#/secrets/4390/general)** 
    
*   Node2: **aoc-l-mygov-02** **→ 10.120.1.38 [](https://pam.aoc.cat/SecretServer/app/#/secrets/4392/general)** 
*   User: **tomcat8**

*   Node1: **aoc-l-mygov-01-pre** **→ 10.120.2.138 [](https://pam.aoc.cat/SecretServer/app/#/secrets/4387/general)** 
    
*   Node2: **aoc-l-mygov-02-pre** **→ 10.120.2.139 [](https://pam.aoc.cat/SecretServer/app/#/secrets/4389/general)** 
*   User: **tomcat8**





**

#### **1.2) PCI30 - SOA**

*    **/apps/aoc/APP/logs/MC-ETRAM\_APPNODO?\_SOA.log**
*   **/apps/aoc/APP/logs/MC-ETRAM-DESAL\_APPNODO?\_SOA.log**

**Servidors** 
==============

***   Node1: **aoc-l-soa01 → 10.120.1.163 [](https://pam.aoc.cat/SecretServer/app/#/secrets/4785/general)** 
    
*   Node2: **aoc-l-soa02 → 10.120.1.164 [](https://pam.aoc.cat/SecretServer/app/#/secrets/4786/general)** 
*   Node3: **aoc-l-soa03 → 10.120.1.172 [](https://pam.aoc.cat/SecretServer/app/#/secrets/4787/general)** 
*   User: **soa**  
    

 Admin: **[http://10.120.1.163:7001/console/login/LoginForm.jsp](http://10.120.1.163:7001/console/login/LoginForm.jsp)[](https://pam.aoc.cat/SecretServer/app/#/secrets/4777/general)**

*   Node1: **aoc-l-soa01-pre → 10.120.2.125 [](https://pam.aoc.cat/SecretServer/app/#/secrets/4745/general)** 
    
*   Node2: **aoc-l-soa02-pre → 10.120.2.126 [](https://pam.aoc.cat/SecretServer/app/#/secrets/4744/general)** 
*   Node3: **aoc-l-soa03-pre → 10.120.2.136 [](https://pam.aoc.cat/SecretServer/app/#/secrets/4746/general)** 
*   User: **soa**

 Admin: **[http://10.120.2.125:7001/console/login/LoginForm.jsp](http://10.120.2.125:7001/console/login/LoginForm.jsp) [](https://pam.aoc.cat/SecretServer/app/#/secrets/4734/general)**** 

### 2) Solucions d'errors.

  

java.lang.Exception: net.sf.json.JSONException: JSONObject\["missatgeError"\] not found.

Si es veu aquest missatge d'error:

04 Apr 2023 08:45:00,974 ERROR RebutWork      : java.lang.Exception: net.sf.json.JSONException: JSONObject\["missatgeError"\] not found.
        at cat.aoc.pci30.modalitats.etram20.managers.ETRAMDesalMngr.rebut(ETRAMDesalMngr.java:410)
        at cat.aoc.pci30.modalitats.etram20.RebutWork.procesa(ETRAMEventSubscriber.java:90)
        at cat.aoc.pci30.core.mti.fases.MTIEventWork.run(MTIEventWork.java:13)
        at weblogic.work.j2ee.J2EEWorkManager$WorkWithListener.run(J2EEWorkManager.java:209)
        at weblogic.invocation.ComponentInvocationContextManager.\_runAs(ComponentInvocationContextManager.java:352)
        at weblogic.invocation.ComponentInvocationContextManager.runAs(ComponentInvocationContextManager.java:337)
        at weblogic.work.LivePartitionUtility.doRunWorkUnderContext(LivePartitionUtility.java:57)
        at weblogic.work.PartitionUtility.runWorkUnderContext(PartitionUtility.java:41)
        at weblogic.work.SelfTuningWorkManagerImpl.runWorkUnderContext(SelfTuningWorkManagerImpl.java:655)
        at weblogic.work.ExecuteThread.execute(ExecuteThread.java:420)
        at weblogic.work.ExecuteThread.run(ExecuteThread.java:360)
Caused by: net.sf.json.JSONException: JSONObject\["missatgeError"\] not found.
        at net.sf.json.JSONObject.get(JSONObject.java:1107)
        at cat.aoc.pci30.modalitats.etram20.serveis.MUX3.invoca(MUX3.java:191)
        at cat.aoc.pci30.modalitats.etram20.serveis.MUX3.carregaRebut(MUX3.java:348)
        at cat.aoc.pci30.modalitats.etram20.managers.ETRAMDesalMngr.rebut(ETRAMDesalMngr.java:388)

  

Haurem de buscar a la taula ETRAM\_TRAMIT de l'esquema ETRAM20\_PCI el camp mux\_transaccio i amb el postman següent executar la opció Recarregar IdTransacció:

![](attachments/64979976/81856038.png)

  

Adjunto el projecte pel Postman i l'enviroment necessari per tal de que funcioni.

  

[![](download/resources/com.atlassian.confluence.plugins.confluence-view-file-macro:view-file-macro-resources/images/placeholder-medium-file.png)INTEGRACIO MUX V3 PRO - UserMUX3.postman\_collection.json](/download/attachments/64979976/INTEGRACIO%20MUX%20V3%20PRO%20-%20UserMUX3.postman_collection.json?version=1&modificationDate=1680614973322&api=v2)[![](download/resources/com.atlassian.confluence.plugins.confluence-view-file-macro:view-file-macro-resources/images/placeholder-medium-file.png)MUX-PRO.postman\_environment.json](/download/attachments/64979976/MUX-PRO.postman_environment.json?version=1&modificationDate=1680614974180&api=v2)

  

Un cop es diposa del postman correctament configurat, només cal modificar la variable d'entorn idTransaccio per la que hi ha a la BB.DD:

  

![](attachments/64979976/81856041.png)

ERROR RebutWork : java.lang.Exception: cat.aoc.desal.client.impl.exception.InvalidFileNameException: El nom del fitxer informat al camp 'nomFitxer' ('Rebut\_23-04-17\_Ajuntament de Castellar del Vallès\_Plaça Sant Joan s\*n\_INSTANCIA.pdf') no és vàlid: El nom del fitxer conté caràcters il·legals: \[", :, \*, <, \\, |, >, /, ?\]

Si es veu aquest missatge d'error:

18 Apr 2023 11:15:24,405 ERROR RebutWork      : java.lang.Exception: cat.aoc.desal.client.impl.exception.InvalidFileNameException: El nom del fitxer informat al camp 'nomFitxer' ('Rebut\_23-04-17\_Ajuntament de Castellar del Vallès\_Plaça Sant Joan s\*n\_INSTANCIA.pdf') no és vàlid: El nom del fitxer conté caràcters il·legals: \[", :, \*, <, \\, |, >, /, ?\].
        at cat.aoc.pci30.modalitats.etram20.managers.ETRAMDesalMngr.rebut(ETRAMDesalMngr.java:410)
        at cat.aoc.pci30.modalitats.etram20.RebutWork.procesa(ETRAMEventSubscriber.java:90)
        at cat.aoc.pci30.core.mti.fases.MTIEventWork.run(MTIEventWork.java:13)
        at weblogic.work.j2ee.J2EEWorkManager$WorkWithListener.run(J2EEWorkManager.java:209)
        at weblogic.invocation.ComponentInvocationContextManager.\_runAs(ComponentInvocationContextManager.java:352)
        at weblogic.invocation.ComponentInvocationContextManager.runAs(ComponentInvocationContextManager.java:337)
        at weblogic.work.LivePartitionUtility.doRunWorkUnderContext(LivePartitionUtility.java:57)
        at weblogic.work.PartitionUtility.runWorkUnderContext(PartitionUtility.java:41)
        at weblogic.work.SelfTuningWorkManagerImpl.runWorkUnderContext(SelfTuningWorkManagerImpl.java:655)
        at weblogic.work.ExecuteThread.execute(ExecuteThread.java:420)
        at weblogic.work.ExecuteThread.run(ExecuteThread.java:360)
Caused by: cat.aoc.desal.client.impl.exception.InvalidFileNameException: El nom del fitxer informat al camp 'nomFitxer' ('Rebut\_23-04-17\_Ajuntament de Castellar del Vallès\_Plaça Sant Joan s\*n\_INSTANCIA.pdf') no és vàlid: El nom del fitxer conté caràcters il·legals: \[", :, \*, <, \\, |, >, /, ?\].
        at cat.aoc.desal.client.impl.FileNameValidator.checkIsValidFileName(FileNameValidator.java:85)
        at cat.aoc.desal.client.impl.FileNameValidator.validateNomFitxer(FileNameValidator.java:58)
        at cat.aoc.desal.client.impl.Validator.validateCarregaFitxerRequest(Validator.java:62)
        at cat.aoc.desal.client.impl.DESALClientImpl.carregaFitxer(DESALClientImpl.java:184)
        at cat.aoc.desal.client.impl.DESALClientImpl.carregaFitxer(DESALClientImpl.java:171)
        at cat.aoc.pci30.modalitats.etram20.serveis.MUX3.carregaRebut(MUX3.java:316)
        at cat.aoc.pci30.modalitats.etram20.managers.ETRAMDesalMngr.rebut(ETRAMDesalMngr.java:388)
        ... 10 more

El problema és perquè al generar el rebut, es crea un document pdf i el format del nom del rebut es genera de la següent manera: REBUT+DATA+NOM-DESTINATARI+NOM-PROCEDENCIA+TIPUS-DOCUMENT i aquestes dades s'agafen del contingut del XML del tràmit.

En aquest cas, busquem la informació del tràmit amb aquesta query:

SELECT \*
  FROM ETRAM20PCI.ETRAM\_TRAMIT
 WHERE ID = 'XXXXXX';

I al camp XML, si fem click als 3 punts podem revisar el contingut del XML:

![](attachments/64979976/81856130.png)

Hem de modificar els camps amb caràcters il·legals i tornar a baixar reintents.

Amb el programa PL/SQL no es pot modificar directament l'XML, cal realitzar una consulta SQL per modificar el camp <CLOB>. Amb el programa SQLDeveloper si que es pot modificar directament l'XML.

  

### 3) Model de dades

#### R\_SIGNATURA\_EVIDENCIA.SIGNAT

Valor

Significat

0

No signat

1

Signat

#### R\_SIGNATURA\_EVIDENCIA.SIGNAT

Valor

Significat

0

Finalitzat

1

En progrés

Attachments:
------------

![](images/icons/bullet_blue.gif) [CORPME - Procés d'alta de serveiSuport Tècnic16 marzo 2020Procediment a realitzar setmanalment per les altes del CORPME. Guia.url](attachments/64979976/64979977.url) (application/octet-stream)  
![](images/icons/bullet_blue.gif) [cds.gif](attachments/64979976/64979978.gif) (image/gif)  
![](images/icons/bullet_blue.gif) [image2023-4-4\_15-29-10.png](attachments/64979976/81856038.png) (image/png)  
![](images/icons/bullet_blue.gif) [INTEGRACIO MUX V3 PRO - UserMUX3.postman\_collection.json](attachments/64979976/81856039.json) (application/octet-stream)  
![](images/icons/bullet_blue.gif) [MUX-PRO.postman\_environment.json](attachments/64979976/81856040.json) (application/octet-stream)  
![](images/icons/bullet_blue.gif) [image2023-4-4\_16-5-20.png](attachments/64979976/81856041.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2023-4-18\_12-13-28.png](attachments/64979976/81856130.png) (image/png)  

Document generated by Confluence on 02 June 2025 11:08

[Atlassian](http://www.atlassian.com/)