Suport Tècnic : Monitor S.T. - e-NOTUM - RDBMS-eNOTUM-GeneracioPDF  

1.  [Suport Tècnic](index.html)
2.  [Suport Tècnic](13893782.html)
3.  [03 - Monitorització - Revisions globals](26313327.html)
4.  [Monitors S.T.](Monitors-S.T._41522177.html)
5.  [Monitor S.T. - OLD](Monitor-S.T.---OLD_118555256.html)

Suport Tècnic : Monitor S.T. - e-NOTUM - RDBMS-eNOTUM-GeneracioPDF
==================================================================

Created by Unknown User (otecobernal), last modified by OTEC ST Alessandro Trombin Martinez on 02 March 2022

**Query**

SELECT COUNT(id) REGISTRES
FROM NT30.AOC\_NT\_EVENT\_MOTOR
where ESTAT = 0
and DATA\_ACCIO < CURRENT\_TIMESTAMP
and FASE in ('FASE\_GENERACIO\_PDF')

**Descripció:** 

Un cop la notificació en visualitza, es genera un event a la motor d'enotum que crea un pdf d'evidència. En aquest moment es genera un registre en la taula amb estat 0, el motor de enotum agafa aquestes notificacions i crea el PDF. En cas que falli anirà pujant els reintents fins a 6 i si falla l'últim reintent es quedarà en estat 2 (error).

  

**Actuació:** 

En primer lloc comprovarem que el RDBMS està funcionant correctament, llencem la següent QUERY:

SELECT count(\*)
FROM NT30.AOC\_NT\_EVENT\_MOTOR 
where ESTAT = 0 
and DATA\_ACCIO < CURRENT\_TIMESTAMP 
and FASE in ('FASE\_GENERACIO\_PDF')

Revisem si el número baixa, en cas que baixi vol dir que el RDBMS està funcionant correctament. Si no baixa gens → Recrear RDBMS.

En cas que el RDBMS estigui funcionant correctament, veurem si els events estan acabant en error:

select \*
from nt30.aoc\_nt\_event\_motor
where estat = 0
and reintent > 0

Amb aquesta query veiem les notificacions que ja han fallat, al menys, una vegada.

Procedim a revisar:

Primer revisem els WL12 NT per si veiem algun en WARNING que pugui estar donant problemes.

En cas que tot estigui bé, revisem les notificacions en concret que han donat error:

Si tenim una notificació que ha quedat en estat d'error, hem de processar-la de nou:

*   Busquem l'event de la notificació:

select \*
from nt30.aoc\_nt\_event\_motor
where id\_notificacio = 52833397;

*   Reiniciem l'event:

update nt30.aoc\_nt\_event\_motor
set reintents = 3, estat = 0
where id\_notificacio = '2914409'
and fase = 'FASE\_GENERACIO\_PDF';

**En cas que no funcioni haurem de buscar ens els logs: NT-APPNODO?\_SOA.log Al NODES SOA**

En alguns casos que ens hem trobat amb incidències amb els pdf's hem detectat l'error:

ERROR \[\[ACTIVE\] ExecuteThread: '297' for queue: 'weblogic.kernel.Default (self-tuning)'\] EventMotorObserver: Error execució de l'event motor \[52833397\] java.lang.RuntimeException: Error en crear el PDF de la notificació

Per solucionar-ho s'ha traspassat els fitxers més antics de 300 dies : _/apps/aoc20/APP/NT30/tmp_ A he creat un directori /apps/aoc20/APP/NT30/tmp2

*   *   Ens ubiquem a la carpeta: /apps/aoc20/APP/NT30/tmp
    *   Executem la comanda: find . -mtime +300 -exec mv {} ./../tmp2/ \\;

Això farà que guanyem capacitat en el fitxer tmp i els PDF tornin a generar-se de nou. Seguidament haurem de reiniciar els events que hagin quedat en estat 2 i reintents 6 durant la incidència.

**logs:** 

*   **Servidor: SOA PCI3**
*   **Ruta: apps/aoc/NT/logs**
*   **Nom: NT-NTNODO?\_SOA.log  
    **

  

Document generated by Confluence on 02 June 2025 11:09

[Atlassian](http://www.atlassian.com/)