Projectes : Procedure per eliminar un node del repository  

1.  [Projectes](index.md)
2.  [PSA](PSA_24216342.md)
3.  [PSA - WIKI](PSA---WIKI_24216306.md)
4.  [SQL](SQL_24216319.md)

Projectes : Procedure per eliminar un node del repository
=========================================================

Created by Áurea Alcaide, last modified on 29 julio 2019

**DELETE\_NODE\_FROM\_REPO\_BYUUID**

create or replace 
PROCEDURE DELETE\_NODE\_FROM\_REPO\_BYUUID(NODE\_UUID IN VARCHAR2) AS 

NODE\_ID number;
NODE\_PROP\_ID number;

CURSOR node\_props (node\_id in number) IS
  SELECT np.id
  FROM repositorynodeproperty\_t np
  where np.nodeid = node\_id
  ORDER BY np.id ASC;

CURSOR node\_props\_bin (nodeprop\_id in number) IS
  SELECT npb.id
  FROM repositorynodepropertybinary\_t npb
  where npb.id = nodeprop\_id
  ORDER BY npb.id ASC;

CURSOR node\_props\_str (nodeprop\_id in number) IS
  SELECT nps.id
  FROM repositorynodepropertystring\_t nps
  where nps.id = nodeprop\_id
  ORDER BY nps.id ASC;

BEGIN

  --dbms\_output.put\_line('NODE\_UUID = ' || NODE\_UUID);
  -- node
  select n.id into NODE\_ID from repositorynode\_t n where n.uuid = NODE\_UUID;
  --dbms\_output.put\_line('NODE\_ID = ' || NODE\_ID);

  -- node properties
  FOR node\_prop IN node\_props(NODE\_ID) LOOP
    NODE\_PROP\_ID := node\_prop.id;
    --dbms\_output.put\_line('NODE\_PROP\_ID = ' || node\_prop.id);

    -- delete node property binARY
    FOR node\_prop\_bin in node\_props\_bin(NODE\_PROP\_ID) LOOP
      DELETE FROM repositorynodepropertybinary\_t npb WHERE npb.id = node\_prop\_bin.id;
      -- dbms\_output.put\_line('node property binary deleted -> NODE\_PROP\_BIN = ' || node\_prop\_bin.id);
    END LOOP;

    -- delete node property string
    FOR node\_prop\_str in node\_props\_str(NODE\_PROP\_ID) LOOP
      DELETE FROM repositorynodepropertystring\_t nps WHERE nps.id = node\_prop\_str.id;
      --dbms\_output.put\_line('node property string deleted -> NODE\_PROP\_STR = ' || node\_prop\_str.id);
    END LOOP;

    --delete node property 
    DELETE FROM repositorynodeproperty\_t np WHERE np.id = NODE\_PROP\_ID;
    --dbms\_output.put\_line('node property deleted -> NODE\_PROP\_ID = ' || node\_prop.id);
  END LOOP;

  -- delete node
  DELETE FROM repositorynode\_t n WHERE n.id=node\_id;
  dbms\_output.put\_line('node deleted -> ' || NODE\_UUID);

EXCEPTION
  WHEN NO\_DATA\_FOUND THEN
    DBMS\_OUTPUT.PUT\_LINE (SQLCODE || ' ' || SQLERRM);
  WHEN OTHERS THEN
    DBMS\_OUTPUT.PUT\_LINE (SQLCODE || ' ' || SQLERRM);
    ROLLBACK;

END DELETE\_NODE\_FROM\_REPO\_BYUUID;

Document generated by Confluence on 07 junio 2025 00:00

[Atlassian](http://www.atlassian.com/)