Suport Tècnic : Revisió SSC (TrustedX) - Revisar IP's i treure Nexica  

1.  [Suport Tècnic](index.html)
2.  [Suport Tècnic](13893782.html)
3.  [04 - Tècnica de sistemes + 24x7 + Padró](26313202.html)
4.  [Revisió de serveis](36340340.html)
5.  [SSC - Revisions i Restabliment](SSC---Revisions-i-Restabliment_41521367.html)

Suport Tècnic : Revisió SSC (TrustedX) - Revisar IP's i treure Nexica
=====================================================================

Created by Unknown User (otecobernal), last modified by Joan Riquelme on 25 March 2025

IMPORTANT

Abans de revisar, hem de saber per quin entorn estem donant servei, Nexica o Kyndryl

Infraestructura del servei:
---------------------------

Relació entre els seus components:

Esquema del funcionament:

![](https://intranet.aoc.cat/download/attachments/36340764/image2019-12-2_13-19-39.png?version=1&modificationDate=1586452150490&api=v2)

Tothom qui consumeix el servei entra o bé per **ssc.catcert.cat:8090** o bé per **ssc.catcert.cat:8443**, segons sigui per **Usuari/contrasenya** o bé per **Certificat**, respectivament.

Des d'aqui, s'ataca a dos nodes FRONTALS.

A continuació, s'ataca a dos nodes del TrustedX: **10.120.1.125** i **10.120.1.24** (PRO)

Per darrere del TrustedX tenim **ORACLE12** (BBDD) i dos **HSMs**. Els HSMs s'encarreguen d'emmagatzemar i protegir les claus privades dels certificats i és on es fa la signatura. (Les operacions per crear la signatura és fan allà, assimilant-se a una caixa negra amb una funcionalitat, o a un lector de targetes T\_CAT, per protegir les dades).

Veiem el flux gràficament:

Connexions que fa el TrustedX cap a fora: **PSIS**, concretament TSA → TrustedX es recolza en PSIS per a realitzar les **signatures amb segell de temps.**

  

Revisió del servei per cada component:
======================================

Estàs revisant el SSC de KYNDRYL

  

Revisió de la consola
=====================

* * *

**Entrar per consola admin (web) als dos nodes**:

*   Node 1: [https://10.120.1.125:8080/trustedx-console/login.xhtml](https://10.120.1.125:8080/trustedx-console/login.xhtml)
*   Node 2: [https://10.120.1.24:8080/trustedx-console/login.xhtml](https://10.120.1.24:8080/trustedx-console/login.xhtml)

S'hi ha d'accedir amb Usuari i contrasenya. Són usuaris nominals, que podem trobar al Keepass. Les persones que tenim usuari som: Joan Riquelme, Oriol Bernal

Si podem entrar-hi, en principi el TrustedX funciona correctament. Tot i això, indiquem informació de revisió més al detall.

A la pestanya **Auditoria**, podem trobar logs i estadístiques:

Estadístiques

  

Important!

La pestanya ESTADÍSTIQUES és única per cada node. Per veure les estadístiques del node 1, hem d'accedir a la consola admin del node 1. Idem pel node 2.

**Hora de l'última petició que ha entrat**. Comprovar, per exemple si coincideix amb alguna intervenció. 

**Temps mig de resposta**. Els temps quan funciona correctament haurien de ser d'1 segon aproximadament, o menys.

Podem **reiniciar les estadístiques** clicant al botó _Reiniciar_ de la cantonada inferior dreta. Això pot ser útil després de fer un reinici, per exemple.  
![](attachments/36340771/41522001.png)

Logs

Important!

La pestanya LOGS conté dades dels dos nodes, ja que es consulten a BBDD.

És aconsellable filtrar el **període** dels logs als últims 15 minuts, degut a la gran volumetria d'aquest servei.

A la columna LEVEL veiem el tipus de log que és (INFO, WARN, ERROR...). Podem filtrar per un tipus d'error o un altre escollint a **Tipo de log**.

![](attachments/36340771/41522002.png)

  

Si veiem molts logs del tipus ERROR seguits, significa que el servei no funciona correctament. Pot ser que el TrustedX estigui malament o també que ho estigui algun component extern (PSIS, BDD, etc.)

Tasques en procés

Des de la web també podem revisar les tasques en procés. Haurem de validar que el nombre de tasques no siguin molt elevat:![](attachments/36340771/41522003.png)

  

**OBS**: Normalment si es pot entrar a la consola admin vol dir que el TrustedX està bé, i el més probable és que sigui un tema de rendiment o d'un component extern.

  

BACK
====

Connexió amb el servidor

  

Connectar-nos via SSH, no via SFTP.

Servidors 
==========

*   Node1: **aoc-l-ssc1 → 10.120.1.125**
    
*   Node2: **aoc-l-ssc2** **→ 10.120.1.24**
*   User: **admin**

*   Node1: **SSC Node 1 → 10.124.24.41**
    
*   Node2: **SSC Node 2** **→ 10.124.24.42**
*   User: **admin**

Connectar-nos via SSH, no via SFTP.

Com connectar-se via SSH

Obrir el CMD i executar la comanda PUTTY:  
![](attachments/41521969/41521985.png)

Omplir amb la IP que toca i marcar SSH.

Revisió del JBOSS

Revisió dels logs
=================

Per revisar errors podem mirar els logs del JBOSS (server.out):

*   /mnt/sto1/lhnfs/aoc/APP/logs/SC-BDSeu\_nodeX.log

Si veiem que es repeteix molt un error, que un node té molts més errors que l'altre, que es printa un error quan intentem fer el circuit, etc. Podem valorar el reinici.

  

Revisió del servidor
====================

Per obtenir informació del servei i la memòria:

**Informació del servei**

system info

Per obtenir informació de la CPU (equivalent a un top) → La CPU normal és 30-50%. Si el servei està aixecat hauríem de veure un Tomcat i un JBOSS

**Informació del servei**

system status

Per obtenir informació de les connexions actives (equivalent a un netstat)

**Informació de les connexions actives**

net conections

  

Revisió del servei
==================

Entrar per consola admin (web) als dos nodes:

*   Node 1: [https://10.120.1.125:8080/trustedx-console/login.xhtml](https://10.120.1.125:8080/trustedx-console/login.xhtml)
    
*   Node 2: [https://10.120.1.24:8080/trustedx-console/login.xhtml](https://10.120.1.24:8080/trustedx-console/login.xhtml)
    

S'hi ha d'accedir amb Usuari i contrasenya. Són usuaris nominals, que podem trobar a: [SSC (TrustedX) - FLUX DEL SERVEI - Executar l'script de càrreg](https://confluence.aoc.cat/pages/viewpage.action?pageId=26313647)

Reinici del JBOSS

Per revisar via Shell abans de reiniciar tenim les comandes:

**system info**: memòria, etc.  
**system status**: equival al top. La CPU normal és 30-50%. Si el servei està aixecat hauríem de veure un Tomcat i un JBOSS  
**net conections**: equival a un netstat

  

Si cal **reiniciar**...

**Reinici del node/s afectat/s**

service restart

Para ordenadament, processa tot el que ha de processar i arranca. És la opció preferible, tot i que és probable que falli.

Si el **service restart** no funciona, obrir paralel·lamet una altra consola del Putty i fer:

**Matar el servei**

service kill

Quan haguem matat el servei, el primer **service restart** que hem fet detectarà que ja s'ha matat el servei i l'aixecarà.

Estàs revisant el SSC de NEXICA --→ Ja està tancat

  

Revisió de la consola
=====================

* * *

**Entrar per consola admin (web) als dos nodes**:

*   Node 1: [https://10.123.6.66:8080/trustedx-console/login.xhtml](https://10.123.6.66:8080/trustedx-console/login.xhtml)
*   Node 2: [https://10.123.6.67:8080/trustedx-console/login.xhtml](https://10.123.6.67:8080/trustedx-console/login.xhtml)

S'hi ha d'accedir amb Usuari i contrasenya. Són usuaris nominals, que podem trobar al Keepass. Les persones que tenim usuari som: Joan Riquelme, Oriol Bernal

Si podem entrar-hi, en principi el TrustedX funciona correctament. Tot i això, indiquem informació de revisió més al detall.

A la pestanya **Auditoria**, podem trobar logs i estadístiques:

Estadístiques

  

Important!

La pestanya ESTADÍSTIQUES és única per cada node. Per veure les estadístiques del node 1, hem d'accedir a la consola admin del node 1. Idem pel node 2.

**Hora de l'última petició que ha entrat**. Comprovar, per exemple si coincideix amb alguna intervenció. 

**Temps mig de resposta**. Els temps quan funciona correctament haurien de ser d'1 segon aproximadament, o menys.

Podem **reiniciar les estadístiques** clicant al botó _Reiniciar_ de la cantonada inferior dreta. Això pot ser útil després de fer un reinici, per exemple.  
![](attachments/41522006/41522009.png)

Logs

Important!

La pestanya LOGS conté dades dels dos nodes, ja que es consulten a BBDD.

És aconsellable filtrar el **període** dels logs als últims 15 minuts, degut a la gran volumetria d'aquest servei.

A la columna LEVEL veiem el tipus de log que és (INFO, WARN, ERROR...). Podem filtrar per un tipus d'error o un altre escollint a **Tipo de log**.

![](attachments/41522006/41522008.png)

  

Si veiem molts logs del tipus ERROR seguits, significa que el servei no funciona correctament. Pot ser que el TrustedX estigui malament o també que ho estigui algun component extern (PSIS, BDD, etc.)

Tasques en procés

Des de la web també podem revisar les tasques en procés. Haurem de validar que el nombre de tasques no siguin molt elevat:![](attachments/41522006/41522007.png)

  

**OBS**: Normalment si es pot entrar a la consola admin vol dir que el TrustedX està bé, i el més probable és que sigui un tema de rendiment o d'un component extern.

BACK
====

Connexió amb el servidor

  

Connectar-nos via SSH, no via SFTP.

Si amb la VPN no tenim connexió, ho podem provar des de la màquina de l'AOC

Servidors 
==========

*   Node1: **aoc-cl-ssc-01-pro → 10.123.6.66**
    
*   Node2: **aoc-cl-ssc-02-pro** **→ 10.123.6.67**
*   User: **admin**

*   Node1: **aoc-cl-ssc-01-pre → 10.123.67.10**
    
*   Node2: **aoc-cl-ssc-02-pre** **→ 10.123.67.11**
*   User: **admin**

Connectar-nos via SSH, no via SFTP.

Com connectar-se via SSH

Obrir el CMD i executar la comanda PUTTY:  
![](attachments/41521975/41521988.png)

Omplir amb la IP que toca i marcar SSH.

Revisió del JBOSS

Revisió dels logs
=================

(PER DOCUMENTAR)

Revisió del servidor
====================

(PER REVISAR)

Per obtenir informació del servei i la memòria:

**Informació del servei**

system info

Per obtenir informació de la CPU (equivalent a un top) → La CPU normal és 30-50%. Si el servei està aixecat hauríem de veure un Tomcat i un JBOSS

**Informació del servei**

system status

Per obtenir informació de les connexions actives (equivalent a un netstat)

**Informació de les connexions actives**

net conections

  

Revisió del servei
==================

(PER DOCUMENTAR)

  

Reinici del JBOSS

(PER REVISAR)

Per revisar via Shell abans de reiniciar tenim les comandes:

**system diagnostic stats:** Per cadascún dels serveis de trustedx, retorna el consum de mem, cpu. i/o...

**service info:** Per cadascún dels serveis de trustedx, retorna el seu estat (healthy, failed, stopped etc) com es mostra a continuació:

**Resultat de executar la comanda service info** Expand source

Service name Status
trustedx-deployment-tools healthy
trustedx-hsqldb healthy
trustedx-infinispan healthy
trustedx-jboss healthy
trustedx-monitoring-collectors healthy
trustedx-net-snmp healthy
trustedx-nshield healthy
trustedx-rsyslog healthy
trustedx-tomcat healthy

**system info**: memòria, etc.  
**system status**: equival al top. La CPU normal és 30-50%. Si el servei està aixecat hauríem de veure un Tomcat i un JBOSS  
**net conections**: equival a un netstat

  

Si cal **reiniciar**...

**Reinici del node/s afectat/s**

service restart

Para ordenadament, processa tot el que ha de processar i arranca. És la opció preferible, tot i que és probable que falli.

Si el **service restart** no funciona, obrir paralel·lamet una altra consola del Putty i fer:

**Matar el servei**

service kill

Quan haguem matat el servei, el primer **service restart** que hem fet detectarà que ja s'ha matat el servei i l'aixecarà.

Fallback si el procediment anterior no funciona
===============================================

![(warning)](images/icons/emoticons/warning.svg) El dia 31/08/23 es va intentar reiniciar el servei amb el procediment, i ni el kill ni el restart van funcionar. Finalment en David cos va treure els elements del cluster i va poder aleshores reiniciar-los de forma individual sense problema:

**Treure els nodes del cluster**

cluster node list // ens retorns la llista de IPs del cluster
cluster node delete <IP> // indicant 1 per 1 les IPs del llistat

Un cop fet això en principi s'hauria de poder reiniciar sense problema.

NOTA: Un cop passada la incidència, s'hauria de contactar amb David Cos perquè torni a crear el cluster o que ens indiqui com fer-ho.

INFO ADDICIONAL:  [ST-20477](https://contacte.aoc.cat/browse/ST-20477?src=confmacro) - Data cannot be retrieved due to an unexpected error.

  

  

  

  

Attachments:
------------

![](images/icons/bullet_blue.gif) [image2019-3-4\_17-39-16.png](attachments/36340764/36340765.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2019-3-4\_17-39-51.png](attachments/36340764/36340766.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2019-3-4\_17-30-58.png](attachments/36340764/36340767.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2020-2-17\_17-58-41.png](attachments/36340764/36340768.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2019-12-2\_13-19-39.png](attachments/36340764/36340769.png) (image/png)  

Document generated by Confluence on 02 June 2025 11:15

[Atlassian](http://www.atlassian.com/)