Suport Tècnic : VO - VIDA LABORAL- FLUX DEL SERVEI - ERRORS - More than one result was returned from Query.getSingleResult()  

1.  [Suport Tècnic](index.html)
2.  [Suport Tècnic](13893782.html)
3.  [02 - FAQ's serveis](26313393.html)
4.  [FAQ's VO](28705575.html)
5.  [FAQ's VO - ESTAT](28705579.html)
6.  [VO - TGSS](VO---TGSS_36340977.html)

Suport Tècnic : VO - VIDA LABORAL- FLUX DEL SERVEI - ERRORS - More than one result was returned from Query.getSingleResult()
============================================================================================================================

Created by Cristian Morales, last modified on 12 January 2024

  

Cerquem la petició al SIRI:

select \* from siri.aoc\_pci\_siri\_registre r
where r.codi\_producte = 'TGSS\_VIDA\_LABORAL'
and r.codi\_organisme = '824575017'
and r.codi\_modalitat = 'VIDA\_LABORAL'
and r.data\_entrada >= to\_Date ('27/01/2020','dd/mm/yyyy');

Amb el ID\_PETICIO cerquem als logs de TGSS - VIDA LABORAL

IP: SOA PCI3 (_10.120.1.163_)

Ruta:  _/mnt/storage30/aoc/IOP/logs/MC-TGSS-MINHAP\_IOPNODO?\_SOA.log_

Busquem per data i hora/ INE10 de l'ens o ID\_PETICIO que ha fet la petició XML.  Hauríem de **trobar l'XML de petició i l'error**.

L'error que tractem en aquesta FAQ és:

**Error que trobem als logs**

11 Jan 2024 07:26:00,414 ERROR TGSSModalitats : javax.persistence.NonUniqueResultException: More than one result was returned from Query.getSingleResult()
        at org.eclipse.persistence.internal.jpa.QueryImpl.throwNonUniqueResultException(QueryImpl.java:985)
        at org.eclipse.persistence.internal.jpa.QueryImpl.getSingleResult(QueryImpl.java:534)
        at org.eclipse.persistence.internal.jpa.EJBQueryImpl.getSingleResult(EJBQueryImpl.java:400)
        at cat.aoc.pci30.core.entities.DIR3.getDIR3(DIR3.java:45)

Podem veure  que es tracta d'un **error el qual veu que tenim 2 DIR3 pel mateix ine10.**

Per tant, realitzarem les següents **comprovacions a la Base de Dades del DIR3**:

Username: DIR3  
Database: ORA12PRO  
Password: Keepass

**Comprovem quants DIR3 hi ha associats a l'ens i si estan actius**

SELECT COD\_EXTERNO, CODIGO
  FROM DIR3\_UNIDAD\_ORGANICA
 WHERE COD\_EXTERNO = 'XXXXXXXXXX' -- 10 dígits (CODI INE).
   AND ESTADO IN ('V', 'T');
 
Ex: Codi INE d'exemple 0819445020

Amb aquesta QUERY revisem:

*   Quants DIR3 hi ha associats a un mateix ine10
*   Quin és l'estat d'aquests DIR3 (V/A) (Vigente/Anulado)

Si obtenim dades en la consulta amb el INE10 duplicat, es a dir 2 DIR3 fierents amb el mateix INE10, aquesta es la causa del error, hem de veure quin es el dir3 correcte i l'altre updatejar-lo →  **[DIR3- FLUX DEL SERVEI - Actualitzar el DIR3 amb dades d'un nou ens que no surt#ModificarProceduresDIR3](64980222.html#DIR3FLUXDELSERVEIActualitzarelDIR3ambdadesd'unnouensquenosurt-ModificarProceduresDIR3)**

  

  

**En el cas de no estar el DIR3 : [DIR3- FLUX DEL SERVEI - Actualitzar el DIR3 amb dades d'un nou ens que no surt#ModificarProceduresDIR3](64980222.html#DIR3FLUXDELSERVEIActualitzarelDIR3ambdadesd'unnouensquenosurt-ModificarProceduresDIR3)**

  

A tindre en compte

El funcionament amb aquest servei és:

Agafa el INE10 del XML (en el cas de tindre "0" a l'esquerra els afegeix) i el cerca en la taula :

select \* from dir3.dir3\_2\_ine10\_uo ou
where ou.dir3='A09006701' ;

Una vegada l'ha cercat, valida que estigui en la següent taula i estigui vigent (V):

select \* from dir3.dir3\_unidad\_organica a 
where a.denominacion like '%Generalitat de Cat%'; 

En el cas de PICA, si el INE10 informat es "PICA", el transformarà a l'INE10 de la Gene "000000001" i farà la mateixa cerca.

\---dir3 TGSS\_VIDA\_LABORAL GENE, ha d'estar rel·lacionada la taula dir3.dir3\_unidad\_organica a amb dir3.dir3\_2\_ine10\_uo ou i que estigui Vigent
select \* from dir3.dir3\_unidad\_organica a  -- cerquem si està en aquesta taula i agafem el COD\_UNIDAD\_RAIZ
where a.denominacion like '%Generalitat de Cat%'; --A09006701 (para PRE)  ha d'estar Vigent (V)

select \* from dir3.dir3\_2\_ine10\_uo ou
where ou.dir3='A09006701' ;

query que realitza el codi:

public String getDIR3 (String ine10) throws Exception {  
      EntityManager em = null;  
    try {  
      em = EntityManagerFactoryHolder.getInstance().getEntityManager(DIR3\_PU).createEntityManager();  
      Query qry = em.createNativeQuery("SELECT CODIGO FROM DIR3\_UNIDAD\_ORGANICA WHERE COD\_EXTERNO=? AND ESTADO IN ('V','T')");  
      qry.setParameter(1,"PICA".equals(ine10) ? "0000000001" : String.format("%010d",Long.valueOf(ine10)));  
      return (String)qry.getSingleResult();        
    }  
    finally {  
      if (null != em) em.close();  
    }  
  
  }//getDIR3

  

  

  

  

ZD Relacionats: ZD#167666

  

Attachments:
------------

![](images/icons/bullet_blue.gif) [image2020-10-8\_10-23-2.png](attachments/100008723/100008724.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2020-10-8\_10-22-43.png](attachments/100008723/100008725.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2020-10-8\_10-21-57.png](attachments/100008723/100008726.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2020-10-8\_10-19-43.png](attachments/100008723/100008727.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2020-10-8\_10-17-24.png](attachments/100008723/100008728.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2020-10-8\_10-17-8.png](attachments/100008723/100008729.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2020-8-6\_11-27-13.png](attachments/100008723/100008730.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2020-8-6\_11-26-40.png](attachments/100008723/100008731.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2020-1-28\_11-48-46.png](attachments/100008723/100008732.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2020-1-28\_11-18-45.png](attachments/100008723/100008733.png) (image/png)  

Document generated by Confluence on 02 June 2025 11:02

[Atlassian](http://www.atlassian.com/)