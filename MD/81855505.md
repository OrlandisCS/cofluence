Suport Tècnic : Monitor S.T. - PADRO - Extracció IDESCAT  

1.  [Suport Tècnic](index.html)
2.  [Suport Tècnic](13893782.html)
3.  [03 - Monitorització - Revisions globals](26313327.html)
4.  [Monitors S.T.](Monitors-S.T._41522177.html)

Suport Tècnic : Monitor S.T. - PADRO - Extracció IDESCAT
========================================================

Created by Unknown User (otecobernal), last modified on 22 February 2023

[ST-18912](https://contacte.aoc.cat/browse/ST-18912?src=confmacro) - Data cannot be retrieved due to an unexpected error.

Què mesura aquest monitor?

En el marc del Conveni que tenim amb IDESCAT els hem de traslladar anualment la relació detallada de les transaccions efectuades per cada entitat. És per això que us sol·licitem l'extracció de les mateixes per poder facilitar-lis la informació.

**Extracció**
=============

* * *

Haurem de canviar l'any 2022 per l'any en el qual vulguem fer-la (normalment any anterior).

  

\--Resum:
select CASE tipus\_volant
         WHEN 1 THEN
          'Convivència'
         WHEN 0 THEN
          'Padró '
         ELSE
          '?'
       END as Volant,
       count(id) Peticions
  from mcpciiop.aoc\_mcpadro\_registre
 where codi\_municipi = 999
   and codi\_provincia = 99
   and EXTRACT(YEAR FROM data) = 2022
 group by tipus\_volant;
 
--Consums per ens:
select ens.uen\_nom\_complert "Nom",
       CONVIVENCIA.ens\_c "Codi\_Ens",
       CONVIVENCIA.Peticions "Convivència",
       PADRO.Peticions "Padró",
       CONVIVENCIA.Peticions + PADRO.Peticions "Total"
  from (select aplicacio ens\_c, count(id) Peticions
          from mcpciiop.aoc\_mcpadro\_registre registre
         where codi\_municipi = 999
           and codi\_provincia = 99
           and EXTRACT(YEAR FROM data) = 2022
           and tipus\_volant = 1 -- convivència
         group by tipus\_volant, aplicacio) CONVIVENCIA,
       (select aplicacio ens\_p, count(id) Peticions
          from mcpciiop.aoc\_mcpadro\_registre registre
         where codi\_municipi = 999
           and codi\_provincia = 99
           and EXTRACT(YEAR FROM data) = 2022
           and tipus\_volant = 0 -- padró
         group by tipus\_volant, aplicacio) PADRO,
       usu\_ens ens
 where CONVIVENCIA.ens\_c = ens.uen\_codi\_10
   and PADRO.ens\_p = ens.uen\_codi\_10
   and CONVIVENCIA.ens\_c = PADRO.ens\_p
 order by CONVIVENCIA.Peticions + PADRO.Peticions desc;
 
--Tots els consums:
select CASE tipus\_volant
         WHEN 1 THEN
          'Convivència'
         WHEN 0 THEN
          'Padró '
         ELSE
          '?'
       END as "Volant",
       r.\*
  from mcpciiop.aoc\_mcpadro\_registre r
 where codi\_municipi = 999
   and codi\_provincia = 99
   and EXTRACT(YEAR FROM data) = 2022;

**Procediment**
===============

* * *

Generalment, hi ha massa dades per fer l'extracció amb una única consulta. Podem dividir-la per mes:

Executar les consultes i exportar-les en format Excel.

Desar els resultats al sharepoint: **_Consorci Administració Oberta de Catalunya\\Tecnologia - SUPORT\_TECNIC\\SEGUIMENT\\09 Extracció IDESCAT_**

Crear un Jira seguint el format dels anys anteriors:

*   [ST-4321](https://contacte.aoc.cat/browse/ST-4321) Dades IDESCAT 2018
*   [ST-7671](https://contacte.aoc.cat/browse/ST-7671) Dades IDESCAT 2019
*   [ST-16279](https://contacte.aoc.cat/browse/ST-16279) Dades IDESCAT 2020
*   [ST-16301](https://contacte.aoc.cat/browse/ST-16301) Dades IDESCAT 2021
*   ST-18923 Dades IDESCAT 2022

**Informació addicional**
=========================

Generalment hi ha masses consums com per extreure'ls tots a la vegada. Podem dividir la consulta per cada mes:

  

\--Tots els consums separats per mes:
select CASE tipus\_volant
         WHEN 1 THEN
          'Convivència'
         WHEN 0 THEN
          'Padró '
         ELSE
          '?'
       END as "Volant",
       r.\*
  from mcpciiop.aoc\_mcpadro\_registre r
 where codi\_municipi = 999
   and codi\_provincia = 99
   and EXTRACT(YEAR FROM data) = 2022
   and EXTRACT(MONTH FROM data) = 1;
   
   select CASE tipus\_volant
         WHEN 1 THEN
          'Convivència'
         WHEN 0 THEN
          'Padró '
         ELSE
          '?'
       END as "Volant",
       r.\*
  from mcpciiop.aoc\_mcpadro\_registre r
 where codi\_municipi = 999
   and codi\_provincia = 99
   and EXTRACT(YEAR FROM data) = 2022
   and EXTRACT(MONTH FROM data) = 2;
   
   select CASE tipus\_volant
         WHEN 1 THEN
          'Convivència'
         WHEN 0 THEN
          'Padró '
         ELSE
          '?'
       END as "Volant",
       r.\*
  from mcpciiop.aoc\_mcpadro\_registre r
 where codi\_municipi = 999
   and codi\_provincia = 99
   and EXTRACT(YEAR FROM data) = 2022
   and EXTRACT(MONTH FROM data) = 3;
   
   select CASE tipus\_volant
         WHEN 1 THEN
          'Convivència'
         WHEN 0 THEN
          'Padró '
         ELSE
          '?'
       END as "Volant",
       r.\*
  from mcpciiop.aoc\_mcpadro\_registre r
 where codi\_municipi = 999
   and codi\_provincia = 99
   and EXTRACT(YEAR FROM data) = 2022
   and EXTRACT(MONTH FROM data) = 4;
   
   select CASE tipus\_volant
         WHEN 1 THEN
          'Convivència'
         WHEN 0 THEN
          'Padró '
         ELSE
          '?'
       END as "Volant",
       r.\*
  from mcpciiop.aoc\_mcpadro\_registre r
 where codi\_municipi = 999
   and codi\_provincia = 99
   and EXTRACT(YEAR FROM data) = 2022
   and EXTRACT(MONTH FROM data) = 5;
   
   select CASE tipus\_volant
         WHEN 1 THEN
          'Convivència'
         WHEN 0 THEN
          'Padró '
         ELSE
          '?'
       END as "Volant",
       r.\*
  from mcpciiop.aoc\_mcpadro\_registre r
 where codi\_municipi = 999
   and codi\_provincia = 99
   and EXTRACT(YEAR FROM data) = 2022
   and EXTRACT(MONTH FROM data) = 6;
   
   select CASE tipus\_volant
         WHEN 1 THEN
          'Convivència'
         WHEN 0 THEN
          'Padró '
         ELSE
          '?'
       END as "Volant",
       r.\*
  from mcpciiop.aoc\_mcpadro\_registre r
 where codi\_municipi = 999
   and codi\_provincia = 99
   and EXTRACT(YEAR FROM data) = 2022
   and EXTRACT(MONTH FROM data) = 7;
   
   select CASE tipus\_volant
         WHEN 1 THEN
          'Convivència'
         WHEN 0 THEN
          'Padró '
         ELSE
          '?'
       END as "Volant",
       r.\*
  from mcpciiop.aoc\_mcpadro\_registre r
 where codi\_municipi = 999
   and codi\_provincia = 99
   and EXTRACT(YEAR FROM data) = 2022
   and EXTRACT(MONTH FROM data) = 8;
   
   select CASE tipus\_volant
         WHEN 1 THEN
          'Convivència'
         WHEN 0 THEN
          'Padró '
         ELSE
          '?'
       END as "Volant",
       r.\*
  from mcpciiop.aoc\_mcpadro\_registre r
 where codi\_municipi = 999
   and codi\_provincia = 99
   and EXTRACT(YEAR FROM data) = 2022
   and EXTRACT(MONTH FROM data) = 9;
   
   select CASE tipus\_volant
         WHEN 1 THEN
          'Convivència'
         WHEN 0 THEN
          'Padró '
         ELSE
          '?'
       END as "Volant",
       r.\*
  from mcpciiop.aoc\_mcpadro\_registre r
 where codi\_municipi = 999
   and codi\_provincia = 99
   and EXTRACT(YEAR FROM data) = 2022
   and EXTRACT(MONTH FROM data) = 10;
   
   select CASE tipus\_volant
         WHEN 1 THEN
          'Convivència'
         WHEN 0 THEN
          'Padró '
         ELSE
          '?'
       END as "Volant",
       r.\*
  from mcpciiop.aoc\_mcpadro\_registre r
 where codi\_municipi = 999
   and codi\_provincia = 99
   and EXTRACT(YEAR FROM data) = 2022
   and EXTRACT(MONTH FROM data) = 11;
   
   select CASE tipus\_volant
         WHEN 1 THEN
          'Convivència'
         WHEN 0 THEN
          'Padró '
         ELSE
          '?'
       END as "Volant",
       r.\*
  from mcpciiop.aoc\_mcpadro\_registre r
 where codi\_municipi = 999
   and codi\_provincia = 99
   and EXTRACT(YEAR FROM data) = 2022
   and EXTRACT(MONTH FROM data) = 12;

* * *

  

  

Attachments:
------------

![](images/icons/bullet_blue.gif) [CORPME - Procés d'alta de serveiSuport Tècnic16 marzo 2020Procediment a realitzar setmanalment per les altes del CORPME. Guia.url](attachments/81855505/81855506.url) (application/octet-stream)  
![](images/icons/bullet_blue.gif) [cds.gif](attachments/81855505/81855507.gif) (image/gif)  

Document generated by Confluence on 02 June 2025 11:09

[Atlassian](http://www.atlassian.com/)