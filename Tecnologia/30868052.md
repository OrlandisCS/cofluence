Suport Tècnic : e-VALISA – FLUX DEL SERVEI – ERRORS - Errors en accedir a e-Valisa  

1.  [Suport Tècnic](index.html)
2.  [Suport Tècnic](13893782.html)
3.  [02 - FAQ's serveis](26313393.html)
4.  [FAQ's eVALISA](28705569.html)

Suport Tècnic : e-VALISA – FLUX DEL SERVEI – ERRORS - Errors en accedir a e-Valisa
==================================================================================

Created by Unknown User (otecjriquelme), last modified by Joan Riquelme on 02 January 2025

En aquesta entrada de Confluence desglossarem tots els errors que tenim detectats a l'hora d'accedir a e-Valisa.

  

Error en accedir a eVALISA (usuari en TR MLO i amb dades d'accès GICAR)

Problema
--------

Usuari que no pot accedir a l'e-Valisa. Té accés a EACAT amb dades EACAT però vol accedir per GICAR.

Solució
-------

Si l'usuari te dades en EACAT per MLO, no podrà accedir a Valisa amb usuari GICAR (Certificat), però si que podria accedir per EACAT amb les dades del EACAT.

Realitzem les següents comprovacions:

select \* from usu\_usuari where identificador='40311418P'; -- Mirem si existeix l'usuari

select \* from USU\_USUENS where IdUsuari='40311418P'; -- Mirem a quina entitat està vinculat l'usuari i si és MLO


select \* from USU\_ENS where UEN\_CODI\_ENS='9913738000'; -- Mirem si l'entitat està activa

Revisant les consultes, veiem que abans sí que estava amb accés a EACAT amb 2 ens, això provoca que l'accés amb les dades de GICAR no funcionin, ja que és un usuari de MLO (Món Local) en comtes de EPC (ATRI).

Revisem logs de EACAT\_TR i traslladem amb aquesta informació a l'OT d'EACAT\_TR.

En el tiquet en particular la OT va indicar:

  

L'error en ConstrueixXmlInfoUsuari es devia a la pertinença de l'usuari a un ens inactiu.  
Hem solucionat aquest problema, i ara ConstrueixXmlInfoUsuari s'executa sense problemes.  
Podeu provar novament i avisar-nos i funciona correctament?  
Si l'error continua, hem de canviar l'usuari de tipus MLO a tipus EPC (Atri)

  

A tindre en comptes també: 

Si és un usuari MLO, no pot ingressar a EACAT amb la contrasenya de ATRI.  
Sincronitzar les contrasenyes no és una funció existent,  
L'única cosa que podria fer-se és llevar l'usuari MLO i crear un nou de tipus EPC (ATRI)

  

Revisar que el resultat de les consultes quadri amb el que esperem.

  

Related issues

FP#387696

Error en accedir a eVALISA (usuari en TR inactiu)

Problema
--------

Usuari que no pot accedir a l'e-Valisa. No té accés a EACAT però accedeix per GICAR.

Solució
-------

Revisar si existeix a un ens a TR inactiu

Realitzem les següents comprovacions:

select \* from usu\_usuari where identificador='40311418P'; -- Mirem si existeix l'usuari

select \* from USU\_USUENS where IdUsuari='40311418P'; -- Mirem a quina entitat està vinculat l'usuari

select \* from USU\_ENS where UEN\_CODI\_ENS='9913738000'; -- Mirem si la entitat està activa

Revisant les consultes, veiem que abans sí que estava amb accés a EACAT amb un ens que no està operatiu, això provoca que es faci un embolic l'accés amb les dades d'ENS i l'accés a GICAR i no permet entrar.

Revisar que el resultat de les consultes quadri amb el que esperem.

  

Related issues

FP#198547

Error en accedir a eVALISA Usuari sensible

Problema
--------

Usuari que no pot accedir a l'e-Valisa. No trobem dades en el DC → [e-VALISA – FLUX DEL SERVEI – Usuaris Sensibles](26313283.html)

Solució
-------

Revisar si es tracta d'un usuari sensivble, seguir la FAQ indicada.

S'ha de revisar si tenim dades en la taula :

select \*
  from valisauser a
 where a.nif = 'XXXXXXX';

SI les dades no són les d'un usuari sensible, probem de fer una cerca de l'usuari a través de Valisa tal com explica la FAQ: [e-VALISA – FLUX DEL SERVEI – ERRORS - Usuari en enviar la Valisa no surt al D.C](26313659.html)

  

Related issues

FP#404889 

Error accés - Revisió general

Problema
--------

Ens retorna un error d'unitat per accedir a l'e-VALISA

Solució
-------

  

Realitzem les següents passes:  
  

1.  Fer cerca al GICAR, verifiquem que l'usuari (NIF) estigui en la consulta del D.C ([Soap-UI opció 3](https://steps.everis.com/confluence/download/attachments/1099324281/ServeisComuns_DirectoriCorporatiu-soapui-project.xml?version=1&modificationDate=1512489495000&api=v2))
2.  Fem les següents consultes per BBDD per verificar que estigui la Unitat Menor informada:  
      
    
    \--cerquem usuari a l'eValisa
    select \* from lportal.valisauser a
    where a.nif = '39667010Z';
    
    --verifiquem que estigui la unitat menor informada i activada (1):
    
    select \* from lportal.valisaunitatmenor r
    where r.valisaunitatmenorid = '1OCPR070';
    
    
    --verifiquem que existeix a l'EACAT
    
    select \* from usu\_usuari a
    where a.identificador = '39667010Z';
    
3.  Ens impersonem i verifiquem que podem accedir.  
      
    
    \- Si l'usuari està donat d'alta a EACAT, i accedeixen per GICAR es pot pisar l'usuari, en aquest cas comentar amb David Tejada.
    
    \- Altre error pot ser per causa d'accés per certificat (en accedir amb certificat no obtenim les dades que apareixen de GICAR i per aquest motiu no ubica correctament a la usuària en la seva organització)., en aquest cas hem de comentar que provi d'accedir amb usuari de GICAR per la URL: ([http://idpeacat.gencat.cat/group/1/valisa](http://idpeacat.gencat.cat/group/1/valisa) )
    

  

  

Related articles
----------------

  

Related issues

FP#191698 

  

Error, S'ha produït una excepció

L'usuari introdueix user i password i obté un error: "Error, s'ha produït una excepció".  
  
Revisar en els logs que trobarem a la màquina aoc-w-etram-pro1 (**10.120.1.231**) en la carpeta: **\\\\10.120.1.160\\storage\\eacattr\\LOG\\W2016TR**

![](https://intranet.aoc.cat/plugins/servlet/confluence/placeholder/unknown-attachment?locale=es_ES&version=2)

![](https://intranet.aoc.cat/plugins/servlet/confluence/placeholder/unknown-attachment?locale=es_ES&version=2)

  

Revisió + Solució
-----------------

Cerquem als logs de EACAT TR. Podem veure com revisar aquests logs en la FAQ: [EACAT\_TR - Revisió logs TR](26313435.html)

En aquests logs revisem si veiem el literal d'error següent:

**Literal error**

13:48:23	EACATTR-PRO-LG1.AOCPRO64.internal	ADMIN	00000	3	52395279Z	0	MotorWSSO.AutenticaUsuari('','52395279Z',xxx,'',0) -> \[Col·lectiu: MLO\] OK -  - 		\[SH\_Admin\_WS, Version=1.0.7079.17925, Culture=neutral, PublicKeyToken=null\]	\[N/A\]
13:48:24	EACATTR-PRO-PR3.AOCPRO64.internal	IDP	00000	1	SSO	0	%%SSO\_DEBUG%%:%%ArtifactResolutionService.  aspx%% Recibida la petición de artifactId '09139079-e07a-43df-9d80-09eca0aed439'		\[siid-idp, Version=0.0.0.0, Culture=neutral, PublicKeyToken=null\]	\[edrvvzbn2ylg0dxfbv5f413g\]
13:48:25	EACATTR-PRO-LG2.AOCPRO64.internal	ObtenirIdNomMailIIdCarrec	00000	0	77914801R	0	conexion cerrada		\[SH\_EACAT\_PL\_WS, Version=0.0.0.0, Culture=neutral, PublicKeyToken=null\]	\[N/A\]
13:48:25	EACATTR-PRO-LG4.AOCPRO64.internal	ADMIN	00000	1	46974247J	0	MotorUsuaris.ConstrueixXmlInfoUsuari('MLO','46974247J','Agnès Russiñol Amat','agnes.russinol@gencat.cat','1OABE048','INSTITUT CATALÀ DE L´ACOLLIMENT I DE L´ADOPC.') => ERROR: S'ha produït una excepció.\[System.Data.SqlClient.SqlException (0x80131904): Parent tag ID 2 is not among the open tags. FOR XML EXPLICIT requires parent tags to be opened first. Check the ordering of the result set.
   at System.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection)
   at System.Data.SqlClient.TdsParser.ThrowExceptionAndWarning()
   at System.Data.SqlClient.TdsParser.Run(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj)
   at System.Data.SqlClient.SqlDataReader.HasMoreRows()
   at System.Data.SqlClient.SqlDataReader.ReadInternal(Boolean setTimeout)
   at GENCAT.EACAT.Seguretat.MotorUsuaris.ConstrueixXmlInfoUsuari(String sIdColUsuari, String sIdUsuari, String sNomUsuari, String sEMailUsuari, String sLlocTreball, String sIdUnitatMenor, String sDescUnitatMenor)\]		\[SH\_Admin\_WS, Version=1.0.7079.17925, Culture=neutral, PublicKeyToken=null\]	\[N/A\]
13:48:25	EACATTR-PRO-LG4.AOCPRO64.internal	ADMIN	00000	1	46974247J	0	MotorWSSO.AutenticaUsuari('46974247J','Agnès Russiñol Amat','agnes.russinol@gencat.cat','BE','1OABE048','INSTITUT CATALÀ DE L´ACOLLIMENT I DE L´ADOPC.') -> ! IsValidXML
		\[SH\_Admin\_WS, Version=1.0.7079.17925, Culture=neutral, PublicKeyToken=null\]	\[N/A\]
13:48:25	EACATTR-PRO-PR4.AOCPRO64.internal	IDP	00000	1	SSO	0	Se ha producido un error al validar el usuario System.Exception: ERR\_EXCEPCIO
   at com.tecsidel.siid.commons.usuarios.ValidadorUsuariosSSO.isValid(String sUserIdSession, String appName, ICredencialUsuario credencial)		\[siid-idp, Version=0.0.0.0, Culture=neutral, PublicKeyToken=null\]	\[rv0n1qqlb13jbsmcbtaz2o1j\]

A la línia 4 veiem que hi ha un error de BBDD. Aquest error es dóna perquè la unitat a la que pertany el usuari està mal informada o té algun problema.

La resolució serà obrir un JIRA a EACAT TR explicant l'analisi i adjuntant els logs. indicarem també el DNI de l'usuari que no pot accedir.

![](https://intranet.aoc.cat/plugins/servlet/confluence/placeholder/unknown-attachment?locale=es_ES&version=2)

  
NOTA: També podem traslladar el cas a l'OT d'EACAT, informant de les dades que hem trobat, exemple:  
  
**MISSATGE TIPUS**  
  

Bon dia,

Traslladem a l'OT d'EACAT. Sembla el típic error que hem traslladat d'accés a Valisa.

És un usuari (78580257K) que ens surt com MLO i entenem que ha de ser EPC.

![](https://aoccat.zendesk.com/attachments/token/fU1sJac2JnFMEAWibEsYxWNx0/?name=image.png)

  
  

Related issues
--------------

FP #314207

JIRA exemple: [https://contacte.aoc.cat/browse/PRJ-4038](https://contacte.aoc.cat/browse/PRJ-4038)

  

Error accés - Usuari no surt al Directori Corporatiu

Problema
--------

L'usuari no apareix en el Directori Corporatiu quan busquem pel seu NIF (en aquest cas mitjançant el SoapUI).

  

![](attachments/30868052/41521478.png)

Solució
-------

Enviar missatge tipus informa'n a l'usuari que ha de contactar el GICAR.

**Misatge Tipus**

Bon dia,  
  
Us informem que hem validat que l'usuari amb DNI XXXXXX no apareix al DC (Directori Corporatiu de la Generalitat).  
  
Aquest cas l'heu de traslladar a GICAR o Recursos Humans per validar que us donin d'alta en GICAR.  
  
Salutacions cordials.

Error accés - Usuari no té unitatMajor informada o activa

Problema
--------

L'usuari no té l'unitatMajor informada en el Directori Corporatiu quan busquem pel seu NIF (en aquest cas mitjançant el SoapUI). Quan intenti accedir a eValisa hauria de rebre un error com aquest:

  

![](https://aoccat.zendesk.com/attachments/token/eJaznCoOgyRrzpNe9sKEVOgV1/?name=image.png)

  

També pot donar-se el cas de que estigui informada, però en la BBDD apareixca com inactiva:

  

![](https://aoccat.zendesk.com/attachments/token/gmRJX8uJPdRmZxVUXAM8DvenZ/?name=image.png)

Solució
-------

Traslladar al Cap de Servei i comentar el problema. Ja sigui que s'ha d'activar una unitatMajor o que hi ha que fer una càrrega/actualització de les unitatMajors actuals.

**Misatge Tipus**

Bon dia,  
  
Hem comprovat que els usuaris no poden accedir a eValisa perquè la unitatMajor que utilitzen, "**XXXXX**", està inactiva.  
  
Salutacions cordials.

  

  

Attachments:
------------

![](images/icons/bullet_blue.gif) [image2019-11-27\_11-29-19.png](attachments/30868052/30868054.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2019-11-27\_11-30-53.png](attachments/30868052/30868055.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2019-11-27\_11-38-15.png](attachments/30868052/30868057.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2020-11-19\_11-51-53.png](attachments/30868052/41519882.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2021-2-16\_14-55-21.png](attachments/30868052/41521478.png) (image/png)  

Document generated by Confluence on 02 June 2025 10:54

[Atlassian](http://www.atlassian.com/)