Suport Tècnic : EACAT - PL4 - Reinici  

1.  [Suport Tècnic](index.html)
2.  [Suport Tècnic](13893782.html)
3.  [04 - Tècnica de sistemes + 24x7 + Padró](26313202.html)
4.  [Plataformes](Plataformes_41520520.html)
5.  [z\_OLD\_](z_OLD__118554696.html)
6.  [EACAT - PL4](EACAT---PL4_41520625.html)

Suport Tècnic : EACAT - PL4 - Reinici
=====================================

Created by Unknown User (otecobernal), last modified by Unknown User (otecjriquelme) on 20 December 2021

**Màquines donades de baixa**

S'han aturat definitivament els Tomcat del PL4. Cap servei actiu doncs hauria de dependre d'aquestes màquines (Data: 16/12/2021)

Mantenim la documentació per precaució.

Pas 0: Crear i guardar els Dumps per a Sistemes - **Només** si ens ho demanen
-----------------------------------------------------------------------------

  

**HeapDump**

Abans de reiniciar,  hem  d'extreure el HeapDump.

La idea és treure'n 4, però només ho farem en cas que només hi hagi un node afectat.

Executem el següent script, que ens traurà 4 HeapDumps separant-los 30 segons

cd /apps/liferay-tomcat/scripts
./4\_heapDump\_30segons.sh

Esperem a que acabi abans de procedir amb el reinici.

Els guardarà a la ruta _/apps/liferay-tomcat/dumps/_ acordada amb sistemes.

Executem la següent comanda i esperem que acabi abans de prosseguir amb el reinici...

/apps/versions/jdk1.6.0\_22/bin/jmap -F -dump:format=b,file=/apps/liferay-tomcat/dumps/heapdump.hprof\`date +%Y-%m-%d\_%T \` \`ps -ef | grep java | grep catalina | grep -v grep | awk '{print $2}'\`

Aquesta comanda crearà el HeapDump i el guardarà a la ruta _/apps/liferay-tomcat/dumps/_ acordada amb sistemes.

Reinici
-------

Per aturar el liferay, podem executar la següent comanda i esperar el missatge de confirmació: **Stopping Coyote HTTP/1.1 on http-8080**

**Aturar el LIFERAY**

/etc/init.d/liferay stop && tail -f /apps/liferay-tomcat/logs/catalina.out

![image2019-6-3_13-32-14.png](https://intranet.aoc.cat/download/attachments/26313311/image2019-6-3_13-32-14.png?version=1&modificationDate=1559561534000&api=v2)

  

Un error molt comú és confiar en que el servei ha quedat realment aturat, haurem de forçar l'aturada del seu procés si aquest encara segueix viu:

**Revisar el procés**

ps aux | grep -i tomcat

  

*   Per eliminar el procés (en cas que amb l'stop no s'elimini) es pot executar un kill on **XXXX** serà l'**id** del **procés**:
    
    **Matar el procés (només si cal)**
    
    kill "XXXX"
    
*   Si la comanda no funciona després de 3 o 4 intents:
    
    **Matar el procés forçant-lo (només si cal)**
    
    kill -9 "XXXX"
    

  

És recomanable esborrar els directoris **work** i **temp**: 

**Esborrar temporals**

cd /apps/liferay-tomcat/
rm -rf /work/\*
rm -rf /temp/\*

  

També és recomanable netejar l'arxiu de log i crear-ne un de nou (seguint l'estil de dates dels altres logs): 

**Netejar log**

mv /apps/liferay-tomcat/logs/catalina.out /apps/liferay-tomcat/logs/catalina\_XXXXXdataXXXXX.out

  

Un cop el tomcat estigui aturat, es podrà aixecar:

**Aixecar el LIFERAY**

/etc/init.d/liferay start && tail -f /apps/liferay-tomcat/logs/catalina.out

i esperem que els logs del catalina.out ens mostrin com el tomcat s'ha aixecat: **Server startup in XXXXXX ms**

![image2019-6-3_13-37-28.png](https://intranet.aoc.cat/download/attachments/26313311/image2019-6-3_13-37-28.png?version=1&modificationDate=1559561848000&api=v2)

Document generated by Confluence on 02 June 2025 11:17

[Atlassian](http://www.atlassian.com/)