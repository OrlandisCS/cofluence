Suport Tècnic : Monitor S.T. - REPRESENTA - Notificacions representa que no s'han enviat  

1.  [Suport Tècnic](index.html)
2.  [Suport Tècnic](13893782.html)
3.  [03 - Monitorització - Revisions globals](26313327.html)
4.  [Monitors S.T.](Monitors-S.T._41522177.html)
5.  [Monitors S.T. - REPRESENTA](Monitors-S.T.---REPRESENTA_128647237.html)

Suport Tècnic : Monitor S.T. - REPRESENTA - Notificacions representa que no s'han enviat
========================================================================================

Created by Unknown User (otecobernal), last modified by Joan Riquelme on 16 April 2025

_**S'ha afegit a la query una nova restricció "p.correuelectronic is not null" ja que els casos on està el camp a nul no es poden processar. Estem a la espera que el desenvolupadro ens digui alguna cosa ( [PRJ-7669](https://contacte.aoc.cat/browse/PRJ-7669?src=confmacro) - Data cannot be retrieved due to an unexpected error. ).**_

Què mesura aquest monitor?

Quan un **poderdant** té habilitat a un **representant** i aquest actua en el seu nom, s'envia una notificació indicant que l'operació s'ha realitzat correctament.

Els poderdants poden tenir les notificacions activades o desactivades, segons les seves preferències

El següent monitor conta el nombre de notificacions que no s'han pogut realitzar després de 3 reintents a aquells poderdants que tenen les notificacions activades.

**Consulta**
============

* * *

SELECT count(n.UUID) REGISTRES
FROM REPRESENTA.R\_NOTIFICACIO n, REPRESENTA.R\_PERSONA p
WHERE n.destinatari\_uuid = p.uuid
   AND n.ENVIAT = 0
   AND n.IN\_PROGRESS = 0
   AND n.REINTENTS = 3
   AND n.DATAENVIAMENT\_PLANIFICAT <= current\_timestamp
   AND n.DATAENVIAMENT\_PLANIFICAT > current\_timestamp-60
   AND p.accepta\_avisos = 1
   AND p.correuelectronic is not null
   AND via='MAIL'

**Procediment**
===============

* * *

Actuarem quan hi hagi més de 5 signatures en estat d'error.

Per tal de revisar les alertes haurem de realitzar les següents passes:

### 1) Executar la següent consulta per extreure els UUID dels registres no notificats:

SELECT N.\*
FROM REPRESENTA.R\_NOTIFICACIO n, REPRESENTA.R\_PERSONA p
WHERE n.destinatari\_uuid = p.uuid
   AND n.ENVIAT = 0
   AND n.IN\_PROGRESS = 0
   AND n.REINTENTS = 3
   AND n.DATAENVIAMENT\_PLANIFICAT <= current\_timestamp
   AND n.DATAENVIAMENT\_PLANIFICAT > current\_timestamp-60
   AND p.accepta\_avisos = 1
   AND p.correuelectronic is not null
   AND via='MAIL';

### 2) Reiniciar les notificacions no enviades

Agafarem els UUID de l'anterior consulta, i en farem un update amb la següent query:

Executar el següent update:

UPDATE R\_NOTIFICACIO SET REINTENTS = 0, ENVIAT = 0 WHERE UUID IN ('354454','243234','792243');

Un cop reiniciades, ens haurem d'assegurar que l'RDBMS **REPRESENTA-NOTIFICACIO** les processa correctament.

### 3) Comentar-ho internament amb el responsable del projecte

Si després d'aplicar el procediment, les notificacions segueixen arribant a 3 reintents, podrem obrir un Jira a Desenvolupament (Jordi Florit) o mencionar-lo si ja tenim un tiquet obert, per tal de revisar sobre com procedir en aquests casos.

**Informació addicional**
=========================

* * *

### 1) Revisió de logs

Podrem trobar els logs a les rutes:

*   /aoc/apps/APP/logs/Representa\_APPNODO1\_SOA**.**log
*   /aoc/apps/APP/logs/Representa-portal\_tomcat8-01.log

### 2) Servidors

Servidors 
==========

*   Node1: **aoc-l-soa01 → 10.120.1.163 [](https://pam.aoc.cat/SecretServer/app/#/secrets/4785/general)** 
    
*   Node2: **aoc-l-soa02 → 10.120.1.164 [](https://pam.aoc.cat/SecretServer/app/#/secrets/4786/general)** 
*   Node3: **aoc-l-soa03 → 10.120.1.172 [](https://pam.aoc.cat/SecretServer/app/#/secrets/4787/general)** 
*   User: **soa**  
    

 Admin: **[http://10.120.1.163:7001/console/login/LoginForm.jsp](http://10.120.1.163:7001/console/login/LoginForm.jsp)[](https://pam.aoc.cat/SecretServer/app/#/secrets/4777/general)**

*   Node1: **aoc-l-soa01-pre → 10.120.2.125 [](https://pam.aoc.cat/SecretServer/app/#/secrets/4745/general)** 
    
*   Node2: **aoc-l-soa02-pre → 10.120.2.126 [](https://pam.aoc.cat/SecretServer/app/#/secrets/4744/general)** 
*   Node3: **aoc-l-soa03-pre → 10.120.2.136 [](https://pam.aoc.cat/SecretServer/app/#/secrets/4746/general)** 
*   User: **soa**

 Admin: **[http://10.120.2.125:7001/console/login/LoginForm.jsp](http://10.120.2.125:7001/console/login/LoginForm.jsp) [](https://pam.aoc.cat/SecretServer/app/#/secrets/4734/general)** 

  

  

### 3) Model de dades

#### R\_PERSONA .ACCEPTA\_AVISOS

Valor

Significat

0

No vol rebre notificacions

1

Vol rebre notificacions

#### R\_NOTIFICACIO.IN\_PROGRESS

Valor

Significat

0

Finalitzat

1

En progrés

Attachments:
------------

![](images/icons/bullet_blue.gif) [cds.gif](attachments/41522992/41522993.gif) (image/gif)  

Document generated by Confluence on 02 June 2025 11:09

[Atlassian](http://www.atlassian.com/)