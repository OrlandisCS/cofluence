Suport Tècnic : CDOMICILI - ALTRES - Reinici de peticions de comunicacions de canvi de domicili  

1.  [Suport Tècnic](index.html)
2.  [Suport Tècnic](13893782.html)
3.  [02 - FAQ's serveis](26313393.html)
4.  [FAQ's CDOMICILI](28705548.html)

Suport Tècnic : CDOMICILI - ALTRES - Reinici de peticions de comunicacions de canvi de domicili
===============================================================================================

Created by OTEC ST Alessandro Trombin Martinez, last modified on 27 July 2020

Abans de reiniciar una petició, hem de detectar on ha fallat en el procés de la comunicació de canvi de domicili.

**Cerquem informació del procés de la comunicació.**

\-- L'ID de la taula cd\_proces l'obtenim del registres quan cerquem les comunicacions amb l'error. --

select \* from cd\_proces where id ='XXXXXXX';

select \* from cd\_titular where id\_proces ='XXXXXX';

select \* from cd\_comunicacio where id\_titular ='XXXXXXXX';

select \* from cd\_comunicacio\_minhap where id\_comunicacio ='XXXXXXX';

*   Anem als RDBMS de CDomicili ([http://10.120.1.163:7001/pci3-rdbmseg-admin/](http://10.120.1.163:7001/pci3-rdbmseg-admin/)) per extreure les querys que utilitza el RDBMS per tractar la petició.
    *   Quan accedim a l'URL, cerquem al buscador per CDOMICILI i trobarem els tres RDBMS del servei.

![](attachments/41518265/41518266.png)

  

*   Un cop sabem on ha fallat el procés farem un UPDATE del procés canviant les condicions necessàries perquè el RDBMS torni a tractar la petició.

  

Query reinici volant

SELECT t.ID FROM CD\_TITULAR t, CD\_PROCES p

WHERE t.ESTAT=0

AND t.ID\_PROCES=p.ID

AND p.ESTAT=0

AND t.INTENTS < 5;

_També haurem de reiniciar la petició des de la part del procés de la comunicació perquè la petició realitzi el procés de la comunicació cap a l'emissor final._

Query reinici comunicació

  

SELECT c.ID FROM CD\_COMUNICACIO c, CD\_TITULAR t 
WHERE c.ID\_TITULAR=t.ID 
AND c.ESTAT=0 
AND t.ESTAT=1 
AND c.INTENTS < 5;

_No caldrà reiniciar la petició des del procés de la comunicació cap al MINHAP, ja que una vegada reiniciem des de la comunicació també es reinicia la petició des de la part de la comunicació del MINHAP._

Tips

Per saber quina condició hem de modificar perquè es realitzi el reinici podem comparar els camps de la petició amb les condicions de la query dels RDBMS.

Exemple [ST-7125](https://contacte.aoc.cat/browse/ST-7125):

**Comparar peticions amb les condicions del RDBMS**

SELECT c.ID
 FROM CD\_COMUNICACIO c, CD\_TITULAR t
 WHERE c.ID\_TITULAR = t.ID
 AND c.ESTAT = 0 --no se cumple
 AND t.ESTAT = 1 --se cumple
 AND c.INTENTS < 5 -- se cumple
-- RDBMS CDomicili Minhap
SELECT ID\_COMUNICACIO AS ID
 FROM CD\_COMUNICACIO\_MINHAP
 WHERE ESTAT = '0002' --no se cumple
 AND SYSDATE > (DATA\_ACTUALITZACIO + TER / 24) -- se cumple

-- c = cd\_comunicacio t= cd\_titular --

-- UPDATE per reiniciar la petició fixant-nos en les condicions que no es compleixen del RDBMS --
-- Veiem que el RDBMS processa la petició si l'estat de la taula cd\_comunicacio es 0 i la nostra està en estat 1 --
update cd\_comunicacio set estat = 0 
where id = 'XXXXXX'

Esperem la resposta del MINHAP per BDD. Tarda 24 hores aproximadament, hem d'esperar que la comunicació MINHAP tingui l'estat 003 que significa 'Tramitada'.

Encara que a la base de dades ens trobem amb l'estat '003', no significa que la petició hagi finalitzat correctament, només significa que la petició de la comunicació de canvi de domicili ha arribat a l'emissor final però el MINHAP en pot retornar error igualment.

Attachments:
------------

![](images/icons/bullet_blue.gif) [image2020-7-27\_14-54-55.png](attachments/41518265/41518266.png) (image/png)  

Document generated by Confluence on 02 June 2025 10:51

[Atlassian](http://www.atlassian.com/)