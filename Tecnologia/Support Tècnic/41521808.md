Suport Tècnic : Exemple de nou padró - Sant Quirze del Vallès  

1.  [Suport Tècnic](index.md)
2.  [Suport Tècnic](13893782.md)
3.  [04 - Tècnica de sistemes + 24x7 + Padró](26313202.md)
4.  [Revisió de serveis](36340340.md)
5.  [PADRO - Revisions i Restabliment](PADRO---Revisions-i-Restabliment_118554712.md)
6.  [Padró - Instal·lació i manteniment](26313622.md)
7.  [PADRO - Integrar un nou padró en linia](26313189.md)

Suport Tècnic : Exemple de nou padró - Sant Quirze del Vallès
=============================================================

Created by Unknown User (otecobernal), last modified by Oriol Bernal on 19 June 2023

El CAU crea un Jira amb els documents necessaris signats i les dades de contacte:

[ST-11303](https://contacte.aoc.cat/browse/ST-11303?src=confmacro) - Data cannot be retrieved due to an unexpected error.

Demanar la preparació de l'entorn
=================================

**Missatge Tipus**

Bon dia,

Ens posem en contacte per tramitar la sol·licitud de posada en marxa del **servei del padró en línia**.

Per fer-ho, necessitarem muntar un servei web perquè les entitats públiques de Catalunya puguin consultar les dades dels ciutadans del vostre municipi.

Aquest servei web s’ha de muntar sobre un servidor que ens haureu de proporcionar. Pot ser Linux o Windows, com vosaltres preferiu.

  

Un cop disposeu del servidor, necessitaríem accedir de manera remota per procedir amb la instal·lació del servei.

En aquest servidor, realitzarem les següents accions:

*   Instal·larem un tomcat-8 que escoltarà peticions HTTPS. Un cop instal·lat us informarem per quins ports funciona aquest tomcat, ja que els haureu d’obrir al vostre Firewall (si teniu alguna preferència ens podeu indicar els que us van bé, si no agafarem dos que no estiguin ocupats).
*   Instal·larem el java8 (si no està instal·lat ja). Forçarem que el tomcat-8 faci servir aquest java8 sense modificar les variables d’entorn del Windows (per no interferir en altres aplicacions que tingueu instal·lades).
*   Instal·larem l’aplicació web i configurarem el connector específic (entenem que el vostre proveïdor és **T-SYSTEMS**).

  

Per altra banda, per anar configurant les noves dades del nou aplicatiu a la infraestructura de l’AOC necessitaríem el següent:

1.  **Proveïdor**

Necessitarem saber quina és l'empresa proveïdor (T-SYSTEMS, AUDIFILM, SPAI, etc) i conèixer les dades de connexió amb el seu servei web o base de dades,

  

1.  **Habilitar connectivitats**

Aquest necessita tenir els **ports** **8443** (HTTPS) i **8080** (HTTP) oberts al Firewall per tal d’habilitar les connexions remotes. Si hi ha algun inconvenient, podem canviar el número dels ports perquè no interfereixi amb algun altre procés,

Per altra banda, adjuntem les IP’s amb les que es comunicarà el servei:

*   Proves: 157.97.65.88, 83.38.191.123
*   Producció: 213.27.191.126
*   Desenvolupament: 213.27.191.107
*   Monitorització: 81.19.100.250, 83.231.130.138
*   Unitat de Servei: 212.0.104.88
*   Oficina tècnica: 62.97.96.198, 91.215.65.18
*   Rang:157.97.64.0/24 - 157.97.65.0/24
*   PSIS primari: 157.97.65.27
*   PSIS secundari: 185.86.34.132

  

  

1.  **Disposar de dades de prova**

Necessitaríem disposar d’algun **document** de proves (tipus DNI, NIE, passaport) amb els quals es monitorarà l’aplicatiu.

És a dir, es llençaran peticions cada cert temps per revisar que el servei respon amb normalitat. En cas contrari ens posaríem en contacte amb vosaltres per revisar la casuística concreta, si fes falta.

  

1.  **Demanar certificats**

L’aplicatiu necessita dos certificats:

*   El **CDS** (SSL), que s’encarrega de vincular digitalment les dades de la vostra organització i establir una connexió segura entre client i servidor. A la següent URL trobareu diferents prestadors:
    *   [https://sedeaplicaciones.minetur.gob.es/Prestadores/](https://sedeaplicaciones.minetur.gob.es/Prestadores/)

  

*   El **CDA** (certificat d’aplicació) que s’encarrega de signar les peticions que s’envien a l’AOC amb les dades confidencials i així autenticar les comunicacions. A la següent URL s’explica com demanar el certificat:
    *   [https://suport-tcat.aoc.cat/hc/ca/articles/4413912715025-Com-puc-sol-licitar-un-Segell-Electr%C3%B2nic-de-l-AOC-](https://suport-tcat.aoc.cat/hc/ca/articles/4413912715025-Com-puc-sol-licitar-un-Segell-Electr%C3%B2nic-de-l-AOC-)

Quan demani per l’ús del certificat haureu de marcar la següent opció:

![](attachments/41521808/41521809.png)

  

1.  **Dades tècniques de contacte**

En cas d’incidència o necessitat, disposar d’un o més correus de contacte a qui puguem reportar-ho o demanar quelcom. Entenem que podem fer servir [alfons.amate@santquirzevalles.cat](mailto:alfons.amate@santquirzevalles.cat), però si ho vols canviar o afegir més, per part nostra no hi ha cap problema.

  
Qualsevol dubte o suggeriment ens comenteu.

[![](download/resources/com.atlassian.confluence.plugins.confluence-view-file-macro:view-file-macro-resources/images/placeholder-medium-file.png)AOC\_SUPORT Servei del padró - Ajuntament de Lliçà de Vall ST-16545.msg](/download/attachments/41521808/AOC_SUPORT%20Servei%20del%20padr%C3%B3%20-%20Ajuntament%20de%20Lli%C3%A7%C3%A0%20de%20Vall%20ST-16545.msg?version=2&modificationDate=1649934725760&api=v2)
===================================================================================================================================================================================================================================================================================================================================================================================================================

Crear excel amb dades tècniques
===============================

Haurem de clonar un excel de la següent ruta amb les dades de l'ajuntament a integrar, en aquest cas Sant Quirze del Vallès:

*   (Sharepoint) Tecnologia - SUPORT\_TECNIC\\SERVEIS\\PADRO\\Dades ens

Instal·lar l'aplicació i passar les proves
==========================================

[PADRO - Instal·lació de l'aplicació](26313260.md)

Crear Administració Local
=========================

Serà necessari configurar el nou ajuntament per tal que el servei centralitzat sàpiga contra quin endpoint s'haura de llençar les peticions que preguntin pel codi de municipi associat al nou ens:

  

\-- 1: Crear l'endpoint de l'Ajuntament
SELECT \* FROM REGSERVPADRO.AOC\_ENDPOINT

INSERT INTO AOC\_ENDPOINT
VALUES
  (SEQ\_AOC\_ENDPOINT.NEXTVAL,
   'Sant Quirze del Vallès, Ajuntament de', -- Nom de l'Ens
   'https://contacte.aoc.cat/browse/ST-11303', -- JIRA amb més informació
   0, -- JAVA
   'deprecated', -- Ja no s'utilitza
   'deprecated', -- Ja no s'utilitza
   'https://83.56.37.52:8443/aoc-padro/services/dispatcher', -- Endpoint del servei
   'deprecated', -- Ja no s'utilitza
   to\_date('16/2/2025', 'dd/mm/yyyy'), -- Caducitat del CDA
   to\_date('8/7/2021', 'dd/mm/yyyy'),  -- Caducitat del CDS
   0) -- pilot

\-- 2: Associar l'endpoint a un municipi
select \* FROM REGSERVPADRO.AOC\_MUNICIPI WHERE MUNICIPI LIKE '%QUIRZE%'

SELECT \* FROM REGSERVPADRO.AOC\_ENDPOINT\_MUNICIPI WHERE id\_endpoint = 84

INSERT INTO AOC\_ENDPOINT\_MUNICIPI
VALUES (180, 833)

\-- 3: Crear els registres per poder llençar peticions
SELECT \* FROM REGSERVPADRO.AOC\_REGISTRE

-- 3.1: padron
INSERT INTO AOC\_REGISTRE
(id, id\_versio, id\_endpoint, id\_servei, actiu, monitorable )
VALUES
  (SEQ\_AOC\_REGISTRE.NEXTVAL,
   1, -- Volant de padró  (schema 2.0 - JAVA)
   180, -- id\_endpoint
   1, -- padrón
   'padron',
   'V2\_0', -- versió
   0, -- JAVA
   'https://83.56.37.52:8443/aoc-padro/services/dispatcher?',
   0, -- actiu (tots estan a 0
   1) -- monitorable

-- 3.2: convivencia
INSERT INTO AOC\_REGISTRE
VALUES
  (SEQ\_AOC\_REGISTRE.NEXTVAL,
   3, -- Volant de convivència  (schema 1.0 - JAVA)
   180, -- id\_endpoint
   2, -- convivencia
   'convivencia',
   'V1\_0', -- versió
   0, -- JAVA
   'https://83.56.37.52:8443/aoc-padro/services/dispatcher?',
   0, -- actiu (tots estan a 0
   1) -- monitorable

  

Un cop realitzat, haurem d'accedir a [http://10.120.4.57/pci3-pmh-admin/](http://10.120.4.57/pci3-pmh-admin/), editar el nou ens i guardar sense modificar canvis, per un bug.

  

Entitat configurada

Arribats a aquest punt, hauríem de poder llençar peticions contra la MTI o el SIRI preguntant per un DNI i el codi municipi de la entitat i hauríem d'obtenir resposta del servei.

  

Crear Monitoratge - Sondes Àurea
================================

  

INSERT INTO MONITORS.TRANSACCIONS
VALUES
  (MONITORS.SEQ\_ID\_TRANSACCIO.NEXTVAL,
  104,
  'ID- Ajuntament de Sant Quirze del Vallès',
  'Ajuntament de Sant Quirze del Vallès',
  10000,
  20000,
  30000,
  98,
  107,
    'Ajuntament de Sant Quirze del Vallès',
376,
1,
null,
'FF0000',
null,
   'https://serveis.iop.aoc.cat/siri-proxy/services/Sincron') 

select \* from MONITORS.TRANSACCIONS
where id\_transaccio = '108'

update MONITORS.TRANSACCIONS
set nom = 'ID-108 Ajuntament de Sant Quirze del Vallès'
where id\_transaccio = '108'

  

Un cop fet això haurem de crear els scripts d'execució seguint els exemples de la màquina i afegir-los al script general 2PADRO.sh, que és el que s'executa cada 30 minuts

Attachments:
------------

![](images/icons/bullet_blue.gif) [image2021-3-2\_14-29-31.png](attachments/41521808/41521809.png) (image/png)  
![](images/icons/bullet_blue.gif) [AOC\_SUPORT Servei del padró - Ajuntament de Lliçà de Vall ST-16545.msg](attachments/41521808/64981045.msg) (application/vnd.ms-outlook)  
![](images/icons/bullet_blue.gif) [AOC\_SUPORT Servei del padró - Ajuntament de Lliçà de Vall ST-16545.msg](attachments/41521808/64981043.msg) (application/vnd.ms-outlook)  

Document generated by Confluence on 02 June 2025 11:14

[Atlassian](http://www.atlassian.com/)