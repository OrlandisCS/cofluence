Projectes : PostgreSQL: D\_RI\_ATL\_RSI tables create (YYYY)  

1.  [Projectes](index.md)
2.  [PSIS](PSIS_24215797.md)
3.  [PSIS - WIKI](PSIS---WIKI_24215598.md)
4.  [Scripts SQL](Scripts-SQL_24215612.md)

Projectes : PostgreSQL: D\_RI\_ATL\_RSI tables create (YYYY)
============================================================

Created by Áurea Alcaide, last modified on 27 febrero 2025

  

Script revisat a data 11-ene-2024 

Substituir YYYY per l'any en qüestió.

Substituir "PSIS\_DEV" per l'owner corresponent.

  

\--================================================================
-- DEV
--================================================================

----------------------------------------------------------------
-- CREATE\_NEW\_TABLES
----------------------------------------------------------------

CREATE TABLE public.d\_ri\_atl\_rsi\_yyyy (
    id bigint NOT NULL,
    distribution\_point\_type integer NOT NULL,
    issuer\_dn bytea NOT NULL,
    issuer\_ki bytea NOT NULL,
    retrievaldate timestamp without time zone,
    valid\_until timestamp without time zone,
    asn1dataid bigint
);
ALTER TABLE public.d\_ri\_atl\_rsi\_yyyy OWNER TO "PSIS\_DEV";

CREATE TABLE public.d\_ri\_atl\_rsi\_asn1\_yyyy (
    id bigint NOT NULL,
    asn1data bytea NOT NULL
);
ALTER TABLE public.d\_ri\_atl\_rsi\_asn1\_yyyy OWNER TO "PSIS\_DEV";

CREATE TABLE public.d\_ri\_atl\_rsi\_crls\_yyyy (
    crl\_number integer NOT NULL,
    next\_update timestamp without time zone,
    this\_update timestamp without time zone,
    version integer NOT NULL,
    id bigint NOT NULL,
    distribution\_point bigint
);
ALTER TABLE public.d\_ri\_atl\_rsi\_crls\_yyyy OWNER TO "PSIS\_DEV";

CREATE TABLE public.d\_ri\_atl\_rsi\_deltacrls\_yyyy (
    base\_crl\_number integer NOT NULL,
    id bigint NOT NULL,
    base\_crl\_id bigint NOT NULL
);
ALTER TABLE public.d\_ri\_atl\_rsi\_deltacrls\_yyyy OWNER TO "PSIS\_DEV";

CREATE TABLE public.d\_ri\_atl\_rsi\_ocsp\_resp\_yyyy (
    produced\_at timestamp without time zone NOT NULL,
    id bigint NOT NULL,
    distribution\_point bigint
);
ALTER TABLE public.d\_ri\_atl\_rsi\_ocsp\_resp\_yyyy OWNER TO "PSIS\_DEV";

CREATE TABLE public.d\_ri\_atl\_rsi\_ocsp\_sresp\_yyyy (
    id bigint NOT NULL,
    issuer\_dn\_digest character varying(255) NOT NULL,
    serial\_number\_digest character varying(255) NOT NULL,
    ocsp\_response bigint
);
ALTER TABLE public.d\_ri\_atl\_rsi\_ocsp\_sresp\_yyyy OWNER TO "PSIS\_DEV";


----------------------------------------------------------------
-- BUILD\_INDEXES
----------------------------------------------------------------

-- STARTING INDEX BUILDING TABLES D\_RI\_ATL\_RSI\_\*
ALTER TABLE ONLY public.d\_ri\_atl\_rsi\_yyyy ADD CONSTRAINT d\_ri\_atl\_rsi\_yyyy\_pkey PRIMARY KEY (id);
ALTER TABLE ONLY public.d\_ri\_atl\_rsi\_yyyy ADD CONSTRAINT uk\_d\_ri\_atl\_rsi\_asn1\_yyyy UNIQUE (asn1dataid);
CREATE INDEX idx\_d\_ri\_atl\_rsi\_i01\_yyyy ON public.d\_ri\_atl\_rsi\_yyyy USING btree (distribution\_point\_type, valid\_until);
CREATE INDEX idx\_rev\_rsi\_rd\_yyyy ON public.d\_ri\_atl\_rsi\_yyyy USING btree (retrievaldate);
CREATE INDEX idx\_rev\_rsi\_vu\_yyyy ON public.d\_ri\_atl\_rsi\_yyyy USING btree (valid\_until);
-- ENDING INDEX BUILDING TABLES D\_RI\_ATL\_RSI\_\*

-- STARTING INDEX BUILDING TABLES D\_RI\_ATL\_RSI\_ASN1\_\*
ALTER TABLE ONLY public.d\_ri\_atl\_rsi\_asn1\_yyyy ADD CONSTRAINT d\_ri\_atl\_rsi\_asn1\_yyyy\_pkey PRIMARY KEY (id);
-- ENDING INDEX BUILDING TABLES D\_RI\_ATL\_RSI\_ASN1\_\*

-- STARTING INDEX BUILDING TABLES D\_RI\_ATL\_RSI\_CRLS\_\*
ALTER TABLE ONLY public.d\_ri\_atl\_rsi\_crls\_yyyy ADD CONSTRAINT d\_ri\_atl\_rsi\_crls\_yyyy\_pkey PRIMARY KEY (id);
ALTER TABLE ONLY public.d\_ri\_atl\_rsi\_crls\_yyyy ADD CONSTRAINT uk\_d\_ri\_atl\_rsi\_crls\_u01\_yyyy UNIQUE (crl\_number, distribution\_point);
CREATE INDEX idx\_crls\_tu\_dp\_yyyy ON public.d\_ri\_atl\_rsi\_crls\_yyyy USING btree (this\_update);

CREATE INDEX idx\_rev\_crl\_dist\_point\_yyyy ON public.d\_ri\_atl\_rsi\_crls\_yyyy USING btree (DISTRIBUTION\_POINT);
CREATE INDEX idx\_rev\_crl\_thisupd\_distp\_yyyy ON public.d\_ri\_atl\_rsi\_crls\_yyyy USING btree (THIS\_UPDATE, DISTRIBUTION\_POINT);
-- ENDING INDEX BUILDING TABLES D\_RI\_ATL\_RSI\_CRLS\_\*

-- STARTING INDEX BUILDING TABLES D\_RI\_ATL\_RSI\_DELTACRLS\_\*
ALTER TABLE ONLY public.d\_ri\_atl\_rsi\_deltacrls\_yyyy ADD CONSTRAINT d\_ri\_atl\_rsi\_deltacrls\_yyyy\_pkey PRIMARY KEY (id);
-- ENDING INDEX BUILDING TABLES D\_RI\_ATL\_RSI\_DELTACRLS\_\*

-- STARTING INDEX BUILDING TABLES D\_RI\_ATL\_RSI\_OCSP\_RESP\_\*
ALTER TABLE ONLY public.d\_ri\_atl\_rsi\_ocsp\_resp\_yyyy ADD CONSTRAINT d\_ri\_atl\_rsi\_ocsp\_resp\_yyyy\_pkey PRIMARY KEY (id);
CREATE INDEX idx\_rev\_ocsp\_dist\_point\_yyyy ON public.d\_ri\_atl\_rsi\_ocsp\_resp\_yyyy USING btree (distribution\_point);
CREATE INDEX idx\_rev\_ocsp\_produced\_at\_yyyy ON public.d\_ri\_atl\_rsi\_ocsp\_resp\_yyyy USING btree (produced\_at);
-- ENDING INDEX BUILDING TABLES D\_RI\_ATL\_RSI\_OCSP\_RESP\_\*

-- STARTING INDEX BUILDING TABLES D\_RI\_ATL\_RSI\_OCSP\_SRESP\_\*
ALTER TABLE ONLY public.d\_ri\_atl\_rsi\_ocsp\_sresp\_yyyy
    ADD CONSTRAINT d\_ri\_atl\_rsi\_ocsp\_sresp\_yyyy\_pkey PRIMARY KEY (id);

CREATE INDEX idx\_rev\_ocsp\_sresp\_cert\_yyyy ON public.d\_ri\_atl\_rsi\_ocsp\_sresp\_yyyy USING btree (serial\_number\_digest, issuer\_dn\_digest);
CREATE INDEX idx\_rev\_ocsp\_sresp\_resp\_yyyy ON public.d\_ri\_atl\_rsi\_ocsp\_sresp\_yyyy USING btree (ocsp\_response);
-- ENDING INDEX BUILDING TABLES D\_RI\_ATL\_RSI\_OCSP\_SRESP\_\*


----------------------------------------------------------------
-- BUILD\_FIREIGN\_KEYS
----------------------------------------------------------------

-- STARTING FOREIGN KEYS BUILDING TABLES D\_RI\_ATL\_RSI\_\*
ALTER TABLE ONLY public.d\_ri\_atl\_rsi\_yyyy
    ADD CONSTRAINT fk\_d\_ri\_atl\_rsi\_asn1\_yyyy FOREIGN KEY (asn1dataid) REFERENCES public.d\_ri\_atl\_rsi\_asn1\_yyyy(id);
-- ENDING FOREIGN KEYS BUILDING TABLES D\_RI\_ATL\_RSI\_\*

-- STARTING FOREIGN KEYS BUILDING TABLES D\_RI\_ATL\_RSI\_CRLS\_\*
ALTER TABLE ONLY public.d\_ri\_atl\_rsi\_crls\_yyyy ADD CONSTRAINT fk\_d\_ri\_atl\_dpoints\_crl\_yyyy FOREIGN KEY (distribution\_point) REFERENCES public.d\_ri\_atl\_dpoints\_crl(id);
ALTER TABLE ONLY public.d\_ri\_atl\_rsi\_crls\_yyyy ADD CONSTRAINT fk\_dri\_atl\_rsi\_yyyy FOREIGN KEY (id) REFERENCES public.d\_ri\_atl\_rsi\_yyyy(id);
-- ENDING FOREIGN KEYS BUILDING TABLES D\_RI\_ATL\_RSI\_CRLS\_\*

-- STARTING FOREIGN KEYS BUILDING TABLES D\_RI\_ATL\_RSI\_DELTACRLS\_\*
ALTER TABLE ONLY public.d\_ri\_atl\_rsi\_deltacrls\_yyyy
    ADD CONSTRAINT fk\_d\_ri\_atl\_rsi\_crls\_yyyy FOREIGN KEY (base\_crl\_id) REFERENCES public.d\_ri\_atl\_rsi\_crls\_yyyy(id);
ALTER TABLE ONLY public.d\_ri\_atl\_rsi\_deltacrls\_yyyy
    ADD CONSTRAINT fk\_d\_ri\_atl\_rsi\_crls\_yyyy\_02 FOREIGN KEY (id) REFERENCES public.d\_ri\_atl\_rsi\_crls\_yyyy(id);
-- ENDING FOREIGN KEYS BUILDING TABLES D\_RI\_ATL\_RSI\_DELTACRLS\_\*

-- STARTING FOREIGN KEYS BUILDING TABLES D\_RI\_ATL\_RSI\_OCSP\_RESP\_\*
ALTER TABLE ONLY public.d\_ri\_atl\_rsi\_ocsp\_resp\_yyyy ADD CONSTRAINT fk\_d\_ri\_atl\_dpoints\_ocsp FOREIGN KEY (distribution\_point) REFERENCES public.d\_ri\_atl\_dpoints\_ocsp(id);
ALTER TABLE ONLY public.d\_ri\_atl\_rsi\_ocsp\_resp\_yyyy ADD CONSTRAINT fk\_d\_ri\_atl\_rsi\_yyyy FOREIGN KEY (id) REFERENCES public.d\_ri\_atl\_rsi\_yyyy(id);
-- ENDING FOREIGN KEYS BUILDING TABLES D\_RI\_ATL\_RSI\_OCSP\_RESP\_\*

-- STARTING FOREIGN KEYS BUILDING TABLES D\_RI\_ATL\_RSI\_OCSP\_SRESP\_\*
ALTER TABLE ONLY public.d\_ri\_atl\_rsi\_ocsp\_sresp\_yyyy ADD CONSTRAINT fk\_d\_ri\_atl\_rsi\_ocsp\_resp\_yyyy FOREIGN KEY (ocsp\_response) REFERENCES public.d\_ri\_atl\_rsi\_ocsp\_resp\_yyyy(id);
-- ENDING FOREIGN KEYS BUILDING TABLES D\_RI\_ATL\_RSI\_OCSP\_SRESP\_\*
COMMIT;

Document generated by Confluence on 07 junio 2025 00:00

[Atlassian](http://www.atlassian.com/)