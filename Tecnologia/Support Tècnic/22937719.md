Suport Tècnic : Documentació associada a la integració de Jenkins i Jira  

1.  [Suport Tècnic](index.md)
2.  [Suport Tècnic](13893782.md)
3.  [04 - Tècnica de sistemes + 24x7 + Padró](26313202.md)
4.  [Desplegaments](Desplegaments_26313538.md)

Suport Tècnic : Documentació associada a la integració de Jenkins i Jira
========================================================================

Created by David Tejada, last modified by Unknown User (otecobernal) on 09 August 2019

Document de referència per les diferents tasques que s'han d'emplenar per tenir l'automatització de Jenkins i Jira.

  

En qualsevol projecte de Jenkins tenim diferents fases a configurar:

![](attachments/22937719/22937720.png)

  

### **General**

En la secció general, només haurem d'indicar la JDK amb la que s'executa el projecte:

![](attachments/22937719/22937721.png)

  

### Configurar el origen del código fuente

En aquesta secció, hem de ficar la ubicació on es troba en el GIT i amb quina branca s'ha de compilar (actualment per defecte la màster). En un futur hauríem de disposar una branca diferent per cada entorn.

![](attachments/22937719/22937722.png)

  

### Disparadores de ejecución

Aquí podrem planificar si volem que s'executi periòdicament.

  

![](attachments/22937719/24215572.png)

El que apareix en l'exemple s'executa a les 12:00 de tots els dijous. El format del cron és: MINUT HORA DIADELMES(1-31) MES(1-12) DIADELASEMANA.

  

### Entorno de ejecución

![](attachments/22937719/22937723.png)

### Ejecutar

Aquí dividirem en diversos passos les diferents tasques que es realitzaran.

1) Primer obtindrem els comentaris de l'últim commit que s'hagi fet al git. Això ho farem amb una secció d'execució de codi de linia de comandes (shell) i agafarem quin és l'últim commit en el git i el ficarem a commitActual.txt

git log --pretty=%s -1 > commit.txt

git log --pretty="format:%H" -1 > commitActual.txt

  

.rwui\_text\_box.rwui\_id\_99eba452-bd22-4a11-aece-ddace8732a61 {background-color: #F2F2F2; color: #666666;}.rwui\_text\_box.rwui\_id\_99eba452-bd22-4a11-aece-ddace8732a61 \*:not(.rwui\_content) {color: #666666;}.rwui\_text\_box.rwui\_id\_99eba452-bd22-4a11-aece-ddace8732a61 span.rwui\_icon {color: #666666;}

Això crearà un fitxer de text en el path propi d'execució, per defecte → /opt/bitnami/apps/jenkins/jenkins\_home/jobs/NomProjecte/workspace/

![](attachments/22937719/24215573.png)

2) Executarem un codi de groovy que es connecta a JIRA i mira si hi ha algun tiquet obert del producte i entorn seleccionat. Si existeix, el deixem a un fitxer de text que es diu variables.txt. Si no existeix, crearà el tiquet amb la informació del commit i es guardarà l'identificador del tiquet en el mateix fitxer variables.txt.

En aquest script s'han de modificar un conjunt de variables per tal que funcioni per cada projecte.

Per fer la cerca del tiquet existent és necessari indicar el servei de JIRA. Aquest camp és un desplegable doble i per fer referència en la cerca o a l'hora de fer la creació del tiquet, hem d'indicar els identificadors dels valors amb la dupla Servei in cascadeOption(idServei, idSubservei). 

Per obtenir aquesta informació haurem de revisar la informació del json que obtenim de qualsevol tiquet de desplegament i mirant el camp propi anomenat customfield\_10010.

Per veure aquestes opcions, per exemple podem obtenir el json d'aquest tiquet: [https://contacte.aoc.cat/rest/api/2/issue/DES-1787/editmeta](https://contacte.aoc.cat/rest/api/2/issue/DES-1787/editmeta)

  

Si cerquem el camp: customfield\_10010 veurem totes les opcions disponibles. Adjunto un document amb les possibilitats actuals només d'aquest camp: [Exemple de contingut json dels possibles valors de Servei](Exemple-de-contingut-json-dels-possibles-valors-de-Servei_22937727.md)

  

Adjunto el contingut actual del codi d'aquest groovy, és comú per tots els projectes. [Groovy Fase 1 -> Creació de ticket a JIRA](22937730.md) 

  

3) Executarem un altre groovy que fa la transició del tiquet. Ho fica en estat procés i fica la data de desplegament a la data actual. 

Adjunto el contingut del codi. [Groovy Fase 2 -> Transicionar ticket](24215578.md)

  

4) Es realitza pròpiament el desplegament de l'aplicació.

![](attachments/22937719/24215582.png)

  

Per fer-ho serà necessari disposar dels gradles corresponents en el git que realitzen la compilació, el desplegament i els tests planificats.

  

### Acciones para ejecutar después

  

Un cop realitzades totes les tasques, es comprova si s'ha fet satisfactòriament la tasca.

Disposem de 3 alternatives.

1) No hi ha canvis en el git → Es finalitzarà com que ha anat bé i s'aplica l'etiqueta NO CHANGES en el resultat.

2) Ha fallat algun pas i s'ha fet rollback → Quedarà marcat com DEPLOY FAILED

3) Ha anat correctament → Quedarà marcat com DEPLOYED!! SUCCESFULLY!!

Aquestes comprovacions es realitzen amb codi groovy i es troba a la següent pàgina. [Groovy PostBuild](Groovy-PostBuild_24215580.md)

  

En funció del resultat en el cas dels tomcats farem una còpia del war en la carpeta compartida de desplegaments, per disposar sempre el war de l'últim paquet desplegat.

![](attachments/22937719/24215583.png)

  

Si no ha anat bé, es tornarà a desplegar el war anterior:

![](attachments/22937719/24215584.png)

  

I finalment, es comunica via slack que la intervenció s'ha realitzat i es fica en els canals que es vulguin definir, per defecte sempre ficarem el de #jenkinsdeploymessage

![](attachments/22937719/24215585.png)

  

Per tant, al slack veurem com ha anat:

![](attachments/22937719/24215586.png)

  

![](attachments/22937719/24215587.png)

  

  

Attachments:
------------

![](images/icons/bullet_blue.gif) [image2019-5-28\_15-34-44.png](attachments/22937719/22937720.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2019-5-28\_15-36-10.png](attachments/22937719/22937721.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2019-5-28\_15-40-3.png](attachments/22937719/22937722.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2019-5-28\_15-40-50.png](attachments/22937719/22937723.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2019-5-28\_15-41-35.png](attachments/22937719/22937724.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2019-5-28\_15-46-51.png](attachments/22937719/22937725.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2019-6-20\_16-16-20.png](attachments/22937719/24215572.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2019-6-20\_16-19-42.png](attachments/22937719/24215573.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2019-6-20\_16-39-52.png](attachments/22937719/24215582.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2019-6-20\_16-47-26.png](attachments/22937719/24215583.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2019-6-20\_16-48-23.png](attachments/22937719/24215584.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2019-6-20\_16-49-10.png](attachments/22937719/24215585.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2019-6-20\_16-50-23.png](attachments/22937719/24215586.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2019-6-20\_16-50-49.png](attachments/22937719/24215587.png) (image/png)  

Document generated by Confluence on 02 June 2025 11:17

[Atlassian](http://www.atlassian.com/)