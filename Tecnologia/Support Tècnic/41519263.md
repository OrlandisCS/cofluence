Suport Tècnic : PADRO - Configuració Proxy  

1.  [Suport Tècnic](index.md)
2.  [Suport Tècnic](13893782.md)
3.  [04 - Tècnica de sistemes + 24x7 + Padró](26313202.md)
4.  [Revisió de serveis](36340340.md)
5.  [PADRO - Revisions i Restabliment](PADRO---Revisions-i-Restabliment_118554712.md)
6.  [Padró - Instal·lació i manteniment](26313622.md)

Suport Tècnic : PADRO - Configuració Proxy
==========================================

Created by Unknown User (otecagonzalez), last modified on 05 October 2020

Informació

Antigament molts ajuntaments estaven configurats per a que la crida cap al seu EndPoint es fes amb el sistema de Proxy de l'AOC, degut a que molts ajuntaments encara no tenien actualitzades les tecnologies per poder establir una connexió entre servidors superior a la versió TLS 1,0, 1.1. 

La sortida des de els WL12 es fa amb TLS1.2. Per tant, si els ajuntaments no ho suportaven, la comunicació fallava. Aquest cas va estar resolt, però també ens podíem trobar amb un altre cas.

Al negociar el canal segur (SSL) entre servidors, el CDS que tenien carregat no corresponia al Endpoint i això feia que la connexió no s'establís. Per tant també teniem que utilitzar el sistema proxy per fer la sortida de la petició. 

  

**En aquest apartat documentem com configurar un EndPoint d'un ajuntament en el sistema de proxy de l'AOC.**

  

1- Màquines proxy
-----------------

Les configuracions les haurem de realitzar en les següents màquines.

Les configuracions les haurem de realitzar en les següents màquines

Nom

IP

Usuari

Password

aoc-l-proxy01-pro

10.120.1.39

aoc

La podem obtenir al Keepass buscant per IP

aoc-l-proxy02-pro

10.120.1.166

aoc

La podem obtenir al Keepass buscant per IP

2- Fitxer de configuració
-------------------------

El fitxer que hem de configurar es el següent

*   El fitxer està desat en la ruta: **/etc/httpd/conf.d/sites**

*   Anomenat: **proxyajuntaments.aoc.cat.conf**

3- Configuracions proxy
-----------------------

Procés de configuració dels proxies

3.1) **Back Up**, abans de fer cap tipus de canvi en el fitxer hem de generar una còpia d'aquest. 

**Backup per terminal**

\[aoc@aoc-l-proxy01-pro ~\]$ cp /etc/httpd/conf.d/sites/proxyajuntaments.aoc.cat.conf /etc/httpd/conf.d/sites/backup/ajuntamentscopia.conf                                

3.2) Afegir configuració en el fitxer **proxyajuntaments.aoc.cat.conf**, en el cas que hi hagi algun proxy configurat afegirem el nou a baix d'aquest i sinó després de la línia "_Include /mnt/lhnfs/aoc/httpd/proxyajuntaments.aoc.cat.nfs_"

**Backup per terminal**

ProxyPass /castelldefels https://188.85.161.174:8443/aoc-padro/services/dispatcher
ProxyPassReverse /castelldefels https://188.85.161.174:8443/aoc-padro/services/dispatcher                 

El fitxer quedarà com el següent: 

![](attachments/41519263/41519271.png)

Fixem-nos amb el que hem afegit: 

Paràmetre

Argument de vinculació

EndPoint de l'ajuntament sencer

ProxyPass → Obligatori i sempre igual

/castelldefels → Aquest canviarà podem posar el nom de l'ajuntament (sense espais ni caràcters estranys).  
**Important,** la "/" ha d'anar sempre davant. 

[https://188.85.161.174:8443/aoc-padro/services/dispatcher](https://188.85.161.174:8443/aoc-padro/services/dispatcher)

ProxyPassReverse → Obligatori i sempre igual

/castelldefels → Aquest canviarà podem posar el nom de l'ajuntament (sense espais ni caràcters estranys).  
**Important,** la "/" ha d'anar sempre davant. 

[https://188.85.161.174:8443/aoc-padro/services/dispatcher](https://188.85.161.174:8443/aoc-padro/services/dispatcher)

3.3) Desar els canvis i fem restart de la màquina. 

**Restart per aplicar els canvis**

\[aoc@aoc-l-proxy01-pro ~\]$  sudo /bin/systemctl restart httpd
 
#Veure estat de la màquina 
\[aoc@aoc-l-proxy01-pro ~\]$  /bin/systemctl status httpd

3.4) Realitzem els mateixos passos en el node 2. 

4- Configuracions Admin Padró
-----------------------------

Procés de configuració en la pàgina admin del padró

Un cop ja tenim les configuracions realitzades en fitxers dels nodes del proxy, hem de modificar la pàgina d'admin del padró que és aqui on s'informa de l'endpoint al cual el servei del padró farà el consum: 

4.1) Accedim a la pàgina d'administració: [http://10.120.4.57/pci3-pmh-admin](http://10.120.4.57/pci3-pmh-admin/)

4.2) Busquem l'ENS que estem configurant i fem clic

4.3) Escribim l'Endpoint ([http://proxyajuntaments.aoc.cat](http://proxyajuntaments.aoc.cat)) en la opció **URL dispatch.** I hem d'**afegir l'argument de vinculació** que hem posat abans en el fitxer de configuració del proxy. En aquest cas era /castelldefels

4.5) La URL quedaría així: [http://proxyajuntaments.aoc.cat/castelldefels](http://proxyajuntaments.aoc.cat/castelldefels)

4.6) Acceptem a la part inferior de la pàgina per aplicar els canvis. 

Attachments:
------------

![](images/icons/bullet_blue.gif) [image2020-10-5\_17-1-58.png](attachments/41519263/41519270.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2020-10-5\_17-2-13.png](attachments/41519263/41519271.png) (image/png)  

Document generated by Confluence on 02 June 2025 11:12

[Atlassian](http://www.atlassian.com/)