Projectes : Modificar mètode d'obtenció de la informació de revocació  

1.  [Projectes](index.md)
2.  [PSIS](PSIS_24215797.md)
3.  [PSIS - WIKI](PSIS---WIKI_24215598.md)
4.  [Procediments](Procediments_24215610.md)

Projectes : Modificar mètode d'obtenció de la informació de revocació
=====================================================================

Created by Áurea Alcaide, last modified on 26 abril 2023

En la configuració de PSIS, al ValidationAuthorities, podem modificar la maneera d'obtenir la informació de revocació per qualsevol CA o TA.

Exemple de TA i CA del DNIe:

						<!-- AC RAIZ DNIE 2 -->
						<psis:child psis:name="CertificateIssuer">
							<psis:attributes>
								<psis:attribute psis:name="CertificateIssuerDN">
									<psis:stringNodeValue>cn=ac raiz dnie 2,ou=dnie,o=direccion general de la policia,c=es</psis:stringNodeValue>
								</psis:attribute>
								<psis:attribute psis:name="CertificateIssuerKI">
									<psis:blobNodeValue>BBRT3G5ipM4TG3fgh6FapA+yhxLwmw==</psis:blobNodeValue>
								</psis:attribute>
							</psis:attributes>
							<psis:children>
								<psis:child psis:name="InformationSource">
									<psis:attributes>
										<psis:attribute psis:name="InformationSourceClass">
											<psis:stringNodeValue>Configuration</psis:stringNodeValue>
										</psis:attribute>
										<psis:attribute psis:name="RevocationMethodOperationClass">
											<psis:stringNodeValue>FindFirst</psis:stringNodeValue>
										</psis:attribute>
									</psis:attributes>
									<psis:children>
										<psis:child psis:name="DistributionMethod">
											<psis:attributes>
												<psis:attribute psis:name="RevocationInformationClass">
													<psis:stringNodeValue>CRL</psis:stringNodeValue>
												</psis:attribute>
												<psis:attribute psis:name="ConfidenceTime">
													<psis:numberNodeValue>3600000</psis:numberNodeValue>
												</psis:attribute>
												<psis:attribute psis:name="Timeout">
													<psis:numberNodeValue>3000</psis:numberNodeValue>
												</psis:attribute>
												<psis:attribute psis:name="Retries">
													<psis:numberNodeValue>2</psis:numberNodeValue>
												</psis:attribute>
											</psis:attributes>
											<psis:children>
												<psis:child psis:name="DistributionPoint">
													<psis:attributes>
														<psis:attribute psis:name="URIS">
															<psis:stringNodeValue>https://pki.policia.es/dnie/crls/ARL.crl</psis:stringNodeValue>
														</psis:attribute>
													</psis:attributes>
												</psis:child>
											</psis:children>
										</psis:child>
									</psis:children>
								</psis:child>
							</psis:children>
						</psis:child>
						<!-- AC DNIE 001 -->
						<psis:child psis:name="CertificateIssuer">
							<psis:attributes>
								<psis:attribute psis:name="CertificateIssuerDN">
									<psis:stringNodeValue>cn=ac dnie 001,ou=dnie,o=direccion general de la policia,c=es</psis:stringNodeValue>
								</psis:attribute>
								<psis:attribute psis:name="CertificateIssuerKI">
									<psis:blobNodeValue>BBQaiajF7o92XVVxifM7Nb2qBQCVbw==</psis:blobNodeValue>
								</psis:attribute>
							</psis:attributes>
							<psis:children>
								<psis:child psis:name="InformationSource">
									<psis:attributes>
										<psis:attribute psis:name="InformationSourceClass">
											<psis:stringNodeValue>Configuration</psis:stringNodeValue>
										</psis:attribute>
										<psis:attribute psis:name="RevocationMethodOperationClass">
											<psis:stringNodeValue>FindFirst</psis:stringNodeValue>
										</psis:attribute>
									</psis:attributes>
									<psis:children>
										<psis:child psis:name="DistributionMethod">
											<psis:attributes>
												<psis:attribute psis:name="RevocationInformationClass">
													<psis:stringNodeValue>OCSP</psis:stringNodeValue>
												</psis:attribute>
												<psis:attribute psis:name="HashAlgorithm">
													<psis:stringNodeValue>SHA1</psis:stringNodeValue>
												</psis:attribute>
												<psis:attribute psis:name="ConfidenceTime">
													<psis:numberNodeValue>400000</psis:numberNodeValue>
												</psis:attribute>
												<psis:attribute psis:name="GranularityTime">
													<psis:numberNodeValue>400000</psis:numberNodeValue>
												</psis:attribute>
												<psis:attribute psis:name="Timeout">
													<psis:numberNodeValue>3000</psis:numberNodeValue>
												</psis:attribute>
												<psis:attribute psis:name="Retries">
													<psis:numberNodeValue>2</psis:numberNodeValue>
												</psis:attribute>
											</psis:attributes>
											<psis:children>
												<psis:child psis:name="DistributionPoint">
													<psis:attributes>
														<psis:attribute psis:name="URIS">
															<psis:stringNodeValue>http://ocsp.dnie.es</psis:stringNodeValue>
														</psis:attribute>
													</psis:attributes>
												</psis:child>
											</psis:children>
										</psis:child>
									</psis:children>
								</psis:child>
							</psis:children>
						</psis:child>

  

![(advertencia)](images/icons/emoticons/warning.svg) **IMPORTANT**: Cal que CertificateIssuerDN i CertificateIssuerKI coincideixin exactament amb els de la CA o TA corresponent.

Per calcular-los, a partir de la CA o TA corresponent:

  

System.out.println(X500NameUtils.serialize(cert.getSubjectX500Principal(), Format.RFC2253, true).replace("\\\\00", "").toLowerCase());

System.out.println(new String(Base64.encode(CertificateHelper.getSubjectKeyId(cert))));

  

Si ho fessim a partir d'un certirficat emès per la CA o TA, aleshores:

System.out.println(X500NameUtils.serialize(cert.getIssuerX500Principal(), Format.RFC2253, true).replace("\\\\00", "").toLowerCase());

System.out.println(new String(Base64.encode(CertificateHelper.getAuthorityKeyId(cert))));

  

Si PSIS no segueix les instruccions especificades, comprovar que el CertificateIssuerDN és el mateix que cerca PSIS a la classe:

**psis.revocationstatus.atlantis.configuration.RevocationStatusServiceConfiguration**

Mètode:

	/\*\*
	 \* Finds the issuer configuration for the issuer of the given certificate
	 \* @param cert
	 \* @return
	 \*/
	public CertificateIssuerConfiguration findCertificateIssuer(X509Certificate cert) {
		String issuerDN = cert.getIssuerX500Principal().getName(X500Principal.CANONICAL);
		List<CertificateIssuerConfiguration> issuers = getCertificateIssuerConfiguration(issuerDN);
		byte\[\] issuerKI = CertificateHelper.getAuthorityKeyId(cert);

		//Check the issuer with it's key matching
		for(CertificateIssuerConfiguration currentIssuer:issuers){
			if (issuerKI == null || Arrays.equals(currentIssuer.getIssuerKeyIdentifier(), issuerKI)) {
				return currentIssuer;
			}
		}

		return null;
	}

  

  

Document generated by Confluence on 07 junio 2025 00:00

[Atlassian](http://www.atlassian.com/)