Suport Tècnic : REPRESENTA - EXTRACCIÓ DADES- Consultar representacions d'un ens  

1.  [Suport Tècnic](index.md)
2.  [Suport Tècnic](13893782.md)
3.  [02 - FAQ's serveis](26313393.md)
4.  [FAQ's REPRESENTA](28705611.md)

Suport Tècnic : REPRESENTA - EXTRACCIÓ DADES- Consultar representacions d'un ens
================================================================================

Created by Unknown User (otecjcolomer), last modified on 17 May 2022

Tiquet JIRA Referència

[ST-16797](https://contacte.aoc.cat/browse/ST-16797?src=confmacro) - Data cannot be retrieved due to an unexpected error.

Bon dia,

Necessitaria una extracció de la base de dades de les representacions creades a l'ens Gramepark (administracioReceptora), amb aquesta informació:

  

identificadorLegal

Identificador únic de la representació. Usat per recuperar representacions úniques a _consultaRepresentacio_

tipusRepresentacio

Tipus de Representacio (TIPUS\_A, TIPUS\_B, TIPUS\_C)

estat

Llistat d'elements _estat_

  

  

dataCreacio

Data de creació de la representació (yyyy-MM-dd'T'HH:mm:ss)

dataIniciVigencia

Data d'inici de vigència (yyyy-MM-dd'T'HH:mm:ss)

dataFiVigencia

Data de fi de la vigència (yyyy-MM-dd'T'HH:mm:ss)

validacions

Nombre de validacions realitzades sobre aquesta representació

  

  

origen

Element que permet veure l'origen de creció de la representació (PORTAL\_EMPLEAT, PORTAL\_CIUTADA, INTEGRACIO)

  

  

**Passes a seguir per fer l'extracció de dades**
------------------------------------------------

  

1.  Primer de tot, revisarem l'administració a la taula representa:  ![](https://contacte.aoc.cat/secure/attachment/78448/78448_image-2022-05-12-12-31-09-642.png)

       2. Realitzarem la cerca com sol·licitant, amb la taula Administraciosolicitant. En aquest cas, veiem que tenen 407 representacions creades.

  

A TENIR EN COMPTE (COMENTARI D'ARTUR BARBETA)

El camp \_R\_REPRESENTACIO.ADMINISTRACIORECEPTORA\_UUID\_ es feia servir antigament. Posteriorment es va modificar perquè això només permetia guardar l'administracio receptora de la inscripció de la representació (a la taula R\_REPRESENTACIO), però no permetia registrar quina administració feia cadascun dels següents canvis d'estat (es desen a R\_EVIDENCIA). 

Per això, hi ha representacions antigues que tenen el camp _ADMINISTRACIORECEPTORA\_UUIID_ informat però cal que mireu en general el camp _ADMINISTRACIOSOLICITANT\_UUID_ (a la taula R\_REPRESENTACIO per saber la inscripció i a la taula R\_EVIDENCIES per cada acció futura sobre aquella representacio).

  

           ![](https://contacte.aoc.cat/secure/attachment/78453/78453_image-2022-05-12-12-33-40-849.png)

3\. Podem respondre amb el següent missatge tipus al Tiquet Jira corresponent:

MISSATGE TIPUS

Hem realitzat una extracció en relació a les representacions sol·licitades de l'entitat Gramepark  amb la següent query:

SELECT RR.IDENTIFICADORLEGAL, RR.TIPUSREPRESENTACIO, RR.ESTAT, RR.DATACREACIO, RR.DATAINICI, RR.DATAFI,RR.VALIDACIONS, RR.ORIGEN FROM R\_REPRESENTACIO RR WHERE TIPUSREPRESENTACIO IN ('TIPUS\_C','TIPUS\_B','TIPUS\_A') AND RR.Administraciosolicitant\_Uuid = '40003'

  

Adjuntem el CSV resultant amb els 407 resultats, el fixer té el nom "exportacioGrameParkRepresentacionsSolicitades".

  

Qualsevol cosa ho comentem.

  

Salutacions!

  

Com podem observar, **Administraciosolicitant\_Uuid serà igual al UUid de l'ens que ens demanin.** 

Haurem de tenir en compte els camps que ens sol·licitin a l'hora de muntar la QUERY.

Adjuntarem una captura o un arxiu amb les dades que ens hagin sol·licitat

  

Després d'enviar aquestes dades, pot ser que l'usuari ens demani més detalls respecte a la consulta que han volgut fer. Posem l'exemple del mateix tiquet per seguir amb la consulta:

> Necessitaria saber però, les que estan en **estat Vàlid** i que prèviament han passat per l'estat **"Pendent validació".**
> 
> Per tant, podem consultar a bbdd les representacions vàlides q han estat validades? I q per tant en algun moment han passat X pendent de validació?
> 
> Una aproximació també seria saber les representacions en estat vàlid que tenen 2 o més documents adjunts.
> 
> Les necessitaria per tipologia. Poso com a observador a l'[Artur Barbeta](https://contacte.aoc.cat/secure/ViewProfile.jspa?name=abarbeta) per si ens pot donar un cop de mà. Gràcies

  

**Passos a seguir per a realitzar la següent subconsulta:**
-----------------------------------------------------------

*   Representacions en estat **Vàlid** i que prèviament han passat per l'estat **Pendent Validació**
*   Representacions en estat **Vàlid** que **tinguin 2 o més documents adjunts**
*   Indicar-les tipologia

  

**Representacions en estat VALID que han passat per PENDENT\_VALIDACIO filtrat per una administracio solicitant GramePark**

select count(distinct r.identificadorlegal) FROM ((R\_REPRESENTACIO r JOIN R\_ADMINISTRACIO a ON r.ADMINISTRACIOSOLICITANT\_UUID = a.UUID) RIGHT JOIN R\_EVIDENCIA e ON r.identificadorlegal = e.identificadorlegal AND e.estat = 'PENDENT\_VALIDACIO') WHERE r.ADMINISTRACIOSOLICITANT\_UUID = 40003 AND r.estat = 'VALIDA';

Total 37 representacions

  

**Representacions en estat VALID que han passat per PENDENT\_VALIDACIO filtrat per una administracio receptora GramePark**

select distinct r.identificadorlegal, r.tipusrepresentacio , r.estat, r.DATACREACIO, r.DATAINICI, r.datafi, r.validacions, r.origen, a.nom as AdministracioSolicitant FROM ((R\_REPRESENTACIO r JOIN R\_ADMINISTRACIO a ON r.ADMINISTRACIOSOLICITANT\_UUID = a.UUID) RIGHT JOIN R\_EVIDENCIA e ON r.identificadorlegal = e.identificadorlegal AND e.estat = 'PENDENT\_VALIDACIO') WHERE r.ADMINISTRACIOSOLICITANT\_UUID = 40003 AND r.estat = 'VALIDA' ORDER BY r.DATACREACIO;

  

Document generated by Confluence on 02 June 2025 10:58

[Atlassian](http://www.atlassian.com/)