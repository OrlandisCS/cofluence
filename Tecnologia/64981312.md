Suport Tècnic : Monitor S.T. - DCOC - col·legis indisponibles  

1.  [Suport Tècnic](index.html)
2.  [Suport Tècnic](13893782.html)
3.  [03 - Monitorització - Revisions globals](26313327.html)
4.  [Monitors S.T.](Monitors-S.T._41522177.html)

Suport Tècnic : Monitor S.T. - DCOC - col·legis indisponibles
=============================================================

Created by Unknown User (jxnieto), last modified on 06 May 2022

Què mesura aquest monitor?

Col·legis del DCOC que no estan donant servei.

  

**Consulta**
============

* * *

select COLLEGIS\_CAIGUTS.descripcio "ENS",
       (case
                when (sysdate - COLLEGIS\_CAIGUTS.ultim\_OK) >= 1 then
                 CAST((sysdate - COLLEGIS\_CAIGUTS.ultim\_OK) AS INT) || ' dies' -- Número de dies caiguts
                when 24\*(sysdate - COLLEGIS\_CAIGUTS.ultim\_OK) >= 1 then
                 CAST(24 \* (sysdate - COLLEGIS\_CAIGUTS.ultim\_OK) AS INT) || ' hores' -- Número de hores caiguts
                when 24\*(sysdate - COLLEGIS\_CAIGUTS.ultim\_OK) < 1 then
                 CAST(24 \* 60 \* (sysdate - COLLEGIS\_CAIGUTS.ultim\_OK) AS INT) || ' minuts' -- Número de minuts caiguts
              end) as "TEMPS CAIGUT"
  from (
    select KOS.descripcio, KOS.ultim\_KO, OKS.ultim\_OK
          from
                -- Seleccionem els KOs
                (select indxa.ultim\_KO, indxa.descripcio, logs.resultat
                   from monitors.estadistiques logs,
                        (select max(logs.data) as ultim\_KO,
                                tt.descripcio,
                                logs.id\_transaccio
                           from monitors.estadistiques logs,
                                monitors.transaccions  tt
                          where logs.id\_transaccio = tt.id\_transaccio
                            and tt.id\_servei = 100
                        
                          group by logs.id\_transaccio, tt.descripcio) indxa
                  where indxa.ultim\_KO = logs.data
                    and indxa.id\_transaccio = logs.id\_transaccio
                    and logs.resultat = 'KO') KOS,

               -- Seleccionem els OKs
               (select max(logs.data) as ultim\_OK,
                       tt.descripcio,
                       logs.id\_transaccio
                  from monitors.estadistiques logs, monitors.transaccions tt
                 where tt.id\_servei = 100
                   and logs.id\_transaccio = tt.id\_transaccio
                   and logs.resultat = 'OK'
            
                 group by logs.id\_transaccio, tt.descripcio) OKS
         where OKS.descripcio(+) = KOS.descripcio -- juntem OKs amb KOs
         and 24 \* (sysdate - OKS.ultim\_OK) >= 5 -- més de 12 hores caiguts
         order by OKS.ultim\_OK asc -- ordenem per temps que porten caiguts
        ) COLLEGIS\_CAIGUTS
        order by COLLEGIS\_CAIGUTS.ultim\_OK asc

**Procediment**
===============

* * *

A continuació s'explicarà el procediment de revisió dels col·legis, o Ecas que tenen el seu servei en línia indisponible.

Eines i recursos:

*   **Dades dels ens integrats**: Es troben en la BBDD en MCIIOP AOC\_MCDCOC\_COLLEGI
*   **Monitors Àurea**: [http://10.124.95.14:8080/monitors/home.do](http://10.124.95.14:8080/monitors/home.do)

**1. Assignació i contacte**
============================

L'eina assignarà el tiquet del DCOC al responsable que estigui marcat a les sondes de Monitors.ST

![](attachments/64981316/64981367.png)

  

Un cop assignats, haurem de fer una primera revisió si el servei està caigut, o ha sigut un error puntual. Per fer-ho, podrem fer ús dels monitors del dcoc d'Àurea:

Executar un monitor del padró d'Àurea

Haurem d'accedir al servidor d'Amposta i accedir a la shell per SSH amb l'usuari de Catcert:

![](attachments/64981316/64981368.png)

  

Un cop dins haurem de moure'ns a la ruta on es troben els scripts que fan peticions contra els ens del padró:

cd /Monitors/DCOCMonitorv2

Després haurem d'executar l'script de l'col·legi/ECA que ens interessi provar:

./DcocCOACPROConsultaPRO

![](attachments/64981316/64981370.png)

*   Exemple OK:

![](attachments/64981316/64981371.png)

*   Exemple KO:

![](attachments/64981316/64981372.png)

  

Com es veu a la captura surt que la consuta ha fallat "KO!!!" i després indica el motiu. 

Revisar l'historic d'execucions dels monitors Àurea del padró

Per revisar els estats dels ajuntaments, podem anar a la [web de sondes del padró](http://10.124.95.14:8080/monitors/categories.do):

![](attachments/64981316/64981318.gif)

*   **OK color verd →** Tot correcte  
    **OK color groc**/**vermell** → és per temps, comprovar amb el col·legi  
    **KO en negre** → El servei no està funcionant correctament, s'han de fer les proves després explicades, i avisar l'ajuntament amb l'error que tenen

  

*   Si el servei respon correctament, podrem deixar el tiquet JIRA com a resolt, explicant que es tracta d'un error puntual que ja ha quedat resolt després de la revisió.
*   Si el servei no respon correctament, haurem d'enviar un correu als responsables del col·legi i haurem de deixar el tiquet JIRA en pendent d'informació explicant que hem contactat amb els tècnics i estem a l'espera d'obtenir més informació.
    *   Missatge Tipus (Canviar el nom del col·legi i el tiquet JIRA) :

**AOC\_SUPORT: Servei del DCOC indisponible - Col·legi d'arquitectes de Catalunya - #ST-12896**

Bon dia,

El vostre servei del DCOC està en estat d’error.

Podeu revisar-ho si us plau?

Salutacions i gràcies per avançat

**2\. Revisió exhaustiva**
==========================

Revisió bàsica dels ajuntaments

**Pas 0:** Fer un test del servei directament contra el col·legi.(podem utilitzar SoapUI des de la màquina de l'AOC) i apuntar l'error obtingut.

**Pas 1:** En cas que falli DESCARREGA\_HTTP. Podem comprovar el SFTP connectat-nos als SOA i tirant la següent comanda:

Cas correcte: 

![](attachments/64981316/64981374.png)

Amb errors:

![image2022-1-26_17-35-27.png](https://intranet.aoc.cat/download/attachments/26313406/image2022-1-26_17-35-27.png?version=1&modificationDate=1643214876961&api=v2)

Això vol dir que al col·legi els hi falta habilitar les ip's. o qué ens han afegit en una black list per algún motiu.

Haurem de dir-lis que habilitin les següents ips:

Per fer-ho ens hauran d'habilitar les següents IP's.

157.97.64.126

IP de sortida de diversos serveis d’AOC

Varis

157.97.64.35

serveis3-pre.iop.aoc.cat

Varis (PCI – integració web)

157.97.64.36

serveis3-pre.app.aoc.cat

Varis (PCI – integració web)

157.97.64.39

serveis3.iop.aoc.cat

Varis (PCI – integració web)

157.97.64.40

serveis3.app.aoc.cat

Varis (PCI – integració web

En cas que torni a fallar indicar que revisin el seu firewall o si ens han afegit en una blacklist.

  

Finalment, si les proves tornen a funcionar, tancarem la incidència al JIRA. En cas contrari, comentarem internament per mirar de resoldre l'error tan aviat com es pugui.

**Informació addicional**
=========================

  

  

Attachments:
------------

![](images/icons/bullet_blue.gif) [cds.gif](attachments/64981312/64981313.gif) (image/gif)  
![](images/icons/bullet_blue.gif) [CORPME - Procés d'alta de serveiSuport Tècnic16 marzo 2020Procediment a realitzar setmanalment per les altes del CORPME. Guia.url](attachments/64981312/64981314.url) (application/octet-stream)  

Document generated by Confluence on 02 June 2025 11:09

[Atlassian](http://www.atlassian.com/)