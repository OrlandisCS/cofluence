Suport Tècnic : Eina d'integradors  

1.  [Suport Tècnic](index.html)
2.  [Suport Tècnic](13893782.html)
3.  [01 - Gestió Operativa](26313391.html)
4.  [Tasques complementàries](26313409.html)

Suport Tècnic : Eina d'integradors
==================================

Created by OTEC ST Alessandro Trombin Martinez, last modified by OTEC ST JAlejandro Cardete Postigo on 12 December 2022

L'objectiu de l'eina d'integradors és registrar les dades de les integracions (Ens, empresa integradora, servei, etc.) per tal de consultar quins Ens tenim integrats als nostres serveis, quines són les empreses integradores i amb què Ens estan integrats. A més, podem consultar les dades de contacte dels Ens i de les empreses. 

Per accedir a l'eina d'integradors és través de l'URL [http://192.168.166.136:8080/ens/](http://192.168.166.136:8080/ens/)

Configuració de l'entorn i connexions.

**Configuració de l'entorn i connexions a la base de dades.**

La base de dades de l’eina de integradors es gestiona amb el programa **MySQL Query Browser**. La connexió a la base de dades és:

*   Server Host: **168.166.136**
*   Port: **3306**
*   Usuari: **root**
*   Password: **Keepass**

En la base de dades de l’eina de integradors, l’esquema que gestionarem és **ens\_empresa**, ón tenim 4 taules.

*   **Empresa:** Informació de les empreses integradores.
*   **Ens:** Informació dels Ens que se integren.
*   **Servei:** Informació dels Serveis.
*   **Ens\_emp:** Relació entre l’empresa, l’ens i el servei on demanen la integració.

  

Mantenir l'eina actualitzada.

Per mantenir l’eina actualitzada és important que després de cada integració que realitzem, creem una nova relació en l’eina mitjançant el formulari. Podeu veure-ho en l'apartat Global, en la FAQ d'Integracions.

Manteniment.

Per mantenir l’eina totalment actualitzada, hauria de ser suficient amb la creació de noves relacions en l’eina, però si detectem que l’eina està molt desactualitzada, haurem de realitzar els passos següents:

**Procediment de recerca**

*   Crearem un Excel per recopilar els Ens no informats o amb camps buits en la taula ens\_emp. En la ruta següent ruta del teams, teniu exemples: **01 - Gestión Operativa -> 03 Iniciatives i Millores -> Seguiment Integracions -> Ens que falten per afegir a Eina Llebaria**
*   Realitzarem una recerca de les dades que falten. Les podem consultar en:
    *   La mateixa Eina d’integradors buscant per l’Ens, ja que si tenim informació d’aquest Ens en altre servei, les dades seran les mateixes.
    *   En les carpetes FP de la xarxa perquè tindrem el formulari d’integració per consultar les dades.
        *   **e-NOTUM:** (Sharepoint) Tecnologia - SUPORT\_TECNIC\\SERVEIS\\eNotum\\01 Integració\\04 Altes de Serveis
            
        *   **e-TAULER:** (Sharepoint) Tecnologia - SUPORT\_TECNIC\\SERVEIS\\eTauler\\01 Integració\\04 Altes de Serveis
            
        *   **e-TRAM:** (Sharepoint) Tecnologia - SUPORT\_TECNIC\\SERVEIS\\ETRAM\\01 Integració\\04 Altes de Serveis
            
        *   **PSCP:** (Sharepoint) Tecnologia - SUPORT\_TECNIC\\SERVEIS\\PSCP\\01 Integració\\04 Altes de Serveis
            
        *   **RPC:** (Sharepoint) Tecnologia - SUPORT\_TECNIC\\SERVEIS\\RPC\\01 Integració\\04 Altes de Serveis
            
        *   **MUX:** (Sharepoint) Tecnologia - SUPORT\_TECNIC\\SERVEIS\\MUX\\01 Integració\\04 Altes de Serveis
            
        *   **Valid:** (Sharepoint) Tecnologia - SUPORT\_TECNIC\\SERVEIS\\Signador Centralitzat\\01 Integració\\04 Altes de Serveis
            
        *   **OVER:** (Sharepoint) Tecnologia - SUPORT\_TECNIC\\SERVEIS\\OVER\\01 Integració\\04 Altes de Serveis
            
        *   **DOGC:** (Sharepoint) Tecnologia - SUPORT\_TECNIC\\SERVEIS\\DOGC\\01 Integració\\04 Altes de Serveis
            
    *   En la base de dades de l’eina podrem consultar el tiquet footprints, si està informat, en la taula ens\_emp.
    *   En la base de dades del Footprints (en el welcome pack podem trobar com configurar l'entorn per consultar la base de dades).

**Query per cercar en la base de dades de FP.** Expand source

select m.mrID, m.mrTITLE, m.Servei, m.INE10,m.NomEns, m.Municipi, m.Afectaci\_\_UGLT\_, m.mrSUBMITDATE, m.EstatRetorn from MASTER15 m
--where m.Municipi like '%Agullana%'
--where m.INE10 = '1700100000'
where m.mrTITLE like '%DdG%'
--and m.mrTITLE like '%sant andreu de la barca%'
and m.mrSUBMITDATE >= '2019-11-01'
and m.mrSUBMITDATE < '2019-12-06'
--and m.Afectaci\_\_UGLT\_ = 'integracio'
--and m.mrALLDESCRIPTIONS like '%Ens complau confirmar-vos que hem procedit a configurar%'
--and m.NomEns like '%Cabanyes%'
--and m.Servei like '%EACAT\_\_bTR\_\_UGKO\_MITS%'
--and m.mrALLDESCRIPTIONS like '%notum%'
--and m.mrALLDESCRIPTIONS like '%OVER%'
--and m.EstatRetorn like '%integr%'
--where m.mrID >= '265943'
--and m.mrID < '265945'
and m.mrASSIGNEES like '%Suport%'

No trobem dades.

En cas de no trobar dades, en les dades de contacte informarem amb un ‘NA’.

En cas que no trobem dades de l’empresa, informem com Departament Tècnic Propi i amb el CIF de l’Ens.

**Procediment per insertar dades a la base de dades. -despegables**

  
Un cop tenim les dades localitzades dels Ens que volem informar, realitzarem l’INSERT a la base de dades en la taula ens\_emp.

**Query per inserir una nova relació.** Expand source

INSERT INTO ens\_empresa.ens\_emp (id\_ens, id\_emp,id\_servei,subservei,data,data\_act,tiquet,email\_en,telefon\_ens,email\_emp, telefon\_emp,mux\_eres) values(
(select id from ens\_empresa.ens e where ine ='1704700000'),
(select id from ens\_empresa.empresa e where CIF ='B59383596'),
(select id from ens\_empresa.servei e where servei ='eNOTUM'), 'NA','2016-08-26', SYSDATE(), 'N/A', 'MARGA@CASTELLO.CAT', '972250426', 'jceldran@absis.es', '934864601', 0)

Abans de realitzar l’INSERT en la taula ens\_emp, hem de comprovar si els Ens o empreses que tenim localitzats després de realitzar la recerca existeixen en la base de dades. Si us fixeu en la query, l’id de l’Ens i de l'empresa, els agafa de les taules ens i empresa, si l’empresa o l’Ens no existeixen a la base de dades l’INSERT fallarà i no es realitzarà.

Per realitzar la comprovació de l'existència dels Ens o empreses que tenim a l’Excel, realitzarem el següent:

*   En cas de l’Ens, agafem els INE10 i fem una taula a l’Excel i fem el següent per no tindre dades duplicades. ![](attachments/41519218/41519220.png)

Un cop tenim els INE10 sense duplicar, realitzem la següent consulta a la taula Ens:  

**Query per trobar Ens ja creats.** Expand source

SELECT \* FROM ens\_empresa.ens WHERE ine IN('11111111','00000000','444444444');

Si coincideixen el nombre de registres a la base de dades amb el número total de INE10 que volem informar, significa que tenim tots els Ens que volem informar creats, si no és què tenim algun Ens no informat a la taula Ens i l’haurem de crear**.** 

**Query per inserir Ens.** Expand source

INSERT INTO ens\_empresa.ens(nom,ine) VALUES('Ajuntament X','00000000');

*   En cas de les empreses, serà el mateix procediment però amb el CIF. 

**Queries per buscar i inserir empresa.** Expand source

\--CERCAR EMPRESES EXISTENTS A LA BASE DE DADES --
SELECT \* FROM ens\_empresa.empresa WHERE CIF IN('11111111Z','00000000B','444444444X');

--INSERIR EMPRESA
INSERT INTO ens\_empresa.empresa(nom,CIF) VALUES('Empresa X','00000000Z');

  

**Procediment per realitzar UPDATES.**

En cas que hàgim de realitzar alguna modificació en algun registre en les taules, podem fer-ho de dues maneres:

**IMPORTANT: REALITZAR BACKUP ABANS DE REALITZAR UN UPDATE:**

**![](attachments/41519218/41519221.png)**

*   Si només hem de modificar un camp o un registre, ho podem fer en el mateix programa (MySQL Query Browser) seguint les següents captures de pantalla: 

![](attachments/41519218/41519222.png)

En cas que necessitem modificar molts registres, podem utilitzar les següents queries:

**Queries per actualitzar** Expand source

\--UPDATE TIQUET--
SELECT \* FROM ens\_empresa.ens\_emp e where tiquet is not null AND tiquet != 'NA' AND tiquet !='N/A' AND tiquet < 100;

UPDATE ens\_empresa.ens\_emp e set tiquet = 'NA'
where tiquet is not null AND tiquet != 'NA' AND tiquet !='N/A' AND tiquet < 100;

--UPDATE EMAIL ENS--
SELECT \* FROM ens\_empresa.ens\_emp where email\_ens is not null AND email\_ens != 'NA' AND email\_ens !='N/A' AND length(email\_ens)< 1;

UPDATE ens\_empresa.ens\_emp e set email\_ens = 'NA'
where email\_ens is not null AND email\_ens != 'NA' AND email\_ens !='N/A' AND length(email\_ens)< 1;

--UPDATE TELEFON ENS--
SELECT \* FROM ens\_empresa.ens\_emp where telefon\_ens is not null AND telefon\_ens != 'NA' AND telefon\_ens !='N/A' AND length(telefon\_ens) < 1;

UPDATE ens\_empresa.ens\_emp e set telefon\_ens = 'NA'
where telefon\_ens is not null AND telefon\_ens != 'NA' AND telefon\_ens !='N/A' AND length(telefon\_ens)< 1;

--UPDATE EMAIL EMP--
SELECT \* FROM ens\_empresa.ens\_emp where email\_emp is not null AND email\_emp != 'NA' AND email\_emp !='N/A' AND length(email\_emp) < 1;

UPDATE ens\_empresa.ens\_emp e set email\_emp = 'NA'
where email\_emp is not null AND email\_emp != 'NA' AND email\_emp !='N/A' AND length(email\_emp)< 1;

--UPDATE TELEFON EMP--
SELECT \* FROM ens\_empresa.ens\_emp where telefon\_emp is not null AND telefon\_emp != 'NA' AND telefon\_emp !='N/A' AND length(telefon\_emp) < 1;

UPDATE ens\_empresa.ens\_emp e set telefon\_emp = 'NA'
where telefon\_emp is not null AND telefon\_emp != 'NA' AND telefon\_emp !='N/A' AND length(telefon\_emp)< 1;

Errors detectats.

De moment només tenim un error detectat (si en la relació tenim algun camp amb caràcters estranys, l’eina no generarà l’Excel a l’hora de consultar informació i ens retornarà l’error: Pàgina no disponible).

Per solucionar aquest error, haurem d’anar a la base de dades i comprovar si l’ens amb l’error té camps amb caràcters estranys i modificar-ho amb un UPDATE o amb l’opció de modificar del programa.

És important que a l’hora de realitzar una nova relació a l’eina mitjançant el formulari, no informem dades amb caràcters estranys, signes de puntuació o accents.

JIRA :   [ST-10419](https://contacte.aoc.cat/browse/ST-10419?src=confmacro) - Data cannot be retrieved due to an unexpected error.

Attachments:
------------

![](images/icons/bullet_blue.gif) [image2020-9-29\_19-14-45.png](attachments/41519218/41519219.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2020-9-29\_19-17-1.png](attachments/41519218/41519220.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2020-9-29\_19-26-11.png](attachments/41519218/41519221.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2020-9-29\_19-27-11.png](attachments/41519218/41519222.png) (image/png)  

Document generated by Confluence on 02 June 2025 10:47

[Atlassian](http://www.atlassian.com/)