Suport Tècnic : eNOTUM - FLUX DEL SERVEI - Informació del Servei i FAQ's generals  

1.  [Suport Tècnic](index.html)
2.  [Suport Tècnic](13893782.html)
3.  [02 - FAQ's serveis](26313393.html)
4.  [FAQ's ENOTUM](28705561.html)

Suport Tècnic : eNOTUM - FLUX DEL SERVEI - Informació del Servei i FAQ's generals
=================================================================================

Created by Unknown User (agonlara), last modified by Unknown User (oteccmorales) on 15 November 2022

Què és e-NOTUM?
===============

És un servei que permet realitzar notificacions d’actes administratius (resolucions, decrets, notificacions per a contractació, notificacions de sancions de trànsit, convocatòries d’òrgans col·legiats, etc) i comunicacions per mitjans electrònics, amb totes les garanties jurídiques que estableix la normativa vigent. Amb la intenció de poder reduir el format paper, costos i temps. 

  

Aquest servei segueix totes les polítiques d'enviament per [missatgeria PCI](https://suport-integradors.aoc.cat/hc/ca/articles/7352984409757-Documentaci%C3%B3-gen%C3%A8rica-per-a-integrar-se-a-la-PCI) com totes les aplicacions de l'AOC, inclosa la missatgeria especifica d'eNOTUM. Així doncs podrem tindre en compte que podrem realitzar proves a través de l'eina SOAPUI o preferiblement amb el [client JAVA que proporciona l'AOC](https://suport-integradors.aoc.cat/hc/ca/articles/7352984409757-Documentaci%C3%B3-gen%C3%A8rica-per-a-integrar-se-a-la-PCI) als integradors. 

Tot organisme que vulgui utilitzar e-NOTUM haurà de donar-se [d'alta al servei](https://suport-enotum.aoc.cat/hc/ca/articles/4412313373457-Com-sol-licitar-el-servei-e-NOTUM-). Un cop estiguin donats d'alta podran sol·licitar la integració. Un organisme que no estigui donat d'alta primer no podrem procedir a integrar-los a l'aplicació. 

**La gestió de les integracions les efectuarem nosaltres**, des del [procediment d'alta](https://steps.everis.com/confluence/display/AOC/e-NOTUM+-+Alta+de+servei) de la integració fins al suport al proveïdor que estigui integrant e-NOTUM a alguna aplicació per algun organisme en concret. 

  

Funcionalitat
=============

Per saber com funciona l'aplicació descriurem el procés de vida d'una notificació, des que un empleat públic la genera fins que la notificació acaba sent acceptada o expirada. 

### Creació d'una notificació:

L'empleat públic serà l'encarregat de crear les notificacions. Generalment les notificacions es crearan des d'eines exclusives de l'entitat (integració) creades per un proveïdor (ABSIS, Audifilm, T-Systems....) o bé des de l'EACAT. 

Per crear una notificació s'omplirà un formulari [informant les dades del o dels destinataris](https://steps.everis.com/confluence/display/AOC/eNotum+-+Notificacions+sense+dades+de+contacte+pel+destinatari). A més, d'un PDF adjunt, que és l'acte administratiu. Podent adjuntar un màxim de 5 adjunts, el límit màxim que poden adjuntar és de 6MB [tot i que la majoria d'ens tenen configurat 3MB,](https://steps.everis.com/confluence/pages/viewpage.action?pageId=1125759886) per prevenir una sobre càrrega en xarxa. 

Un cop l'empleat públic ha omplert les dades de la notificació correctament l'enviarà, si tot és correcte en cas d'utilitzar una aplicació integrada es validarà aquesta contra el SIRI, es registrarà a la PCI i arribarà a e-NOTUM. En cas de ser creada a través d'EACAT la petició no passarà pel SIRI.

![](attachments/26313306/26315292.png?effects=drop-shadow)

### Fases d'una notificació: 

Un cop l'empleat públic ha enviat la notificació, el següent procés impactarà contra els nostres sistemes procedint per unes fases de _**creació, registre i autenticació fins a ser dipositades**_. Anomenem a una notificació _dipositada_ quan ha sigut totalment generada en aquesta fase s'enviarà el missatge d'avís al destinatari assegurant que té una notificació electrònica a consultar.

_**Per ordre de procés:**_ 

  

Creada

Registrada

Dipositada

Visualitzada

Rebutjada sense accés

Rebutjada sense acció

Rebutjada

Acceptada

En error

CODI ESTAT

0

1

3

7

19

23

31

47

\>=1024

Estat NO Final

Estat final

Estat d'error

  

FASE CREACiÓ

**FASE\_CREACIÓ** → És la primera fase que es crea quan s'interacciona amb el sistema. Aquesta fase queda registrada en la BD d'eNOTUM.

Si ha arribat a aquesta fase, podem suposar que la notificació ha arribat a la PCI.

En la base de dades es crea la notificació amb la data/hora de la creació.

  

  

SELECT \*
FROM NT30.AOC\_NT\_NOTIFICACIONS NOTI
WHERE NOTI.DATA\_CREACIO >= to\_date ('25/03/2019','dd/mm/yyyy');

FASE REGISTRE

**FASE\_REGISTRE** → En la fase del registre hi ha una interacció amb l'aplicació del MUX, ja que aquesta serà l'encarregada de donar un número de registre a la notificació. Tindrem en compte que si l'aplicació del MUX fallés, la notificació no es genera i quedaria en estat d'error en l'estat de registre. Aquesta fase també queda registrada en la BD d'e-NOTUM.

En aquesta fase les notificacions poden donar error per altres motius que no sigui que l'aplicació del MUX falla. Per exemple tenim la FAQ: [eNOTUM - FLUX DEL SERVEI - ERRORS - Errors logs: EVENT-MOTOR](/pages/createpage.action?spaceKey=SII&title=eNOTUM+-+FLUX+DEL+SERVEI+-+ERRORS+-+Errors+logs%3A+EVENT-MOTOR&linkCreation=true&fromPageId=26313306) anirem registrant els casos que ens trobem a la FAQ per tots errors de la event motor.

A més a nivell de petició processar tramesa, els integradors (o des del mateix portlet d'eacat) existeix la possibilitat d'alegar un registre, indicant un número i data del mateix en l'element /Notificacio/DadesRegistre dins de la <Tramesa>. Si aquestes dades venen informades, es desaran a la BDD i no és programarà l'event motor de registre, ni es realitzarà la petició a MUX.

SELECT \*
FROM NT30.AOC\_NT\_NOTIFICACIONS NOTI
WHERE NOTI.DATA\_REGISTRE >= to\_date ('25/03/2019','dd/mm/yyyy');

  
A més, en aquesta fase no sols el MUX executa processos per donar un número de registre a la notificació, en el motor d'e-NOTUM es generà un event de registre. Aquesta fase la processa interaccionat amb la BD i el [RDBMS](https://steps.everis.com/confluence/display/AOC/Sondes+-+eNOTUM) (e-Notum-Motor). 

SELECT \*
FROM NT30.AOC\_NT\_EVENT\_MOTOR MOTOR
WHERE MOTOR.FASE = 'FASE\_REGISTRE'

  
Resumint el flux, un cop s'ha creat en base de dades la notificació,  en la taula event\_motor es crea un registre de "fase\_registre" en estat 0 (pendent de processar) i reintents 0. El RDBMS actualitza l'estat a 1 processant i el motor d'e-Notum la registra. En cas de ser executat amb èxit, la notificació queda registrada i aquest registra s'esborra de la taula event\_motor passant a la fase de signatura. En cas de donar error s'aplicarà la política de reintents. Un cop finalitzat la política de reintents (6) la notificació quedarà en error ["Error irrecuperable en fase registre"](https://steps.everis.com/confluence/display/AOC/eNOTUM+-++Error+irrecuperable.+En+fase+registre).

  

**En cas de rebre una incidència que les notificacions s'estan quedant en aquest estat NO LES REINICIAREM, analitzarem el motiu per què no s'estan registrant i actuarem. Un cop trobat l'error i s'ha solucionat, indicarem a l'usuari que aquestes notificacions que s'han quedat en l'estat irrecuperable les haurà de tornar a enviar (si ells ho troben convenient, no és obligatori si no volen).**

FASE\_SIGNATURA (no event\_motor)

**FASE\_SIGNATURA** → Un cop la notificació ja és registrada aquesta se signarà per donar autenticitat. Aquesta fase no treballa amb el motor d'e-NOTUM com hem vist en el cas anterior però sí que interacciona altres aplicacions com validadors de certificats, PSIS, etc. 

SELECT \*
FROM NT30.AOC\_NT\_NOTIFICACIONS NOTI
WHERE NOTI.DATA\_CREACIO >= to\_date ('25/03/2019','dd/mm/yyyy');

Si executem la query i ens fixem amb el **c****amp de data\_publicació i data\_signatura** podrem veure que els dos camps són la mateixa data. Ja que, quan la notificació és signada també és dipositada. 

Per més informació de la signatura de la notificació podem consultar la faq [eNOTUM - Signatura de la notificació amb els certificats del TRUSTEDX](26313373.html).

  

**Aquesta fase no es processa en la event motor.**

**En cas de rebre una incidència que les notificacions s'estan quedant en aquest estat NO LES REINICIAREM, analitzarem el motiu per què no s'estan registrant i actuarem, normalment es queden en estat irrecuperable en la fase de signatura per què tenen el certificat del trustedX caducat o bé no està carregat.**

**Un cop trobat l'error i s'ha solucionat, indicarem a l'usuari que aquestes notificacions que s'han quedat en l'estat irrecuperable les haurà de tornar a enviar (si ells ho troben convenient, no és obligatori si no volen).**

FASE DIPÓSIT

**FASE\_DIPÒSIT** → En la fase dipòsit es generen vàries accions. 

**L'avís al destinatari**: Per avisar al destinatari que té una notificació se li enviarà un correu electrònic i/o SMS.

Per revisar els enviaments d'avisos: [eNOTUM - Error en rebre avís notificació per correu](26313432.html) El procés de les comunicacions es gestionen des de la event comunicació. Un procés similar a la event motor però per les comunicacions.

select \*
  from nt30.aoc\_nt\_logs\_comunicacio c
 where c.id\_notificacio in ('5417636');

*   La generació del PDF de dipòsit (_**En cas de comunicació, en cas de notificació es crearà en estat final)**_:  
    Aquesta fase es processa a través de la event motor com veiem en la següent consulta i depenent del seu [RDBMS (eNotum-Motor(nomesGenPdf))](https://steps.everis.com/confluence/display/AOC/Sondes+-+eNOTUM).
    
       select \*
        from nt30.aoc\_nt\_event\_motor mm
        where mm.fase = 'FASE\_GENERACIO\_PDF\_DIPOSIT'
    
    En cas d'error: [eNOTUM - Error notificació estat "1027 i 1031" FASE\_GENERACIO\_PDF\_DIPOSIT](/pages/createpage.action?spaceKey=SII&title=eNOTUM+-+FLUX+DEL+SERVEI+-+ERRORS+-+Error+notificaci%C3%B3+estat+%221027+i+1031%22+FASE_GENERACIO_PDF_DIPOSIT&linkCreation=true&fromPageId=26313306)
    

*   Enviament de callback de canvi d'estat a dipositada:
    
    select \*
      from nt30.aoc\_nt\_logs\_comunicacio c
     where c.id\_notificacio in ('5417636');
    
    El tipus de comunicació pels callbacks és WS.  
    El missatge enviat el trobarem al camp Missatge on l'estat sigui 0.  
    ![](attachments/26313306/26317191.png?effects=drop-shadow)
    

FASE VISUALITZADA (no event motor)

**Notificació visualitzada**→ Un cop tenim la notificació dipositada i l'usuari rep l'avís que té una notificació, podrà accedir-hi a través de l'enllaç que hi ha en el mateix avís.

Aquest enllaç dirigirà a l'usuari a la web del ciutadà: [https://usuari.enotum.cat/webCiutada/login#](https://usuari.enotum.cat/webCiutada/login)

Des d'aquest portal l'usuari podrà accedir-hi de dues maneres.

  

Mitjançant eNOTUM ciutadà:

**Certificat**: En la petició de la notificació s'ha especificat que s'ha d'accedir amb nivell d'accés SUBSTANCIAL o ALT, i a més s'ha informat les dades del destinatari com el CIF en cas de persona jurídica o NIF per persona física.

En fer l'accés eNOTUM farà matching entre les dades del certificat (NIF al qual està lligat) i les dades que consten al bloc destinatari de la petició que es va realitzar per generar la notificació.

![](attachments/26313306/41522887.png)

  

**Paraula de pas**: En la petició per generar la notificació s'jha especificat nivell d'accés BAIX. També s'ha afegit correu o telèfon i NIF al bloc de destinataris.

Així que un cop l'usuari estigui en el portal web del ciutadà, haurà d'introduir el seu NIF i correu o telèfon. eNOTUM farà matching amb les dades introduides i les que constaven al bloc destinataris de la petició per generar la notificació.

Seguidament l'usuari rebrà una paraula de pas al correu o telèfon, per accedir-hi.

![](attachments/26313306/41522886.png)

  

[Un cop s'accedeix a la notificació aquesta s'acceptarà.](https://steps.everis.com/confluence/display/AOC/eNOTUM+-+Estats+Notificacions+per+integrar-se+a+NT) En cas d'integrador pot fer l'opció que en accedir a la notificació hagi d'acceptar-la o rebutjar-la manualment. Des de la marca blanca (e-NOTUM Ciutadà) no hi ha aquesta opció.  
  
Un cop visualitzada es genera una evidència. [Aquesta evidència sempre es generarà quan estigui en un estat final.](https://steps.everis.com/confluence/pages/viewpage.action?pageId=1136657999) Excep\`te en le cas de comunicacions, que, com que no expiren, generaran una evidència de dipòsit.  
  
Possible cas d'error quan una notificació ha estat visualitzada: [eNOTUM - Error notificació estat "1027 i 1031" FASE\_GENERACIO\_PDF\_DIPOSIT](/pages/createpage.action?spaceKey=SII&title=eNOTUM+-+FLUX+DEL+SERVEI+-+ERRORS+-+Error+notificaci%C3%B3+estat+%221027+i+1031%22+FASE_GENERACIO_PDF_DIPOSIT&linkCreation=true&fromPageId=26313306)

  

Mitjançant Valid:

Si l'usuari fa clic a AMB IDCAT MOBIL, eNOTUM farà una crida a valid per fer el login:

![](attachments/26313306/41522888.png)

Redirigeix a VALID:

![](attachments/26313306/41522889.png)

FASE ACCEPTADA (no event motor)

**Notificació acceptada →** Les notificacions que s'accedeixin per via de marca blanca, es a dir que no utilitzin una bústia integrada per alguna entitat seran acceptades automàticament.

En canvi hi ha entitats com l'Ajuntament de Barcelona que s'ha d'acceptar explícitament, si el destinatari no l'accepta la notificació, quedarà en estat visualitzada i si passen els dies d'expiració la notificació passarà a estat "rebutjada sense acció". En l'evidència es detallarà aquest estat i que ha sigut rebutjada pel sistema e-Notum

  

FASE REBUTJADA (no event motor)

**Notificació rebutjada**→ Aquesta fase es produeix quan la notificació s'expira o bé quan l'usuari l'ha rebutjat explícitament per eines d'integració.

*   Sense accés: El destinatari no ha accedit a la notificació.
*   Sense acció: El destinatari ha visualitzat la notificació però no l'acceptat.  
      
    

FASE RECORDATORI

**FASE\_RECORDATORI** → [Es pot definir en la petició](https://github.com/ConsorciAOC/eNotum/blob/master/missatgeria/README.md#diesavisos) nombre de dies a comptar a partir de l'enviament pel qual s'enviaran recordatoris al/s destinatari/s de la notificació mentre aquesta no es trobi en un estat final.

Aquesta fase es torna a enviar un correu amb el destinatari:

\--Podem revisar els logs si s'ha generat la fase amb èxit.

select \*
  from nt30.aoc\_nt\_logs c
where c.nom\_fase\_motor = 'FASE\_RECORDATORI'
 and c.id\_notificacio in ('5213877');


-- Podem veure en la event motor si aquesta fase ha donat error.
  select mm.\*
  from nt30.aoc\_nt\_event\_motor mm, nt30.aoc\_nt\_notificacions nn
  where mm.fase = 'FASE\_RECORDATORI' 
 and c.id\_notificacio in ('5213877');


--En cas afirmatiu es pot de reiniciar la fase. 
update aoc\_nt\_event\_motor
  set reintent = 3, estat = 0
 where id\_notificacio in ('5391559')
  and fase = 'FASE\_RECORDATORI';

  

FASE EXPIRACIÓ

**FASE\_EXPIRACIÓ** → En el cas de les notificacions, [es pot informar els dies de validesa d'una notificaci](https://github.com/ConsorciAOC/eNotum/blob/master/missatgeria/README.md#notificaci%C3%B3)ó. Un cop passat aquests dies la notificació expirarà.

Un cop la notificació queda expirada ja no serà accessible pel destinatari i quedarà en estat final de rebutjada sense acció.

*   *   Es generarà l'evidència de la notificació
        
    *   S'enviarà avís de canvi d'estat a l'emissor de la notificació.
        
        \--Podem revisar els logs si s'ha generat la fase amb èxit.
        
        select \*
          from nt30.aoc\_nt\_logs c
        where c.nom\_fase\_motor = 'FASE\_EXPIRACIO'
         and c.id\_notificacio in ('5213877');
        
        
        -- Podem veure en la event motor si aquesta fase ha donat error.
          select mm.\*
          from nt30.aoc\_nt\_event\_motor mm, nt30.aoc\_nt\_notificacions nn
          where mm.fase = 'FASE\_EXPIRACIO' 
         and c.id\_notificacio in ('5213877');
        
        
        --En cas afirmatiu es pot de reiniciar la fase. 
        
        update aoc\_nt\_event\_motor
          set reintent = 3, estat = 0
         where id\_notificacio in ('5391559')
          and fase = 'FASE\_EXPIRACIO';
        

En cas d'incidències en aquesta fase consultar: [eNOTUM - Error notificació estat "1027" FASE\_EXPIRACIO](/pages/createpage.action?spaceKey=SII&title=eNOTUM+-+FLUX+DEL+SERVEI+-+ERRORS+-+Error+notificaci%C3%B3+estat+%221027%22+FASE_EXPIRACIO&linkCreation=true&fromPageId=26313306)  

  

Attachments:
------------

![](images/icons/bullet_blue.gif) [image2019-3-25\_19-55-35.png](attachments/26313306/26315292.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2019-4-18\_15-10-27.png](attachments/26313306/26317191.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2021-5-4\_13-51-58.png](attachments/26313306/41522885.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2021-5-4\_13-52-41.png](attachments/26313306/41522886.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2021-5-4\_13-53-2.png](attachments/26313306/41522887.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2021-5-4\_13-54-2.png](attachments/26313306/41522888.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2021-5-4\_13-55-13.png](attachments/26313306/41522889.png) (image/png)  

Document generated by Confluence on 02 June 2025 10:53

[Atlassian](http://www.atlassian.com/)