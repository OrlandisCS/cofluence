Projectes : Query recuperació CRL de BD a partir del DistributionPoint i les dates de validesa  

1.  [Projectes](index.md)
2.  [PSIS](PSIS_24215797.md)
3.  [PSIS - WIKI](PSIS---WIKI_24215598.md)
4.  [Scripts SQL](Scripts-SQL_24215612.md)

Projectes : Query recuperació CRL de BD a partir del DistributionPoint i les dates de validesa
==============================================================================================

Created by Áurea Alcaide, last modified on 08 julio 2019

 Cerca:

        select
            crls.ID as ID66\_0\_,
            this\_1\_.ISSUER\_DN as ISSUER2\_66\_0\_,
            this\_1\_.ISSUER\_KI as ISSUER3\_66\_0\_,
            this\_1\_.VALID\_UNTIL as VALID4\_66\_0\_,
            this\_1\_.RETRIEVALDATE as retrieva5\_66\_0\_,
            this\_1\_.ASN1DATAID as ASN6\_66\_0\_,
            crls.CRL\_NUMBER as CRL2\_68\_0\_,
            crls.NEXT\_UPDATE as NEXT3\_68\_0\_,
            crls.VERSION as VERSION68\_0\_,
            crls.DISTRIBUTION\_POINT as DISTRIBU6\_68\_0\_,
            crls.THIS\_UPDATE as THIS5\_68\_0\_,
            this\_2\_.BASE\_CRL\_NUMBER as BASE2\_69\_0\_,
            this\_2\_.BASE\_CRL\_ID as BASE3\_69\_0\_,
            case 
                when this\_2\_.ID is not null then 2 
                when crls.ID is not null then 1 
            end as clazz\_0\_ 
        from
            D\_RI\_ATL\_RSI\_CRLS\_YYYY crls 
        inner join
            D\_RI\_ATL\_RSI\_YYYY this\_1\_ on crls.ID=this\_1\_.ID 
        left outer join
            D\_RI\_ATL\_RSI\_DELTACRLS\_YYYY this\_2\_ on crls.ID=this\_2\_.ID 
        where
            crls.DISTRIBUTION\_POINT = XXXXXXXX
            and crls.THIS\_UPDATE <= TO\_DATE('XX/XX/XXXX', 'DD/MM/YYYY')
            and this\_1\_.VALID\_UNTIL>= TO\_DATE('XX/XX/XXXX', 'DD/MM/YYYY')
        order by
            crls.THIS\_UPDATE desc

  

On cal substituir:

*   _**YYYY**_ (línies 20, 22, i 24) al nom de les taules, per l'any on volguem realitzar la cerca.
*   _**XXXXXXXX**_ (línia 26) per l'ID del distribution point sobre el que volem cerca (obtenir-lo de la taula D\_RI\_ATL\_DPOINT\_NAMES).
*   _**XX/XX/XXXX**_ (línies 27 i 28) en cada cas per les dates corresponents:
    *   **THIS\_UPDATE**: data d'emissió de la CRL
    *   **VALID\_UNTIL = RETRIEVALDATE + CAUTIONARY PERIOD**  
        1.  RETRIEVALDATE és la data en què PSIS s'ha baixat la CRL de comunicacions.
        2.  CAUTIONARY PERIOD: Típicament uns 10 minuts. Es pot especificar per configuració.

  

Exemple de cerca per les taules de l'any 2018:

select
 crls.ID as ID66\_0\_,
 this\_1\_.ISSUER\_DN as ISSUER2\_66\_0\_,
 this\_1\_.ISSUER\_KI as ISSUER3\_66\_0\_,
 this\_1\_.VALID\_UNTIL as VALID4\_66\_0\_,
 this\_1\_.RETRIEVALDATE as retrieva5\_66\_0\_,
 this\_1\_.ASN1DATAID as ASN6\_66\_0\_,
 crls.CRL\_NUMBER as CRL2\_68\_0\_,
 crls.NEXT\_UPDATE as NEXT3\_68\_0\_,
 crls.VERSION as VERSION68\_0\_,
 crls.DISTRIBUTION\_POINT as DISTRIBU6\_68\_0\_,
 crls.THIS\_UPDATE as THIS5\_68\_0\_,
 this\_2\_.BASE\_CRL\_NUMBER as BASE2\_69\_0\_,
 this\_2\_.BASE\_CRL\_ID as BASE3\_69\_0\_,
 case 
 when this\_2\_.ID is not null then 2 
 when crls.ID is not null then 1 
 end as clazz\_0\_ 
 from
 D\_RI\_ATL\_RSI\_CRLS\_2018 crls 
 inner join
 D\_RI\_ATL\_RSI\_2018 this\_1\_ on crls.ID=this\_1\_.ID 
 left outer join
 D\_RI\_ATL\_RSI\_DELTACRLS\_2018 this\_2\_ on crls.ID=this\_2\_.ID 
 where
 crls.DISTRIBUTION\_POINT=19264277
 and crls.THIS\_UPDATE<=TO\_DATE('14/06/2018', 'DD/MM/YYYY')
 and this\_1\_.VALID\_UNTIL>= TO\_DATE('12/06/2018', 'DD/MM/YYYY')
 order by
 crls.THIS\_UPDATE desc

Document generated by Confluence on 07 junio 2025 00:00

[Atlassian](http://www.atlassian.com/)