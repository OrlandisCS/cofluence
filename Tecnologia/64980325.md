Suport Tècnic : Monitor S.T. - Padró - Padrons indisponibles  

1.  [Suport Tècnic](index.html)
2.  [Suport Tècnic](13893782.html)
3.  [03 - Monitorització - Revisions globals](26313327.html)
4.  [Monitors S.T.](Monitors-S.T._41522177.html)

Suport Tècnic : Monitor S.T. - Padró - Padrons indisponibles
============================================================

Created by Unknown User (otecobernal), last modified on 22 February 2022

Què mesura aquest monitor?

Aplicacions del padró que no estan donant servei.

  

**Consulta**
============

* * *

SELECT AJUNTAMENTS\_CAIGUTS.descripcio "ENS",
       (case
                when (sysdate - AJUNTAMENTS\_CAIGUTS.ultim\_OK) >= 1 then
                 CAST((sysdate - AJUNTAMENTS\_CAIGUTS.ultim\_OK) AS INT) || ' dies' -- Número de dies caiguts
                when 24\*(sysdate - AJUNTAMENTS\_CAIGUTS.ultim\_OK) >= 1 then
                 CAST(24 \* (sysdate - AJUNTAMENTS\_CAIGUTS.ultim\_OK) AS INT) || ' hores' -- Número de hores caiguts
                when 24\*(sysdate - AJUNTAMENTS\_CAIGUTS.ultim\_OK) < 1 then
                 CAST(24 \* 60 \* (sysdate - AJUNTAMENTS\_CAIGUTS.ultim\_OK) AS INT) || ' minuts' -- Número de minuts caiguts
              end) as "TEMPS CAIGUT"
  from (
    select KOS.descripcio, KOS.ultim\_KO, OKS.ultim\_OK
          from
                -- Seleccionem els KOs
                (select indxa.ultim\_KO, indxa.descripcio, logs.resultat
                   from monitors.estadistiques logs,
                        (select max(logs.data) as ultim\_KO,
                                tt.descripcio,
                                logs.id\_transaccio
                           from monitors.estadistiques logs,
                                monitors.transaccions  tt
                          where logs.id\_transaccio = tt.id\_transaccio
                            and tt.id\_servei = 104
                            and tt.Id\_Transaccio not in
                                (2568, 2566, 2567, 2569, 2565) -- ens que ja no tenen padro
                          group by logs.id\_transaccio, tt.descripcio) indxa
                  where indxa.ultim\_KO = logs.data
                    and indxa.id\_transaccio = logs.id\_transaccio
                    and logs.resultat = 'KO') KOS,

               -- Seleccionem els OKs
               (select max(logs.data) as ultim\_OK,
                       tt.descripcio,
                       logs.id\_transaccio
                  from monitors.estadistiques logs, monitors.transaccions tt
                 where tt.id\_servei = 104
                   and logs.id\_transaccio = tt.id\_transaccio
                   and logs.resultat = 'OK'
                   and tt.Id\_Transaccio not in (2568, 2566, 2567, 2569, 2565) -- ens que ja no tenen padro
                 group by logs.id\_transaccio, tt.descripcio) OKS
         where OKS.descripcio(+) = KOS.descripcio -- juntem OKs amb KOs
         and 24 \* (sysdate - OKS.ultim\_OK) >= 5 -- més de 12 hores caiguts
         order by OKS.ultim\_OK asc -- ordenem per temps que porten caiguts
        ) AJUNTAMENTS\_CAIGUTS
        order by AJUNTAMENTS\_CAIGUTS.ultim\_OK asc

**Procediment**
===============

* * *

A continuació s'explicarà el procediment de revisió dels ajuntaments, diputacions i/o consells comarcals que tenen el seu padró en línia indisponible.

Eines i recursos:

*   **Dashboard de l'estat del padró**: [https://contacte.aoc.cat/secure/Dashboard.jspa?selectPageId=10902](https://contacte.aoc.cat/secure/Dashboard.jspa?selectPageId=10902)
*   **Dades dels ens integrats**: (Sharepoint) Tecnologia - SUPORT\_TECNIC\\SERVEIS\\PADRO\\Dades ens
*   **Monitors Àurea**: [http://10.124.95.14:8080/monitors/home.do](http://10.124.95.14:8080/monitors/home.do)

  

Informació addicional:

Cada dia rebem correus a la nostra bústia personal a les 8:10 i a les 13 del matí, amb informació sobre els serveis que no es troben disponibles:

*   **Assumpte:** AOC\_SUPORT: Monitoratge Ajuntaments - DD/MM/YYYY

![](attachments/41522807/41522854.png)

  

**1. Assignació i contacte**
============================

El primer pas de la tasca serà assignar-se els tiquets JIRA d'alerta dels padrons indisponibles. Per fer-ho haurem d'accedir al dashboard i assignar-nos els tiquets nous (assignats a botpadro):

![](attachments/41522807/41522856.png)TO CHANGE

  

Un cop assignats, haurem de fer una primera revisió si el servei està caigut, o ha sigut un error puntual. Per fer-ho, podrem fer ús dels monitors del padró d'Àurea:

Executar un monitor del padró d'Àurea

Haurem d'accedir al servidor d'Amposta i accedir a la shell per SSH:

![](attachments/41522807/41522858.png)

  

Un cop dins haurem de moure'ns a la ruta on es troben els scripts que fan peticions contra els ens del padró:

cd /Monitors/PADROMonitor

Després haurem d'executar l'script de l'ajuntament/diputació/consell comarcal que ens interessi provar:

./PADROSeuurgellMonitorPRO.sh

![](attachments/41522807/41522829.png)

*   Exemple OK:

![](attachments/41522807/41522828.png)

*   Exemple KO:

![](attachments/41522807/41522827.png)

  

Per obtenir informació històrica sobre el servei, ho podrem consultar a través de la web:

Revisar l'historic d'execucions dels monitors Àurea del padró

Per revisar els estats dels ajuntaments, podem anar a la [web de sondes del padró](http://10.124.95.14:8080/monitors/categories.do):

![](attachments/41522807/41522857.gif)

*   **OK color verd →** Tot correcte  
    **OK color groc**/**vermell** → és per temps, comprovar amb l'ajuntament  
    **KO en negre** → El servei no està funcionant correctament, s'han de fer les proves després explicades, i avisar l'ajuntament amb l'error que tenen

  

*   Si el servei respon correctament, podrem deixar el tiquet JIRA com a resolt, explicant que es tracta d'un error puntual que ja ha quedat resolt després de la revisió.
*   Si el servei no respon correctament, haurem d'enviar un correu als responsables de l'ajuntament i haurem de deixar el tiquet JIRA en pendent d'informació explicant que hem contactat amb els tècnics i estem a l'espera d'obtenir més informació.
    *   Missatge Tipus (Canviar el nom de l'ajuntament i el tiquet JIRA) :

**AOC\_SUPORT: Servei del padró indisponible - Ajuntament de la Seu d'Urgell - #ST-12896**

Bon dia,

El vostre servei del padró està en estat d’error.

Podeu revisar-ho si us plau?

Salutacions i gràcies per avançat

**2\. Revisió exhaustiva**
==========================

Revisió bàsica dels ajuntaments

**Pas 0:** Fer un test de l'estat de l'Ajuntament a través de la màquina Amposta.

**Pas 1:** Fer un test del servei directament contra l'Ajuntament (podem utilitzar SoapUI des de la màquina de l'AOC) i apuntar l'error obtingut.

**Pas 2:** Revisar que tenim connectivitat al seu endpoint (des de la màquina back i amb l'ajuda de la màquina de l'AOC). Per fer-ho seguim les següents passes:

*   **Pas 2.1:** Ens connectem a la web d'administració del padró per veure l'endpoint del servei (haurem de buscar l'ajuntament en qüestió): [http://10.120.4.57/pci3-pmh-admin/](http://10.120.4.57/pci3-pmh-admin/)

![](attachments/41522807/41522809.png)

Trobarem l'endpoint al camp URL Dispatch:

![](attachments/41522807/41522808.png)

  

*   **Pas** 2.2: Ens connectem a la màquina de l'AOC, obrim el Chrome i ens connectem a l'endpoint. Si el servei està aixecat i hi tenim connectivitat veurem alguna cosa com el següent:  
    ![](attachments/41522807/41522812.png)  
      
    En cas que la pàgina no carregui, significa que no tenim connectivitat a l'endpoint on està aixecat el servei web del Padró. Hauríem d'informar a l'ajuntament de l'endpoint al qual apuntem i demanar-los que ho revisin o que ens habilitin connexió, per tal de reiniciar el servei.

**Pas 3:** Connectar-nos al servidor de l'Ajuntament i revisar l'aplicació (amb l'ajuda de l'Excel que trobarem a **(Sharepoint) Tecnologia - SUPORT\_TECNIC\\SERVEIS\\PADRO\\Dades ens**).

*   **Pas 3.1:** Si la connexió no funciona, haurem de trucar a l'Ajuntament per demanar que ens habilitin la connexió on ens obrin una nova (podem utilitzar el Team Viewer).
*   **Pas 3.2:** Revisar l'hora del servidor, si està més d'un minut desincronitzat, l'haurem de canviar.
*   **Pas 3.3:** Revisar els logs de l'aplicació per obtenir més informació de l'error.
*   **Pas 3.4:** Reiniciar l'aplicació i tornar a fer les proves adients.
*   **Pas 3.5:** Si l'error persisteix, comentar el JIRA amb les accions realitzades i comentar internament (Important no deixar passar molt temps perquè no es perdi la connexió).

Altres accions que poden ser útils:

*   Revisar l'hora del servidor: A vegades si està un minut avançada o endarrerida, les peticions fallen a la MTI.
*   Netejar els logs (a vegades fallen per problemes d'espai).
*   Reiniciar el servidor (a vegades no arriben les peticions i no és un problema de falta d'IP's)

  

Finalment, si les proves tornen a funcionar, tancarem la incidència al JIRA. En cas contrari, comentarem internament per mirar de resoldre l'error tan aviat com es pugui.

**Informació addicional**
=========================

  

  

Attachments:
------------

![](images/icons/bullet_blue.gif) [CORPME - Procés d'alta de serveiSuport Tècnic16 marzo 2020Procediment a realitzar setmanalment per les altes del CORPME. Guia.url](attachments/64980325/64980326.url) (application/octet-stream)  
![](images/icons/bullet_blue.gif) [cds.gif](attachments/64980325/64980327.gif) (image/gif)  

Document generated by Confluence on 02 June 2025 11:09

[Atlassian](http://www.atlassian.com/)