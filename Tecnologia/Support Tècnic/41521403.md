Suport Tècnic : Revisió PSIS - NEXICA  

1.  [Suport Tècnic](index.md)
2.  [Suport Tècnic](13893782.md)
3.  [04 - Tècnica de sistemes + 24x7 + Padró](26313202.md)
4.  [Revisió de serveis](36340340.md)
5.  [PSIS - Revisions i Restabliment](PSIS---Revisions-i-Restabliment_41521345.md)
6.  [Revisió PSIS](41521401.md)

Suport Tècnic : Revisió PSIS - NEXICA
=====================================

Created by Unknown User (otecobernal), last modified on 15 July 2021

Revisió de l'Splunk
===================

* * *

[http://10.123.4.52:8000/en-GB/account/login?return\_to=%2Fen-GB%2Fapp%2Fcatcert\_reports%2Fconsultas\_catcert\_tiemporeal\_pro](http://10.123.4.52:8000/en-GB/account/login?return_to=%2Fen-GB%2Fapp%2Fcatcert_reports%2Fconsultas_catcert_tiemporeal_pro)

Revisió de Xarxa
================

Revisió general del servei

L'origen de l'error por venir produït per problemes de connectivitats amb els components de l'arquitectura de PSIS.

En el cas de que totes les transaccions estiguin en estat KO, caldrà revisar si hi ha algun problema de xarxa: balancejadors, frontals web, servidors de DNS, etc...

*   Comprovar si el WSDL del servei es pot descarregar

El WSDL està penjat a l’Apache, i està accessible des de la següent URL:

*   [http://psis.catcert.cat/wsdl/dss.wsdl](http://psis.catcert.cat/wsdl/dss.wsdl)
*   [http://185.86.34.132/wsdl/dss.wsdl](http://185.86.34.132/wsdl/dss.wsdl)

Ha d’aparèixer una plana del tipus:

![](attachments/41521403/41523845.png)

Si no està accessible, comprovar DNS, balancejadors, i Apaches. Comprovar que el servei PSIS està accessible:

*   [http://psis.catcert.cat/](http://psis.catcert.cat/psis/catcert/dss)[psis/catcert/dss](http://185.86.34.132/psis/catcert/dss)
*   [http://185.86.34.132/psis/catcert/dss](http://185.86.34.132/psis/catcert/dss)

Ha d’aparèixer una plana del tipus:

![](attachments/41521403/41523846.png)

Com veiem apareix el nom de PSIS i la versió desplegada (en aquest cas, la 6.0.0).

Podem provar per cadascun dels nodes, per veure si algun d’ells està donant problemes.

*   [http://10.123.5.188:8080/psis/catcert/tdss](http://10.123.5.188:8080/psis/catcert/tdss)
*   [http://10.123.5.189:8080/psis/catcert/tdss](http://10.123.5.189:8080/psis/catcert/tdss)
*   [http://10.123.5.178:8080/psis/catcert/tdss](http://10.123.5.178:8080/psis/catcert/tdss)
*   [http://10.123.5.179:8080/psis/catcert/tdss](http://10.123.5.179:8080/psis/catcert/tdss)

Si tot és correcte, la plana que apareixerà ha de ser del mateix tipus que l’anterior.

WILDFLY
=======

Connexió amb el servidor

Servidors 
==========

*   Node1: **aoc-cl-psis-wf01-pro → 10.123.5.188**
    
*   Node2: **aoc-cl-psis-wf02-pro → 10.123.5.189**
*   Node3: **aoc-cl-psis-wf03-pro → 10.123.5.178**
*   Node4: **aoc-cl-psis-wf04-pro → 10.123.5.179**
*   User: **wildfly**

*   Node1: **aoc-cl-wf01-pre → 10.123.69.163**
    
*   Node2: **aoc-cl-wf02-pre** **→ 10.123.69.164**
*   User: **aoc/wildfly**

Revisió del WildFly

Revisió dels logs
=================

Per revisar errors podem mirar els logs del WildFly (server.log):

*   __/apps/wildfly/standalone/log/server.log__  

  

Si veiem que efectivament hi ha algun problema, podem procedir amb el reinici.

  

Revisió de l'Splunk
===================

**SPLUNK NEXICA**: [http://10.123.4.52:8000/en-GB/app/catcert\_reports/consultas\_catcert\_tiemporeal\_pro](http://10.123.4.52:8000/en-GB/app/catcert_reports/consultas_catcert_tiemporeal_pro)

*   Usuari: aoc
*   A l'opció de menú “Producció”, seleccionar “Nexica Temps Real – Entorn de Producció”, per veure les operacions que s’estan processant a PSIS en temps real.

A les opcions abans indicades tenim diferents gràfics que monitoritzen diferents aspectes del funcionament en temps real. Per exemple, a Nexica veiem, entre d’altres, els següents gràfics (tenim els equivalents per Kyndryl a l’Splunk de Kyndryl):

  

![](attachments/41521428/81855998.png)

**En blau** → Les peticions processades per cada un dels nodes. Si algun no està processant peticions com els altres és possible que l'haguem de reiniciar.

**En vermell** → El temps màxim, mínim i mig que triga PSIS a processar les peticions. No hauria de passar de 2 o 3 segons.

Reinici del WildFly

  

L’script de balanceig dels frontals no contempla encara els nodes WildFly. **NO BALANCEJAR DE NOU ELS NODES 1,2,3, o 4**, doncs aixecarà els JBoss (plataforma antiga)

Reinici:  
  

==============

Reiniciar el node afectat

**Aturar el Wildfly**

sudo /etc/init.d/wildfly stop

Comprovar que el Wildfly estigui efectivament aturat:

**Revisar el procés**

ps -aux | grep -i wildfly

*   Per eliminar el procés (en cas que amb l'stop no s'elimini) es pot executar un kill on **XXXX** serà l'**id** del **procés**:

**Matar el procés (només si cal)**

kill -9 "XXXX"

Un cop el Wildfly estigui aturat, es podrà aixecar:

**Aixecar el Wildfly**

sudo /etc/init.d/wildfly start && tail -f /apps/wildfly/standalone/log/server.log

  
i esperem que els logs del server.log ens mostrin com el Wildfly s'ha aixecat:

  

* * *

* * *

* * *

* * *

* * *

* * *

  

El que s'explica a continuació no aplica de moment → No EXECUTAR-HO fins a nou avís.

  

**L’script de balanceig i desbalanceig ens permet executar-lo des de qualsevol dels 2 frontals, canviar la configuració o reiniciar l’Apache.**

Desbalanceig:
=============

Desbalancejar els frontals

Ens haurem de connectar als frontals:

*   **10.123.5.171**
*   **10.123.5.172**

L’script de balanceig dels frontals no contempla encara el node WildFly. L’important és **NO BALANCEJAR NI EL NODE 3 NI EL NODE 4** mentre no modifiquin l'script de balanceig de nodes. Els nodes 3 i 4 s'han de quedar desbalancejats.

**Si estem actuant sobre els nodes 3 i 4 anem a la part de reinici directament.**

Executar el següent script a un dels frontals:

**Desbalancejar**

./home/aoc/scripts/balancer.sh

En executar l’script apareix la pantalla següent, on es pot configurar el frontal de PSIS (en aquest cas no se’ns demana escollir plataforma, doncs aquest Apache és dedicat per PSIS):  
![](attachments/41521423/41521424.png)

*   Apareixen els 4 nodes de PSIS vists des de cadascun dels 2 frontals, i amb les opcions inferiors, podem balancejar-los o desbalancejar-los:  
    1: Desbalancejar un o varis nodes..  
    2: Balancejar un o varis nodes prèviament desbalancejats.  
    3: Reiniciar l’Apache per a que es recarregui la configuració.
    
*   Per desbalancejar haurem de seleccionar les opcions:  
    1: Seleccionar els nodes a desbalancejar, i si volem fer-ho per un o pels dos frontals.  
    3: Reiniciar l’Apache per a que agafi la nova configuració, també per cada frontal que vulguem reiniciar.
    

Reinici:
========

Reiniciar el node afectat

Reinici Wildfly

**Aturar el Wildfly**

sudo /etc/init.d/wildfly stop

Comprovar que el Wildfly estigui efectivament aturat:

**Revisar el procés**

ps -aux | grep -i wildfly

*   Per eliminar el procés (en cas que amb l'stop no s'elimini) es pot executar un kill on **XXXX** serà l'**id** del **procés**:

**Matar el procés (només si cal)**

kill -9 "XXXX"

Un cop el JBOSS estigui aturat, es podrà aixecar:

**Aixecar el Wildfly**

sudo /etc/init.d/wildfly start && tail -f /apps/wildfly/standalone/log/server.log

i esperem que els logs del server.log ens mostrin com el Wildfly s'ha aixecat:

Balanceig:
==========

Balancejar els frontals

Tornar a **balancejar el node als dos frontals**, segons lo que hem vist al punt , però amb les opcions de balanceig i reinici:

*   Opcions B (balancejar) i R (reiniciar).
    

Attachments:
------------

![](images/icons/bullet_blue.gif) [image2020-4-7\_10-44-48.png](attachments/41521403/41521404.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2021-3-3\_16-24-28.png](attachments/41521403/41521823.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2021-7-15\_12-34-54.png](attachments/41521403/41523845.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2021-7-15\_12-35-44.png](attachments/41521403/41523846.png) (image/png)  

Document generated by Confluence on 02 June 2025 11:14

[Atlassian](http://www.atlassian.com/)