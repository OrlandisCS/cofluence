Suport Tècnic : Revisió MUX  

1.  [Suport Tècnic](index.md)
2.  [Suport Tècnic](13893782.md)
3.  [04 - Tècnica de sistemes + 24x7 + Padró](26313202.md)
4.  [Revisió de serveis](36340340.md)
5.  [MUX - Revisions i Restabliment](MUX---Revisions-i-Restabliment_118554805.md)

Suport Tècnic : Revisió MUX
===========================

Created by Unknown User (otecobernal), last modified on 08 February 2021

BACKEND del servei
==================

Connexió al servidor

Servidors 
==========

*   Node1: **aoc-l-app1 → 10.120.1.20**
    
*   Node2: **aoc-l-app2** **→ 10.120.1.21**
*   User: **bea**

*   Node1: **aoc-l-app1-pre → 10.120.2.80**
    
*   Node2: **aoc-l-app2-pre → 10.120.2.81**
*   User: **bea**

Revisió del BEA8

Quan detectem que està fallant o bé volem revisar si una aplicació està fallant i esta desplegada en el BEA8 podem revisar les següents parts.

**Accedir a la consola del BEA per fer les revisions:**

**PRODUCCIO**

APP → [http://10.120.1.21:8101/console/login/LoginForm.jsp](http://10.120.1.21:8101/console/login/LoginForm.jsp)

IOP → [http://10.120.1.20:8001/console/login/LoginForm.jsp](http://10.120.1.20:8001/console/login/LoginForm.jsp)

  

Si aquesta URL no ens carrega, és possible que hi hagi un problema amb el ADMIN. Anar directament a: [PCI2 - BEA - BEA8 - Reinici](https://confluence.aoc.cat/display/SII/PCI2+-+BEA+-+BEA8+-+Reinici)

  

  

Reviso 1 - Nodes en estat "Running"

  

1- Accedeir a l'opció de "servers":

![](attachments/41520849/41522463.png)

2- Comprovar que els nodes estiguin **RUNNING:**

**![](attachments/41520849/41522464.png)  
**

  

  

  

Reviso 2 - Estat dels threads

Accedir al node que vulguem revisar: Servers >> PCINodoX >> Monitoring >> Monitor all Active Queues:

![](attachments/41520849/41522465.png)

Veurem una taula que ens mostrarà els Threads del node.

*   El número de **Idle Threads** hauria de ser molt proper al número de Threads
*   La **Queue Lengh** hauria de ser 0

  

Exemples de funcionament:

Exemple de funcionament **correcte**:

![](attachments/41520849/41522466.png)

Exemple de funcionament **incorrecte**:

Veiem que de 200 Threads, només n'hi ha 82 lliures → Hi ha uns 120 Threads enganxats.

![](attachments/41520849/41522467.png)

  

  

Si valorem que l'estat dels threads no es normal. Reiniciarem el BEA8.

  

  

Reviso 2 - Estat dels pools a BBDD

Tornem a la Pàgina principal de l'admin del BEA i en comptes d'accedir a SERVERS, accedim a Connection Pools:

![](attachments/41520849/41522468.png)

  

Una vegada dins anem a monitoring:

![](attachments/41520849/41522469.png)

se'ns mostrarà una taula amb tots **els Pools que es fan a les BBDD**, no n'hauríem de veure massa.

La columna **CONNECTIONS** hauria d'estar entre 0 i 15 i anar baixant.

A continuació mostrem la diferència entre comportament normal i comportament anormal:

Comportament **NORMAL** (realment no té per què estar a zero, però si que vagi baixant):

![](attachments/41520849/41522470.png)

Comportament **d'incidència** (hi ha moltes connexions i es mantenen altes):

![](attachments/41520849/41522471.png)

En cas que veiem que hi ha aquests problemes, haurem de discernir si es:

A. Problema del BEA per interactuar amb la BBDD  
B. Problema de la BBDD en si.

Per diferenciar entre les dues possibilitats, podem provar a **connectar-nos a la BBDD del servei que estem revisant**:

En cas que ens puguem connectar sense problemes, podem valorar la possibilitat de reiniciar el BEA8.

Si reiniciant el BEA8 no s'arregla, potser és un tema de BBDD → Podem revisar també OP5 a veure si hi veiem alguna cosa sospitosa...

En cas que veiem un problema clar de BBDD → Escalar a Claranet

  

  

Reinici del BEA8

Per saber si el servei està aixecat:

**Ruta per observar els logs**

ps aux | grep -i appnodo  <-- per APP
ps aux | grep -i pcinodo  <-- per IOP

ps aux | grep -i appadmin  <-- per APPAdmin
ps aux | grep -i pciadmin  <-- per IOPAdmin

Reinici total de la plataforma

En cas de tenir de reiniciar tota la plataforma: 

*   Admin
*   IOP
*   APP

Seguir l'ordre següent: 

0- Seguir procediment de "Tasques de Purga i Manteniment" d'aquesta mateixa faq.

1- Shutdown  PCINodo1 i PCINodo2

2- Shutdown PCIAdmin

3- Start PCIAdmin

4- Start PCINodo1  i PCINodo2 

Problemes durant l'aixecament de nodes

En cas de que tinguem problemes en el restabliment de la plataforma, consultar el desplegable "**Tasques de Purga i Manteniment**".

ATENCIÓ: Sempre és més segur que acabi d'aixecar-se un node abans de parar el procés.

_Per exemple_: 2 nodes KO, fer un pas de 0. 

Resum + Arquitectura

Resum:
------

  

![](https://intranet.aoc.cat/download/attachments/26313194/BEA_APP.png?version=2&modificationDate=1503314507000&api=v2)

  

Documentació tècnica de **l'arquitectura dels BEA 8:** 
-------------------------------------------------------

![](plugins/servlet/confluence/placeholder/unknown-attachment)
--------------------------------------------------------------

Tasques de Purga i Manteniment

Aquest procediment es realitzaria sempre que tinguem de reiniciar tots els nodes de la plataforma (fer pas de 0). 

1.  Parar el node a purgar del Cluster (**NO FER-HO AL ADMIN!**).
2.  Dintre de les carpetes les carpetes de cadascun dels nodes (**ADMIN NO!**), per exemple:  
    _/apps/bea/beaplat/user\_projects/domains/PCIDomain/PCINodo1_  
    _/apps/bea/beaplat/user\_projects/domains/PCIDomain/PCINodo2_
3.   Esborrar les carpetes “**_stage_**” i “**_.wlnotdelete_**”i els logs:
    1.  Comanda per esborrar desplegaments i estat d’aplicacions:  
        _rm -rf stage && rm -rf .wlnotdelete_
    2.  Comanda per esborrar logs :  
         _rm ".tlog_
4.   Aixecar de nou el Cluster, **primer l’Admin i després els nodes.**

  

_( \* )Aquest procediment s'explica al document "PCI 2.0 – Documentació referència arquitectura IOP i APP", per més informació sobre la plataforma, podrem consultar el document en la pestanya "Resum i Arquitectura"._

Reinici APP

**Node 1:**

Haurem d'obrir dos terminals.

1.  **Comprovar** que no hi hagin **tasques pendents** abans de fer el reinici:  
    1.  Accedim a la pàgina d'admintració dels BEA i fer clic a "Recent Task Status":  
        ![](attachments/41520848/41520856.png)  
          
          
        
    2.  Si hi ha una tasca pendent per exemple un deploy d'una aplicació ho podrem veure si en la columna "End Time" no hi ha una data i hora informada.  
         ![](attachments/41520848/41520857.png)  
          
        
    3.  Si hi ha un**a tasca pendet**, només podem esperar a que finalitzi, en el cas que no ho faci perquè **s'ha quedat penjat i haurem de prosseguir amb el reinici.** **Hem de tindre en compte que si reiniciem el node i queda una tasca pendent el propi BEA té un temps d'espera de 60 minuts, un cop passats aquests 60 minuts forçarà l'stop de la tasca pendent.**   
        Per tant no ens quedarà una altra que esperar durant el reinici que el BEA forci l'aturada de la tasca pendent.   
          
          
        
2.  En un terminal haure d'obrir els logs (Introduir la data del dia actual):
    
    **Ruta per observar els logs**
    
    cd /apps/bea/beaplat/user\_projects/domains/AppDomain
    tail -200f nodo1.out.2018XXXXXXXX
    
3.  Al segon terminal, procedirem a fer el reinici:
    
    **Aturar el servei**
    
    cd /apps/bea/beaplat/user\_projects/domains/AppDomain
    ./BEA\_STOP\_NODO1.sh
    
    El servei estarà aturat quan aparegui el missatge: 
    
    `**Done**`
    
    ![](https://intranet.aoc.cat/download/attachments/26313194/image2018-2-7_12-40-56.png?version=1&modificationDate=1518003657000&api=v2)
    
      
    Comprovem que el node està efectivament aturat:
    
    **Comprovar que el procés està mort**
    
    ps -ef | grep -i appnodo
    
    Si veiem el següent, és que el procés **no s'ha acabat d'apagar**:
    
    ![](attachments/41520848/41521899.png)
    
    L'argument _\-Dweblogic.Name_ indica el procés del weblogic que està corrent.
    
    **En cas de tenir aquest procés actiu**, tal i com està a la captura, farem _kill_ del procés, o _kill -9_ si el kill no funciona.
    
    **Matem el procés**
    
    kill \[PID\_PROCES\]
    kill -9 \[PID\_PROCES\]
    
      
    Una vegada el node s'ha aturat, l'encenem amb la següent comanda.
    
    **Iniciar el servei**
    
    ./BEA\_START\_NODO1.sh
    
    ![](https://intranet.aoc.cat/download/attachments/26313194/image2018-2-7_12-41-22.png?version=1&modificationDate=1518003682000&api=v2)
    
    El servei estarà iniciat quan aparegui el missatge:
    
    `<``Notice``> <``WebLogicServer``> <``BEA-000360``> <``Server` `started in RUNNING mode>`
    
    ![](https://intranet.aoc.cat/download/attachments/26313194/image2018-2-7_13-29-38.png?version=1&modificationDate=1518006578000&api=v2)
    
    Exemples d'errors que poden aparèixer:  
      
    ![](https://intranet.aoc.cat/download/attachments/26313194/image2018-2-7_12-42-17.png?version=1&modificationDate=1518003737000&api=v2)

**Node 2:**

Haurem de realitzar el mateix procediment:

**Ruta per observar els logs**

cd /apps/bea/beaplat/user\_projects/domains/AppDomain
tail -200f nodo2.out.2013XXXXXXXX

**Aturar el servei**

cd /apps/bea/beaplat/user\_projects/domains/AppDomain
./BEA\_STOP\_NODO2.sh

  

**Comprovar que el procés està mort**

ps -ef | grep -i appnodo

  

**Matem el procés**

kill \[PID\_PROCES\]
kill -9 \[PID\_PROCES\]

  

  

**Iniciar el servei**

./BEA\_START\_NODO2.sh

Reinici IOP

**Node 1:**

Haurem d'obrir dos terminals.

1.  **Comprovar** que no hi hagin **tasques pendents** abans de fer el reinici:
    1.  Accedim a la pàgina d'admintració dels BEA i fer clic a "Recent Task Status":  
        ![](attachments/41520848/41520856.png)  
          
        
    2.  Si hi ha una tasca pendent per exemple un deploy d'una aplicació ho podrem veure si en la columna "End Time" no hi ha una data i hora informada.  
         ![](attachments/41520848/41520857.png)  
          
        
    3.  Si hi ha un**a tasca pendet**, només podem esperar a que finalitzi (10 minuts), en el cas que no ho faci perquè **s'ha quedat penjat i haurem de prosseguir amb el reinici.** **Hem de tindre en compte que si reiniciem el node i queda una tasca pendent el propi BEA té un temps d'espera de 60 minuts, un cop passats aquests 60 minuts forçarà l'stop de la tasca pendent.**   
        Per tant no ens quedarà una altra que esperar durant el reinici que el BEA forci l'aturada de la tasca pendent.   
          
        
2.  En un terminal haure d'obrir els logs (Introduir la data del dia actual):
    
    **Ruta per observar els logs**
    
    cd /apps/bea/beaplat/user\_projects/domains/PCIDomain
    tail -200f nodo1.out.2013XXXXXXXX
    
3.  Al segon terminal, procedirem a fer el reinici:
    
    **Aturar el servei**
    
    cd /apps/bea/beaplat/user\_projects/domains/PCIDomain
    ./BEA\_STOP\_NODO1.sh
    
    El servei estarà aturat quan aparegui el missatge: 
    
    `**Done**`
    
    ![](https://intranet.aoc.cat/download/attachments/26313194/image2018-2-7_12-40-56.png?version=1&modificationDate=1518003657000&api=v2)
    
      
    Comprovem que el node està efectivament aturat:
    

  

**Comprovar que el procés està mort**

ps -ef | grep -i pcinodo

Si veiem el següent, és que el procés **no s'ha acabat d'apagar**:

![](attachments/41520848/41521898.png)

L'argument _\-Dweblogic.Name_ indica el procés del weblogic que està corrent.

**En cas de tenir aquest procés actiu**, tal i com està a la captura, farem _kill_ del procés, o _kill -9_ si el kill no funciona.  
  

**Matem el procés**

kill \[PID\_PROCES\]
kill -9 \[PID\_PROCES\]

Una vegada el node s'ha apagat correctament, l'encenem:

**Iniciar el servei**

./BEA\_START\_NODO1.sh

![](https://intranet.aoc.cat/download/attachments/26313194/image2018-2-7_12-41-22.png?version=1&modificationDate=1518003682000&api=v2)

El servei estarà iniciat quan aparegui el missatge:

`<``Notice``> <``WebLogicServer``> <``BEA-000360``> <``Server` `started in RUNNING mode>`

![](https://intranet.aoc.cat/download/attachments/26313194/image2018-2-7_13-29-38.png?version=1&modificationDate=1518006578000&api=v2)  
  
  

Exemples d'errors que poden aparèixer:  
  
![](https://intranet.aoc.cat/download/attachments/26313194/image2018-2-7_12-42-17.png?version=1&modificationDate=1518003737000&api=v2)

**Node 2:**

Haurem de realitzar el mateix procediment:

**Ruta per observar els logs**

cd /apps/bea/beaplat/user\_projects/domains/PCIDomain
tail -200f nodo2.out.2013XXXXXXXX

**Aturar el servei**

cd /apps/bea/beaplat/user\_projects/domains/PCIDomain
./BEA\_STOP\_NODO2.sh

**Comprovar que el procés està mort**

ps -ef | grep -i pcinodo

**Matem el procés**

kill \[PID\_PROCES\]
kill -9 \[PID\_PROCES\]

**Iniciar el servei**

./BEA\_START\_NODO2.sh

  

Reinici ADMINS

El BEA8 té 2 ADMINS, un a IOP (**PCIAdmin**) i l'altre a APP (**APPAdmin**).

A més, cada Admin està desplegat a un node diferent:

*   **PCIAdmin → Node1** (aoc-l-app1)
*   **APPAdmin → Node2** (aoc-l-app2)

En funció del admin que vulguem reiniciar haurem d'accedir a una ruta:

**Ruta per observar els logs**

cd /apps/bea/beaplat/user\_projects/domains/PCIDomain
cd /apps/bea/beaplat/user\_projects/domains/AppDomain

  

1.  En un terminal haure d'obrir els logs (Introduir la data del dia actual):
    
    **Ruta per observar els logs**
    
    tail -200f admin.out.2013XXXXXXXX
    
2.  Al segon terminal, procedirem a fer el reinici:
    
    **Aturar el servei**
    
    ./BEA\_STOP\_ADMIN.sh
    
    **Iniciar el servei**
    
    ./BEA\_START\_ADMIN.sh
    
    El servei estarà iniciat quan aparegui el missatge:
    
    `<``Notice``> <``WebLogicServer``> <``BEA-000360``> <``Server` `started in RUNNING mode>`
    

Error cacerts

subject key, Unknown key spec: Invalid RSA modulus size.

![](attachments/41520848/41520858.png)

Aquest error es deu a que el fitxer de cacerts que utilitza el jdk del BEA8 té certificats de 2048 bits o superiors (no compatibles amb BEA8).

La solució és accedir a la ruta: /mnt/lhnfs/aoc/certs/BEA i revisar l'arxiu. Si recentment s'ha fet alguna modificació es pot mirar de deixar el backup que es va realitzar d'aquell fitxer:

![](attachments/41520848/41520859.png)

  

Després tornar a inciar 'admin i els nodes.

  

  

  

  

  

  

Document generated by Confluence on 02 June 2025 11:12

[Atlassian](http://www.atlassian.com/)