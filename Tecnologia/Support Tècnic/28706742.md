Suport Tècnic : Monitor S.T. - e-NOTUM - Callbacks en error Barcelona últims 3 dies  

1.  [Suport Tècnic](index.md)
2.  [Suport Tècnic](13893782.md)
3.  [03 - Monitorització - Revisions globals](26313327.md)
4.  [Monitors S.T.](Monitors-S.T._41522177.md)
5.  [Monitor S.T. - OLD](Monitor-S.T.---OLD_118555256.md)

Suport Tècnic : Monitor S.T. - e-NOTUM - Callbacks en error Barcelona últims 3 dies
===================================================================================

Created by Unknown User (otecjriquelme), last modified by Joan Riquelme on 18 July 2024

**Query:**

Select count(cm.id) REGISTRES
from nt30.aoc\_nt\_event\_cues\_missatgeria cm,
nt30.aoc\_nt\_ws\_message\_queue qq
where qq.id = cm.identificador
and (qq.id\_entitat = '69' or qq.id\_entitat = '2606')
and cm.estat = 2
and cm.inici\_execucio >= sysdate-3

**Descripció:** 

Aquesta sonda compta el número de callbacks que estan en estat d'error (han arribat a 6 intents) per l'ajuntament de Barcelona (id\_entitat=69) i per l'útim dia i mig.

Els estats en què pot estar un callback, a la taula nt30.aoc\_nt\_event\_cues\_missatgeria, són:

*   0: Esperant a ser agafat per el RDBMS, ja sigui perquè l'intent previ ha fallat o perquè encara no s'ha intentat.
*   1: Processant-se
*   2: S'han exhaurit els intents i ha quedat en estat d'error.

  

Serà útil per analitzar, tenir els ID\_NOTIFICACIO de les notificacions que tenen callbacks en error...

**Per trobar un exemple d'un ID\_NOTIFICACIO que li hagin fallat els callbacks....** Expand source

select qq.id\_notificacio
from nt30.aoc\_nt\_event\_cues\_missatgeria cm, nt30.aoc\_nt\_ws\_message\_queue qq
where qq.id = cm.identificador
and (qq.id\_entitat = '69' or qq.id\_entitat = '2606')
and cm.estat = 2
and cm.inici\_execucio >= sysdate - 3;

**Anàlisi:** 

**Primerament****, provarem de seguir les revisions que s'indiquen en aquesta FAQ**: **[eNOTUM - FLUX DEL SERVEI - ERRORS - Callback BCN](/pages/createpage.action?spaceKey=SII&title=eNOTUM+-+FLUX+DEL+SERVEI+-+ERRORS+-+Callback+BCN&linkCreation=true&fromPageId=28706742)**

Si els passos de la FAQ mencionada a sobre no arreglen el problema, podem revisar els logs per una notificació en concret:

select \* from nt30.aoc\_nt\_logs\_comunicacio lc
where lc.id\_notificacio = 'XXXX'
order by lc.data\_log desc;

En aquesta taula trobarem una traça inicial del log de l'error, val la pena veure la traça completa a:

*   **Servidor: SOA PCI3**
*   **Ruta: apps/aoc/NT/logs**
*   **Nom:**  **/NT-ErrorComunicacio-NTNODO\*\_SOA.log**

**Resolució:**

Una vegada hem resolt el problema,podem procedir a re-iniciar els processos de comunicació per tal que es tornin a tractar:

Per 1 sol event de Callback:

update nt30.aoc\_nt\_event\_cues\_missatgeria
set estat=0, reintent=3
where id='XXXXXX';

**Relació entre taules**

Recordem la relació entre taules:

Camp **INDENTIFICADOR** de la taula aoc\_nt\_event\_cues\_missatgeria = Camp **ID** de la taula aoc\_nt\_ws\_message\_queue

  

Per fer un **UPDATE massiu** de tots els callbacks en estat d'error que mostra la sonda (comentar internament i llençar només en casos concrets):

update nt30.aoc\_nt\_event\_cues\_missatgeria
set estat=0, reintent=3
	where id in (select cm.id
				from nt30.aoc\_nt\_event\_cues\_missatgeria cm, nt30.aoc\_nt\_ws\_message\_queue qq
				where qq.id = cm.identificador
				and qq.id\_entitat = '69'
				and cm.estat = 2
				and cm.inici\_execucio >= sysdate - 3);

**logs:** 

*   **Servidor: SOA PCI3**
*   **Ruta: apps/aoc/NT/logs**
*   **Nom:**  **/NT-ErrorComunicacio-NTNODO\*\_SOA.log**

Document generated by Confluence on 02 June 2025 11:09

[Atlassian](http://www.atlassian.com/)