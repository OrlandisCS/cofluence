Suport Tècnic : VO - VIDA LABORAL- FLUX DEL SERVEI - ERRORS - Error genèric per DIR3 duplicat  

1.  [Suport Tècnic](index.md)
2.  [Suport Tècnic](13893782.md)
3.  [02 - FAQ's serveis](26313393.md)
4.  [FAQ's VO](28705575.md)
5.  [FAQ's VO - ESTAT](28705579.md)
6.  [VO - TGSS](VO---TGSS_36340977.md)

Suport Tècnic : VO - VIDA LABORAL- FLUX DEL SERVEI - ERRORS - Error genèric per DIR3 duplicat
=============================================================================================

Created by Unknown User (otecjriquelme), last modified by Maria Dolors Alvarez on 14 August 2020

Consultes a **VIDA LABORAL** amb el següent **literal d'error**:

**Literal error**

<ns1:DatosEspecificos>
	<aoc:respostaConsultaVidaLaboral xmlns:aoc="http://www.aoc.cat/tgss" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
		<aoc:resultat>
			<aoc:codiResultat>0502</aoc:codiResultat>
			<aoc:descripcio>
						Error realizant l'operació. Si us plau, torneu a intentar-ho en uns instants. Si el problema persisteix poseu-vos en contacte amb el Servei d'Atenció a l'Usuari.
			</aoc:descripcio>
		</aoc:resultat>
	</aoc:respostaConsultaVidaLaboral>
	<ns0:ExtensionesRespuesta xmlns:ns0="http://www.aocat.net/scsp/esquemes/caoc-extensions"/>
</ns1:DatosEspecificos>

  

Cerquem als logs de **TGSS - VIDA LABORAL**

IP: SOA PCI3 (_10.120.1.163_)

Ruta:  _/mnt/storage30/aoc/IOP/logs/MC-TGSS-MINHAP\_IOPNODO?\_SOA.log_

Busquem per data i hora o per INE10 de l'ens que ha fet la petició XML.  Hauríem de **trobar l'XML de petició i l'error**.

L'error que tractem en aquesta FAQ és:

**Error que trobem als logs**

02 Dec 2019 08:16:18,413 ERROR TGSSModalitats : javax.persistence.NonUniqueResultException: More than one result was returned from Query.getSingleResult()
        at org.eclipse.persistence.internal.jpa.QueryImpl.throwNonUniqueResultException(QueryImpl.java:980)
        at org.eclipse.persistence.internal.jpa.QueryImpl.getSingleResult(QueryImpl.java:529)
        at org.eclipse.persistence.internal.jpa.EJBQueryImpl.getSingleResult(EJBQueryImpl.java:400)
        at cat.aoc.pci30.core.entities.DIR3.getDIR3(DIR3.java:45)
        at cat.aoc.pci30.modalitats.tgssminhap.TGSSModalitats.getPeticionSCSP(TGSSModalitats.java:211)
        at cat.aoc.pci30.modalitats.tgssminhap.TGSSModalitats.VIDA\_LABORAL(TGSSModalitats.java:106)
        at cat.aoc.pci30.modalitats.tgssminhap.TGSSModalitats.procesa(TGSSModalitats.java:93)
        at cat.aoc.pci30.core.mti.fases.MTIFase4Impl.procesa(MTIFase4Impl.java:30)
        at sun.reflect.GeneratedMethodAccessor3693.invoke(Unknown Source)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
        at java.lang.reflect.Method.invoke(Method.java:498)
        at weblogic.wsee.jaxws.WLSInstanceResolver$WLSInvoker.invoke(WLSInstanceResolver.java:120)

Podem veure a la línia 5 que es tracta d'un **error que es retorna de la Base de dades referent al DIR3.**

Aquest error es deu a que l'ens té més d'un DIR3 informat a la BBDD. Abans d'enviar la petició al MINHAP, es fa una consulta a la taula **dir3.dir3\_2\_ine10\_uo** per tal d'obtenir el DIR3 de l'entitat a partir de l'INE10.

Si aquesta consulta retorna més d'un resultat, la petició fallarà amb l'error dels logs.

Per tant, realitzarem les següents **comprovacions a la Base de Dades del DIR3**:

Username: DIR3  
Database: CAT  
Password: Keepass

**Comprovem quants DIR3 hi ha associats a l'ens i si estan actius**

 select uo.denominacion as ENS, uoine10.ine10 as INE10, uo.codigo, uo.estado
 from dir3.dir3\_unidad\_organica uo, dir3.dir3\_2\_ine10\_uo uoine10
 where uo.codigo=uoine10.dir3
 and uoine10.ine10 ='XXXXXXXXX'; --Indiquem l'INE10 de l'ens que ha patit l'error

Amb aquesta QUERY revisem:

*   Quants DIR3 hi ha associats a un mateix ine10
*   Quin és l'estat d'aquests DIR3 (V/A) (Vigente/Anulado)

Si detectem que hi ha DIR3 amb un estat = A, llavors l'esborrem de la taula **dir3.dir3\_2\_ine10\_uo:**

**Esborrem el DIR3 caducat**

 delete from dir3.dir3\_2\_ine10\_uo uoine10
 where uoine10.ine10='XXXXXXXXX' -- Indiquem l'INE10 de l'ens que ha patit l'error
 and uoine10.dir3='YYYYYYYY' -- Indiquem el DIR3 que hem vist ANULADO amb la query anterior

Amb aquesta modificació les consultes ja els haurien de funcionar correctament

  

FP Relacionats: FP #**314858**

  

  

Attachments:
------------

![](images/icons/bullet_blue.gif) [image2020-1-28\_11-18-45.png](attachments/30868411/30870024.png) (image/png)  

Document generated by Confluence on 02 June 2025 11:02

[Atlassian](http://www.atlassian.com/)