Suport Tècnic : VO - DCOC - FLUX DE SERVEI - Timer de descàrrega de documents  

1.  [Suport Tècnic](index.html)
2.  [Suport Tècnic](13893782.html)
3.  [02 - FAQ's serveis](26313393.html)
4.  [FAQ's VO](28705575.html)
5.  [FAQ's VO - Col·legis Professionals](28705581.html)
6.  [VO - DCOC](VO---DCOC_36340967.html)

Suport Tècnic : VO - DCOC - FLUX DE SERVEI - Timer de descàrrega de documents
=============================================================================

Created by Unknown User (otecobernal), last modified by Unknown User (otecbdura) on 24 June 2020

El **DCOC** té un component encarregat de descarregar els projectes dels FTP's dels col·legis.  
Aquest component llança tasques programades cada X minuts. Aquestes tasques s'executen en threads o fils d'execució diferents.

Haurem de tenir en compte que les tasques només es llençaran d'es d'un dels nodes on el DCOC estigui desplegat (actualment al BEA8 - 2 nodes).

Això significa que si el node 1 és l'encarregat de fer-ho, al node 2 no veurem traces als logs sobre aquestes execucions.

  

Si obrim l'arxiu **dcoc.properties** que trobarem a la ruta **/mnt/sto1/lhnfs/aoc/IOP/prjModalitatsDCOC/appHome/cfg**, trobarem aquestes configuracions:

![](attachments/36341383/36341419.png)

Podem veure com les tasques de descàrrega es realitzen des del PCINodo1 (**dcoc.servlet.deploy.node**) i s'executen cada minut (**dcoc.frequencia.timer**).

Per veure les traces dels timmers, podem accedir a la ruta dels logs

cd /apps/aoc/IOP/logs

Com s'executa al node 1, podem observar com s'executa cada minut:

grep -i "Arrencant" DCOC\_PCINodo1.log

![](attachments/36341383/36341420.png)

En canvi si ho mirem pel node 2, no veurem res.

  

Podem veure les traces del timer al node1:

grep -i "timer" DCOC\_PCINodo1.log

  

18 may 2020 10:55:21,876 DEBUG DCOC-DescarregaVisatFromColegiTimerTask : \*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*
18 may 2020 10:55:21,876 DEBUG DCOC-DescarregaVisatFromColegiTimerTask : Arrencant timer descàrrega de projectes visats...
18 may 2020 10:55:21,876 DEBUG DCOC-DescarregaVisatFromColegiTimerTask : Timer descàrrega de projectes visats finalitzat.
18 may 2020 10:55:21,876 DEBUG DCOC-DescarregaVisatThreadTask : Executant tasca del timer descàrrega de projectes visats...
18 may 2020 10:55:21,884 DEBUG DCOC-DescarregaVisatThreadTask : Finalitzant la tasca descarrega del timer ...
18 may 2020 10:55:21,884 DEBUG DCOC-DescarregaVisatThreadTask : Tasca del timer descàrrega de projectes visats finalitzat!

Logs

Hem de tenir en compte que les propietats dels logs del DCOC estan configurades per a que el fitxer del log vagi rotant cada cop que el fitxer arriba a 3MB.

Per aquesta raó és possible que si busquem alguna traça en concret no la trobem.

  

### Problemes amb el "timer". 

Si tenim problemes amb el timer que s'encarrega d'agafar les peticions que estan encuades en la taula projecte per la descarrega dels documents, aquestes no finalitzaran i es quedaran en estat 3 (pendents de descàrrega). 

Aquest sistema del Timer s'hi instància un cop s'arrenca l'aplicació del DCOC. **És possible que al iniciar el node 1 hi hagin problemes i no s'agendin els timers, i les descarregues no es processaran.**

Per solucionar-ho:

1.Posarem les peticions que hi hagi a la taula projecte en estat 99:

update dcoc.aoc\_dcoc\_projecte
set estat = 99
where estat = 3;

2\. Anem a l'admin dels BEA  [http://10.120.1.20:8001/console/login/LoginForm.jsp](http://10.120.1.20:8001/console/login/LoginForm.jsp) → Aplications → prjModalitatsDCOC\_PRO-IOP → Deploy →  I fem un redeploy de l'aplicació.

3\. Tornem a posar les peticions a estat = 3 

update dcoc.aoc\_dcoc\_projecte
set estat = 3
where estat = 99;

DCOC\_PCINodo1.log.1:15 may 2020 16:15:11,147 DEBUG DCOC-StartupListener : El timer de descarrega no es troba disponible (el seu valor es 'null')!

Quan fem el redeploy, als logs veurem aquest missatge, que ens indica que el timer estava caigut. 

Seguidament comprovem pel log si el timer torna a estar executat i revisem per BBDD del DCOC si en la taula projectes el registres amb estat 3 comencen a baixar.   
  

select count(\*)
from dcoc.aoc\_dcoc\_projecte 
where estat = '3';

Si no baixen, haurem de reiniciar les peticions (en grups de 20-25, no totes alhora) que ens retorni la query:

select aa.id\_colegi, aa.id\_projecte, bb.id\_peticio from dcoc.aoc\_dcoc\_projecte aa, dcoc.aoc\_dcoc\_resposta bb 
where aa.id\_projecte = bb.id\_projecte
and aa.estat = '3';

Podem utilitzar l'eina Jar del DCOC per reiniciar les peticions→ [VO - DCOC - ALTRES - DCOC Toolsv2 (Eina funional)](36340597.html)

Attachments:
------------

![](images/icons/bullet_blue.gif) [image2019-9-4\_14-59-59.png](attachments/36341383/36341384.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2019-9-4\_14-58-1.png](attachments/36341383/36341385.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2019-9-4\_14-51-13.png](attachments/36341383/36341386.png) (image/png)  
![](images/icons/bullet_blue.gif) [MC DCOC - Manual d'instal·lació BEA.doc](attachments/36341383/36341387.doc) (application/msword)  
![](images/icons/bullet_blue.gif) [MC DCOC - Manual explotació.doc](attachments/36341383/36341388.doc) (application/msword)  
![](images/icons/bullet_blue.gif) [DCOC\_Integració\_nous\_col·legis.pdf](attachments/36341383/36341389.pdf) (application/pdf)  
![](images/icons/bullet_blue.gif) [image2019-8-22\_18-29-30.png](attachments/36341383/36341390.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2019-8-22\_18-28-17.png](attachments/36341383/36341391.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2019-8-22\_18-27-29.png](attachments/36341383/36341392.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2019-8-22\_18-26-29.png](attachments/36341383/36341393.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2019-8-22\_18-19-30.png](attachments/36341383/36341394.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2019-8-22\_18-17-7.png](attachments/36341383/36341395.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2019-8-22\_18-9-15.png](attachments/36341383/36341396.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2019-8-22\_18-4-39.png](attachments/36341383/36341397.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2019-8-22\_18-0-48.png](attachments/36341383/36341398.png) (image/png)  
![](images/icons/bullet_blue.gif) [Correu permisos COEIC.msg](attachments/36341383/36341399.msg) (application/vnd.ms-outlook)  
![](images/icons/bullet_blue.gif) [image2019-8-21\_18-57-46.png](attachments/36341383/36341400.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2019-8-21\_18-54-10.png](attachments/36341383/36341401.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2019-8-21\_18-49-35.png](attachments/36341383/36341402.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2019-8-21\_17-45-58.png](attachments/36341383/36341403.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2019-3-28\_11-52-41.png](attachments/36341383/36341404.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2018-7-24\_15-12-37.png](attachments/36341383/36341405.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2018-7-24\_15-11-15.png](attachments/36341383/36341406.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2018-7-24\_15-11-6.png](attachments/36341383/36341407.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2018-7-24\_15-8-34.png](attachments/36341383/36341408.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2018-7-24\_14-54-25.png](attachments/36341383/36341409.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2018-7-24\_14-39-51.png](attachments/36341383/36341410.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2018-7-24\_14-37-2.png](attachments/36341383/36341411.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2018-7-24\_11-48-37.png](attachments/36341383/36341412.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2018-7-24\_10-18-59.png](attachments/36341383/36341413.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2018-7-24\_10-18-56.png](attachments/36341383/36341414.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2018-7-24\_10-11-59.png](attachments/36341383/36341415.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2018-7-24\_10-2-11.png](attachments/36341383/36341416.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2018-7-24\_9-51-54.png](attachments/36341383/36341417.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2020-5-18\_10-47-35.png](attachments/36341383/36341419.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2020-5-18\_10-54-43.png](attachments/36341383/36341420.png) (image/png)  

Document generated by Confluence on 02 June 2025 11:02

[Atlassian](http://www.atlassian.com/)