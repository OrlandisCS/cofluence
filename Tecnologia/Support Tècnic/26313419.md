Suport Tècnic : eTRAM\_ROUTER – FLUX DEL SERVEI – CONFIGURACIONS - Configurar SoapUI per generar proves tràmit.  

1.  [Suport Tècnic](index.md)
2.  [Suport Tècnic](13893782.md)
3.  [02 - FAQ's serveis](26313393.md)
4.  [FAQ's eTRAM](28705567.md)

Suport Tècnic : eTRAM\_ROUTER – FLUX DEL SERVEI – CONFIGURACIONS - Configurar SoapUI per generar proves tràmit.
===============================================================================================================

Created by Unknown User (agonlara), last modified by Cristian Morales on 28 March 2023

  

En aquesta FAQ es documenta com configurar un projecte SoapUi per llançar una tramitació simulant que som l'AOC contra un ens. Així validar el circuit del tràmit o detectar possibles errors.

Els tràmits els podrem llançar des de dos punts, atacant contra la web l'etramRouter o directament al gateway de l'entitat a la qual volem realitzar el tràmit.

  

  

  

**Requisits per configurar:** 

*   SoapUi
*   Fitxers que trobarem a la carpeta : _(Sharepoint) Tecnologia - SUPORT\_TECNIC\\SERVEIS\\ETRAM\\02 Producció\\01 Documentació Funcional\\eTRAMRouter\\Projecte SoapUI_ 
*   Màquin remota de l'AOC

**Passos a Seguir**
===================

1- Connexió màquina de l'AOC
----------------------------

*   Per realitzar les proves ens hem de connectar a la màquina de l'AOC amb el nostre usuari d'accés personal. 

2- Importar projecte 
---------------------

  

*   **Un cop hem accedit al SoapUI el primer pas que hem de realitzar és importar el projecte:** 

File **\>** Import Project **\>** Seleccionar el projecte etramrouter-pre-aoc-soapui-project.xml que trobem a la carpeta indicada en els requisits.

![](attachments/26313419/26315080.png?effects=drop-shadow)

3- Afegir KeyStore de l'AOC
---------------------------

  

*   **Per realitzar aquestes peticions hem de tenir configurat en el SoapUi el KeyStore de l'aoc (jks):**

Preferences > SSL Settings > Browse... > Seleccionem el "SEGELL\_AOC.jks"

Un cop carregat el KeyStore també li hem d'afegir el KeyStore password que també trobarem a la mateixa carpeta on indiquem als requisits. 

  

![](attachments/26313419/26315106.png?effects=drop-shadow)

  

4- Modificar petició
--------------------

  

*   *   **De totes les peticions que trobem en el projecte farem servir la de "ExempleDadesTramit-pre".**   
          
        Obrim la petició i modifiquem les etiquetes següents: 

Etiqueta

Valor

Exemple

<pet:IdPeticion>

prova\_NOM\_ENS\_AOC-${=(long)(System.currentTimeMillis())}

![](attachments/26313419/26315090.png)

<pet:Finalidad>

PROVES (!!Tenir en compte que hi han 2 etiquetes Finalidad!!)

![](attachments/26313419/26315094.png)

<pet:IdSolicitanteOriginal>

Aqui afegirem el INE10(0 inclós si cal ) de l'entitat que li enviem el tràmit.

![](attachments/26313419/26315092.png)

<abc:ensPropietari>

Aqui afegirem el INE10(0 inclós si cal ) de l'entitat que li enviem el tràmit.

![](attachments/26313419/26315091.png)

URL

[https://etramrouter-pre.aoc.cat:443/etramrouter/Sincron](https://etramrouter-pre.aoc.cat:443/etramrouter/Sincron)

![](attachments/26313419/26315957.png)

  

5- Canvi de fitxer adjunt de la petició
---------------------------------------

  

*   *   **Hi ha cops que el soapUi ens pot donar error perquè el fitxer adjunt de la petició és massa gran, a més modificarem el _contentID_ perquè apunti correctament al de la petició.** 

Attachments (n) > Clic al símbol + > obrim el fitxer "**adjunt\_soapui\_etram.txt**" (ubicat a la carpeta que indiquem als requisits). 

![](attachments/26313419/26315057.png?effects=drop-shadow)

*   *   **Eliminem el fitxer que ja estava adjunt:** 

Seleccionem el símbol X **\>** Removed select attachment **\>** "_YES"_

  

*   *   **Canviem el _contentID_ pel cid de l'etiqueta <_dadesAdjunt>_.**

*   *   **Canviem el camp _part_ i seleccionem del desplegable el _cid_.**

![](attachments/26313419/26315068.png?effects=drop-shadow)

6- Request Properties
---------------------

*   *   **De les request properties haurem de modificar dos paràmetres:**

_"Enable MTOM"→ true._

"_Disable multiparts_"→ false.

![](attachments/26313419/26315072.png?effects=drop-shadow)

  

  

Per obtenir més informació el soapUi proporciona uns 'logs' que podem veure seleccionant httplogs de la petició.

![](attachments/26313419/26315074.png?effects=drop-shadow)

  

Informació:

si apuntem en l'XML al XMLS → [http://cat.aoc/etramsge/adapter/peticio](http://cat.aoc/etramsge/adapter/peticio) anirà cap al adapter (el certificat d'eTRAM ha d'estar actualitzat) Això l'ens ha de fer-ho aixó

  

![](attachments/26313419/34505134.png)

  

![](attachments/26313419/34505129.png)

Si el certificat indicat està caducat, no funcionarà aquesta invocació. I fallarà l'adapter (per tant les actuacions fallaran)

Si no també es pot apuntar cap a: [http://cat.aoc/etramsge/gateway/peticio](http://cat.aoc/etramsge/gateway/peticio) aquest va cap el getway → Per fer nosaltres proves i validar correctament.

  

  

Fins a arribar al final d'aquests passos haurem aconseguit configurar el projecte del SoapUi per poder realitzar una petició com si fos l'AOC atacant a l'ens que hem indicat.

![](attachments/26313419/26315956.png)

Hem de tenir en compte que estarem fent una petició i com marca el diagrama anterior en primer lloc consultem la pàgina admin del etramRouter ([http://10.120.2.28:8082/etram-router-console/url.do](http://10.120.2.28:8082/etram-router-console/url.do)), i hem d'estar segurs que les propietats de l'ens està ben configurat tant en l'àmbit del certificat com al de l'URL que apunta al gateway.  
  
Per ser més exhaustius al llançar la petició podem revisar els logs de les màquines d'entorn de PRE: aoc\-l-back1(10.120.2.28) o aoc\-l-back2(10.120.2.29)  
  
Realitzant un tail i veien en temps real el que registra per detectar algun possible error.

  

1- ~$ cd /apps/aoc/APP/EtramSgeRouter/logs

2-  ~$ tail -f EtramSgeRouternode\*.log

  

  

  

7- Configuració petició directa al gateway de l'ens: 
-----------------------------------------------------

  

*   *   **Per realitzar la prova de la petició més acotada i fer-ho directament des del gateway de l'entitat a la qual li volem enviar el tràmit haurem d'afegir un nou wsdl i configurar una altra petició diferent a la anterior:** 

Clic botó dret sobre el projecte **>** Add WSDL **>** obrim el fitxer "**gateway.wsdl**" 

  

*   *   **Un cop s'ha creat el nou wsdl veurem que s'ha creat una **nova** petició:** 

![](attachments/26313419/26315069.png)

Obrim la petició "_Request1_" **\>** Eliminem tot igual que a la imatge següent: 

![](attachments/26313419/26315070.png?effects=drop-shadow)

*   *   **Entre les etiquetes de transmissió afegirem tota una part del xml de la petició "_ExempleDadesTramit_".**   
          
        Des de l'obertura de <dadesTramit> fins al tancament "</dadesTramit>"

![](attachments/26313419/26315045.png?effects=drop-shadow)

  

  

*   *   **Per aquesta petició haurem de fer els mateixos passos que hem realitzat en els pasos 5 i 6 de la petició "ExemplesDadesTramit - Pre" .**

  

### 6.2 Configuració endopint entitat

En la barra de navegació haurem d'afegit la URL del gateway de l'entitat a la qual volem realitzar la prova. La URL la podem treure o bé de la pàgina d'admin d'eTramRouter o ens la pot proporcionar el propi ens. 

![](attachments/26313419/26315047.png)

  

  

  

  

  

  

Un cop tinguem tots aquests passos realitzats podrem llançar la petició i validar que tot funciona correctament. 

Per tenir un control més exhaustiu podem fer un tail dels logs de la màquina

\[tomcat8@aoc-l-eacat8-01-pro logs\]$ pwd  
/apps/aoc/APP/ETRAM-SGE-ROUTER/logs

*   tail -f EtramSgeRouterfront-tomcat8\*.log
    

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

Attachments:
------------

![](images/icons/bullet_blue.gif) [image2018-11-8\_17-42-21.png](attachments/26313419/26315080.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2018-11-8\_17-53-23.png](attachments/26313419/26315106.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2018-11-8\_18-7-58.png](attachments/26313419/26315090.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2018-11-8\_18-8-30.png](attachments/26313419/26315089.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2018-11-8\_18-9-5.png](attachments/26313419/26315092.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2018-11-8\_18-9-31.png](attachments/26313419/26315091.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2018-11-8\_18-10-0.png](attachments/26313419/26315094.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2018-11-8\_18-49-25.png](attachments/26313419/26315057.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2018-11-8\_19-2-11.png](attachments/26313419/26315071.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2018-11-8\_19-7-45.png](attachments/26313419/26315072.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2018-11-8\_19-10-15.png](attachments/26313419/26315074.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2018-11-8\_19-18-34.png](attachments/26313419/26315068.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2018-11-8\_19-21-0.png](attachments/26313419/26315069.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2018-11-8\_19-24-35.png](attachments/26313419/26315070.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2018-11-8\_19-26-23.png](attachments/26313419/26315045.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2018-11-8\_19-32-49.png](attachments/26313419/26315046.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2018-11-8\_19-35-8.png](attachments/26313419/26315047.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2018-11-12\_21-51-13.png](attachments/26313419/26315956.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2018-11-12\_21-55-2.png](attachments/26313419/26315957.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2020-2-18\_10-1-35.png](attachments/26313419/34505129.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2020-2-18\_11-36-33.png](attachments/26313419/34505134.png) (image/png)  

Document generated by Confluence on 02 June 2025 10:54

[Atlassian](http://www.atlassian.com/)