Suport Tècnic : Comunicats AOC - GTM - Generació GTM  

1.  [Suport Tècnic](index.html)
2.  [Suport Tècnic](13893782.html)
3.  [01 - Gestió Operativa](26313391.html)
4.  [Tasques complementàries](26313409.html)
5.  [Comunicats AOC - Plantilles Comunicats](Comunicats-AOC---Plantilles-Comunicats_26313472.html)

Suport Tècnic : Comunicats AOC - GTM - Generació GTM
====================================================

Created by Unknown User (oteccmorales), last modified by Cristian Morales on 27 February 2025

Validar si hi ha GTM per la URL

F12, anem a Fuentes i cerquem la URL del GTM, aquí tenim el codi GTM-XXXXXX si surt aixó, es que tenim GTM preparat per aquest URL. Si no surt a la web de GTM es perque no tenim visibilitat.

![](attachments/41523295/100010571.png)

Cas per comunicar en el Portlet (EACAT) per un servei en concret: [Comunicats AOC - GTM - Activador EACAT per un servei en concret](https://intranet.aoc.cat/display/SII/Comunicats+AOC+-+GTM+-+Activador+EACAT+per+un+servei+en+concret)  
**GTM**

Accedir a [https://tagmanager.google.com/](https://tagmanager.google.com/) i fer login amb [suportintegracio.aoc@gmail.com](mailto:suportintegracio.aoc@gmail.com)

Plana principal, tots els comptes, seleccionem l’aplicació sobre la qual volem editar l’avís. En el cas de l’exemple farem servir eNotum:

![](attachments/41523295/41523296.png)

  

Dins dels espais de treball del projecte, seleccionem **Default Workspace,** en cas que no existeixi aquest espai de treball, seleccionem l’espai per defecte:

![](attachments/41523295/41523355.png)

Seleccionem les **Etiquetes** i dins de les etiquetes el **FLOTANT – AVIS - CAIGUDA:**

**![](attachments/41523295/41523298.png)  
**

![](attachments/41523295/41523299.png)

  

En el editor, és necessari modificar les següents parts de l’apartat HTML (@albciff: **he modificat el codi HTML dels avisos d’eNotum per a que sigui més senzill de modificar, per a la resta de serveis, si encara no s’ha fet cap avís potser que us trobeu amb una versió antiga d’aquest HTML, si és el cas m’ho podeu comentar i ho arreglaré també**)

[HTML base](41523295.html) (exemple):

<style>
#flotantAvisAOC2 {
  background: #f86464 url(https://upload.wikimedia.org/wikipedia/commons/1/1d/Human-dialog-warning.svg) no-repeat scroll 8px 10px;
  background-size: 40px 40px;
  border: 1px solid #f7e7ad;
  bottom: 0;
  color: #313131;
  display: none;
  font-family: "Lucida Grande","Lucida Sans Unicode","Lucida Sans","DejaVu Sans",Verdana,"sans-serif";
  font-size: 13px;
  padding-bottom: 25px;
  padding-left: 3%;
  padding-right: 5px;
  position: fixed;
  right: 0;
  width: 350px;
  text-align: left;
  line-height: 1.2em;
  Z-INDEX: 1000001;
}
#flotantAvisAOC2 li {
  list-style: disc;
}	
#flotantAvisAOC2 button.close {
  background: rgba(0, 0, 0, 0) none repeat scroll 0 0;
  border: 0 none;
  cursor: pointer;
  padding: 0;
    margin:7px;
}
#flotantAvisAOC2 .close {
  color: #000;
  float: right;
  font-size: 29px;
  font-weight: 700;
  line-height: 1;
  opacity: 0.3;
  text-shadow: 0 1px 0 #fff;
}
#flotantAvisAOC2 .titolAvis{padding: 16px 0;font-weight: bold; font-size: 16px;}
#flotantAvisAOC2 .contentAvis span {
  display: block;
  font-size: 12px;
  padding-top: 10px;
}
@media screen and (max-width: 880px) {
#flotantAvisAOC2 .titolAvis {
  padding: 16px 0 16px 15px;
}
}
@media screen and (max-width: 480px) {
#flotantAvisAOC2 {
  width: 100%;
}
#flotantAvisAOC2 .titolAvis {
  padding: 16px 0 16px 31px;
}


}

</style>

<div id="flotantAvisAOC2" tabindex="0">
  <div>
    <button type="button" class="close" onClick="TancarFlotant\_2e728ce88127();" title="Tancar missatge"><span>x</span></button>
  	<div class="titolAvis">\[AOC\] Intervenció programada al servei</div>
  	<div class="contentAvis">
	A causa d’una intervenció programada, <b>el servei eNotum quedarà totalment interromput del dia 14/05/2021 a les 15:30h fins el dia 16/05/2021 a les 09:00h</b>.
      </br></br>
    La no disponibilitat <b>afectarà</b> tant al <b>portal de l'empleat públic</b>, com al <b>portal de ciutadania</b> com als webservices, per tant, durant aquest període 
	<b>no es podran ni crear notificacions</b> per part dels treballadors públics <b>ni accedir-hi</b> per part de la ciutadania.
	  </br></br>
	Per no perjudicar als receptors de notificacions <b>s'allargarà la vida útil d'aquestes 3 dies, sumant 3 dies al còmput de terminis.</b>
	  </br></br>
      Trobareu tota la informació sobre qualsevol afectació al web a <a style="color:blue;" href="https://www.aoc.cat/estatserveis/" target="\_blank">estat dels serveis AOC</a>.
	  </br></br>
	  Per a qualsevol dubte, podeu contactar amb nosaltres a través del <a style="color:blue;" href="https://suport.aoc.cat/hc/ca/requests/new" target="\_blank">Portal de Suport d’Integradors.</a>
	</div>
  
  </div>
</div>

<script type="text/javascript">
/\*\*
 \* @albciff: Retocats els JS per a intentar fer més fàcil la gestió dels avisos.
 \*
 \* @versio: 1.0
 \*
 \* S'han afegit als identificadors de les variables i els mètodes un suffix per evitar colisions
 \* dins de l'espai global de variables, amb les webs on s'injecta el codi. Es podrà fer dins d'un objecte específic però
 \* ho volem fer ràpid, per tant de moment amb aixó tirem
 \*
\*\*/
var cookieAvisAOC\_2e728ce88127;

// Modificar el suffix per un valor aleatori
var idCookieAvis\_2e728ce88127 = 'avisAOCidcatmobil\_14052021\_4323b2c83k1y6';


function Oculta\_2e728ce88127(md){
	var x = document.getElementById(md);
	x.style.display = 'none';
}

function TancarFlotant\_2e728ce88127() {
	Oculta\_2e728ce88127('flotantAvisAOC2');
	setCookie\_2e728ce88127(idCookieAvis\_2e728ce88127,'avisat',2);
}

function setCookie\_2e728ce88127(nombre, valor, caducidad) {
	if(!caducidad)
		caducidad = 31
	var expireDate = new Date() 
	expireDate.setDate(expireDate.getDate()+caducidad);
	document.cookie = nombre + "=" + escape(valor) + "; expires=" + expireDate.toGMTString() + "; path=/";
}

function getCookie\_2e728ce88127(nombre)
{
	if(document.cookie.length>0)
	{
		start=document.cookie.indexOf(nombre + "=");
		if (start!=-1)
		{
			start=start + nombre.length+1;
			end=document.cookie.indexOf(";",start);
			if (end==-1)
				end=document.cookie.length;
			return unescape(document.cookie.substring(start,end));
		}
	}
	return "";
}

cookieAvisAOC\_2e728ce88127 = getCookie\_2e728ce88127(idCookieAvis\_2e728ce88127);

if (cookieAvisAOC\_2e728ce88127 != 'avisat') {
	document.getElementById('flotantAvisAOC2').style.display = 'block';
} 
	
</script>

exemple missatge en concret

<div class="titolAvis">Intervenció programada als serveis AOC l’1 i 2 de març que implica tall en els serveis</div>  
  <div class="contentAvis">  
     <p>Per tasques de manteniment tècnic, aquest servei no estarà disponible en les següents forquilles horàries:</p>

    <p><strong>Dissabte 1 de març:</strong></p>  
    <p>Data inici: 01/03/2025 06:00h</p>  
    <p>Data fi: 01/03/2025 22:00h</p>

    <p><strong>Diumenge 2 de març:</strong></p>  
    <p>Data inici: 02/03/2025 08:00h</p>  
    <p>Data fi: 02/03/2025 22:00h</p>

    <p>Disculpa les molèsties ocasionades. Trobareu més informació sobre aquest tall de servei a:   
        <a style="color:blue;" href="[https://www.aoc.cat/estatserveis/](https://www.aoc.cat/estatserveis/)" target="\_blank">estat dels serveis AOC</a>.  
    </div>  
  
\--------------------------------------------------------------------------------------------------------------------------------------  
  <div class="titolAvis">Intervenció programada als serveis AOC l’1 i 2 de març que implica tall en els serveis</div>  
  <div class="contentAvis">  
     <p>Per tasques de manteniment tècnic, aquest servei no estarà disponible en les següents forquilles horàries:</p>

    <p><strong>Dissabte 1 de març:</strong></p>  
    <p>Data inici: 01/03/2025 06:00h</p>  
    <p>Data fi: 01/03/2025 22:00h</p>

    <p><strong>Diumenge 2 de març:</strong></p>  
    <p>Data inici: 02/03/2025 08:00h</p>  
    <p>Data fi: 02/03/2025 22:00h</p>

    <p>Disculpa les molèsties ocasionades.</p>  
      </div>

  

  

Només cal modificar l’avís de la primera línia de: <div class="contentAvis">

 ![](attachments/41523295/41523301.png)

  

 I canviar la part final de l'identificador de la galeta, en aquest cas he fet avisAOCenotum\_ddMMYYYY\_ValorAleatori

![](attachments/41523295/41523302.png)

 Un cop fet això, abans de publicar-ho, farem una prova de visualització. Per tal de dur-ho a terme, ho deixem activat i desem els canvis:

 ![](attachments/41523295/41523357.png)

Ara seleccionem la previsualització:

![](attachments/41523295/41523306.png)

 Ens apareixerà aquesta finestra:

![](attachments/41523295/41523358.png)

 Ara només és necessari obrir una nova pestanya i anar a la url que volem validar, en aquest cas [https://usuari.enotum.cat/webCiutada/](https://usuari.enotum.cat/webCiutada/) automàticament es carregarà la pestanya de debug de GTM:

![](attachments/41523295/41523310.png)

Comprovem que el tag està llençat, i podem minimitzar la part de debug per veure l’avís:

![](attachments/41523295/41523312.png)

Si no es publica el GTM - Revisió codi Javascript

Si després de fer diversos intents, es canvia el valor de la cookie, es visualitza en incògnit la web, i continuem sense veure el GTM, podríem revisar la variable amb la que declarem la cookie i la funció amb la que fem la crida a aquesta variable. 

En un cas ens vam trobar que el nom de la variable estava mal escrit a la funció. 

EXEMPLE:

![](attachments/41523295/100008288.png)

  

Aquesta és la variable el valor de la qual hem de modificar, normalment ho fem indicant la data del dia actual. 

Si ens en anem més a sota veurem aquesta funció:

![](attachments/41523295/100008289.png)

  

El que passava és que no estava ben declarada la variable que associava l'anterior variable declarada:

  

![](attachments/41523295/100008290.png)

  

Com veiem a la línea comentada, la variable acaba en 26a, quan realment si ens en anem a dalt, la variable acaba en 26.

  

Aquest cas fa referència a un GTM d'e-NOTUM, però podria passar quelcom semblant en altres serveis. A tenir en compte per si no aconseguim veure publicat el GTM.

  

  

  

Un cop fet això tornem al GTM, i finalitzem el procés de previsualització, i programem el temps d’activació real, en aquest cas posarem 30 mins abans de la intervenció i 30 mins després de marge:

![](attachments/41523295/41523314.png)

 Finalment desem els canvis:

![](attachments/41523295/41523316.png)

 Ara ja podem Enviar els canvis:

![](attachments/41523295/41523318.png) 

Revisem que només es publicaran els nostres canvis, i podem publicar:

![](attachments/41523295/41523320.png)  
**Treure l'avís un cop restablerta la incidència**

Per treure l'avís que s'ha publicat a causa d'una incidència i aquest avís no s'ha indicat una finestra de temps, haurem de fer pausa l'avís:

1- Entrem en l'etiqueta de l'avís que volem desactivar:

![](attachments/41523295/41523322.png)

  

2- A dalt a l'esquerre hi han 3 puntets fem clic i en "posar en pausa":

![](attachments/41523295/41523324.png)

  

3- Desem

4- Enviem

5- Publiquem

Si no podem tancar el GTM - Revisar script

Si ens comenten que el GTM que hem publicat no es pot tancar, i que, per tant, pot ocupar una part de la pantalla que tapi dades importants de la web, haurem de revisar l'script que oculta i tanca el GTM. 

Aquest script que deixem a continuació és funcional, el podem agafar com a plantilla per enganxar-lo als GTM.

  

**Scrtipt Tancar GTM**

<script type="text/javascript">
/\*\*
 \* @albciff: Retocats els JS per a intentar fer més fàcil la gestió dels avisos.
 \*
 \* @versio: 1.0
 \*
 \* S'han afegit als identificadors de les variables i els mètodes un suffix per evitar colisions
 \* dins de l'espai global de variables, amb les webs on s'injecta el codi. Es podría fer dins d'un objecte específic, però
 \* ho volem fer ràpid, per tant de moment amb això tirem
 \*
\*\*/
var cookieAvisAOC\_2e728ce88125;

// Modificar el suffix per un valor aleatori
var idCookieAvis\_2e728ce88125 = 'avisAOCIDcatmobil\_2024021911h53m\_chillingesincreible432234';


function Oculta\_2e728ce88125(md){
	var x = document.getElementById(md);
	x.style.display = 'none';
}

function TancarFlotant\_2e728ce88125() {
	Oculta\_2e728ce88125('flotantAvisAOC2');
	setCookie\_2e728ce88125(idCookieAvis\_2e728ce88125,'avisat',2);
}

function setCookie\_2e728ce88125(nombre, valor, caducidad) {
	if(!caducidad)
		caducidad = 31
	var expireDate = new Date() 
	expireDate.setDate(expireDate.getDate()+caducidad);
	document.cookie = nombre + "=" + escape(valor) + "; expires=" + expireDate.toGMTString() + "; path=/";
}

function getCookie\_2e728ce88125(nombre)
{
	if(document.cookie.length>0)
	{
		start=document.cookie.indexOf(nombre + "=");
		if (start!=-1)
		{
			start=start + nombre.length+1;
			end=document.cookie.indexOf(";",start);
			if (end==-1)
				end=document.cookie.length;
			return unescape(document.cookie.substring(start,end));
		}
	}
	return "";
}

//cookieAvisAOC\_2e728ce88125 = getCookie\_2e728ce88125(idCookieAvis\_2e728c41231238125);
  
cookieAvisAOC\_2e728ce88125 = getCookie\_2e728ce88125(idCookieAvis\_2e728ce88125);

if (cookieAvisAOC\_2e728ce88125 != 'avisat') {
	document.getElementById('flotantAvisAOC2').style.display = 'block';
} 
	
</script>

  

IMPORTANT: si utilitzem aquest script, a l'hora de cridar la funció per tancar el GTM haurem de canviar el nom a l'onClick per TancarFlotant\_2e728ce88125()

**Scrtipt Tancar GTM MODIFICAR NOM FUNCIÓ**

<div id="flotantAvisAOC" tabindex="0">
	<div>
		<button type="button" class="close" onClick="TancarFlotant\_2e728ce88125();" title="Tancar missatge">
			<span>×</span>
		</button>
		<div class="titolAvis">\[AOC\] Intervenció programada als serveis Via Oberta i al MUX per a l’optimització del model de dades</div>
		<div class="contentAvis">
      El proper dimecres <strong>28 de febrer entre les 22:00h i les 23:59h</strong> està prevista una intervenció per a l’optimització del model de dades d’alguns serveis per a la millora dels procediments interns de manteniment.
      <br/>
Serveis afectats: <strong>Consultes de Via Oberta i Registre Unificat (MUX)</strong>
			<br/>
			<span>
				<ul>
					<li>Data inici: <strong>28/02/2024 22:00h</strong>
					</li>
					<li>Data fi: <strong>28/02/2024 23:59h</strong>
					</li>
				</ul>
			</span>
      Durant l’inici d’aquest període es durà a terme un tall de servei que pot durar entre 30 i 45 minuts.
	Trobareu tota la informació sobre qualsevol afectació al web de <a href="https://www.aoc.cat/estatserveis/">l’estat dels serveis AOC.</a>
		</div>
	</div>
</div>

Attachments:
------------

![](images/icons/bullet_blue.gif) [image2021-5-7\_10-12-4.png](attachments/41523295/41523296.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2020-2-4\_14-28-30.png](attachments/41523295/41523297.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2020-4-20\_9-43-30.png](attachments/41523295/41523298.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2021-5-7\_10-13-25.png](attachments/41523295/41523299.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2020-2-4\_14-28-49.png](attachments/41523295/41523300.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2021-5-7\_10-15-15.png](attachments/41523295/41523301.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2021-5-7\_10-16-39.png](attachments/41523295/41523302.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2021-5-7\_10-16-39.png](attachments/41523295/41523303.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2020-2-4\_14-30-5.png](attachments/41523295/41523304.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2020-2-4\_14-30-5.png](attachments/41523295/41523305.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2020-2-4\_14-30-17.png](attachments/41523295/41523306.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2020-2-4\_14-30-17.png](attachments/41523295/41523307.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2020-2-4\_14-31-9.png](attachments/41523295/41523308.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2020-2-4\_14-31-9.png](attachments/41523295/41523309.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2020-2-4\_14-31-18.png](attachments/41523295/41523310.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2020-2-4\_14-31-18.png](attachments/41523295/41523311.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2020-2-4\_14-31-27.png](attachments/41523295/41523312.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2020-2-4\_14-31-27.png](attachments/41523295/41523313.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2020-2-4\_14-31-34.png](attachments/41523295/41523314.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2020-2-4\_14-31-34.png](attachments/41523295/41523315.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2020-2-4\_14-31-41.png](attachments/41523295/41523316.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2020-2-4\_14-31-41.png](attachments/41523295/41523317.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2020-2-4\_14-31-50.png](attachments/41523295/41523318.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2020-2-4\_14-31-50.png](attachments/41523295/41523319.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2020-2-4\_14-31-57.png](attachments/41523295/41523320.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2020-2-4\_14-31-57.png](attachments/41523295/41523321.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2020-4-20\_16-29-58.png](attachments/41523295/41523322.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2020-4-20\_16-29-58.png](attachments/41523295/41523323.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2020-4-20\_16-31-41.png](attachments/41523295/41523324.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2020-4-20\_16-31-41.png](attachments/41523295/41523325.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2021-5-21\_12-57-35.png](attachments/41523295/41523355.png) (image/png)  
![](images/icons/bullet_blue.gif) [enotum\_aapp\_avis\_intervencio.html](attachments/41523295/41523356.html) (text/html)  
![](images/icons/bullet_blue.gif) [image2021-5-21\_13-3-9.png](attachments/41523295/41523357.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2021-5-21\_13-4-49.png](attachments/41523295/41523358.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2023-11-6\_13-30-43.png](attachments/41523295/100008288.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2023-11-6\_13-32-22.png](attachments/41523295/100008289.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2023-11-6\_13-35-16.png](attachments/41523295/100008290.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2024-5-28\_12-11-5.png](attachments/41523295/100010571.png) (image/png)  

Document generated by Confluence on 02 June 2025 10:47

[Atlassian](http://www.atlassian.com/)