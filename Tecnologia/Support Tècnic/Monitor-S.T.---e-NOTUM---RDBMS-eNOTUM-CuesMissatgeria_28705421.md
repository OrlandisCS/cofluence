Suport Tècnic : Monitor S.T. - e-NOTUM - RDBMS-eNOTUM-CuesMissatgeria  

1.  [Suport Tècnic](index.md)
2.  [Suport Tècnic](13893782.md)
3.  [03 - Monitorització - Revisions globals](26313327.md)
4.  [Monitors S.T.](Monitors-S.T._41522177.md)
5.  [Monitor S.T. - OLD](Monitor-S.T.---OLD_118555256.md)

Suport Tècnic : Monitor S.T. - e-NOTUM - RDBMS-eNOTUM-CuesMissatgeria
=====================================================================

Created by Unknown User (otecobernal), last modified by OTEC ST Alessandro Trombin Martinez on 02 March 2022

**Query:**

SELECT COUNT(ID) REGISTRES
FROM NT30.AOC\_NT\_EVENT\_CUES\_MISSATGERIA
where ESTAT = 0
and DATA\_ACCIO < CURRENT\_TIMESTAMP

**Descripció:** 

La taula AOC\_NT\_EVENT\_CUES\_MISSATGERIA gestiona les fases de les comunicacions. Quan s'envia una comunicació/avís per una notificació es crea un registre en aquesta taula, amb estat 0. Seguidament si està en estat 0, es passarà a estat en procés (1) perquè s'enviï l'avís a l'usuari. Si falla tornarà a estat 0 fins a estar en reintents 5 i estat dos que voldrà dir que l'avís a fallat i no s'ha pogut enviar.

  

**Actuació:** 

**Revisem que el RDBMS processa i que les notificacions no acabin en estat d'error.**

Mirarem si el RDBMS està processant:

SELECT count(ID)
FROM AOC\_NT\_EVENT\_CUES\_MISSATGERIA 
where ESTAT = 0 
and DATA\_ACCIO < CURRENT\_TIMESTAMP

Si veiem que el número baixa, indica que el RDBMS funciona correctament. En cas que no baixi gens → Recrear RDBMS

  

Una vegada comprovat el RDBMS, comprovem que el scallbacks estiguin acabant correctament.

Pot ser que la cua s'estigui fent llarga perque els que es processen acaben en error i es tornen a posar a la cua.

Intentarem veure si està passant això. La següent query ens mostrarà tota la informació dels que estan en la cua:

select cc.\* 
from nt30.aoc\_nt\_event\_cues\_missatgeria cc, nt30.aoc\_nt\_ws\_message\_queue qq, nt30.aoc\_nt\_entitat ee
where cc.identificador= qq.id
and qq.id\_entitat = ee.id\_entitat
and cc.inici\_execucio >= sysdate -1
order by cc.inici\_execucio desc;

Si detectem molts events pels que estan pujant els re-intents, és que alguna cosa passa → Estan fallant els events de comunicació.

Agrupem per entitat per veure si alguna entitat en particular està protagonitzant els problemes, i filtrem per estat en error:

select ee.id\_ens, ee.nom, count (\*)
from nt30.aoc\_nt\_event\_cues\_missatgeria cc, nt30.aoc\_nt\_ws\_message\_queue qq, nt30.aoc\_nt\_entitat ee
where cc.identificador= qq.id
and qq.id\_entitat = ee.id\_entitat
and cc.inici\_execucio >= sysdate -1
and cc.estat = 2
group by ee.id\_ens, ee.nom
order by count (\*) desc;

  

Si veiem que alguns entitat en concret té problemes amb els callbacks, podem agafar una notificació en concret i revisar els logs:

select \* from nt30.aoc\_nt\_logs\_comunicacio cc
where cc.id\_notificacio='XXXXXX'

  

**Possible cas d'error**: Pot ser que l'endpoint configurat pels callbacks de l'entitat estigui mal configurat o hagin generat algun canvi per part de l'ens i no hi hagi connexió amb el WS.

Davant d'aquest problema podrem:

1.  Desactivar els callbacks per l'ens.
2.  Contactar amb l'ens que té els consum massius d'error.

\*\*Actuem en aquest cas per prevenir que els avisos de canvi d'estats quedin tots en error.

**logs:** 

*   **Servidor: SOA PCI3**
*   **Ruta: apps/aoc/NT/logs**
*   **Nom:**  **/NT-ErrorComunicacio-NTNODO\*\_SOA.log**

Document generated by Confluence on 02 June 2025 11:09

[Atlassian](http://www.atlassian.com/)