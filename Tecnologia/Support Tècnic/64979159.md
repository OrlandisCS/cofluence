Suport Tècnic : Monitor S.T. - SCTDEV - Consums asíncrons sense resposta  

1.  [Suport Tècnic](index.md)
2.  [Suport Tècnic](13893782.md)
3.  [03 - Monitorització - Revisions globals](26313327.md)
4.  [Monitors S.T.](Monitors-S.T._41522177.md)

Suport Tècnic : Monitor S.T. - SCTDEV - Consums asíncrons sense resposta
========================================================================

Created by Unknown User (otecobernal), last modified by Joan Riquelme on 24 April 2025

Què mesura aquest monitor?

Revisa els consums de SCT\_DEV per lots (Asíncrons) que hagin finalitzat, però la sol·licitud no tingui XML de resposta i, per tant, finalitzen sense dades de respostes.

  

**Consulta**
============

* * *

select count(p.id) "Peticions"
  from PCI30APP.PCI\_MTI\_PETICIO p, PCI30APP.PCI\_MTI\_SOLICITUD s
 where p.id = s.id\_peticio
   and p.data\_recepcio >= to\_date('15/11/2021', 'dd/mm/yyyy') --  data en al que es comença a fer revisió
      -- and p.id>1799124408 -- id d'una peticio cluster APP del dia 15 de novembre (per si cal fer-la cross-projecte)
   and p.codi\_producte = 'ENOTUM\_CREDENCIALS'
   and s.modalitat\_consum = 'CONSULTA\_CREDENCIALS\_LOT'
   and p.estat = 3 -- finalitzada
   and 0 = (select count(id)
              from PCI30APP.PCI\_MTI\_XML x
             WHERE x.id\_peticio = p.id
               and TIPUS = 4)

**Procediment**
===============

* * *

Procedirem a reiniciar la petició. Si hi ha resposta al SFTP acabarà correctament; i si no acabarà amb un error controlat.

\-- Cerquem el consum
select \* from PCI30APP.PCI\_MTI\_PETICIO p, PCI30APP.PCI\_MTI\_SOLICITUD s
where p.id = s.id\_peticio
and p.id\_peticio = 'D21052213002987'

-- eliminem l'XML de resposta de sol i resposta de les peticions afectades
 
DELETE FROM PCI30APP.PCI\_MTI\_XML
 WHERE TIPUS IN (4, 5)
   AND ID\_PETICIO IN
       (SELECT ID
          FROM PCI30APP.PCI\_MTI\_PETICIO
         WHERE ID\_PETICIO in
               (select p.id\_peticio
                  from PCI30APP.PCI\_MTI\_PETICIO   p,
                       PCI30APP.PCI\_MTI\_SOLICITUD s
                 where p.id = s.id\_peticio
                   and p.data\_recepcio >= to\_date('15/11/2021', 'dd/mm/yyyy') --  data en al que es comença a fer revisió
                   and p.codi\_producte = 'ENOTUM\_CREDENCIALS'
                   and s.modalitat\_consum = 'CONSULTA\_CREDENCIALS\_LOT'
                   and p.estat = 3 -- finalitzada
                   and 0 = (select count(id)
                              from PCI30APP.PCI\_MTI\_XML x
                             WHERE x.id\_peticio = p.id
                               and TIPUS = 4)));
    
-- modifiquem estat de les solicituds afectades a pendent
       
UPDATE PCI30APP.PCI\_MTI\_SOLICITUD
   SET ESTAT = 0
 WHERE ID\_PETICIO in
       (SELECT ID
          FROM PCI30APP.PCI\_MTI\_PETICIO
         WHERE ID\_PETICIO in
               (select p.id\_peticio
                  from PCI30APP.PCI\_MTI\_PETICIO   p,
                       PCI30APP.PCI\_MTI\_SOLICITUD s
                 where p.id = s.id\_peticio
                   and p.data\_recepcio >= to\_date('15/11/2021', 'dd/mm/yyyy') --  data en al que es comença a fer revisió
                   and p.codi\_producte = 'ENOTUM\_CREDENCIALS'
                   and s.modalitat\_consum = 'CONSULTA\_CREDENCIALS\_LOT'
                   and p.estat = 3 -- finalitzada
                   and 0 = (select count(id)
                              from PCI30APP.PCI\_MTI\_XML x
                             WHERE x.id\_peticio = p.id
                               and TIPUS = 4)));

  
-- modifiquem estat de les peticions afectades a Executada
 
UPDATE PCI30APP.PCI\_MTI\_PETICIO
   SET ESTAT = 2
 WHERE ID\_PETICIO in
       (select p.id\_peticio
          from PCI30APP.PCI\_MTI\_PETICIO p, PCI30APP.PCI\_MTI\_SOLICITUD s
         where p.id = s.id\_peticio
           and p.data\_recepcio >= to\_date('15/11/2021', 'dd/mm/yyyy') --  data en al que es comença a fer revisió
           and p.codi\_producte = 'ENOTUM\_CREDENCIALS'
           and s.modalitat\_consum = 'CONSULTA\_CREDENCIALS\_LOT'
           and p.estat = 3 -- finalitzada
           and 0 = (select count(id)
                      from PCI30APP.PCI\_MTI\_XML x
                     WHERE x.id\_peticio = p.id
                       and TIPUS = 4));

**Informació addicional**
=========================

* * *

### 1) Revisió de logs

Podrem trobar els logs a les rutes:

*   /apps/aoc/APP/logs/MC-SCTDEV-IOP\_IOPNODO\*\_SOA.log → **Consums asíncrons SFTP** 

  

####   
  

  

Attachments:
------------

![](images/icons/bullet_blue.gif) [cds.gif](attachments/64979159/64979160.gif) (image/gif)  
![](images/icons/bullet_blue.gif) [Monitor S.T. - SCTDEV - Consums asíncrons sense resposta.url](attachments/64979159/64979162.url) (application/octet-stream)  

Document generated by Confluence on 02 June 2025 11:09

[Atlassian](http://www.atlassian.com/)