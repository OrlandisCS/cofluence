Suport Tècnic : MUX - INTEGRACIÓ - Alta servei (PRE)  

1.  [Suport Tècnic](index.html)
2.  [Suport Tècnic](13893782.html)
3.  [02 - FAQ's serveis](26313393.html)
4.  [FAQ's MUX](28705591.html)

Suport Tècnic : MUX - INTEGRACIÓ - Alta servei (PRE)
====================================================

Created by Unknown User (agonlara), last modified by Unknown User (oteccmorales) on 15 November 2022

  

  

Procediment per donar d'alta a una entitat al MUX (Registre unificat)

  

Al rebre una sol·licitud d'alta el ens ens ha d'adjuntar (obligatori):

*   *   CDA
    *   Sol·licitud d'alta en PDF i signada
    *   URL's per configurar els proxys

  

Quan ens trobem que l'ens no ho ha adjuntat les dades anteriors els hi enviarem: 

**Missatge per demanar les dades d'integració**

Benvolguts,

  

Després d’haver rebut la sol·licitud d’alta per realitzar la integració del registre Unificat us comentem que:

Per donar-vos d’alta, precisarem la URL on residirà el vostre Registre ([aquí](https://suport-integradors.aoc.cat/hc/ca/articles/4416414657297-Com-integrar-se-al-servei-) teniu la documentació) per tal de realitzar l’alta i obrir les connexions cap a ella (ens hauríeu d’omplir el següent formulari amb la URL i si s’escau, l’empresa externa desenvolupadora de la vostra eina. S’haurà de signar el formulari digitalment, previ pas a PDF); i també carregarem el vostre certificat CDA a l’entorn de pre-producció, amb el qual signareu les peticions XML que aniran cap a la nostra plataforma (necessitem la clau pública .cer, ens la podeu adjuntar amb extensió .txt perquè el servidor de correu no la bloquegi).

Aprofitem per adjuntar-vos les claus públiques (arrels) tant de l’entorn de preproducció com de producció, i les claus públiques dels certificats amb els quals signarem els XMLs cap a la vostra plataforma perquè pugueu carregar-ho tot en el vostre truststore.

Recordar-vos que com a registre auxiliar (si falla l’assentament cap a la vostra plataforma), s’activarà el registre de l’EACAT com a auxiliar, per tant caldrà que seguiu consultant l’EACAT com a registre on poden arribar assentaments, o desenvolupar un servei web del registre auxiliar per bolcar els assentaments cap al vostre registre (documentació [aquí](https://suport-integradors.aoc.cat/hc/ca/articles/4416414658833-Puc-consultar-els-assentaments-realitzats-al-MUX-mitjan%C3%A7ant-WS-)).

També teniu en compte que els documents no viatgen en la creació dels assentaments, per tant, si els voleu al vostre registre, caldrà que desenvolupeu un altre servei web de descàrrega de documentació (documentació [aquí](https://suport-integradors.aoc.cat/hc/ca/articles/4416400141073-Com-descarregar-la-documentaci%C3%B3-dels-assentaments-del-MUX-)) per poder-vos-la descarregar (menys les factures, que no descarreguen la documentació per aquest mètode sinó que ho fan per integració directa al Hub d’eFact).

[Aquí](https://www.aoc.cat/base-de-coneixement-integradors/#mux) teniu més preguntes freqüents perquè li doneu una ullada.

  

Atentament,

  

**Al copiar i enganxar el missatge anterior tenir en compte que hi han enllaços, ens hem d'assegurar que els exportem bé.**

A més en aquesta part també els hem d'adjuntar:

*   *   *   *   *   Formulari Sol·licitud Integració:  
                    [![](rest/documentConversion/latest/conversion/thumbnail/26314134/1)](/download/attachments/26313555/Formulari%20Sol%20licitud%20Integraci%C3%B3%20Serveis%20CAOC%20V16_20170601143357_20181030144023.docx?version=1&modificationDate=1542380389000&api=v2)

  

*   *   *   *   *   Claus públiques (arrels) tant de l’entorn de pre-producció com de producció, i les claus públiques dels certificats amb els quals signarem els XMLs cap a la  plataforma del ens perquè puguin carregar-ho tot en el seu truststore:

  

           [![](download/resources/com.atlassian.confluence.plugins.confluence-view-file-macro:view-file-macro-resources/images/placeholder-small-zip.png)CLAUS\_MUX.zip](/download/attachments/26313555/CLAUS_MUX.zip?version=2&modificationDate=1553690168000&api=v2)

Un cop ens contesti l'entitat amb tota la informació adjuntada ja podrem procedir a realitzar l'alta. 

  

  

1- Autorització i Autenticació al SIRI
======================================

  

*   Com totes les altes que realitzem donarem autorització i autenticació al SIRI. Per procedir aquest pas consultem la FAQ [Global - Altes de Serveis](/pages/createpage.action?spaceKey=SII&title=GLOBAL+-+INTEGRACI%C3%93+-+Altes+de+Serveis&linkCreation=true&fromPageId=26313555).(**Realitzem les autoritzacions i autenticació també per l'entorn de PRO**)

  

  

2- Configuració d'IP's
======================

  

*   En el formulari d'integració l'entitat ens haurà informat de les IP's que haurem de configurar.
*   Abans de configurar avisarem amb un tiquet JIRA a sistemes, que farem configuracions d'IP's i a més aprofitem i també els hi notificarem que ho farem pels proxys. 
    
    Descripció tiquet
    
    Faig graceful, havent fet un backup, per afegir IP a PRE i PRO, tant APP com IOP i identitats:
    
    #178.237.148.146 40.69.58.156 - Ajuntament de Montgat
    
    També un Proxy a PRE
    
    /montgat/[https://annexapre.montgat.cat/](https://annexapre.montgat.cat/ "Seguir el enlace")
    
    Addicionalment, afegeixo JKS al MUX de PRE i reinicio.
    
    Salutacions,
    
*   **Realitzem les configuracions també per l'entorn de PRO**

3- Configuració proxy
=====================

  

*   L'usuari ens haurà d'haver proporcionat una url similar a: **[https://annexapre.montgat.cat/integracions/mux](https://annexapre.montgat.cat/integracions/mux)** i afegirem Proxy en el primer node, **i realitzar els mateixos passos al node aoc-l-back02-pre**
*   **En el cas que ens enviessin també els proxys per a PRO, també els configurarem.** 

  

3.1 - Ens connectem a la màquina aoc-l-back01-pre 

3.2 - Copia de seguretat del fitxer: 

**$ cp /etc/httpd/conf.d/sites/test.proxyMUX.aoc.cat.conf /etc/httpd/conf.d/sites/test.proxyMUX.aoc.cat.conf.20XXXXXX**

3.3 - Afegir Proxy al final del fitxer

**_$ vi_ /etc/httpd/conf.d/sites/test.proxyMUX.aoc.cat.conf**

**![](attachments/26313555/26315765.png)  
**

Seguirem el patró que està en els altres proxys, si ens fixem, no afegim la URL sencera que ens ha passat l'ens. 

  

3.4 - Validem que el fitxer estigui ben configurat:

**$ /etc/init.d/httpd configtest**

![](attachments/26313555/26315761.png)  

  

  

3.5 - Realitzem graceful:

**$ sudo /etc/init.d/httpd graceful**

Ens demanarà password per realitzar el graceful: 

**back01 ---> PBxJofeW**  
**back02 ---> JADzKMqV**

4 - Afegir al JKS el CDA
========================

  

4.1 - L'entitat ens haurà d'haver passat el CDA que l'afegirem a _MUX-reg\_referencia\_truststore.jks_ (al **node 1** del frontal de **PRE – aoc-l-web1-pre, fent còpia de seguretat del jks anterior**):

 **$ cp apps/aoc/certs/MUX-reg\_referencia\_truststore.jks apps/aoc/certs/MUX-reg\_referencia\_truststore.jks.XXXXX**

 4.2 - Descarreguem el trustore: 

![](attachments/26313555/26315740.png)

  

4.3 Obrim el JKS amb l'eina Portecle, ens demanarà una paraula de pas que la podrem obtenir en el Keepass CAOC\_OT posant al buscador : **MUX-reg\_referencia\_truststore.jks**

**![](attachments/26313555/26315730.png)**

4.4 - Un cop obert arrossegarem el CDA de l'ens i ja el tindrem afegit al trutstore.

  

4.5 - Carreguem de nou el .jks a la màquina **PRE – aoc-l-web1-pre**

Ruta: **$** **apps/aoc/certs/**

**No fer a pro, quan l'ens sol·liciti l'alta a Pro li passarem el certificat al Toni Llebaria (el carrega els Dimecres)** 

5 - Configurem el Registre com a tal a la web d’administració del MUX
=====================================================================

5.1- Ens connectem a la pàgina admin de mux PRE: [http://admin-pre.iop.aoc.cat/prjMUXWebAdmin/inici.do](http://admin-pre.iop.aoc.cat/prjMUXWebAdmin/inici.do)

5.2 - Obrim un exemple d'un ens que tingui el mateix proveïdor(Audifilm, ABSIS...)

5.3 - Anem a Gestió de registres telemàtics >  a baix de tot >  afegir un de nou, omplim les dades del nou registre i copiar el patró de l'exemple del mateix proveïdor.  
       

Passwords : Buscar **Passwords Detall Registre MU**X al Keepass CAOC\_OT

  

![](attachments/26313555/26316128.png)

5.4- Afegir les regles d'entrada i sortida:

[D](http://admin-pre.iop.aoc.cat/prjMUXWebAdmin/inici.do)es de la mateixa pàgina admin > Gestió de regles > Nova Regla > Creem una regla de cada (Entrada i Sortida) 

![](attachments/26313555/26316268.png?effects=drop-shadow)

  

Camp

Entrada

Sortida

NOM

NomEntitat/E

NomEntitat/S

APLICACIÓ

\*

\*

TIPUS 

Entrada

Sortida

PROCEDÈNCIA

BUIT

INE10 + CODI INE10 **amb 0 davant si cal**

POB. PROCEDÈNCIA

Totes i \*

Totes i \*

DESTINACIÓ

 INE10 + CODI INE10 **amb 0 davant si cal**

BUIT

POB. DESTINACIÓ

Totes i \*

Totes i \*

REG. PRINCIPAL

Buscar el registre del Ajuntament

Buscar el registre del Ajuntament

REG. AUXILIAR

Registre EACAT

Registre EACAT

  

  
  

  

6- Reiniciem app1 i 2 de WL8
============================

  

6.1-  Reiniciem les màquines una per una:

**Connectem a:**           

bea@aoc-l-app1-pre / bea@aoc-l-app2-pre

  

**Ens ubiquem al directori:**           

cd /apps/bea/beaplat/user\_projects/domains/PCIDomain

  

**Executem comanda:**

./BEA\_STOP\_NODO1.sh     - ./BEA\_STOP\_NODO2.s

./BEA\_START\_NODO1.sh    - ./BEA\_START\_NODO2.sh

  

**Obrim en una altra pantalla el log per veure l'estat del reinici:**

tail -200f nodo1.out.XX -  tail -200f nodo2.out.XX

  

**Missatge exemple que indica que el reinici s'ha finalitzat correctament:** 

<06-nov-2018 17H11' CET> <Notice> <WebLogicServer> <BEA-000360> <Server started in RUNNING mode\>

  

  

7- Fem una prova del funcionament del MUX
=========================================

  

 Per validar que se'ls ha donat correctament d'alta a l'entitat podrem fer una prova generant una tramesa genèrica. 

7.1- Accedir a [https://plpre6.eacat.cat/group/aoc/over-generica](https://plpre6.eacat.cat/group/aoc/over-generica) (Accedim amb el nostre DNI o T-CAT)

7.2- Omplir el camp "A on us dirigiu" per crear una tramesa contra l'ens que estem donant d'alta(i a la vegada es farà un registre de sortida des de l'AOC dirigit a l'ens en qüestió ):

 ![](attachments/26313555/26315838.png)

  

7.3- Clicar al botó del PDF Tramesa Genèrica verd, per descarregar el formulari a l'escriptori.

7.4- Obrir el PDF descarregat i omplir els camps en vermell (assumpte i exposo) amb dades fictícies

7.5- Clicar el botó Validar del PDF

7.6- Signar el PDF (al clicar el botó Validar, s'habilitarà el botó Signar)

7.7- Guardar el PDF resultant a l'escriptori

7.8- Anar a [https://plpre6.eacat.cat/group/aoc/over-upload](https://plpre6.eacat.cat/group/aoc/over-upload)

7.9- Pujar el document resultant de l'escriptori i donar el botó Tramitar

7.10- Anem a la pàgina d'administració del MUX( [http://admin-pre.iop.aoc.cat/prjMUXWebAdmin/inici.do](http://admin-pre.iop.aoc.cat/prjMUXWebAdmin/inici.do) ) > Auditoria de peticions > Comprovem que s'ha generat correctament l'assentament pel registre principal. 

  

  

En cas que el número de registre s'hagi creat pel registre auxiliar, haurem d'identificar l'error perquè no s'ha generat pel principal i comunicar-ho a l'entitat perquè es posi en contacte amb el proveïdor i revisi perquè no està funcionant el registre principal. 

  

  

8 - Procediment quan demanin la integració a l'entorn de producció
==================================================================

  

*   *   En el cas que ja hàgim validat que el registre principal de l'ens funciona correctament i ens demana l'usuari que ja podem passar a producció, seguirem els següents passos: 

  

8.1 - Clonarem el tiquet: [https://contacte.aoc.cat/browse/DES-224](https://contacte.aoc.cat/browse/DES-224) seguin el format del mateix tiquet informant David: 

Hola,

Precisem de la pujada a PRO de MUX per (**següent dimecres**). ( ENS i treure  INE10 0825890004 de la regla ERES-GENERIC1 E/S)

**Ajuntament de Isovol (Audifilm)<----- EXEMPLE**

[http://proxyMUX.aoc.cat/isovol/Services/services/RegistreReferencia](http://proxymux.aoc.cat/isovol/Services/services/RegistreReferencia "Seguir el enlace") <----- **Indicarem la url del proxy en PRO que ens haurà de haver passat l'ajuntament. La url la podem configurar seguint els mateixos passos que en el punt 3, però per a pro (**/etc/httpd/conf.d/sites/proxyMUX.aoc.cat.conf**)**

[![](https://contacte.aoc.cat/secure/thumbnail/11235/_thumb_11235.png)](https://contacte.aoc.cat/secure/attachment/11235/11235_image-2017-05-10-12-07-48-004.png "image-2017-05-10-12-07-48-004.png")<-------------- **Captura de pantalla de configuració de l'ens en PRE. per a que David ho configuri a PRO**

On els Passwords són (per ordre descendent):  
Password del trustStore => trust  
Password del keyStore => 2ESfRXIb  
Password de l’àlias => 2ESfRXIb (el mateix que el keystore)

Regles a configurar:  
Entrada i Sortida amb INE10 XXXXXXXXXXX

Adjuntar certificat per a que en Toni Llebaria el carregui al JKS de PRO( li especifiquem a la descripció al Toni)

  

  

Attachments:
------------

![](images/icons/bullet_blue.gif) [Formulari Sol licitud Integració Serveis CAOC V16\_20170601143357\_20181030144023.docx](attachments/26313555/26314134.docx) (application/vnd.openxmlformats-officedocument.wordprocessingml.document)  
![](images/icons/bullet_blue.gif) [Claus i Certs MUX.RAR](attachments/26313555/26314137.rar) (application/octet-stream)  
![](images/icons/bullet_blue.gif) [Claus i Certs MUX.RAR](attachments/26313555/26314136.rar) (application/octet-stream)  
![](images/icons/bullet_blue.gif) [image2018-11-21\_18-19-4.png](attachments/26313555/26315765.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2018-11-21\_18-26-40.png](attachments/26313555/26315761.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2018-11-21\_18-43-10.png](attachments/26313555/26315740.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2018-11-21\_18-55-33.png](attachments/26313555/26315730.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2018-11-21\_18-57-6.png](attachments/26313555/26315733.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2018-11-21\_18-57-9.png](attachments/26313555/26315723.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2018-11-22\_18-58-45.png](attachments/26313555/26316287.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2018-11-22\_18-58-45.png](attachments/26313555/26316288.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2018-11-22\_18-58-45.png](attachments/26313555/26316128.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2018-12-19\_18-9-13.png](attachments/26313555/26316268.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2019-1-7\_16-49-54.png](attachments/26313555/26315838.png) (image/png)  
![](images/icons/bullet_blue.gif) [segell-admin-elec\_NOU\_2019.zip](attachments/26313555/26315846.zip) (application/zip)  
![](images/icons/bullet_blue.gif) [CLAUS\_MUX.zip](attachments/26313555/26316309.zip) (application/zip)  
![](images/icons/bullet_blue.gif) [CLAUS\_MUX.zip](attachments/26313555/26317243.zip) (application/zip)  

Document generated by Confluence on 02 June 2025 10:56

[Atlassian](http://www.atlassian.com/)