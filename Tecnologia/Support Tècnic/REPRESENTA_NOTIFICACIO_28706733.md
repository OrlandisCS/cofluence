Suport Tècnic : REPRESENTA\_NOTIFICACIO  

1.  [Suport Tècnic](index.md)
2.  [Suport Tècnic](13893782.md)
3.  [03 - Monitorització - Revisions globals](26313327.md)
4.  [03 - Monitorització - OLD](128647245.md)
5.  [Sondes S.T.](Sondes-S.T._30869120.md)
6.  [Sondes ST - Old](Sondes-ST---Old_41522507.md)
7.  [Sondes ST - REPRESENTA](Sondes-ST---REPRESENTA_28706731.md)

Suport Tècnic : REPRESENTA\_NOTIFICACIO
=======================================

Created by Unknown User (otecagonzalez), last modified by OTEC ST JAlejandro Cardete Postigo on 18 November 2021

  

**Query:**

SELECT 'REPRESENTA\_NOTIFICACIO' OTAP, count(n.UUID) REGISTRES
  FROM REPRESENTA.R\_NOTIFICACIO n, REPRESENTA.R\_PERSONA p
 WHERE n.destinatari\_uuid = p.uuid
   AND n.ENVIAT = 0
   AND n.IN\_PROGRESS = 0
   AND n.REINTENTS = 3
   AND n.DATAENVIAMENT\_PLANIFICAT <= current\_timestamp
   AND p.accepta\_avisos = 1;

_**NOTA:**_

_**S'ha afegit a la query una nova restricció "p.correuelectronic is not null" ja que els casos on està el camp a nul no es poden processar. Estem a la espera que el desenvolupadro ens digui alguna cosa ( [PRJ-7669](https://contacte.aoc.cat/browse/PRJ-7669?src=confmacro) - Data cannot be retrieved due to an unexpected error. ).**_

**Descripció:** 

Aquesta sonda funcional fa referència amb un RDBMS que mira si té correus per enviar.

Quan un poderdant dóna representació a un representant s'envia una notificació de que l'operació s'ha realitzat correctament.

  

Si en la taula hi ha un registre (avís a notificar) el RDBMS canvia l'estat de IN\_PROGRESS a 1. Si falla puja el reintent +1 i torna a deixar el IN\_PROGRESS a 0. Fa aquest procés fins a 3 reintents, un cop el registre té 3 reintents el RDBMS no el tornarà a executar i podrem entendre que aquell registre esta en estat d'error.

  

Estats dels camps de la taula R\_NOTIFICACIO

  

  

*   IN\_PROGRES 1= en curs. No s'hauria de veure aquest estat perquè es molt ràpida la operació. Si esta aquest estat es probable que hi hagi algun problema. 
    
*   ENVIAT 1= enviat 0 = no enviat
    
*   REINTENTS màxim 3
    
*   Hi ha un flag que els usuaris poden tenir la opció de desmarcar de tenir avisos. 1 = true  0 = false. 
    

  

QUERY RDBMS:

 SELECT UUID FROM R\_NOTIFICACIO WHERE ENVIAT=0 AND IN\_PROGRESS=0 AND REINTENTS < 3 AND DATAENVIAMENT\_PLANIFICAT <= current\_timestamp;

  

**Actuació:** 

Actuarem quan hi hagin 10 o més registres en la sonda.

En cas que les peticions es quedin en estat 3 "error", el més possible és que les haguem de reinciciar.

Farem la següent consulta per aconseguir els UUID de les peticions a reiniciar.

SELECT n.UUID FROM R\_NOTIFICACIO n, REPRESENTA.R\_PERSONA p WHERE n.destinatari\_uuid = p.uuid and n.ENVIAT=0 AND n.IN\_PROGRESS=0 AND n.REINTENTS = 3 AND n.DATAENVIAMENT\_PLANIFICAT <= current\_timestamp AND  p.accepta\_avisos = 1 GROUP BY n.UUID;

I podem fer un update massiu per reiniciar tots els enviaments:

UPDATE R\_NOTIFICACIO SET REINTENTS = 0, ENVIAT = 0 WHERE UUID IN ('XXXX',
'XXX');

En alguns casos es quedarán errors controlats i es podrà revisar en els logs de APP.

Tiquets Jira relacionants amb la tasca.

[ST-13029](https://contacte.aoc.cat/browse/ST-13029?src=confmacro) - Data cannot be retrieved due to an unexpected error.

**LOGS:**

SOA -> /apps/aoc/APP/logs/Representa\_APPNODO2\_SOA**.**log

            /apps/aoc/APP/logs/Representa-portal\_tomcat8-01.log

**Tomcats 8**:

aoc-l-tomcat8

**BBDD**:

BD de core: ORA12 (KeePass)

  

Document generated by Confluence on 02 June 2025 11:11

[Atlassian](http://www.atlassian.com/)