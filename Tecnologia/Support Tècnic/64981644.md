Suport Tècnic : Prova de concepte Let's Encrypt - signasuite-pre.aoc.cat  

1.  [Suport Tècnic](index.md)
2.  [Suport Tècnic](13893782.md)
3.  [03 - Monitorització - Revisions globals](26313327.md)
4.  [Monitors S.T.](Monitors-S.T._41522177.md)
5.  [Monitor S.T. - Caducitat CDS AOC](Monitor-S.T.---Caducitat-CDS-AOC_41522179.md)

Suport Tècnic : Prova de concepte Let's Encrypt - signasuite-pre.aoc.cat
========================================================================

Created by Unknown User (otecobernal), last modified on 17 June 2022

Descarregar software WIN-ACME per generar el certificat
-------------------------------------------------------

1.  Descarregar el client [win-acme](https://www.win-acme.com/)  
    ![](attachments/64981644/64981645.png)
2.  Desar el fitxer i descomprimir-lo al directori desitjat
3.  Executar el fitxer `wacs.exe`.  
    ![](attachments/64981644/64981681.png)  
    

  

Generar el certificat
---------------------

### **Preparar el servidor per connectar amb WIN-ACME**

1.  Connectar-nos als nodes on tenim el domini aixecat (PRE)  
    
    Servidors 
    ==========
    
    *   Node1: **aoc-l-http01-pro → 10.120.55.130 [](https://pam.aoc.cat/SecretServer/app/#/secrets/4331/general)** 
        
    *   Node2: **aoc-l-http02-pro** **→ 10.120.55.131 [](https://pam.aoc.cat/SecretServer/app/#/secrets/4332/general)** 
    *   User: **aoc**
    
    *   Node1: **aoc-l-http01-pre** **→ 10.120.2.153 [](https://pam.aoc.cat/SecretServer/app/#/secrets/4329/general)** 
        
    *   Node2: **aoc-l-http02-pre** **→ 10.120.2.154 [](https://pam.aoc.cat/SecretServer/app/#/secrets/4330/general)** 
    *   User: **aoc**
    
2.  Fer un backup manual dels arxius de configuració:  
    ![](attachments/64981644/64981670.png)
    
3.  Canviar els arxius de configuració SSL:
    
    cd /mnt/storage30/aoc/httpd/ssl
    cp signasuite-pre.aoc.cat.ssl.conf.nfs signasuite-pre.aoc.cat.ssl.conf.nfs.BACKUP\_LE\_GENERATION
    cp signasuite-pre.aoc.cat.ssl.conf.nfs.letsencrypt signasuite-pre.aoc.cat.ssl.conf.nfs
    
4.  Aplicar els canvis:
    
    sudo apachectl configtest
    sudo apachectl restart
    
5.  Obrir els logs en temps real:
    
    tail -f /mnt/lhnfslogpre/aoc-l-http0?-pre/apache-logs/signasuite-pre.cat/signasuite-pre.aoc.cat-ssl-access.20220607.log | grep -i 'acme'
    
6.  Repetir el mateix procés pels altres nodes:
    
    Rutes compartides
    
    En cas que la ruta dels fitxers estigui compartida, només caldrà repetir la passa 4 per sincronitzar la nova configuració als altres apaches.
    

### **Generar les claus**

1.  Executar el fitxer **`wacs.exe`**  
    ![](attachments/64981644/64981654.png)  
    
2.  Seleccionar l'opció **N: Create certificate (default settings)**  
    ![](attachments/64981644/64981655.png)
3.  Seleccionar l'opció **2: Manual input**  
    ![](attachments/64981644/64981656.png)
4.  Introduir el nom del domini del certificat: **signasuite-pre.aoc.cat  
    ![](attachments/64981644/64981657.png)  
    **
5.  Seleccionar l'opció **4: \[http-01\] Upload verification files via SSH-FTP  
    ![](attachments/64981644/64981831.png)**
6.  Indicar la connexió SFTP a un dels nodes: [sftp://10.120.2.153:22/apps/aoc/httpd/docroot/](sftp://10.120.2.153:22/apps/aoc/httpd/docroot/)  
    ![](attachments/64981644/64981845.png)
7.  Copiar la configuració per defecte ![(thumbs up)](images/icons/emoticons/thumbs_up.svg)  
    ![](attachments/64981644/64981834.png)
8.  Indicar l'usuari de l'SFTP: **aoc  
    ![](attachments/64981644/64981835.png)  
    **
9.  Seleccionar la manera d'introduir la paraula de pas per connectar-se a l'SFTP: **2: Type/paste in console** i indicar la paraula de pas (Info del Keepass):  
    ![](attachments/64981644/64981837.png)![](attachments/64981644/64981838.png)
10.  Si és el primer cop que ho realitzem, podem desar la configuració per reutilitzar-la en un futur:  
    ![](attachments/64981644/64981839.png)
11.  Seleccionar l'opció **2: PEM encoded files (Apache, nginx, etc.)**  
    ![](attachments/64981644/64981675.png)
12.  Seleccionar el directori en local on desar els fitxers  
    ![](attachments/64981644/64981677.png)
13.  Seleccionar l'opció **1: None**  
    ![](attachments/64981644/64981678.png)
14.  Seleccionar l'opció **3: No (additional) installation steps**  
    ![](attachments/64981644/64981679.png)
15.  El programari win-acme generarà el certificat i el desarà a la ruta local que li hem indicat:  
    ![](attachments/64981644/64981840.png)

  

### Restaurar la configuració SSL inicial del servidor

1.  Canviar els arxius de configuració SSL
    
    cd /mnt/storage30/aoc/httpd/ssl
    cp signasuite-pre.aoc.cat.ssl.conf.nfs.BACKUP\_LE\_GENERATION signasuite-pre.aoc.cat.ssl.conf.nfs
    
2.  Aplicar els canvis
    
    sudo apachectl configtest
    sudo apachectl restart
    
3.  Repetir-ho pels altres nodes
    
    Rutes compartides
    
    En cas que la ruta dels fitxers estigui compartida, només caldrà repetir la passa 4 per sincronitzar la nova configuració als altres apaches.
    

### **Instal·lar les claus**

1.  Modificar el fitxer /mnt/storage30/aoc/httpd/ssl/signasuite-pre.aoc.cat.ssl.conf.nfs  
    ![](attachments/64981644/64981683.png)
2.  Haurem de pujar les claus generades al servidor i canviar-les al fitxer de configuració esmentat (Fer backup abans)
3.  Revisar la configuració i fer un graceful:
    
    sudo apachectl configtest
    sudo apachectl graceful
    

### **Comprovar la instal·lació**

1.  Accedir a [https://signasuite-pre.aoc.cat/signasuite/inici](https://signasuite-pre.aoc.cat/signasuite/inici)
2.  Revisar que la web carrega amb el nou certificat:  
    ![](attachments/64981644/64981841.png)![](attachments/64981644/64981842.png)![](attachments/64981644/64981843.png)

TODO

Attachments:
------------

![](images/icons/bullet_blue.gif) [image2022-6-3\_11-9-20.png](attachments/64981644/64981645.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2022-6-3\_11-14-2.png](attachments/64981644/64981646.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2022-6-3\_11-15-47.png](attachments/64981644/64981647.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2022-6-7\_12-28-30.png](attachments/64981644/64981654.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2022-6-7\_12-29-40.png](attachments/64981644/64981655.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2022-6-7\_12-30-22.png](attachments/64981644/64981656.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2022-6-7\_12-31-30.png](attachments/64981644/64981657.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2022-6-7\_12-44-57.png](attachments/64981644/64981670.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2022-6-7\_12-55-52.png](attachments/64981644/64981672.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2022-6-7\_12-57-7.png](attachments/64981644/64981673.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2022-6-7\_12-57-28.png](attachments/64981644/64981674.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2022-6-7\_12-57-47.png](attachments/64981644/64981675.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2022-6-7\_12-57-55.png](attachments/64981644/64981676.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2022-6-7\_12-58-33.png](attachments/64981644/64981677.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2022-6-7\_12-58-56.png](attachments/64981644/64981678.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2022-6-7\_12-59-27.png](attachments/64981644/64981679.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2022-6-7\_13-5-17.png](attachments/64981644/64981681.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2022-6-7\_13-11-54.png](attachments/64981644/64981683.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2022-6-17\_12-13-53.png](attachments/64981644/64981831.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2022-6-17\_12-16-4.png](attachments/64981644/64981832.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2022-6-17\_12-16-7.png](attachments/64981644/64981833.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2022-6-17\_12-16-31.png](attachments/64981644/64981834.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2022-6-17\_12-17-10.png](attachments/64981644/64981835.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2022-6-17\_12-17-49.png](attachments/64981644/64981836.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2022-6-17\_12-19-8.png](attachments/64981644/64981837.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2022-6-17\_12-19-33.png](attachments/64981644/64981838.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2022-6-17\_12-23-22.png](attachments/64981644/64981839.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2022-6-17\_12-26-29.png](attachments/64981644/64981840.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2022-6-17\_12-30-33.png](attachments/64981644/64981841.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2022-6-17\_12-30-38.png](attachments/64981644/64981842.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2022-6-17\_12-30-43.png](attachments/64981644/64981843.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2022-6-17\_12-33-45.png](attachments/64981644/64981845.png) (image/png)  

Document generated by Confluence on 02 June 2025 11:08

[Atlassian](http://www.atlassian.com/)