Suport Tècnic : Revisió PSIS  

1.  [Suport Tècnic](index.html)
2.  [Suport Tècnic](13893782.html)
3.  [04 - Tècnica de sistemes + 24x7 + Padró](26313202.html)
4.  [Revisió de serveis](36340340.html)
5.  [PSIS - Revisions i Restabliment](PSIS---Revisions-i-Restabliment_41521345.html)

Suport Tècnic : Revisió PSIS
============================

Created by Unknown User (otecobernal), last modified by OTEC ST JAlejandro Cardete Postigo on 12 April 2024

IMPORTANT

Hem de saber amb claredat per quin PSIS estem anant si Nexica o Kyndryl.

[PSIS - ALTRES - Comprovar per quina IP respon PSIS](PSIS---ALTRES---Comprovar-per-quina-IP-respon-PSIS_28706375.html)

Revisió del servei per cada component:
======================================

Estàs revisant el PSIS de NEXICA

  

Revisió de l'Splunk
===================

* * *

[http://10.123.4.52:8000/en-GB/account/login?return\_to=%2Fen-GB%2Fapp%2Fcatcert\_reports%2Fconsultas\_catcert\_tiemporeal\_pro](http://10.123.4.52:8000/en-GB/account/login?return_to=%2Fen-GB%2Fapp%2Fcatcert_reports%2Fconsultas_catcert_tiemporeal_pro)

Revisió de Xarxa
================

Revisió general del servei

L'origen de l'error por venir produït per problemes de connectivitats amb els components de l'arquitectura de PSIS.

En el cas de que totes les transaccions estiguin en estat KO, caldrà revisar si hi ha algun problema de xarxa: balancejadors, frontals web, servidors de DNS, etc...

*   Comprovar si el WSDL del servei es pot descarregar

El WSDL està penjat a l’Apache, i està accessible des de la següent URL:

*   [http://psis.catcert.cat/wsdl/dss.wsdl](http://psis.catcert.cat/wsdl/dss.wsdl)
*   [http://185.86.34.132/wsdl/dss.wsdl](http://185.86.34.132/wsdl/dss.wsdl)

Ha d’aparèixer una plana del tipus:

![](attachments/41521403/41523845.png)

Si no està accessible, comprovar DNS, balancejadors, i Apaches. Comprovar que el servei PSIS està accessible:

*   [http://psis.catcert.cat/](http://psis.catcert.cat/psis/catcert/dss)[psis/catcert/dss](http://185.86.34.132/psis/catcert/dss)
*   [http://185.86.34.132/psis/catcert/dss](http://185.86.34.132/psis/catcert/dss)

Ha d’aparèixer una plana del tipus:

![](attachments/41521403/41523846.png)

Com veiem apareix el nom de PSIS i la versió desplegada (en aquest cas, la 6.0.0).

Podem provar per cadascun dels nodes, per veure si algun d’ells està donant problemes.

*   [http://10.123.5.188:8080/psis/catcert/tdss](http://10.123.5.188:8080/psis/catcert/tdss)
*   [http://10.123.5.189:8080/psis/catcert/tdss](http://10.123.5.189:8080/psis/catcert/tdss)
*   [http://10.123.5.178:8080/psis/catcert/tdss](http://10.123.5.178:8080/psis/catcert/tdss)
*   [http://10.123.5.179:8080/psis/catcert/tdss](http://10.123.5.179:8080/psis/catcert/tdss)

Si tot és correcte, la plana que apareixerà ha de ser del mateix tipus que l’anterior.

WILDFLY
=======

Connexió amb el servidor

Servidors 
==========

*   Node1: **aoc-cl-psis-wf01-pro → 10.123.5.188**
    
*   Node2: **aoc-cl-psis-wf02-pro → 10.123.5.189**
*   Node3: **aoc-cl-psis-wf03-pro → 10.123.5.178**
*   Node4: **aoc-cl-psis-wf04-pro → 10.123.5.179**
*   User: **wildfly**

*   Node1: **aoc-cl-wf01-pre → 10.123.69.163**
    
*   Node2: **aoc-cl-wf02-pre** **→ 10.123.69.164**
*   User: **aoc/wildfly**

Revisió del WildFly

Revisió dels logs
=================

Per revisar errors podem mirar els logs del WildFly (server.log):

*   __/apps/wildfly/standalone/log/server.log__  

  

Si veiem que efectivament hi ha algun problema, podem procedir amb el reinici.

  

Revisió de l'Splunk
===================

**SPLUNK NEXICA**: [http://10.123.4.52:8000/en-GB/app/catcert\_reports/consultas\_catcert\_tiemporeal\_pro](http://10.123.4.52:8000/en-GB/app/catcert_reports/consultas_catcert_tiemporeal_pro)

*   Usuari: aoc
*   A l'opció de menú “Producció”, seleccionar “Nexica Temps Real – Entorn de Producció”, per veure les operacions que s’estan processant a PSIS en temps real.

A les opcions abans indicades tenim diferents gràfics que monitoritzen diferents aspectes del funcionament en temps real. Per exemple, a Nexica veiem, entre d’altres, els següents gràfics (tenim els equivalents per Kyndryl a l’Splunk de Kyndryl):

  

![](attachments/41521428/81855998.png)

**En blau** → Les peticions processades per cada un dels nodes. Si algun no està processant peticions com els altres és possible que l'haguem de reiniciar.

**En vermell** → El temps màxim, mínim i mig que triga PSIS a processar les peticions. No hauria de passar de 2 o 3 segons.

Reinici del WildFly

  

L’script de balanceig dels frontals no contempla encara els nodes WildFly. **NO BALANCEJAR DE NOU ELS NODES 1,2,3, o 4**, doncs aixecarà els JBoss (plataforma antiga)

Reinici:  
  

==============

Reiniciar el node afectat

**Aturar el Wildfly**

sudo /etc/init.d/wildfly stop

Comprovar que el Wildfly estigui efectivament aturat:

**Revisar el procés**

ps -aux | grep -i wildfly

*   Per eliminar el procés (en cas que amb l'stop no s'elimini) es pot executar un kill on **XXXX** serà l'**id** del **procés**:

**Matar el procés (només si cal)**

kill -9 "XXXX"

Un cop el Wildfly estigui aturat, es podrà aixecar:

**Aixecar el Wildfly**

sudo /etc/init.d/wildfly start && tail -f /apps/wildfly/standalone/log/server.log

  
i esperem que els logs del server.log ens mostrin com el Wildfly s'ha aixecat:

  

* * *

* * *

* * *

* * *

* * *

* * *

  

El que s'explica a continuació no aplica de moment → No EXECUTAR-HO fins a nou avís.

  

**L’script de balanceig i desbalanceig ens permet executar-lo des de qualsevol dels 2 frontals, canviar la configuració o reiniciar l’Apache.**

Desbalanceig:
=============

Desbalancejar els frontals

Ens haurem de connectar als frontals:

*   **10.123.5.171**
*   **10.123.5.172**

L’script de balanceig dels frontals no contempla encara el node WildFly. L’important és **NO BALANCEJAR NI EL NODE 3 NI EL NODE 4** mentre no modifiquin l'script de balanceig de nodes. Els nodes 3 i 4 s'han de quedar desbalancejats.

**Si estem actuant sobre els nodes 3 i 4 anem a la part de reinici directament.**

Executar el següent script a un dels frontals:

**Desbalancejar**

./home/aoc/scripts/balancer.sh

En executar l’script apareix la pantalla següent, on es pot configurar el frontal de PSIS (en aquest cas no se’ns demana escollir plataforma, doncs aquest Apache és dedicat per PSIS):  
![](attachments/41521423/41521424.png)

*   Apareixen els 4 nodes de PSIS vists des de cadascun dels 2 frontals, i amb les opcions inferiors, podem balancejar-los o desbalancejar-los:  
    1: Desbalancejar un o varis nodes..  
    2: Balancejar un o varis nodes prèviament desbalancejats.  
    3: Reiniciar l’Apache per a que es recarregui la configuració.
    
*   Per desbalancejar haurem de seleccionar les opcions:  
    1: Seleccionar els nodes a desbalancejar, i si volem fer-ho per un o pels dos frontals.  
    3: Reiniciar l’Apache per a que agafi la nova configuració, també per cada frontal que vulguem reiniciar.
    

Reinici:
========

Reiniciar el node afectat

Reinici Wildfly

**Aturar el Wildfly**

sudo /etc/init.d/wildfly stop

Comprovar que el Wildfly estigui efectivament aturat:

**Revisar el procés**

ps -aux | grep -i wildfly

*   Per eliminar el procés (en cas que amb l'stop no s'elimini) es pot executar un kill on **XXXX** serà l'**id** del **procés**:

**Matar el procés (només si cal)**

kill -9 "XXXX"

Un cop el JBOSS estigui aturat, es podrà aixecar:

**Aixecar el Wildfly**

sudo /etc/init.d/wildfly start && tail -f /apps/wildfly/standalone/log/server.log

i esperem que els logs del server.log ens mostrin com el Wildfly s'ha aixecat:

Balanceig:
==========

Balancejar els frontals

Tornar a **balancejar el node als dos frontals**, segons lo que hem vist al punt , però amb les opcions de balanceig i reinici:

*   Opcions B (balancejar) i R (reiniciar).
    












==================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================

Estàs revisant el PSIS de KYNDRYL

  

Revisió de l'Splunk
===================

* * *

[http://10.120.1.235/en-US/account/login?return\_to=%2Fen-US%2Fapp%2Fcatcert\_reports%2Fconsultas\_catcert\_tiemporeal\_pro](http://10.120.1.235/en-US/account/login?return_to=%2Fen-US%2Fapp%2Fcatcert_reports%2Fconsultas_catcert_tiemporeal_pro)

Revisió de Xarxa
================

Revisió general del servei

L'origen de l'error por venir produït per problemes de connectivitats amb els components de l'arquitectura de PSIS.

En el cas de que totes les transaccions estiguin en estat KO, caldrà revisar si hi ha algun problema de xarxa: balancejadors, frontals web, servidors de DNS, etc...

*   Comprovar si el WSDL del servei es pot descarregar

  

El WSDL està penjat a l’Apache, i està accessible des de la següent URL:

*   [http://psis.catcert.cat/wsdl/dss.wsdl](http://psis.catcert.cat/wsdl/dss.wsdl)
*   [http://157.97.65.27/wsdl/dss.wsdl](http://157.97.65.27/wsdl/dss.wsdl)

Ha d’aparèixer una plana del tipus:

![](attachments/41521408/41521822.png)

  

  

Si no està accessible, comprovar DNS, balancejadors, i Apaches. Comprovar que el servei PSIS està accessible:

*   [http://psis.catcert.cat/psis/catcert/dss](http://psis.catcert.cat/psis/catcert/dss)
*   [http://157.97.65.27/psis/catcert/dss](http://157.97.65.27/psis/catcert/dss)

Ha d’aparèixer una plana del tipus:

![](attachments/41521408/41521409.png)

Com veiem apareix el nom de PSIS i la versió desplegada (en aquest cas, la 5.4.1).

  

Podem provar per cadascun dels nodes, per veure si algun d’ells està donant problemes.

*   [http://10.124.18.11:8080/psis/catcert/tdss](http://10.124.18.11:8080/psis/catcert/tdss)
*   [http://10.124.18.12:8080/psis/catcert/tdss](http://10.124.18.12:8080/psis/catcert/tdss)
*   h[ttp://10.124.18.13:8080/psis/catcert/tdss](http://10.124.18.13:8080/psis/catcert/tdss)
*   [http://10.124.18.14:8080/psis/catcert/tdss](http://10.124.18.14:8080/psis/catcert/tdss)

Si tot és correcte, la plana que apareixerà ha de ser del mateix tipus que l’anterior.

Wildfly
=======

Connexió amb el servidor

Servidors 
==========

*   Node1: **aoc-l-psis-wf01-pro → 10.120.1.57**
    
*   Node2: **aoc-l-psis-wf02-pro→ 10.120.1.58**
*   Node3: **aoc-l-psis-wf03-pro→ 10.120.1.214**
*   Node4: **aoc-l-psis-wf04-pro→ 10.120.1.215**
*   User: **wildfly**

*   Node1: **aoc-l-psis-wf01-pre → 10.120.2.130**
    
*   User: **wildfly**

Revisió del Wildfly

Revisió dels logs
=================

Per revisar errors podem mirar els logs dels Wildfly (server.log):

*   __/apps/wildfly/standalone/log/server.log__  

Si veiem que efectivament hi ha algun problema, podem procedir amb el reinici.

  

Revisió de l'Splunk
===================

**SPLUNK Kyndryl**: [http://10.120.1.235/en-US/app/catcert\_reports/consultas\_catcert\_tiemporeal\_pro](http://10.120.1.235/en-US/app/catcert_reports/consultas_catcert_tiemporeal_pro)

*   Usuari: catcert
*   A la opció de menú “Producció”, seleccionar “Temps Real – Entorn de Producció”, per veure les operacions que s’estan processant a PSIS en temps real.

A les opcions abans indicades tenim diferents gràfics que monitoritzen diferents aspectes del funcionament en temps real.

Per exemple, a Nexica veiem, entre d’altres, els següents gràfics (tenim els equivalents per Kyndryl a l’Splunk de Kyndryl):

![](attachments/41520927/81855994.png)

**En blau** → Les peticions processades per cada un dels nodes. Si algun no està processant peticions com els altres és possible que l'haguem de reiniciar.

**En vermell** → El temps màxim, mínim i mig que triga PSIS a processar les peticions. No hauria de passar de 2 o 3 segons.

  

  

  

  

Reinici del Wildfly

  

S'ha de desbalancejar i balancejar el reinici d'un node **des dels 2 frontals**, per tant, les opcions Desbalanceig i Balanceig s'hauran d'executar dos cops (un per cada frontal).

Desbalanceig:
=============

Desbalancejar els frontals

Ens haurem de connectar als frontals:

*   **10.124.16.11**
*   **10.124.16.12**

Executar el següent script a un dels frontals:

**Desbalancejar**

./home/catcert/gestio\_balanceig.sh

  

*   Apareix una pantalla del tipus:  
    ![](attachments/41520926/41520935.png)  
      
    
*   Seleccionar PSIS clicant el número 2 i Enter.  
    Aleshores apareix la següent pantalla:  
    ![](attachments/41520926/41520936.png)  
      
    
*   Apareixen els 4 nodes de PSIS, i amb les opcions inferiors, podem balancejar-los o desbalancejar-los:  
    
    B: Balancejar un o varis nodes prèviament desbalancejats.  
    D: Desbalancejar un o varis nodes.  
    R: Reiniciar l’Apache per a que es recarregui la configuració.
    
    **Per desbalancejar** haurem de seleccionar les opcions:  
    D: seleccionar els nodes a desbalancejar.  
    R: Reiniciar l’Apache per a que agafi la nova configuració.
    
      
    
    Fixeu-vos que a la pantalla anterior, a dalt diu si la configuració que es mostra és la que està corrent o si s’han fet canvis que no s’han aplicat:  
    ![](attachments/41520926/41520937.png)
    

Reinici:
========

Reiniciar el node afectat

**Aturar el JBOSS**

 sudo /etc/init.d/wildfly stop

Comprovar que el wildfly estigui efectivament aturat:

**Revisar el procés**

ps -aux | grep -i wildfly

*   Per eliminar el procés (en cas que amb l'stop no s'elimini) es pot executar un kill on **XXXX** serà l'**id** del **procés**:

**Matar el procés (només si cal)**

kill -9 "XXXX"

Un cop el JBOSS estigui aturat, es podrà aixecar:

**Aixecar el JBOSS**

 sudo /etc/init.d/wildfly start && tail -f /apps/wildfly/standalone/log/server.log

i esperem que els logs del server.log ens mostrin com el jboss s'ha aixecat:

Balanceig:
==========

Balancejar els frontals

Tornar a **balancejar el node als dos frontals**, segons lo que hem vist al punt , però amb les opcions de balanceig i reinici:

*   Opcions B (balancejar) i R (reiniciar).
    












=========================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================

Connectivitat amb 3rs
=====================

Revisió de tercers

Per revisar la connectivitat amb tercers anem a [http://10.124.95.14:8080/monitors/console.do](http://10.124.95.14:8080/monitors/console.do) i prenem l'opció a final de tot SERVEIS\_EXTERNS

![](attachments/41521401/81856001.png)

Veurem els següents resultats:

![](attachments/41521401/81856002.png)

**Verd**: Resposta bona entre t < 3000ms

**Groc**: Resposta bona entre 3000ms i 8000ms

**Vermell**: Resposta bona, però ha trigat molt. Entre 8000ms i 45000ms

**Negre**: Resposta dolenta. Més de 45000ms

Attachments:
------------

![](images/icons/bullet_blue.gif) [image2023-3-28\_9-16-30.png](attachments/41521401/81856001.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2023-3-28\_9-17-49.png](attachments/41521401/81856002.png) (image/png)  

Document generated by Confluence on 02 June 2025 11:14

[Atlassian](http://www.atlassian.com/)