Suport Tècnic : GLOBAL - INTEGRACIÓ - Configuració d'IP's  

1.  [Suport Tècnic](index.md)
2.  [Suport Tècnic](13893782.md)
3.  [02 - FAQ's serveis](26313393.md)
4.  [FAQ's Global](28705585.md)

Suport Tècnic : GLOBAL - INTEGRACIÓ - Configuració d'IP's
=========================================================

Created by Unknown User (obernalp), last modified by OTEC ST Alessandro Trombin Martinez on 13 May 2025

En aquest apartat s'explica el procediment a seguir per la configuració de les IP's dels ens que s'integren als diferents serveis.  
El procediment també aplica quan vulguem realitzar una modificació.

Pas 0: Consideracions prèvies
-----------------------------

Important

*   No podem donar moltes IP's, sempre hem de dir que **obrim connectivitats a màxim 1 IP per a PRO** i **dues IP's per a PRE**.
*   Haurem de realitzar les altes de les IP's **a partir de les 15h de la tarda** per no interferir amb l'equip de SISTEMES.

Comprovar abans si cal demanar NAT/XCAT

**Abans de procedir** amb la configuració de les IP's comprovarem el següent:

Si les IP's es troben en el rang **10.0.0.0/8**, **192.168.0.0/16** i de la **172.16.0.0 a 172.31.255.255** i **169.254.X.X** són IP's **PRIVADES** i per tant s'han de configurar mitjançant un NAT/XCAT.

[https://protecciondatos-lopd.com/empresas/direccion-ip-privada-publica/#Rango\_clase\_A](https://protecciondatos-lopd.com/empresas/direccion-ip-privada-publica/#Rango_clase_A)

### Pas 0: Revisem que les IP's no tinguin ja un NAT/XCAT demanat

Per revisar-ho, les cercarem en el sharepoint de SIS:  

*   [https://llicenciesaoc.sharepoint.com/:f:/s/Tecnologia/Ej2Ajgj6FExFl\_l3CZpYahABVVC-XOtT8eVwmLSxJC-Xnw?e=ELZbmX&xsdata=MDV8MDJ8fGM3N2ZkMjI4NjhhMDRmMTZkZTg1MDhkYzM2ZTRhM2JhfDM3YThhMGI5MTg3NDRlNWRiMWY1MTEwNDBjMWMwN2ZjfDB8MHw2Mzg0NDU2MDI4MDcxNDQwNjl8VW5rbm93bnxWR1ZoYlhOVFpXTjFjbWwwZVZObGNuWnBZMlY4ZXlKV0lqb2lNQzR3TGpBd01EQWlMQ0pRSWpvaVYybHVNeklpTENKQlRpSTZJazkwYUdWeUlpd2lWMVFpT2pFeGZRPT18MXxMMk5vWVhSekx6RTVPbTFsWlhScGJtZGZXVlJKTkUweVdUSmFiVlYwV21wT2EwOVRNREJhUjFrMFRGZEpNMDFxVVhSTmVsRjVUa1JWTVUxcVNUSlpWRnBzUUhSb2NtVmhaQzUyTWk5dFpYTnpZV2RsY3k4eE56QTRPVFl6TkRjNU9UazB8YWQ5MTRhZGE1ODNmNDRkOGRlODUwOGRjMzZlNGEzYmF8ODA5MjYwMjI0MDBkNDViZjg3MTg1NDM4MDQ3NzBjZjA%3D&sdata=ZGMyeVAvN3VMVmlKS0FqcDM5TlQrN2tFOVUwb2Y1VHQvRE1JSDByRFF0MD0%3D&ovuser=37a8a0b9-1874-4e5d-b1f5-11040c1c07fc%2Ceantonell%40aoc.cat](https://llicenciesaoc.sharepoint.com/:f:/s/Tecnologia/Ej2Ajgj6FExFl_l3CZpYahABVVC-XOtT8eVwmLSxJC-Xnw?e=ELZbmX&xsdata=MDV8MDJ8fGM3N2ZkMjI4NjhhMDRmMTZkZTg1MDhkYzM2ZTRhM2JhfDM3YThhMGI5MTg3NDRlNWRiMWY1MTEwNDBjMWMwN2ZjfDB8MHw2Mzg0NDU2MDI4MDcxNDQwNjl8VW5rbm93bnxWR1ZoYlhOVFpXTjFjbWwwZVZObGNuWnBZMlY4ZXlKV0lqb2lNQzR3TGpBd01EQWlMQ0pRSWpvaVYybHVNeklpTENKQlRpSTZJazkwYUdWeUlpd2lWMVFpT2pFeGZRPT18MXxMMk5vWVhSekx6RTVPbTFsWlhScGJtZGZXVlJKTkUweVdUSmFiVlYwV21wT2EwOVRNREJhUjFrMFRGZEpNMDFxVVhSTmVsRjVUa1JWTVUxcVNUSlpWRnBzUUhSb2NtVmhaQzUyTWk5dFpYTnpZV2RsY3k4eE56QTRPVFl6TkRjNU9UazB8YWQ5MTRhZGE1ODNmNDRkOGRlODUwOGRjMzZlNGEzYmF8ODA5MjYwMjI0MDBkNDViZjg3MTg1NDM4MDQ3NzBjZjA%3D&sdata=ZGMyeVAvN3VMVmlKS0FqcDM5TlQrN2tFOVUwb2Y1VHQvRE1JSDByRFF0MD0%3D&ovuser=37a8a0b9-1874-4e5d-b1f5-11040c1c07fc%2Ceantonell%40aoc.cat)

Per NAT amb xarxa XCAT: **Mapeo XCAT- CS\_AOC - NTT Confluence.pdf**

Per NAT amb xarxa Sara: **Mapeo SARA - CS\_ AOC - NTT Confluence.pdf**

**Per accedir hem de fer-ho amb l'usuari de l'AOC (Ex: OTECJACardete@aoc.cat)**

### Pas 1: Demanar els NAT en cas que no existeixin

En cas que no estiguin en el registre, demanem un nou NAT/XCAT obrint un JIRA a Sistemes.

Exemple de JIRA:

![](attachments/26313331/36340581.png)

Amb aquesta gestió, l'equip de Sistemes assignarà una IP amb la qual l'ens arribarà a atacar la PCI.

### Pas 2: Configurar les IP's natejades

Una vegada SISTEMES ha assignat una IP amb el NAT XCAT, caldrà comprovar si aquesta (la IP nova, natejada) està afegida al context que toca, procedint amb el que s'explica en aquesta FAQ.

Si la nova IP no està afegida, afegir-la.

  

Pas 1: Connectar-nos a les màquines.
------------------------------------

El primer pas serà obrir el WinSCP i obrir una sessió via SSH (Putty) a un node de PRE/PRO. Només caldrà modificar el fitxer en un node.

 A continuació mostrem quines són les plataformes a les quals ens haurem de connectar:

*   ##### **.PRE - pci30  
    ![](attachments/thumbnails/26313331/26314844)→ usuari: aoc  
    **
    

*   ##### **PRO - pci30  
    ![](attachments/thumbnails/26313331/26316409)→ usuari: aoc  
    **
    

Pas 2: Realitzar còpia de seguretat del fitxer de configuració.
---------------------------------------------------------------

**Sempre haurem de realitzar una còpia de seguretat,** ja que el fitxer és molt sensible a errates de sintaxi. Un cop realitzat els canvis és molt difícil recordar el que hem fet i deixar-lo com estava i per això és millor realitzar la còpia.

**Realitzarem la còpia de seguretat del fitxer que haguem de modificar.**

*   **PRE - PCI3**
    --------------
    

cp /apps/aoc/httpd/ssl/serveis3-pre.app.aoc.cat\_ssl.conf.nfs /apps/aoc/httpd/ssl/conf.nfs.backup/serveis3-pre.app.aoc.cat\_ssl.conf.nfs.20XXXXXX
cp /apps/aoc/httpd/ssl/serveis3-pre.iop.aoc.cat\_ssl.conf.nfs /apps/aoc/httpd/ssl/conf.nfs.backup/serveis3-pre.iop.aoc.cat\_ssl.conf.nfs.20XXXXXX
cp /apps/aoc/httpd/ssl/serveis3-pre.nt.aoc.cat\_ssl.conf.nfs /apps/aoc/httpd/ssl/conf.nfs.backup/serveis3-pre.nt.aoc.cat\_ssl.conf.nfs.2020XXXX

*   **PRO - PCI3**
    --------------
    

cp /mnt/storage30/aoc/httpd/ssl/serveis3.app.aoc.cat\_ssl.conf.nfs /mnt/storage30/aoc/httpd/ssl/conf.nfs.backup/serveis3.app.aoc.cat\_ssl.conf.nfs.20XXXXXX
cp /mnt/storage30/aoc/httpd/ssl/serveis3.iop.aoc.cat\_ssl.conf.nfs /mnt/storage30/aoc/httpd/ssl/conf.nfs.backup/serveis3.iop.aoc.cat\_ssl.conf.nfs.20XXXXXX
cp /mnt/storage30/aoc/httpd/ssl/serveis3.nt.aoc.cat\_ssl.conf.nfs /mnt/storage30/aoc/httpd/ssl/conf.nfs.backup/serveis3.nt.aoc.cat\_ssl.conf.nfs.20XXXXXXX

**_Nota_**_: on posa XXXXXX ho substituirem per la data del dia, per exemple 20181030_

Pas 3: Identificar els blocs on afegir les IP's.
------------------------------------------------

En funció dels serveis que vulguem configurar, haurem d'afegir les IP's a unes categories o a unes altres. En general les afegim a services i a NTDescarrega.

A la següent taula trobarem quines categories corresponen a cada servei:

Servei

e-NOTUM

**NT**

**pci30:** /mnt/storage30/aoc/httpd/ssl/serveis3.nt.aoc.cat\_ssl.conf.nfs

  

**PCI30:**

**/enotum/rest/descarrega**

**<Location /siri-proxy/services/\* >**

Servei

e-TAULER

**APP**

**Rutes:**

**pci30:** /mnt/storage30/aoc/httpd/ssl/serveis3.app.aoc.cat\_ssl.conf.nfs

**<Location /siri-proxy/services/\* >** 

  

Servei

Hèstia

**APP**

**Rutes:**

**pci30:** /mnt/storage30/aoc/httpd/ssl/serveis3.app.aoc.cat\_ssl.conf.nfs

**<Location /siri-proxy/services/\* >**

  

Servei

REPRESENTA

**APP**

**Rutes:**

**pci30: /**mnt/storage30/aoc/httpd/ssl/serveis3.app.aoc.cat\_ssl.conf.nfs

**<Location /siri-proxy/services/\* >**

  

**<Location /representa-core>**

Servei

Valid

No es tracta de la mateixa màquina. Anar a aquest [enllaç](26313331.md).

Servei

OVER

**APP**

**Rutes:**

**pci30: /**mnt/storage30/aoc/httpd/ssl/serveis3.app.aoc.cat\_ssl.conf.nfs

**<Location /siri-proxy/services/\* >**

  

**<Location /CAOC-PCI30-OVER-TRAMITS/descarrega >**

  

Servei

RPC

**IOP**

**pci30:** /mnt/storage30/aoc/httpd/ssl/serveis3.iop.aoc.cat\_ssl.conf.nfs

**<Location /siri-proxy/services/\* >**

  

  

Servei

PSCP

**APP**

**PRE:** /mnt/storage30/aoc/httpd/ssl/serveis3.app.aoc.cat\_ssl.conf.nfs

**PRO:** /mnt/storage30/aoc/httpd/ssl/serveis3.app.aoc.cat\_ssl.conf.nfs

**<Location /siri-proxy/services/\* >**  

([pci30](#GLOBALINTEGRACIÓConfiguraciód'IP's-maquinas))

<Location /CAOC-PCI30-PSCP/resources/rest >

([pci30](#GLOBALINTEGRACIÓConfiguraciód'IP's-maquinas))

Servei

e-TRAM

**APP**

**Rutes:**

**pci30:** /mnt/storage30/aoc/httpd/ssl/serveis3.app.aoc.cat\_ssl.conf.nfs

**<Location /siri-proxy/services/\* >** 

  

Servei

MUX

**APP**

**Rutes:**

**pci30:** /mnt/storage30/aoc/httpd/ssl/serveis3.app.aoc.cat\_ssl.conf.nfs

**AOC-PCI30-MSC-DESAL/descarrega**

**IOP**

**pci30:** /mnt/storage30/aoc/httpd/ssl/serveis3.iop.aoc.cat\_ssl.conf.nfs

**<Location /siri-proxy/services/\* >**

Servei

VO

**IOP**

**pci30:** /mnt/storage30/aoc/httpd/ssl/serveis3.iop.aoc.cat\_ssl.conf.nfs

**<Location /siri-proxy/services/\* >**

  

**Només en el cas del producte REGISTRE\_ENTITAT, en la modalitat ENTITAT\_ESTATUS**

**<Location /CAOC-PCI30-MC-REGISTREENTITATS/descarrega >**

  

**Només en el cas del producte DCOC,** 

**CAOC-PCI30-MC-DCOC/descarrega**

  

Servei

SIR

**APP**

**pci30:** /mnt/storage30/aoc/httpd/ssl/serveis3.app.aoc.cat\_ssl.conf.nfs

  

**<Location /siri-proxy/services/\* >**

**<Location /CAOC-PCI30-MC-SIR/descarrega>**

ATENCIÓ!

Per eNotum PRODUCCIÓ encara continuem configurant IP's en PCI2, ja que eNotum encara apunta a serveis per la consulta i descàrrega de evidències. Això és perquè la PICA encara ha de migrar els seus WS a serveis3.

Comandes per PCI2:

**PRO**

cp /apps/aoc/httpd/ssl/serveis.app.aoc\_ssl.conf.nfs /apps/aoc/httpd/ssl/conf.nfs.backup/serveis.app.aoc\_ssl.conf.nfs.20XXXXXX

vi  /apps/aoc/httpd/ssl/serveis.app.aoc\_ssl.conf.nfs

sudo /etc/init.d/httpd configtest

sudo apachectl graceful

  

Pas 3: Afegir les IP's.
-----------------------

Un cop fet el backup ja podem afegir les IP's utilitzarem l'editor vi o **millor directament amb editar del winscp o descarregant-nos el fitxer i fent servir el notepad ++**

Exemple mode "editar winscp":

![](attachments/26313331/26314798.png)

  

Alternativament, si ho volem fer per consola, amb la comanda **vi**:

*   **PRE - PCI3**
    --------------
    

vi  /apps/aoc/httpd/ssl/serveis3-pre.app.aoc.cat\_ssl.conf.nfs
vi  /apps/aoc/httpd/ssl/serveis3-pre.iop.aoc.cat\_ssl.conf.nfs
vi  /apps/aoc/httpd/ssl/serveis3-pre.nt.aoc.cat\_ssl.conf.nfs

*   **PRO PCI3**
    ------------
    

vi  /apps/aoc/httpd/ssl/serveis3.iop.aoc.cat\_ssl.conf.nfs
vi  /apps/aoc/httpd/ssl/serveis3.app.aoc.cat\_ssl.conf.nfs
vi  /apps/aoc/httpd/ssl/serveis3.nt.aoc.cat\_ssl.conf.nfs

El primer pas serà mirar que no estiguin afegides ja. 

*   Dintre del fitxer fem la cerca **ESC + / + IP** (amb "**N**" anem revisant que es troba en els contexts que toca → veure taula de contexts)
*   En el següent exemple hem d'afegir la IP 83.48.55.147 que pertany a l’ajuntament de Naut Aran. En aquest cas, les IP ja estaven introduïdes.  
      
    ![Ip comentada2.png](https://steps.everis.com/confluence/download/attachments/1067516589/Ip%20comentada2.png?version=1&modificationDate=1509631886000&api=v2)
    
    **_Nota_**_: En el cas que la IP ja es trobés afegida, podem sortir de l'editor vi utilitzant la tecla ESC i escrivint ":q" ó ":q!"_
    

Si les IP's no estan afegides, les podrem afegir:

*   Per informar la IP anem a la línia a modificar i pressionem “**i**” + **espai** + **enganxem IP** + **ESC** 
*   Per informar la IP en els dos contexts anem a la primera línia on surten les IP + “**$**” + “**i**” + **espai** + **enganxem IP** + **ESC**  
      
    
*   Una vegada informades totes les IP, finalitzarem amb un **:wq!** 

Com anar al final d'una fila per consola en Linux:

Ens poden trobar a vegades, que hi ha moltes IP configurades en una fila, si no tinguéssim cap _shortcut_, hauríem de prémer la fletxa direccional del teclat cap a la dreta, fins a arribar al final de la fila. Cosa que com es pot veure en aquesta imatge, i especialment depenent de la fila, podríem tardar un temps que amb el següent _shorcut_, ens podem evitar.

![](attachments/26313331/100008986.png)

Per anar directament al final d'una fila per consola Linux, tot el que hem fer és apretar a la teclar "**$**" (en el nostra teclat, el més segurament és que la tecla serà fent **SHIFT + 4, PERÒ abans de fer aquesta comanda, revisem que realment estigui assignat el dolar en aquest botó**)

**Allow from duplicat**

Si ens trobem amb el **ALLOW FROM** duplicat, significa que en la primera linia ja s'ha arribat al màxim d'IP's que es poden informar.

En aquest cas, informarem la nostra IP en la segona línia.

Per exemple, si haguéssim d'afegir una IP en el context del Siri en el següent cas, caldria posar-la dins el segon ALLOW FROM:

![](attachments/26313331/41522162.png)Ç

Si n'hi ha dos, és perquè el primer està ple.

Si tenim dubtes, comentar-ho internament.

  

  

IP's ja afegides

Si les IP's ja estaven afegides, no haurem de realitzar cap tipus de modificació i no farà falta realitzar graceful (tenir en compte que si les IP's estan afegides a PRE, no tenen per què estar afegides a PRO i viceversa).

  

IPs per rangs

Hem de revisar si les IP estan afegides en un rang d'IPs.

Per exemple:

**Ens indiquen de configurar la IP 150.90.90.90**

Haurem de revisar si el rang **150.90.90.0/24** apareix configurat.

Si veiem que el rang no està configurat fem la cerca per la IP que indica l'usuari.

  

Pas 4: Revisar la sintaxi i Realitzar un graceful.
--------------------------------------------------

**Si hem modificat el fitxer, haurem de comprovar la sintaxi abans de fer res.**

Per comprovar la sintaxis:

**PRE i PRO - PCI3**
--------------------

sudo apachectl configtest

  

**Si la sintaxi és correcta, apareixerà un missatge com el següent:**

![](attachments/26313331/30869724.png)

**Si la sintaxi és incorrecte, haurem de restaurar els backups i comentar-ho internament.**

Finalment fem el graceful **de tots els nodes** :

Només cal realitzar la modificació del fitxer en un node de cada plataforma però el graceful cal realitzar-lo a cada un dels nodes.

#PRE i PRO - PCI3:
sudo apachectl graceful

  

Pas 5: Comprovacions extres

Podem comprovar que servidor que hem reiniciat torna a estar en marxa (mirant l’hora)

 ps -axu | grep apache

![](attachments/26313331/26314813.png) 

Revisió extra:

telnet localhost 80  
telnet localhost 443

Attachments:
------------

![](images/icons/bullet_blue.gif) [image2018-10-25\_16-17-59.png](attachments/26313331/26317553.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2018-10-29\_15-47-17.png](attachments/26313331/26314841.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2018-10-29\_15-49-47.png](attachments/26313331/26314842.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2018-10-29\_15-51-50.png](attachments/26313331/26314844.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2018-10-29\_16-6-45.png](attachments/26313331/26314798.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2018-10-29\_16-12-27.png](attachments/26313331/26314794.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2018-10-29\_16-12-35.png](attachments/26313331/26314793.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2018-10-29\_16-22-23.png](attachments/26313331/26314815.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2018-10-29\_16-22-23.png](attachments/26313331/26314814.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2018-10-29\_16-22-23.png](attachments/26313331/26314813.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2019-4-4\_17-21-30.png](attachments/26313331/26316409.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2020-1-16\_16-26-41.png](attachments/26313331/30869724.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2020-4-6\_13-7-51.png](attachments/26313331/36340581.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2021-3-24\_14-0-22.png](attachments/26313331/41522162.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2024-1-30\_12-54-55.png](attachments/26313331/100008986.png) (image/png)  

Document generated by Confluence on 02 June 2025 10:55

[Atlassian](http://www.atlassian.com/)