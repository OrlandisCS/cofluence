Suport Tècnic : PL-Edictes\_no\_retirats\_en\_la\_data\_establerta  

1.  [Suport Tècnic](index.html)
2.  [Suport Tècnic](13893782.html)
3.  [03 - Monitorització - Revisions globals](26313327.html)
4.  [03 - Monitorització - OLD](128647245.html)
5.  [Sondes S.T.](Sondes-S.T._30869120.html)
6.  [Sondes ST - ETAULER](Sondes-ST---ETAULER_28705319.html)

Suport Tècnic : PL-Edictes\_no\_retirats\_en\_la\_data\_establerta
==================================================================

Created by Unknown User (otecobernal), last modified by Unknown User (otecjriquelme) on 03 January 2022

**Query:**

SELECT count(\*) FROM ETAULER3PL.ET\_EDICTE WHERE SYSDATE > (DATA\_FI\_EXPOSICIO + 15/24/60 + 1) AND ESTAT = 3 AND (REINTENTS < 20 or reintents is null);

**Descripció:** 

Aquesta sonda consulta els edictes del PORTLET que no s'han despublicat en la data establerta:

*   L'edicte està publicat (estat igual a 3).
*   La data de retirada és menor a la data actual amb un marge de 15 minuts.
*   L'edicte té 5 o més reintents, que significat que s'han realitzat tots els intents permesos.
*   L'edicte té menys de 20 reintents per no agafar edictes de la blacklist (entre altres casuístiques).

  

**Actuació:** 

Buscar els edictes afectats i amb estat incorrecte:

select \*
  from etauler3pl.et\_edicte pl
 where pl.data\_fi\_exposicio < to\_date('03/01/2022', 'dd/mm/yyyy') -- Dia actual
   and pl.estat = '3'
   AND (pl.REINTENTS < 20 or pl.reintents is null)
   and pl.data\_fi\_exposicio > to\_date('01/01/2019', 'dd/mm/yyyy') -- Aquí fiquem un data límit, normalment el primer dia de l'any.

D'aquesta consulta agafarem tots els IDs dels edictes que apareguin i els fiquem en la següent consulta:

select pci.id\_edicte "ID PL", proces.\*
  from etauler3pci.et\_edicte pci, etauler3pci.et\_proces proces
 where pci.id = proces.id\_edicte
      and proces.operacio = '1' -- Filtrem per l'operació despublicar (0=Publicar i 1=Despublicar)
      --and pci.reintents != '99' -- Filtrem per les entitats que no estan a la blacklist
   and pci.eacat = '1'
   and pci.id\_edicte in ('227822', '227824')

Si trobem el camp SINCRONITZAT\_EACAT està a 1, el tornem a posar a 0 i esperem que el gestor de tasques actuï.

update ETAULER3PCI.et\_proces p
set p.sincronitzat\_eacat = '0'
where p.id = 173797

**logs:** 

*   **Servidor:** Tomcat 8 - EACAT
*   **Ruta:** /mnt/storage30/aoc/APP/logs
*   **Nom:**  aoc-l-tomcat8-01-pro

Document generated by Confluence on 02 June 2025 11:11

[Atlassian](http://www.atlassian.com/)