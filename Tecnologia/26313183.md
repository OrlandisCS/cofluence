Suport Tècnic : ETAULER - BBDD - Dies inhàbils  

1.  [Suport Tècnic](index.html)
2.  [Suport Tècnic](13893782.html)
3.  [02 - FAQ's serveis](26313393.html)
4.  [FAQ's eTAULER](28705565.html)

Suport Tècnic : ETAULER - BBDD - Dies inhàbils
==============================================

Created by Unknown User (cmoralea), last modified by OTEC ST JAlejandro Cardete Postigo on 22 December 2023

VALIDAT

A començament d'any es fiquen els dies inhàbils manualment en el servei

Traspàs Toni Vierge

S'ha d'executar cada any amb les dates del calendari oficial que publica la Generalitat cap a final d'any. El Cap de Servei s'encarrega de facilitar aquestes dades i obrir el JIRA corresponent.

Passos
------

Aquesta acció la feia el Cap de servei amb Toni Vierge. A partir d'ara la realitzarem nosaltres.

A tenir en compte

Com el PL fa dos Output per cada ens, si no hem modificat el buffer del PL/SQL ens donarà error, pel que es aconsellable ampliar la mida del buffer abans de lleçar el procés:

![](attachments/26313183/64980838.png)

Si posem un o dos 0's més ja seria suficient.

1.  Es realitza un procedure per tal d'actualitzar aquesta informació a la BBDD (ETAULER3PL). La informació l'ha de passar la Cap de Servei (els dies inhàbils del nou any).
    
    **Update dels dies inhàbils**
    
    \-- Procedure per carregar els dies inhàbils de 2018 (Calendari GENE) per tots els ENS. FET PER TONI VIERGE
    
    CREATE OR REPLACE PROCEDURE P\_ET\_DIES\_FESTIUS IS
     CURSOR c\_ens IS SELECT DISTINCT CODI\_ENS FROM ET\_CFG order by CODI\_ENS asc;
     vCodiEns NUMBER;
    BEGIN 
     OPEN c\_ens;
     LOOP
     FETCH c\_ens INTO vCodiEns;
     EXIT WHEN c\_ens%NOTFOUND;
     BEGIN
     dbms\_output.put\_line('Carregant ET\_CFG\_CALENDARI - ' || vCodiEns); 
     INSERT INTO ET\_CFG\_CALENDARI (ID,CODI\_ENS,DATA) VALUES (SEQ\_ET\_CFG\_CALENDARI.NEXTVAL,vCodiEns,TO\_DATE('01/01/2018','DD/MM/YYYY')); 
     INSERT INTO ET\_CFG\_CALENDARI (ID,CODI\_ENS,DATA) VALUES (SEQ\_ET\_CFG\_CALENDARI.NEXTVAL,vCodiEns,TO\_DATE('06/01/2018','DD/MM/YYYY'));
     INSERT INTO ET\_CFG\_CALENDARI (ID,CODI\_ENS,DATA) VALUES (SEQ\_ET\_CFG\_CALENDARI.NEXTVAL,vCodiEns,TO\_DATE('30/03/2018','DD/MM/YYYY'));
     INSERT INTO ET\_CFG\_CALENDARI (ID,CODI\_ENS,DATA) VALUES (SEQ\_ET\_CFG\_CALENDARI.NEXTVAL,vCodiEns,TO\_DATE('02/04/2018','DD/MM/YYYY'));
     INSERT INTO ET\_CFG\_CALENDARI (ID,CODI\_ENS,DATA) VALUES (SEQ\_ET\_CFG\_CALENDARI.NEXTVAL,vCodiEns,TO\_DATE('01/05/2018','DD/MM/YYYY'));
     INSERT INTO ET\_CFG\_CALENDARI (ID,CODI\_ENS,DATA) VALUES (SEQ\_ET\_CFG\_CALENDARI.NEXTVAL,vCodiEns,TO\_DATE('15/08/2018','DD/MM/YYYY'));
     INSERT INTO ET\_CFG\_CALENDARI (ID,CODI\_ENS,DATA) VALUES (SEQ\_ET\_CFG\_CALENDARI.NEXTVAL,vCodiEns,TO\_DATE('11/09/2018','DD/MM/YYYY'));
     INSERT INTO ET\_CFG\_CALENDARI (ID,CODI\_ENS,DATA) VALUES (SEQ\_ET\_CFG\_CALENDARI.NEXTVAL,vCodiEns,TO\_DATE('12/10/2018','DD/MM/YYYY'));
     INSERT INTO ET\_CFG\_CALENDARI (ID,CODI\_ENS,DATA) VALUES (SEQ\_ET\_CFG\_CALENDARI.NEXTVAL,vCodiEns,TO\_DATE('01/11/2018','DD/MM/YYYY'));
     INSERT INTO ET\_CFG\_CALENDARI (ID,CODI\_ENS,DATA) VALUES (SEQ\_ET\_CFG\_CALENDARI.NEXTVAL,vCodiEns,TO\_DATE('06/12/2018','DD/MM/YYYY'));
     INSERT INTO ET\_CFG\_CALENDARI (ID,CODI\_ENS,DATA) VALUES (SEQ\_ET\_CFG\_CALENDARI.NEXTVAL,vCodiEns,TO\_DATE('08/12/2018','DD/MM/YYYY'));
     INSERT INTO ET\_CFG\_CALENDARI (ID,CODI\_ENS,DATA) VALUES (SEQ\_ET\_CFG\_CALENDARI.NEXTVAL,vCodiEns,TO\_DATE('25/12/2018','DD/MM/YYYY'));
     INSERT INTO ET\_CFG\_CALENDARI (ID,CODI\_ENS,DATA) VALUES (SEQ\_ET\_CFG\_CALENDARI.NEXTVAL,vCodiEns,TO\_DATE('26/12/2018','DD/MM/YYYY'));
     dbms\_output.put\_line('Carregat ET\_CFG\_CALENDARI - ' || vCodiEns); 
     COMMIT;
     EXCEPTION
     WHEN OTHERS THEN
     dbms\_output.put\_line('Error carregant ET\_CFG\_CALENDARI - ' || vCodiEns || ': ' || sqlerrm);
     ROLLBACK;
     END;
     END LOOP;
     CLOSE c\_ens;
     
    END P\_ET\_DIES\_FESTIUS;
    
2.  Un cop hem creat el procedure amb l'script l'haurem d'executar.
    
    **Update dels dies inhàbils**
    
    \-- Executem el procedure creat
    begin
      P\_ET\_DIES\_FESTIUS; -- Nom del procedure
    end;
    

En cas que l'script falli per un ens concret podrem executar el següent (es pot veure si ha fallat algun ens a la pestanya Output del PL/SQL Developer):

**Update dels dies inhàbils**

 INSERT INTO ET\_CFG\_CALENDARI (ID,CODI\_ENS,DATA) VALUES (SEQ\_ET\_CFG\_CALENDARI.NEXTVAL,'2521730008',TO\_DATE('01/01/2019','DD/MM/YYYY'));
 INSERT INTO ET\_CFG\_CALENDARI (ID,CODI\_ENS,DATA) VALUES (SEQ\_ET\_CFG\_CALENDARI.NEXTVAL,'2521730008',TO\_DATE('19/04/2019','DD/MM/YYYY'));
 INSERT INTO ET\_CFG\_CALENDARI (ID,CODI\_ENS,DATA) VALUES (SEQ\_ET\_CFG\_CALENDARI.NEXTVAL,'2521730008',TO\_DATE('22/04/2019','DD/MM/YYYY'));
 INSERT INTO ET\_CFG\_CALENDARI (ID,CODI\_ENS,DATA) VALUES (SEQ\_ET\_CFG\_CALENDARI.NEXTVAL,'2521730008',TO\_DATE('01/05/2019','DD/MM/YYYY'));
 INSERT INTO ET\_CFG\_CALENDARI (ID,CODI\_ENS,DATA) VALUES (SEQ\_ET\_CFG\_CALENDARI.NEXTVAL,'2521730008',TO\_DATE('24/06/2019','DD/MM/YYYY'));
 INSERT INTO ET\_CFG\_CALENDARI (ID,CODI\_ENS,DATA) VALUES (SEQ\_ET\_CFG\_CALENDARI.NEXTVAL,'2521730008',TO\_DATE('15/08/2019','DD/MM/YYYY'));
 INSERT INTO ET\_CFG\_CALENDARI (ID,CODI\_ENS,DATA) VALUES (SEQ\_ET\_CFG\_CALENDARI.NEXTVAL,'2521730008',TO\_DATE('11/09/2019','DD/MM/YYYY'));
 INSERT INTO ET\_CFG\_CALENDARI (ID,CODI\_ENS,DATA) VALUES (SEQ\_ET\_CFG\_CALENDARI.NEXTVAL,'2521730008',TO\_DATE('12/10/2019','DD/MM/YYYY'));
 INSERT INTO ET\_CFG\_CALENDARI (ID,CODI\_ENS,DATA) VALUES (SEQ\_ET\_CFG\_CALENDARI.NEXTVAL,'2521730008',TO\_DATE('01/11/2019','DD/MM/YYYY'));
 INSERT INTO ET\_CFG\_CALENDARI (ID,CODI\_ENS,DATA) VALUES (SEQ\_ET\_CFG\_CALENDARI.NEXTVAL,'2521730008',TO\_DATE('06/12/2019','DD/MM/YYYY'));
 INSERT INTO ET\_CFG\_CALENDARI (ID,CODI\_ENS,DATA) VALUES (SEQ\_ET\_CFG\_CALENDARI.NEXTVAL,'2521730008',TO\_DATE('25/12/2019','DD/MM/YYYY'));
 INSERT INTO ET\_CFG\_CALENDARI (ID,CODI\_ENS,DATA) VALUES (SEQ\_ET\_CFG\_CALENDARI.NEXTVAL,'2521730008',TO\_DATE('26/12/2019','DD/MM/YYYY'));

  
Related articles

  

Attachments:
------------

![](images/icons/bullet_blue.gif) [image2022-3-29\_17-27-15.png](attachments/26313183/64980838.png) (image/png)  

Document generated by Confluence on 02 June 2025 10:54

[Atlassian](http://www.atlassian.com/)