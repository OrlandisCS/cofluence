Suport Tècnic : PCI - FLUX DEL SERVEI - Purga de registres  

1.  [Suport Tècnic](index.md)
2.  [Suport Tècnic](13893782.md)
3.  [02 - FAQ's serveis](26313393.md)
4.  [FAQ's PCI](28705599.md)

Suport Tècnic : PCI - FLUX DEL SERVEI - Purga de registres
==========================================================

Created by Unknown User (obernalp), last modified by Unknown User (otecobernal) on 05 December 2019

Màquines Linux

![](attachments/26313596/26314566.png)

Procés de purga

Cada dissabte es purguen els registres de la PCI (s'eliminen), tant per IOP com per APP (PRE i PRO).

També rebem un correu per cada entorn i clúster amb un resum de la tasca de purga:

![](attachments/26313596/26317614.png)

La tasca de purga elimina els registres que estan en una finestra entre 135 i 35 dies, és a dir, aquells registres de la PCI amb antiguitat superior a 35 dies seran eliminats. A efectes pràctics, com la purga es realitza cada dissabte, s'eliminen els registres entre 42 (35 + 7) i 35 dies.

Aquest procés es realitza per evitar la sobrecàrrega de dades a les bases que puguin afectar el seu rendiment.

Històric de la PCI30

Per auditories, és obligatori mantenir un mínim d'informació registrada per si cal fer un seguiment. Per això, abans d'eliminar els registres, es guarden certes dades a una taula anomenada PCI\_MTI\_AUDIT (dins de cada esquema corresponent, és a dir, PCI30APP, PCI30IOP, etc).

**Consulta de l'històric de registres purgats**

select \* from PCI\_MTI\_AUDIT 

  
Les dades que es guarden són:

*   ID\_PETICIO
*   ID\_SOLICITUD
*   CODI\_REUQRIDOR
*   CODI\_PRODUCTE
*   CODI\_MODALITAT
*   SINCRONA
*   DATA\_RECEPCIO
*   DATA\_FI
*   ESTAT
*   NUM\_ELEMENTS
*   ELEMENT
*   DATA\_PROCES
*   EMISOR\_NIF
*   CODI\_FINALITAT
*   CONSENTIMENT
*   FUNCIONARI\_NIF
*   EXPEDIENT

Històric de la PCI20

També es purgaven les peticions de la PCI2 (antiga a PCI30). Aquells registres es troben a un esquema a part, dins d'ORA12:

![](attachments/26313596/26317582.png)

Dins d'aquest esquema es troben les purgues per cada versió de la PCI20 i per cada clúster. Hi va haver un total de 3 versions (PCI20, PCI20V2 i PCI20V3)

Les taules PCIAPP fan referència al clúster d'APP i les taules PCI al clúster d'IOP.

**Consulta de l'històric de registres purgats**

select \* from all\_all\_tables where owner = 'PCI20\_AUDIT'

  
![](attachments/26313596/26317579.png)

Està previst organitzar aquestes taules històriques per anys, per tenir totes les peticions agrupades anualment. De moment no hi ha previsió.

  
  

  

  

  

  

Attachments:
------------

![](images/icons/bullet_blue.gif) [image2018-11-21\_9-45-20.png](attachments/26313596/26317596.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2019-5-21\_9-48-49.png](attachments/26313596/26317614.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2019-5-21\_9-55-19.png](attachments/26313596/26317582.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2019-5-21\_9-58-13.png](attachments/26313596/26317580.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2019-5-21\_9-58-51.png](attachments/26313596/26317579.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2019-5-23\_13-7-26.png](attachments/26313596/26314566.png) (image/png)  

Document generated by Confluence on 02 June 2025 10:57

[Atlassian](http://www.atlassian.com/)