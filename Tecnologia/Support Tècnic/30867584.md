Suport Tècnic : SIGNADOR - FLUX DEL SERVEI - Revisió signatura i components  

1.  [Suport Tècnic](index.md)
2.  [Suport Tècnic](13893782.md)
3.  [02 - FAQ's serveis](26313393.md)
4.  [FAQ's SIGNADOR](30867480.md)

Suport Tècnic : SIGNADOR - FLUX DEL SERVEI - Revisió signatura i components
===========================================================================

Created by Unknown User (otecagonzalez), last modified on 14 October 2020

En aquesta FAQ detallarem el flux a seguir davant d'una incidència reportada per l'usuari que vol signar algun tràmit amb el signador. Tant amb l'aplicació nativa com amb JNLP

Normalment per realitzar la revisió haurem de connectar-nos remotament a l'ordinador de l'usuari. 

Per més informació relacionada amb el SIGNADOR consultem [aquí](https://intranet.aoc.cat/pages/viewpage.action?pageId=30867482).  

**Test de signatura**
---------------------

El **test de signatura**, es una prova funcional del servei del signador. Es **reprodueix l'operació de fer una signatura feta pel signador** seguint el mateix flux que es faria a l'hora de signar un tràmit des d'una plataforma integrada, com pot ser EACAT, Serveis de la Generalitat, etc.

Què cal saber abans de fer el test

1.  Hi han dos mètodes per fer la firma: 
    *   **_Aplicació Nativa_**:  
        a. Aplicació que s'ha d'instal·lar prèviament en l'equip local (_Més informació sobre la instal·lació de l'aplicació nativa [aquí](https://github.com/ConsorciAOC/signador/blob/master/guiaUsuaris/nativa.md#3-installaci%C3%B3)_).  
        b. Els logs només es poden obtenir si l'usuari té l'aplicació nativa instal·lada. 
        
    *   **Applet JNLP:** a. Applet que es descarrega cada cop que es vol fer una firma.  
        b. Cal tenir JAVA 8 o superior instal·lat per executar-lo.  
          
        
2.  En cas de que tinguem la aplicació nativa instal·lada es pot forçat l'execució del JNLP:   
      
    Duran el procés del test, un cop fem clic a test (en la pantalla [https://signador.aoc.cat/signador/demoGet](https://signador.aoc.cat/signador/demoGet/) ) **es re-dirigeix a la URL:**   
    [https://signador.aoc.cat/signador/nativa?id=bc2e50ed-c1c6-4f62-85dc-3064135e1618](https://signador.aoc.cat/signador/nativa?id=bc2e50ed-c1c6-4f62-85dc-3064135e1618).   
      
    Si ens fixem en aquesta **URL hi ha la paraula "nativa" que vol dir que s'està fent la crida a l'aplicació nativa.**  
      
    Però si modifiquem la URL per:  
     [https://signador.aoc.cat/signador/JNLP?id=bc2e50ed-c1c6-4f62-85dc-3064135e1618](https://signador.aoc.cat/signador/nativa?id=bc2e50ed-c1c6-4f62-85dc-3064135e1618), **afegint "JNLP" podem forçar que la firma es faci pel JNLP**

Realitzar test de signatura

**Executar el test des del mateix navegador que l'usuari obté l'error.** 

Test JNLP

*    **Anem a la web del [signador](https://signador.aoc.cat/signador/init), seguidament fem clic a "altre":**  
    ![](attachments/30867584/30867593.png)  
      
      
    
*   **Seguidament s'obrirà la següent [plana](https://signador.aoc.cat/signador/demoGet) i fem clic a "TEST" (no cal tocar cap paràmetre):**  
    ![](attachments/30867584/30867595.png)  
      
      
    
*   **Si NO tenim l'aplicació nativa instal·lada, automàticament al fer clic a "Test" es re-dirigirà a la plana següent (es farà la firma amb el JNLP):**  
    ![](attachments/30867584/30867598.png)  
      
    
*   **Realitzarem els 3 punts de la imatge anterior, finalment ens sortirà una "pantalla" on hem d'escollir el certificat amb el que volem signar i acceptar:**   
      
    ![](attachments/30867584/41519359.png)  
      
      
    
*   **Finalment podem veure que la signatura s'ha realitzat correctament**   
    ![](attachments/30867584/30867599.png)

  

Test aplicació Nativa

*    **Anem a la web del [signador](https://signador.aoc.cat/signador/init), seguidament fem clic a "altre":**  
    ![](attachments/30867584/30867593.png)  
      
      
    
*   **Seguidament s'obrirà la següent [plana](https://signador.aoc.cat/signador/demoGet) i fem clic a "TEST" (no cal tocar cap paràmetre):**  
    ![](attachments/30867584/30867595.png)  
      
      
    
*   **Si SÍ tenim l'aplicació nativa instal·lada, a****utomàticament al fer clic a "Test" es re-dirigirà a la plana següent:**

![](attachments/30867584/30867602.png)  
En aquesta plana han de sortir tots els certificats possibles que tinguem en el KeyStore per signar o bé en el dispositiu pkcs11.

  

*   **Escollirem un certificat i farem clic a "Signeu", llavors si tot va bé veurem que la signatura s'ha generat correctament:**

  

![](attachments/30867584/30867603.png)

  

  

  

  

  

**Revisió aplicació nativa**
----------------------------

Per realitzar una **revisió més exhaustiva serà millor descarregar l'aplicació nativa**, ja que amb aquesta podrem obtenir logs per identificar els errors.  
Per més informació sobre la instal·lació de l'aplicació nativa ( fer clic [aquí](https://github.com/ConsorciAOC/signador/blob/master/guiaUsuaris/nativa.md#3-installaci%C3%B3)).

Operativitat de l'aplicació

  

1.  **Comunicació Nativa ↔ SIGNADOR  
    **Quan l'aplicació nativa s'executa, es realitza una connexió entre aquesta i el Signador (servei AOC), per la transferència de les dades entre els aplicatius.  
      
    
2.  **Al executar l'aplicació Nativa la comunicació es pot realitzar pels ports (9090, 9091, 9092, 9093):  
    **Es prova de realitzar la comunicació pel port 9090 en cas que estigui en ús es prova el 9091, així fins el 9093. En el cas que tots els ports estiguin ocupats, la connexió entre components no es realitzarà amb èxit i **l'aplicació nativa no funcionarà.  
      
    Ex: Traça del log "C:\\Program Files\\Signador\\log\\webappTemp.log" al iniciar la nativa:**_  
    08 de gen. 2019 16:36:04,341 DEBUG SignadorNativaUtils: El port 9090 no està disponible  
    08 de gen. 2019 16:36:04,602 DEBUG SignadorNativaUtils: El port 9091 està disponible  
      
    _
3.  **Test de operativitat de l'aplicació nativa  
      
    ****Podem executar la següent url "[https://nativa.aoclocal.cat:9090/version](https://nativa.aoclocal.cat:9090/version)"** **al navegador per validar que l'aplicació estigui corrent correctament.  
      
    **a. Si el test va bé haurem de veure la següent informació:  
    ![](attachments/30867584/30867685.png)b. Si en executar la URL ens surt una **pantalla de "lloc no segur"** hem de revisar aquesta [FAQ](https://intranet.aoc.cat/display/SII/SIGNADOR+-+FLUX+DE+SERVEIS+-+ERRORS+-+Problemes+de+seguretat+en+les+connexions+SSL), ja que falta instal·lar un certificat per la connexió SSL entre els dos aplicatius.  
    ![](attachments/30867584/30867687.png)  
      
    **O bé, podem fer la prova següent:  
    **a. Accedim a: [https://signador.aoc.cat/signador/testNativa](https://signador.aoc.cat/signador/testNativa)  
      
    b. Fem clic a "Iniciar Test...":   
    ![](attachments/30867584/41519379.png)  
      
    c. Al fer el test ens validarà si la nativa està correctament instal·lada.   
      
      
    
4.  **És possible que al fer aquesta validació ens digui que no estigui ben instal·lada la nativa.**   
      
    a. Pot ser que l'origen de l'error sigui perquè **falta instal·lar el certificat per la connexió SSL**. S'explica en el punt anterior (b) "pantalla de "lloc no segur".  
    b. La validació també fallarà si l'aplicació **nativa està des-instal·lada** o no està executada.   
    c. Que l'usuari tingui tots els ports **(9090, 9091, 9092, 9093) ocupats,** i la nativa no es pugui comunicar amb el Signador.   
    d. **Altres motius**, que podem **recomanar que es torni a fer la instal·lació de nou.** 

  

Revisió de Logs

**Si l'usuari té instal·lada l'aplicació nativa podrà obtenir els logs.** En aquests logs es traça totes les operacions que fa la nativa, en cas de haver-hi algun error, aquí en el log podrem obtenir més informació. 

Informació

Si l'usuari no té instal·lada l'aplicació nativa (fa ús del JNLP), no es podrà revisar cap log, ja que **el JNLP no registra logs.**

  

**Revisió**

**Rutes d'accés al log**

*   **En el cas de sistemes operatius _Windows_, seguint la instal·lació per defecte, la ubicació d'instal·lació és la següent:**  
    _Per a l'instal·lable de32-bits→_  `C:\Program Files (x86)\Signador` _Per a l'instal·lable de 64-bits→_ `C:\Program Files\Signador`
*   **Per tant els fitxers de logs els trobareu a:  
    **`C:\Program Files (x86)\Signador\log\webappTemp.log   ``C:\Program Files (x86)\Signador\error.log   `  
    `C:\Program Files\Signador\log\webappTemp.log`  
    `C:\Program Files\Signador\error.log`  
      
    

*   **En el cas de sistema operatiu _Ubuntu_:**  
    `Home\Signador      `
*   **Podeu accedir a la carpeta dels logs amb la comanda:  
    **`cd home\Signador\error.log   cd` `home\Signador\``webappTemp.log`

**En cas que el fitxer de logs no sigui recent (_logs no printen_):**

És perquè l'aplicació nativa no esta executada amb privilegis d'administrador.   
També es possible, tot i que s'executi com administrador no es printin els logs ja que l'usuari amb el que es va instal·lar l'aplicació nativa no té privilegis per executar amb el Rol d'administrador.

*   Executar com administrador:  
    Obrir Administrador de tasques > Finalitzar tasca _Signador.exe_

![](attachments/30867584/30867607.png)

  

*   Seguidament executem el signador com Administrador (_Signador.exe, ubicat en el path de instal·lació esmentats en el punt anterior_).
*   Tornem a reproduir l'error de l'usuari o fer el Test. Aquest cop sí que haurien d'imprimir els logs.

  

  

  

**Revisió d'errors**
--------------------

Detallem els **errors més comuns** que ens trobem a l'hora de resoldre incidències que entres via tiquet.

No hi ha certificats disponibles per a signar

  

**Comprovar certificats carregats**

En el cas que l'usuari en informi que no se li mostren els certificats a l'hora de triar-ne un per signar, podrem fer les revisions següents:

  

1- Anar a: [https://usuari.enotum.cat/webCiutada/](https://usuari.enotum.cat/webCiutada/) i accedim amb certificat.

D'aquesta manera veurem els certificats que tenim carregats al magatzem de certificats:

![](attachments/30867609/30867610.png)

  

2- Revisar magatzems de certificats **Windows:**

*   *   Opciones de Intenet **>** Contenido **>** Certificados  
        ![](attachments/30867609/30867662.png)

  

3- En cas que l'usuari tingui un SO diferent a windows o al instal·lar l'app nativa va decidir obtenir els certs del magatzem de **FireFox** podrem revisar aquest magatzem seguint els següents passos:

*   *   Obrir Firefox **\>** a la barra del navegador enganxem "about:preferences#privacy" **\>** Busquem l'apartat certificats **\>** Mostra els certificats:  
        ![](attachments/30867609/30867663.png)

  

  

**Instal·lar certificat**

En el cas de que detectem que no tenen el certificat ben carregat podem seguir la FAQ següent on explica com instal·lar un certificat al magatzem de Windows i Firefox:

****[https://github.com/ConsorciAOC/signador/blob/master/guiaUsuaris/nativa.md#5-installar-certificat](https://github.com/ConsorciAOC/signador/blob/master/guiaUsuaris/nativa.md#5-installar-certificat)****

**Paràmetres de filtratge de certificats (app integrada amb signador)**

Quan una aplicació integra el signador es permet configurar uns paràmetres de negoci per el procés de signatura.

En aquests paràmetres es poden filtrar quins tipus de certificats ha d'utilitzar l'usuari per signar.

_Per exemple:_ El DNI sigui un concret, la UO sigui una explícita, el certificat sigui de signatura i no de autorització....

  

Per saber més al detall els paràmetres de filtratge consultar la [FAQ](https://github.com/ConsorciAOC/signador#27-filtres-de-certificats-certs_cfg).

allowed\_CAs

Permet filtrar mitjançant el _CommonName_ de l'_IssuerDistinguishedName_ del certificat. Es poden indicar múltiples entrades separades per punts i comes `;`. El filtre és _case insensitive_. Exemple: `“EC-SAFP;EC-idCAT”`.

allowed\_OIDs

Permet filtrar mitjançant l'identificador de la directiva de certificat que apareix a l'extensió _Bases del certificat_. Es poden indicar múltiples entrades separades per punts i comes `;`.

selected\_alias

Permet filtrar per l'àlies del certificat. Es comprova que existeixi en el dispositiu / magatzem seleccionat.

selected\_CN

Permet filtrar per el _CommonName_ dins del _SubjectDistinguishedName_ del certificat.

subject\_Text

Permet filtrar per una cadena de text que ha d'estar present dins de qualsevol dels camps del _SubjectDistinguishedName_ del certificat. El filtre és _case insensitive_. Exemple: `“Director General”`

required\_nif

Aquest paràmetre no permet el filtrage a priori, sinó que el que fa és realitzar una comprovació contra [PSIS](http://web.aoc.cat/blog/serveis/validador/) previa a la realització de la signatura, validant que el certificat seleccionat per l'usuari és correspon amb el _NIF_ indicat en aquest camp. Cas que no sigui així l'applet no continuarà amb l'operació de signatura i mostrarà el missatge d'error corresponent.

psis\_validation

Igual que el paràmetre required\_nif aquest paràmetre fa una validació previa del certificat abans de realitzar la signatura. Simplement valida que el certificat sigui reconegut per [PSIS](http://web.aoc.cat/blog/serveis/validador/).

keyUsage

Permet filtrar per l'ús de la clau del certificat. Els possibles valors d'aquest atribut són:

*   FD : Firma digital.
*   NR : Non repudiation.

Es poden indicar múltiples entrades separades per punts i comes `;`. El filtre es _case insensitive_. Per defecte filtra per les dues opcions. Exemple: `"NR; FD"`.

**Important**: Si esta com NR → El certificat només pot ser de signatura, i no de Autorització (AUT)

  

  

Problemes de confiança en la connexió SSL

![](attachments/30867682/30867683.png?effects=border-simple,blur-border)

Perquè funcioni l'aplicació nativa és obligatori que s'instal·li el certificat en el seu navegador o sistema operatiu.

### Windows

La càrrega del certificat al magatzem de _Windows_ permet el correcte funcionament de l'aplicació amb Internet explorer, Edge i Chrome.

A més a més en el magatzem de _Windows_ s'instal·la automàticament, tot i que s'ha d'acceptar la instal·lació del certificat mitjançant un popup que apareix durant aquesta.

En cas que no s'hagi cancel·lat l'instal·lació en aquest popup serà necessari que l'usuari ho faci manualment seguint les següents passes d'aquesta [FAQ](https://github.com/ConsorciAOC/signador/blob/master/guiaUsuaris/nativa.md#51-windows).

  

### Firefox

_Firefox_ disposa del seu propi magatzem de claus, per tant independentment del sistema operatiu sobre el que s'estigui executant, si vol fer servir l'aplicació amb _Firefox_ serà necessari carregar el certificat seguint les següents passes que apliquen per qualsevol sistema operatiu. Consultar la següent [FAQ](https://github.com/ConsorciAOC/signador/blob/master/guiaUsuaris/nativa.md#52-firefox).

  

### MAC OS X

Per a MAC OS X el certificat és carrega de forma automàtica però l'usuari ha de procedir a acceptar-lo manualment amb les passes que es descriuen a la següent [FAQ](https://github.com/ConsorciAOC/signador/blob/master/guiaUsuaris/nativa.md#53-mac-os-x). 

  

Problemes amb Firefox

**1- Si als logs veiem que hi ha traces de llibreries path de Firefox i acaba donant un NullPointer és probablement perquè quan es va instal·lar la nativa no es va configurar correctament el path de firefox.**

Això ho podem veure a  archivos de programa> signador >signador.vmoptions a la primera línia **Duser.firefox.dir=C:\\Program Files\\Mozilla Firefox.**

Si arribem a la conclusió que està mal configurat en aquest aspecte, la solució és que l'usuari torni a instal·lar la nativa i seleccioni correctament el path de firefox en la passa que toqui.

Missatge tipus

Bon dia,

Veiem que el servei no pot obtindre correctament els certificats ja que, el realitzar la instal·lació no es va configurar correctament l'ús de certificats del magatzem de Firefox.

Per tornar a realitzar la configuració correctament, torni a instal·lar la aplicació nativa i segueixi els pasos de la guia on detalla com configurar l'ús del magatzem de Firefox en Windows:  
[https://github.com/ConsorciAOC/signador/blob/master/guiaUsuaris/nativa.md#31-windows](https://github.com/ConsorciAOC/signador/blob/master/guiaUsuaris/nativa.md#31-windows)

Restem a la vostra disposició per qualsevol dubte.

Salutacions cordials,

  

  

  

**2- Incompatibilitats de versions del SO 32/64 bits i Firefox 23/64 bits**

  

Si es treballa des de un entorn Windows de 64 bits i els certificats es magatzem-en en el keyStore de firefox, el programari Firefox ha de ser de 64 bits. **Si es de 32 no es trobaran els certificats.** 

**"**_Hem comprovat que el problema que teníem era que estàvem treballant amb un Firefox de 32 bits en un entorn Windows de 64 bits._  
  
_Si instal·lem el certificat IdCat en el magatzem de Firefox 64 bits, tant si estem al Firefox 32 bits com al 64 bits l'aplicació nativa o el jws ens troba el certificat que havíem instal·lat al magatzem de Firefox 64 bits._**"**

  

**3- Versió més antiga que es necessita per fer ús del Signador els la 64.**

  

Attachments:
------------

![](images/icons/bullet_blue.gif) [image2019-11-12\_16-59-43.png](attachments/30867584/30867593.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2019-11-12\_17-3-8.png](attachments/30867584/30867594.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2019-11-12\_17-3-36.png](attachments/30867584/30867595.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2019-11-12\_17-11-50.png](attachments/30867584/30867598.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2019-11-12\_17-18-6.png](attachments/30867584/30867599.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2019-11-12\_17-32-40.png](attachments/30867584/30867602.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2019-11-12\_17-35-38.png](attachments/30867584/30867603.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2019-11-12\_17-55-11.png](attachments/30867584/30867607.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2019-11-13\_11-41-34.png](attachments/30867584/30867685.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2019-11-13\_11-45-24.png](attachments/30867584/30867687.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2020-10-13\_11-53-16.png](attachments/30867584/41519359.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2020-10-13\_13-56-8.png](attachments/30867584/41519379.png) (image/png)  

Document generated by Confluence on 02 June 2025 10:59

[Atlassian](http://www.atlassian.com/)