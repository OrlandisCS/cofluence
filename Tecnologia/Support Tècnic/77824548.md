Suport Tècnic : Sonda OMI - DECIDIM (8x19h)  

1.  [Suport Tècnic](index.md)
2.  [Suport Tècnic](13893782.md)
3.  [03 - Monitorització - Revisions globals](26313327.md)
4.  [Monitors OMI (CTTI)](26313608.md)

Suport Tècnic : Sonda OMI - DECIDIM (8x19h)
===========================================

Created by Unknown User (otecjlortega), last modified by OTEC ST Robert Font Rubí on 31 March 2025

SERVEI 8X5 (8H - 19H)

  

Circuit que realitza la sonda

Aquesta sonda realitza les següents accions:

1.  Accedir a la URL: [https://pilotatge.decidimcatalunya.cat/](https://pilotatge.decidimcatalunya.cat/ "Seguir enllaç")  
      
      
    
2.  Esperar a rebre un 200 OK

  

Màquines a revisar en cas de caiguda

Els servidors de Decidim son els següents:

*   PRE: 13.81.34.139, 40.68.24.241
*   PRO: 20.47.115.162:2201 (node1), 20.47.115.162:2202 (node2)  
      
      
    
    Configuració de ports
    
    Atenció, a l'hora de configurar aquestes màquines és important que tinguem en compte que els ports estiguin ben informats:
    
    *   node1: 2201
    
    *   node2: 2202  
          
        ![](attachments/77824548/81855963.png)
    
      
    

En el cas dels servidors de PRE, connectem per ssh amb l’usuari nominal. En el cas dels servidors de PRO, connectem per ssh amb l’usuari adminuser.

Pendent d'informació [ST-17586](https://contacte.aoc.cat/browse/ST-17586)

Procediment a seguir

Serveis
-------

D’acord amb el que s’ha vist en la configuració, els serveis dels que disposa l’aplicació de Decidim son:

*   **Sidekiq-decidim:** gestiona les peticions que arriben a la cua de redis, arrenca jobs en background
*   **Nginx (Pushion Passenger):** servidor web

Tots dos serveis s’aixequen juntament amb el sistema operatiu, pero si no és el cas, es pot fer manual amb:

nginx
=====

Aquest servei ha d’estar aixecat. 

Al fer :

systemctl status nginx

  

Ens ha de tornar això:

Active: active (running)

Si no ens torna running, cal iniciar-ho amb:

systemctl start nginx

 Verificació: Des de l’usuari decidim, podem fer un ps -faux per veure que el proces  esta aixecat:

root      781778  0.0  0.0  57516  2148 ?        Ss   Oct20   0:00 nginx: master process /usr/sbin/nginx -g daemon on; master\_process on;

www-data  781782  0.0  0.3  80632 30260 ?        S    Oct20   9:54  \\\_ nginx: worker process

www-data  781783  0.0  0.1  63208 12904 ?        S    Oct20   0:24  \\\_ nginx: worker pro

  

sidekiq-decidim
---------------

Aquest servei s’encarrega de gestionar les cues, i també ha d’estar aixecat,  l’usuari que el gestiona es l’usuari decidim. Així que per poder tirar comandes per veure el seu estat, primer cal fer login amb l’usuari decidim amb:

sudo su - decidim

  

Després podem veure l’estat del servei amb la comanda:

systemctl --user status sidekiq-decidim.service

Ens ha de tornar això:

Active: active (running)

Si veiem que el servei no està aixecat, el podem aixecar amb:

systemctl --user start sidekiq-decidim.service

Verificació: Des de l’usuari decidim, podem fer un ps -faux per veure que el proces  esta aixecat:

 ps -faux  | grep sidekiq

 decidim  1552685  0.1  5.2 596240 430536 ?       Ssl  Nov03  19:08  \\\_ sidekiq 6.3.1 decidim \[0 of 5 busy\]

  

### Nota:

 Fa uns dies vam tenir un problema amb aquest servei a PRE que no aixecava, el problema era que al ser un servei d’usuari cal que la sessió tingui la variable d’entorn:

XDG\_RUNTIME\_DIR

És per això que varem afegir al .bashrc de l’usuari decidim aquesta entrada:

export XDG\_RUNTIME\_DIR=/run/user/\`id -u\`

Si amb aquests procediments, tant a PRE com a PRO, el servei/node no aixeca, hem d'enviar un mail a Manel Rella ([mrella@aoc.cat](mailto:mrella@aoc.cat)) amb els problemes detectats.

Feedback

Pendent d'informació [ST-17586](https://contacte.aoc.cat/browse/ST-17586)

Attachments:
------------

![](images/icons/bullet_blue.gif) [image2023-3-23\_8-53-16.png](attachments/77824548/81855963.png) (image/png)  

Document generated by Confluence on 02 June 2025 11:05

[Atlassian](http://www.atlassian.com/)