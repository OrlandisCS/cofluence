Suport Tècnic : MUX v3 - Scripts per tractar incidències generals.  

1.  [Suport Tècnic](index.html)
2.  [Suport Tècnic](13893782.html)
3.  [04 - Tècnica de sistemes + 24x7 + Padró](26313202.html)
4.  [Plataformes](Plataformes_41520520.html)
5.  [MUX v3](MUX-v3_93356465.html)

Suport Tècnic : MUX v3 - Scripts per tractar incidències generals.
==================================================================

Created by OTEC ST Alessandro Trombin Martinez, last modified by OTEC ST JAlejandro Cardete Postigo on 12 April 2024

Hi ha una sèrie d'scripts per a reindexar els registres del MUX. A continuació teniu els diferents scripts per tractar incidències generals al MUX v3 per recuperar la informació dels registres i per tractar tiquets.

  

Mux v2 vs Mux v3

Quan llancem aquest script afectarà tant els assentaments nous del MUXv3 com els antics del MUXv2. Per tant, tot i que l'script indiqui v3, afecta a tots els assentaments del MUX.

  

  

Abans de continuar

Primer de tot haureu de descarregar els scripts, deixem adjunt el .zip. i també l'haureu de descomprimir. Recomanem que els descomprimiu en una ruta de fàcil accés en el vostre ordinador.

[![](download/resources/com.atlassian.confluence.plugins.confluence-view-file-macro:view-file-macro-resources/images/placeholder-small-zip.png)muxv3\_tools.zip](/download/attachments/93356702/muxv3_tools.zip?version=1&modificationDate=1689585811083&api=v2)

Ens ha donat problemes al executar els scripts des del CMD, per evitar aquests problemes, heu d'utilitzar la aplicació Git Bash: (URL de descàrrega: [https://gitforwindows.org/](https://gitforwindows.org/))

![](attachments/93356702/93356704.png)  
  
  

Configuració del Host

Aquests scripts necessiten connexió a la bd scan scan.ora12-cl-pro, heu de configurar-la en l'arxiu hosts

Ruta: **C:\\Windows\\System32\\drivers\\etc**  
  

**10.123.4.12  scan.ora12-cl-pro**  
  
Exemple:  
![](attachments/93356702/100009327.png)

![](attachments/93356702/100009326.png)

  

Com entrar a Git Bash directament des de la carpeta on tinguem muxv3\_tools

Farem click dret dins de la carpeta contenidora del projecte i obrirem el Git Bash directament per començar el procés de reindexació.  
![](attachments/93356702/100009322.png)

Reindexat a Elasticsearch a partir de les dades que hi ha a la BD de MUX 3
--------------------------------------------------------------------------

  

./reindex\_elasticsearch.sh <entorn> <data\_inici> <data\_fi> <interval\_hores> 

entorn: dev|pre|pro data\_inici: dd/mm/yyyyThh:mm:ss data\_fi: dd/mm/yyyyThh:hh:ss interval\_hores: 1-24. 
Es farà successives consultes amb rang de (data\_inici + (interval\_hores\*iteracio)) per a no executar consultes que tractin massa registres en una sola tacada.

Exemples: ./reindex\_elasticsearch.sh pro 06/07/2023T00:00:00 06/07/2023T23:59:59 2

**Aquesta eina agafa el que hi ha a la BD de MUX 3 entre les dates especificades i reindexa tota la informació contra els índexs tant amb format V2 com V3.  
**

**Com saber l'estat d'un registre al llençar l'script**

Quan llencem l'script, podem veure si els registres s'han creat o actualitzat, tal com es mostra en aquestes captures:  
  
Com es pot veure en aquesta captura, el registre amb id _10c2-9404-cdde-fdc4_..., es va actualitzar.  
![](attachments/93356702/100009331.png)  
  
En canvi, aquest registre, es veu que es el registre s'ha creat des de zero, perquè no existia previament.  
![](attachments/93356702/100009333.png)

  
Reindexat a Elasticsearch a partir de les dades que hi ha a la BD de MUX

./reindex\_mux2records.sh <entorn> <id\_inici> <id\_fi> <interval\_hores> 

entorn: dev|pre|pro id\_inici: identificador de bd del primer registre a tractar id\_fi: identificador de bd del darrer registre a tractar interval\_hores: 1-24. 
Es farà successives consultes amb rang de (id\_inici + (interval\_hores\*iteracio)) per a no executar consultes que tractin massa registres en una sola tacada. 

Exemples: ./reindex\_mux2records.sh pro 716324667 717324667 2

  

Aquesta eina agafa els registres (per ID) de MUX 2 (a Kyndryl) i reindexa tota la informació contra els índexs de la V2. En aquest cas no hi ha prou informació per a generar dades als índexs de la V3.

Consolidació a EACAT dels registres
-----------------------------------

./consolida\_eacat.sh <entorn> <data\_inici> <data\_fi> <interval\_hores> 

entorn: dev|pre|pro data\_inici: dd/mm/yyyyThh:mm:ss data\_fi: dd/mm/yyyyThh:hh:ss interval\_hores: 1-24. 
Es farà successives consultes amb rang de (data\_inici + (interval\_hores\*iteracio)) per a no executar consultes que tractin massa registres en una sola tacada. 

Exemples: ./consolida\_eacat.sh pro 06/07/2023T00:00:00 06/07/2023T23:59:59 2

  

Aquesta eina agafa els registres entre dates de MUX 3 i realitza les crides corresponents al servei de consolidació del registre EACAT.

Recreació dels XML V2 en local
------------------------------

  

./build\_local\_xml.sh <entorn> <data\_inici> <data\_fi> <interval\_hores> 

entorn: dev|pre|pro data\_inici: dd/mm/yyyyThh:mm:ss data\_fi: dd/mm/yyyyThh:hh:ss interval\_hores: 1-24. 
Es farà successives consultes amb rang de (data\_inici + (interval\_hores\*iteracio)) per a no executar consultes que tractin massa registres en una sola tacada. 

Exemples: ./build\_local\_xml.sh pro 06/07/2023T00:00:00 06/07/2023T23:59:59 2

  

Aquesta eina agafa els registres entre dates de MUX 3 i genera els XMLs que simulen el format de la V2 per a que el puguin visualitzar correctament a la consola d'administració del MUX.

Recreació dels XML V2 a Kyndryl
-------------------------------

./build\_remote\_xml.sh <entorn> <data\_inici> <data\_fi> <interval\_hores> 

entorn: dev|pre|pro data\_inici: dd/mm/yyyyThh:mm:ss data\_fi: dd/mm/yyyyThh:hh:ss interval\_hores: 1-24. 
Es farà successives consultes amb rang de (data\_inici + (interval\_hores\*iteracio)) per a no executar consultes que tractin massa registres en una sola tacada. 

Exemples: ./build\_remote\_xml.sh pro 06/07/2023T00:00:00 06/07/2023T23:59:59 2

  

Aquesta eina és la més important per a que MUX\_DESCARREGA funcioni, ja que genera els XMLs que simulen el format de la V2 i els envia cap a Kyndryl per a que s'insereixin a la BD de MUX 2. Sense aquests XMLs MUX\_DESCARREGA no pot funcionar, ja que la llista de documents es troba a aquests XMLs

Repàs dels rebuts no actualitzats
---------------------------------

./check\_rebuts.sh <entorn> <data\_inici> <data\_fi> <interval\_hores> 

entorn: dev|pre|pro data\_inici: dd/mm/yyyyThh:mm:ss data\_fi: dd/mm/yyyyThh:hh:ss interval\_hores: 1-24. 
Es farà successives consultes amb rang de (data\_inici + (interval\_hores\*iteracio)) per a no executar consultes que tractin massa registres en una sola tacada. 

Exemples: ./check\_rebuts.sh pro 06/07/2023T00:00:00 06/07/2023T23:59:59 2

  

  

Aquesta eina revisa les transaccions que tenen rebuts adjunts i si no consten encara a les dades indexades a Elasticsearch, realitza una nova indexació per a que les dades quedin reflectides i els serveis de consulta funcionin correctament.  
  

  

  

Attachments:
------------

![](images/icons/bullet_blue.gif) [muxv3\_tools.zip](attachments/93356702/93356703.zip) (application/zip)  
![](images/icons/bullet_blue.gif) [image2023-7-17\_11-25-59.png](attachments/93356702/93356704.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2024-2-16\_10-6-1.png](attachments/93356702/100009322.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2024-2-16\_10-13-9.png](attachments/93356702/100009326.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2024-2-16\_10-15-4.png](attachments/93356702/100009327.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2024-2-16\_10-23-8.png](attachments/93356702/100009330.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2024-2-16\_10-24-4.png](attachments/93356702/100009331.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2024-2-16\_10-28-38.png](attachments/93356702/100009333.png) (image/png)  

Document generated by Confluence on 02 June 2025 11:16

[Atlassian](http://www.atlassian.com/)