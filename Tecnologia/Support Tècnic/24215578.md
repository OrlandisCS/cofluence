Suport Tècnic : Groovy Fase 2 -> Transicionar ticket  

1.  [Suport Tècnic](index.md)
2.  [Suport Tècnic](13893782.md)
3.  [04 - Tècnica de sistemes + 24x7 + Padró](26313202.md)
4.  [Desplegaments](Desplegaments_26313538.md)
5.  [Documentació associada a la integració de Jenkins i Jira](22937719.md)

Suport Tècnic : Groovy Fase 2 -> Transicionar ticket
====================================================

Created by David Tejada on 20 June 2019

package jira.jenkins.aoc


import java.util.Date
def authString = "jenkins:jenkins\_aoc".bytes.encodeBase64().toString()



def passarIncidenciaProces={String ticket->
		
	def dataDesplegament = new Date().format('yyyy-MM-dd');
	
	// S'ha de ficar el json de post
	
	/\*
	id -> 11
	
	\*/
	def jsonUpdate = """
        {
            "transition":{
                "id":"11"
            },
            "fields": {
                "assignee": {
                    "name": "dtejada"
                      },
                 "customfield\_10013":"$dataDesplegament"
        
            },
            "update":{
                "comment":
                \[
                    {"add":
                        {"body": "Comencem el desplegament, passem a estat en Procés i fiquem la data de Desplegament"}
                    }
                \]
            }
        }
        """
	
	 return jsonUpdate

}


def post={ String url, String postContent ->
	
		def connection = url.toURL().openConnection()
		connection.addRequestProperty("Authorization", "Basic ${authString}")
		connection.addRequestProperty("Content-Type", "application/json; charset=UTF-8")
	
	
		connection.setRequestMethod("POST")
		connection.doOutput = true
	
		connection.outputStream.withWriter('UTF-8',{
			it.write(postContent)
			it.flush()
		})
	
		connection.connect()
	
		try {
			connection.content.text
		} catch (IOException e) {
			try {
				((HttpURLConnection)connection).errorStream.text
			} catch (Exception ignored) {
				throw e
			}
		}
	}
	
// Codi que s'haurà d'executar.

	println("Afegim la data de desplegament i transicionem a En Procés")

	def file = new File("variables.txt")
	def ticket = file.text
	//def ticket="DES-1735"
	
	def urlService = "https://contacte.aoc.cat/rest/api/2/issue/${ticket}/transitions"
	println(post(urlService, passarIncidenciaProces(ticket)))

	

  

Document generated by Confluence on 02 June 2025 11:17

[Atlassian](http://www.atlassian.com/)