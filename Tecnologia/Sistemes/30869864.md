Sistemes : Monitorització Splunk  

1.  [Sistemes](index.md)
2.  [Sistemes](Sistemes_13893749.md)
3.  [Operativa](Operativa_30869608.md)

Sistemes : Monitorització Splunk
================================

Created by Usuario desconocido (jlorenzo), last modified on 23 enero 2020

Definició
=========

Splunk és en producte destinar a recopilar, indexar i explotar les dades proporcionades per sistemes i aplicacions del Consorci AOC.

  

Accés
=====

Els enllaços són:

**Entorn MediaCloud**

[http://10.120.1.235/en-US/app/SOA/search](http://10.120.1.235/en-US/app/SOA/search)

**Entorn Nexica**

[http://aoc-cl-splunk:8000/en-US/account/login](http://aoc-cl-splunk:8000/en-US/account/login)

  

Les credencials estan guardades a la cartera de credencials i són col·lectives

  

Agregar una aplicació a Splunk
==============================

Per agregar una aplicació a Splunk hi ha 3 maneres:

*   Via un "universal forwarder" (agent instal·lable)
*   Via syslog
*   Via ubicació física de fitxers

En general i com a bona pràctica farem servir la primera opció: Redirecionador Universal

Per afegir una plataforma a Splunk ens cal considerar els punts següents:

*   Servidor d'Splunk
*   Hosts que volem instal·lar els agents
*   Fitxers de logs a analitzar
*   Dades internes del fitxer a analitzar
*   Índex ( ho considereram con un schema d'Oracle) al que pertanyen les dades
*   Format de les dades

Cal aportar aquesta informació quan fem una petició a NTT ( [https://portal.ntt.eu](https://portal.ntt.eu) ) per afegir una plataforma a Splunk 

  

Servidor d'Splunk
-----------------

Tenim per ara dues opcions:

*   _Splunk Entorn MediaCloud_
*   _Splunk Entorn Nexica_

Indiqueu a NTT a quin entorn integrem l'aplicació.

Hosts
-----

L'agent s'instal·larà a les màquines de la plataforma on resideixen els logs a monitoritzar.  Exemple:

Plataforma Nexica PSIS

Hosts: aoc-cl-psis-01, aoc-cl-psis-02, aoc-cl-psis-03, aoc-cl-psis-04

  

En casos excepcionals si el repositori de logs és en NFS es podria monitoritzar des d'una sola màquina tots els logs però perdríem la referència del "Host" que envia l'agent. En aquest cas caldria identificar el HOST pel nom del fitxer o afegint una variable dins del log que identifiqui el host des del que s'ha escrit ( que és una informació força important per determinar incidències ).

  

Fitxers a analitzar
-------------------

Quan demanem configurar un universal forwarder ( agent instal·lable) ens cal sobretot definir quins seran els logs a reenviar cap a Splunk. Això és pot definir mitjançant la ubicació i nom del fitxer en concret o mitjantçant una [regex](https://regexr.com/).

  

### Fitxer estàtic

El primer cas és per quan tenim un únic fitxer que monitoritzar.

Exemple

/var/splunk/statistics.log 

I un cop al dia podem rotar via cron o el propi software (tomcat):

/var/splunk/statistics.log-20-1-2020 <-- Fitxer rotat
/var/splunk/statistics.log-21-1-2020 <-- Fitxer rotat
/var/splunk/statistics.log-22-1-2020 <-- Fitxer rotat
/var/splunk/statistics.log <--- Fitxer vigent

En aquest cas l'agent únicament cal que monitoritzi el fitxer vigent. L'agent quedarà així:

\[monitor:///var/splunk/statistics.log\]

  

### Fitxer dinàmic ( o rotatiu)

A vegades els fitxer a monitoritzar no tenen sempre el mateix nom ja que el software (tomcat, per exemple) fa la rotació incloent cada dia un nom diferent:

/apps/tomcat/log/catalina.log-20-1-2020 <-- Fitxer rotat
/apps/tomcat/log/catalina.log-21-1-2020 <-- Fitxer rotat
/apps/tomcat/log/catalina.log-22-1-2020 <--- Fitxer vigent

  

D'aquesta manera no podem definir explícitament un nom a l'agent ja que cada dia canvia el nom del fitxer. En aquests casos, que hem d'evitar sempre que sigui possible, cal utilitzar expressions regulars per "seleccionar" els fitxer de la app o el servidor  que ens interessin i fer que l'agent directament monitoritzi el directori sencer on resideixen els fitxers.

Alhora haurem de filtrar els fitxers que ens interessen i els que no via: **_whitelist_** i **_blacklist_**, i és aquí on aplicarem la _regex_.

  

Exemple

Imaginem un directori amb molts fitxer "dinàmics" i que per tant no podem definir específicament. Ens cal monitoritzar el directori senser.

Al directori tenim:

/var/log/apache2/pl.eacat.net.access.2020-01-18.log
/var/log/apache2/pl.eacat.net.access.2020-01-19.log
/var/log/apache2/pl.eacat.net.access.2020-01-20.log
/var/log/apache2/pl.eacat.net.access.2020-01-21.log
/var/log/apache2/pl.eacat.net.error.2020-01-18.log
/var/log/apache2/pl.eacat.net.error.2020-01-19.log
/var/log/apache2/pl.eacat.net.error.2020-01-20.log
/var/log/apache2/pl.eacat.net.error.2020-01-21.log
/var/log/apache/mod\_pl\_jk.log

L'agent s'haurà de configurar monitoritzant tot el directori ( /var/log/apache2/ ) seleccionant (_**whitelist**_)  pl.eacat.net.\*.log però no (_**blacklist**_) el mod\_pl\_jk.log. La configuració quedaria així:

\[monitor:///var/log/apache2/\]
whitelist = pl\\.eacat\\.net.\*\\.log$
blacklist = mod\_pl\_jk\\.log

  

Un dels beneficis de l'agent és que és conscient de l'estat dels logs i no reenvia allò que ja ha processat. Si un fitxer no es veu modificat (amb un increment de contingut) l'agent no reenvia la informació que ja ha enviat i per tant és igual que monitoritzem tot el directori.

  

  

  

  

  

Document generated by Confluence on 07 junio 2025 00:13

[Atlassian](http://www.atlassian.com/)