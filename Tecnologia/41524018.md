Suport Tècnic : Càrrega massiva de destinataris  

1.  [Suport Tècnic](index.html)
2.  [Suport Tècnic](13893782.html)
3.  [02 - FAQ's serveis](26313393.html)
4.  [FAQ's ENOTUM](28705561.html)
5.  [eNOTUM - FLUX DEL SERVEI - Procediments i configuracions](eNOTUM---FLUX-DEL-SERVEI---Procediments-i-configuracions_36341299.html)

Suport Tècnic : Càrrega massiva de destinataris
===============================================

Created by Unknown User (otecjriquelme), last modified on 22 June 2022

Si una entitat ens indica que vol carregar massivament un gran número de destinataris a eNOTUM, i és molt tediós fer-ho manualment a través del Portlet, podem seguir aquest procediment i carregar-los nosaltres per darrera a BBDD.

  

No ho fem

En principi no fem càrrega massiva de destinataris. Si ens ho demanen, comentar internament.

  

  

Antic procediment

1 - Demanem les dades dels destinataris a l'entitat en forma de CSV.
--------------------------------------------------------------------

Necessitarem un CSV amb les dades de cada destinatari per executar la càrrega massiva.

Aquest CSV ha de tenir una forma concreta i ens l'ha de facilitar el usuari.

**Missatge tipus per l'usuari**

Hola,

Actualment no hi ha cap funcionalitat que permeti fer una càrrega massiva de destinataris a eNOTUM.

No obstant això, si ens faciliteu les dades podem carregar-ho nosaltres a la nostra BBDD pel darrera.

Per fer això, necessitaríem les següents dades en format CSV:

COGNOM\_1, COGNOM\_2, ID\_DOCUMENT\_PF, ID\_DOCUMENT\_PJ, ENTITAT, COD\_IDIOMA, NOM\_DESTINATARI, RAO\_SOCIAL, TIPUS\_DOCUMENT\_PF, TIPUS\_DOCUMENT\_PJ,EMAIL,TELEFON;GRUP

Tingueu en compte el següent:

*   COGNOM\_1 i COGNOM\_2 fan referència només a persones físiques. Si el destinatari es persona jurídica han de venir en null.
*   Les lletres "PF" o "PJ" fan referència a Persona Física i Persona Jurídica respectivament.
*   ENTITAT: El nom de l'entitat a la qual està lligat el destinatari.
*   COD\_IDIOMA: És el codi de l'idioma configurat pel destinatari, i pot prendre qualsevol d'aquests 3 valors (és important que estigui en minúscula):
    *   ca: Català
    *   es: Espanyol
    *   oc: Occità
*   NOM\_DESTINATARI: Només aplica per persona física, per jurídica ha de venir null.
*   RAO\_SOCIAL: Només aplica per persona Jurídica, i es correspon al "Nom". Per persona física ha de venir en null.
*   TIPUS\_DOCUMENT\_PF: Pot prendre un dels següents 2 valors:
    *   0: DNI
    *   1: PASSAPORT
*   TIPUS\_DOCUMENT\_PJ: Pot prendre un dels següents 2 valors:
    *   0: CIF
    *   1: VAT
*   EMAIL: Correu electrònic del destinatari. Pot ser null.
*   TELÈFON: Telèfon del destinatari. Pot ser null.
*   GRUP: Nom del grup on voleu que estigui lligat el destinatari. Si no ha d'estar lligat a cap grup, deixeu-ho null.

Si ens feu arribar un CSV amb aquestes dades, podem executar una càrrega massiva.

Restem a l'espera de la vostra resposta.

Salutacions,

  

El que estem fent és demanar un CSV amb les dades amb què omplirem la BBDD

  

2 - Modificacions sobre el CSV
------------------------------

Sobre el CSV que ens enviïn, hem de fer dues modificacions:

1.  **Afegir una columna a l'inici, amb el id únic** que ha de quedar en NULL:  
    ![](attachments/41524018/41524019.png)  
      
    
2.  **Canviar el nom de l'entitat (columna F) per el id\_entitat** de la taula _nt30.aoc\_nt\_entitat_. Ho hem de fer nosaltres perquè el usuari no pot aconseguir aquest codi:  
    Per fer-ho, cerquem:
    
    **Cerquem id\_entitat**
    
    select ee.id\_entitat
    from nt30.aoc\_nt\_entitat ee
    where ee.nom like '%%'; -- nom de l'entitat que demana la càrrega
    
    Agafarem el **id\_Entitat de la filla** (el més gran dels dos que es retornin) i el posarem a l'Excel, a la columna entitat. També substituirem el nom de la columna per ID\_ENTITAT, ha de quedar una cosa així:  
    ![](attachments/41524018/41524020.png)  
      
    
3.  **Canviar el nom del grup (columna N) per l'id del grup** de la _taula nt30\_aapp.aoc\_nt\_grup_. Ho hem de fer nosaltres perquè el usuari no pot aconseguir aquest codi:  
    Per fer-ho, cerquem:
    
    **Cerquem l'id del grup**
    
    select \* from nt30\_aapp.aoc\_nt\_grup gg
    where gg.id\_entitat = '152'
    and gg.nom like '%%'; --Nom grup que ens hagin indicat
    

Quan haguem fet aquests canvis, ens ha de quedar un Excel com el següent, en forma: [csvDestinataris.csv](attachments/41524018/41524021.csv)

  

3 - Executar la millora per generar script de càrrega.
------------------------------------------------------

Una vegada ja tenim el CSV amb les dades  i la forma correcta, li passarem aquest CSV a la millora perquè ens generi el script de càrrega.

Per fer-ho:

1.  Generem el directori: _C:\\temp\\destinataris_
2.  Deixem el CSV al següent directori amb el següent nom: C:\\temp\\destinataris\\csvDestinataris.csv
3.  Executem la millora, que ens guardarà el script que necessitem al següent directori: C:\\temp\\destinataris\\scriptCarrega.txt  
    Per executar la millora. Aquí deixem el codi compilat, només cal descarregar i executar:  [c**arrega-destinataris.jar**](attachments/41524018/61931578.jar) (per executar-lo, obrir terminal : java -jar carrega-destinataris.jar)  
    I també tenim el codi font al gitHub: **_[https://github.com/OTSuportTecnic/carrega-destinataris](https://github.com/OTSuportTecnic/carrega-destinataris)_**

4 - Executar script de càrrega
------------------------------

Si tot ha anat bé, arribats a aquest punt hauríem de tenir el script de càrrega per executar-lo a la BBDD.

Hauria de ser un script com el que pugem a continuació, d'exemple: [scriptCarrega.txt](attachments/41524018/41524024.txt)

Per executar-lo, el copiem a la BBDD de eNOTUM AAPP: nt30\_aapp@ORA12PRO i l'executem. No hauria de trigar més de 10 segons.

  

  

  

Tiquets relacionats: FP #427877 Jira:  [ST-13298](https://contacte.aoc.cat/browse/ST-13298?src=confmacro) - Data cannot be retrieved due to an unexpected error.

  

  

  

Attachments:
------------

![](images/icons/bullet_blue.gif) [image2021-8-19\_12-36-54.png](attachments/41524018/41524019.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2021-8-19\_12-50-46.png](attachments/41524018/41524020.png) (image/png)  
![](images/icons/bullet_blue.gif) [csvDestinataris.csv](attachments/41524018/41524022.csv) (text/csv)  
![](images/icons/bullet_blue.gif) [csvDestinataris.csv](attachments/41524018/41524021.csv) (text/csv)  
![](images/icons/bullet_blue.gif) [scriptCarrega.txt](attachments/41524018/41524024.txt) (text/plain)  
![](images/icons/bullet_blue.gif) [carrega-destinataris.jar](attachments/41524018/61931879.jar) (application/octet-stream)  
![](images/icons/bullet_blue.gif) [carrega-destinataris.jar](attachments/41524018/61931578.jar) (application/octet-stream)  

Document generated by Confluence on 02 June 2025 10:53

[Atlassian](http://www.atlassian.com/)