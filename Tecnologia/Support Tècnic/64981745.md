Suport Tècnic : Canvi d'endpoint al servei d'SMS de Vodafone  

1.  [Suport Tècnic](index.md)
2.  [Suport Tècnic](13893782.md)
3.  [04 - Tècnica de sistemes + 24x7 + Padró](26313202.md)
4.  [FAQs Infraestructura](FAQs-Infraestructura_26313593.md)
5.  [Sistemes de contingència](41518098.md)

Suport Tècnic : Canvi d'endpoint al servei d'SMS de Vodafone
============================================================

Created by Unknown User (otecobernal), last modified by OTEC ST JAlejandro Cardete Postigo on 12 April 2024

La Generalitat ofereix un WS per enviar SMS, des de dos endpoints diferents

[http://sms.gencat.cat/SIC/indice.html](http://sms.gencat.cat/SIC/indice.html)

[https://smsgencatpro.itsoft.es/SIC/indice.html](https://smsgencatpro.itsoft.es/SIC/indice.html)

  

Alguna vegada, per problemes de disponibilitat del primer endpoint (que és el que tenim configurat), s'ha necessitat canviar-lo a les configuracions dels nostres sistemes per evitar la pèrdua de servei.

Els endpoints estan configurats al VÀLid MC, VÀLid NX i a una aplicació de l'MSC desplegada al WL12 (CAOC-PCI30-MSC-SMS.war).

  

VÀLid MC
--------

Per veure l'aplicació desplegada al BEA8 dedicat del Vàlid de Kyndryl haurem d'accedir a la consola: [http://10.124.70.2:8001/console](http://10.124.70.2:8001/console) i cliacar sobre **Applications**:

![](attachments/64981745/64981780.png)

Obtindrem un llistat de les aplicacions desplegades al BEA8, de les quals necessitarem obtenir la ruta de l'aplicació [prjServeisComunsSMS](http://10.124.70.2:8001/console/actions/mbean/EditMBeanAction?reloadNav=false&MBean=PCIDomain%3AName%3DprjServeisComunsSMS%2CType%3DApplication): **/apps/bea/beaplat/user\_projects/domains/PCIDomain/PCIAdmin/upload/prjServeisComunsSMS.ear**

![](attachments/64981745/64981781.png)

Des del WinSCP podrem accedir a la ruta i descarregar l'arxiu .ear:

![](attachments/64981745/64981782.png)

Un cop descarregada l'aplicació podrem obrir-la com si fos un arxiu comprimit:

![](attachments/64981745/64981783.png)

L'endpoint configurat es troba dins de la carpeta **APP-INF\\lib\\** sota una llibreria **.jar** que podem descomprimir:

![](attachments/64981745/64981784.png)![](attachments/64981745/64981785.png)

Dins del .jar, a la ruta **cat\\aoc\\serveiscomuns\\sms\\** trobarem un fitxer de properties on s'especifica la connexió contra el servei dels SMS:

![](attachments/64981745/64981786.png)

Si obrim el properties veurem el TO configurat per la crida WS i l'endpoint, que en aquest cas és fa a través d'un proxy: [http://smsproxy.aoc.cat/wsAdaptorAuth/ws](http://smsproxy.aoc.cat/wsAdaptorAuth/ws)

![](attachments/64981745/64981787.png)

Si fem un ping contra el host, obtindrem resposta des del primer frontal de valid MC dedicat:

![](attachments/64981745/64981788.png)

Ens haurem de connectar contra aquest host i revisar la configuració del proxy (**/etc/httpd/conf.d/sites**):

![](attachments/64981745/64981789.png)

Si obrim el fitxer, veurem l'endpoint real del servei extern d'enviament d'SMS:

![](attachments/64981745/64981790.png)

Si volem canviar l'endpoint haurem de fer un backup del fitxer i pujar un fitxer nou amb el nou endpoint. Finalment haurem de fer un graceful per aplicar els canvis:

sudo /etc/init.d/httpd graceful

Després de fer els canvis podrem validar que el servei segueix funcionat, per exemple, accedint a e-NOTUM ciutadà amb idCAT Mòbil  
[![](https://contacte.aoc.cat/secure/thumbnail/80092/_thumb_80092.png)](https://contacte.aoc.cat/secure/attachment/80092/80092_screenshot-9.png "screenshot-9.png")  
[![](https://contacte.aoc.cat/secure/thumbnail/80086/_thumb_80086.png)](https://contacte.aoc.cat/secure/attachment/80086/80086_screenshot-3.png "screenshot-3.png")

VÀLid NX
--------

Podem fer el mateix que a Kyndryl, i arribarem a un proxy, però aquest cop estarà configurat a tots els frontals del cluster (**/mnt/aoc/httpd**).

Si la ruta està compartida, només necessitarem fer el canvi a un node i aplicar els canvis a tots els nodes (**graceful**).

MSC
---

Les proves amb VÀLid han funcionat però per l'admin de la MTI les peticions d'ENVIAR\_SMS (MSC) continuaven fallant:  
[![](https://contacte.aoc.cat/secure/thumbnail/80094/_thumb_80094.png)](https://contacte.aoc.cat/secure/attachment/80094/80094_screenshot-11.png "screenshot-11.png")

Revisant he vist que hi ha un war desplegat a NT i APP:  
[![](https://contacte.aoc.cat/secure/thumbnail/80095/_thumb_80095.png)](https://contacte.aoc.cat/secure/attachment/80095/80095_screenshot-12.png "screenshot-12.png")

He canviat l'endpoint i redesplegat el paquet:  
[![](https://contacte.aoc.cat/secure/thumbnail/80096/_thumb_80096.png)](https://contacte.aoc.cat/secure/attachment/80096/80096_screenshot-13.png "screenshot-13.png")  
[![](https://contacte.aoc.cat/secure/thumbnail/80097/_thumb_80097.png)](https://contacte.aoc.cat/secure/attachment/80097/80097_screenshot-14.png "screenshot-14.png")

Adjunto el war original per tornar a fer el canvi quan es solucioni la incidència a vodafone:  
[CAOC-PCI30-MSC-SMS.war.2022\_06\_11\_04\_36\_11![](https://contacte.aoc.cat/images/icons/link_attachment_7.gif)](https://contacte.aoc.cat/secure/attachment/80098/80098_CAOC-PCI30-MSC-SMS.war.2022_06_11_04_36_11 "CAOC-PCI30-MSC-SMS.war.2022_06_11_04_36_11 attached to ST-17023")

Ja es veuen les peticions OK:  
[![](https://contacte.aoc.cat/secure/thumbnail/80099/_thumb_80099.png)](https://contacte.aoc.cat/secure/attachment/80099/80099_screenshot-15.png "screenshot-15.png")

Attachments:
------------

![](images/icons/bullet_blue.gif) [clave acceso 3.png](attachments/64981745/64981746.png) (image/png)  
![](images/icons/bullet_blue.gif) [clave acceso 2.png](attachments/64981745/64981747.png) (image/png)  
![](images/icons/bullet_blue.gif) [clave acceso.png](attachments/64981745/64981748.png) (image/png)  
![](images/icons/bullet_blue.gif) [Keypass.jpg](attachments/64981745/64981749.jpg) (image/jpeg)  
![](images/icons/bullet_blue.gif) [image2020-7-16\_15-22-26.png](attachments/64981745/64981750.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2020-7-16\_15-21-30.png](attachments/64981745/64981751.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2020-7-16\_15-20-53.png](attachments/64981745/64981752.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2020-7-16\_15-17-11.png](attachments/64981745/64981753.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2020-7-16\_15-13-26.png](attachments/64981745/64981754.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2020-7-16\_15-9-49.png](attachments/64981745/64981755.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2020-7-16\_15-9-19.png](attachments/64981745/64981756.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2020-7-16\_15-6-18.png](attachments/64981745/64981757.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2020-7-16\_15-5-12.png](attachments/64981745/64981758.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2020-7-16\_14-58-1.png](attachments/64981745/64981759.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2020-7-16\_14-56-2.png](attachments/64981745/64981760.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2020-7-16\_14-53-44.png](attachments/64981745/64981761.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2020-7-16\_14-53-26.png](attachments/64981745/64981762.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2020-7-16\_14-50-50.png](attachments/64981745/64981763.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2020-7-16\_14-49-24.png](attachments/64981745/64981764.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2022-6-13\_19-44-38.png](attachments/64981745/64981780.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2022-6-13\_19-45-40.png](attachments/64981745/64981781.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2022-6-13\_19-46-57.png](attachments/64981745/64981782.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2022-6-13\_19-48-0.png](attachments/64981745/64981783.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2022-6-13\_19-48-46.png](attachments/64981745/64981784.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2022-6-13\_19-49-54.png](attachments/64981745/64981785.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2022-6-13\_19-51-7.png](attachments/64981745/64981786.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2022-6-13\_19-51-50.png](attachments/64981745/64981787.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2022-6-13\_19-53-28.png](attachments/64981745/64981788.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2022-6-13\_19-54-23.png](attachments/64981745/64981789.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2022-6-13\_19-56-28.png](attachments/64981745/64981790.png) (image/png)  

Document generated by Confluence on 02 June 2025 11:18

[Atlassian](http://www.atlassian.com/)