Suport Tècnic : Revisió HÈSTIA  

1.  [Suport Tècnic](index.html)
2.  [Suport Tècnic](13893782.html)
3.  [04 - Tècnica de sistemes + 24x7 + Padró](26313202.html)
4.  [Revisió de serveis](36340340.html)
5.  [HÈSTIA - Revisions i Restabliment](41521272.html)

Suport Tècnic : Revisió HÈSTIA
==============================

Created by Unknown User (otecobernal), last modified on 17 February 2021

Escalat d'incidències:
======================

Telèfon d'escalat

Si es confirma que l’accés a l’Hèstia no funciona correctament i la incidència no s’ha pogut resoldre reiniciant els servidors IIS, caldrà escalar amb la màxima urgència possible la incidència a **Sergio Gutiérrez** al telèfon **+34 675 78 28 16** en horari 24x7.

Accés als components de l'Hèstia
================================

Accés als components de l'arquitectura

Els servidors de gestió permeten accedir de forma directa a la majoria dels recursos que es necessiten per identificar l’origen de la incidència així com per intentar solucionar-la.

Com a bona pràctica s’ha d’intentar evitar en la mida del possible l’**accés directe** per escriptori remot a qualsevol dels servidors que composen els 3 components principals de l’Hèstia. Haurem de connectar-nos a través dels servidors de gestió:

*   **_hestia-pro-gs01_** (20.67.88.3)
*   **_hestia-pro-gs02_** (20.71.138.180)

  

Aquests 2 servidors actuen com a porta d’entrada a tota la infraestructura de l'Hèstia (**AD**, **BD**, **IIS**).

  

Fitxers de log de l’Hèstia
==========================

Accedir als fitxers de log

Per accedir als logs de l’Hèstia (ubicats als frontals IIS), es pot accedir des de l'explorador de Windows dels **servidors de gestió**, accedint a la següent ruta:

*   \\\\10.8.3.4\\c$\\Hestia\\Hestia
*   \\\\10.8.3.5\\c$\\Hestia\\Hestia

L'Hèstia disposa d'uns fitxers de log on queden enregistrats tots els errors que es produeixen a nivell de servidor, aquest logs ens donen la informació necessària per identificar l’origen de la incidència. Aquests fitxers són els següents:

*   \\\\10.8.3.4\\c$\\Hestia\\Hestia\\HestiaWS.txt
*   \\\\10.8.3.5\\c$\\Hestia\\Hestia\\HestiaWS.txt

![](attachments/41521556/41521557.png)

Introducció i arquitectura bàsica de l’Hèstia
=============================================

Introducció al servei

El present document descriu les principals incidències que es poden donar en el servei Hèstia i com s'ha de procedir per a reconèixer-les i intentar solucionar-les.

  

La infraestructura de  l’Hèstia es troba virtualitzada sobre el cloud d’Azure que en l’actualitat ens ofereix CTTI. A continuació es presenta la descripció dels diferents servidors que conformen l’arquitectura de l’Hèstia.

  

A nivell lògic l’Hèstia es composa de 3 components principals:

*   Frontal IIS 10 (IIS)
*   Active Directory (AD)
*   Base de dades SQL Server 2019 (BD)

  

Tots aquests components es troben en alta disponibilitat (2 servidors per component lògic) i per motius de seguretat cap dels servidors (ni tan sols els frontals) disposa d’IP pública. Per poder realitzar qualsevol gestió sobre l’Hèstia s’ha d’accedir via escriptori remot a qualsevol dels 2 servidors de gestió que estan habilitats per a aquest propòsit: _hestia-pro-gs01_ (20.67.88.3) i _hestia-pro-gs02_ (20.71.138.180).

Aquests 2 servidors actuen com a porta d’entrada a tota la infraestructura de l'Hèstia (AD,BD,IIS).

  

Cal tenir en compte 2 punts importants per accedir via escriptori remot als servidors de gestió:

*   Cadascun dels servidors permet com a molt la connexió simultània de dos usuaris. Per l’experiència que tenim, en ocasions (p. ex. quan l’usuari anterior no tanca correctament la sessió) alguna d’aquestes sessions es queda penjada i no és possible reciclar-la. En aquests casos cal intentar accedir amb l’altra sessió disponible i intentar forçar el tancament de la sessió penjada per tal que quedi disponible per a un futur accés.

  

En el cas que no fos possible accedir a un dels servidors de gestió, s’ha d’intentar amb l’altre servidor (recordant que tenim 2 possibles sessions concurrents) i si tampoc és possible (en molt rares ocasions ha passat) no hi ha cap altra opció que reiniciar els servidors de gestió segons el procediment que es descriu a l’apartat 4 - Solucionar problemes connexió escriptori remot.

*   Per motius de seguretat només és possible accedir als servidors de gestió accedint des de la IP pública d’oficines de l’AOC. Això implica que si es requereix accedir-hi estant fora de l’oficina de l’AOC s’haurà de tenir connectada la VPN amb la xarxa de l’AOC.

  

Un altre punt important que cal destacar és que els servidors de gestió permeten accedir de forma directa a la majoria dels recursos que es necessiten per identificar l’origen de la incidència així com per intentar solucionar-la. Com a bona pràctica s’ha d’intentar evitar en la mida del possible l’accés per escriptori remot a qualsevol dels servidors que composen els 3 components principals de l’Hèstia (AD, IIS i BD):

*   Per accedir als logs de l’Hèstia (ubicats als frontals IIS), es pot accedir des de l'explorador de Windows dels servidors de gestió, accedint a la següent ruta:
    *   \\\\10.8.3.4\\c$\\Hestia\\Hestia
    *   \\\\10.8.3.5\\c$\\Hestia\\Hestia
*   Per accedir a la BD, es pot accedir directament amb el client SQL Server Management que hi ha instal·lat a qualsevol dels 2 servidors de gestió:

![](attachments/41521556/41521577.png)

*   Per accedir als AD, també es pot fer des dels servidors de gestió:

![](attachments/41521556/41521578.png)

  

  

Incidències més habituals
=========================

Si la sonda de l’Hèstia detecta un error, el primer que caldrà fer és comprovar si realment es tracta d’una incidència o d’una falsa alarma. A continuació indiquem les incidències més habituals que ens podem trobar, com confirmar si realment es tracta d’una incidència i què podem fer per intentar solucionar-la.

1\. El servei Hèstia no mostra la pantalla de login

L’aplicació Hèstia és una aplicació d’escriptori que es distribueix i s’actualitza de forma automàtica fent ús de la tecnologia ClickOnce de Microsoft. ClickOnce el primer que fa quan s’executa l’Hèstia és comprovar si hi ha publicada una nova versió per descarregar-la i instal·lar-la de forma transparent a l’usuari.

Si a l’obrir l’Hèstia no surt la pantalla de login o si surt i es tanca automàticament en pocs segons, és possible que un o els dos frontals estiguin caiguts o no responguin correctament, amb el que l’Hèstia no funcionarà.

Aquest comportament és dóna quan el ClickOnce no aconsegueix accedir a la web de l’Hèstia ([https://hestia.aoc.cat](https://hestia.aoc.cat)) per comprovar si hi ha una nova versió publicada i en aquest cas automàticament tanca el servei.

AJS.toInit(function() { aptis.plugins.serverStatus.startAjaxRequestHttpRequest('APTIS\_65840', 'https://confluence.aoc.cat/rest/serverStatus/1.0/service/httpRequest', 'https://hestia.aoc.cat', '30'); AJS.$('#APTIS\_65840').click(function(e) { if (!AJS.$('#APTIS\_65840').hasClass('loading')) { aptis.plugins.serverStatus.updateUserInterface("loading", "", 'APTIS\_65840'); aptis.plugins.serverStatus.startAjaxRequestHttpRequest('APTIS\_65840', 'https://confluence.aoc.cat/rest/serverStatus/1.0/service/httpRequest', 'https://hestia.aoc.cat', '30'); } }); });

.rwui\_text\_box.rwui\_id\_d36f2794-78f1-4c73-9a56-3f2d6f7bd58f {background-color: #E9F7E9; color: #32561F;}.rwui\_text\_box.rwui\_id\_d36f2794-78f1-4c73-9a56-3f2d6f7bd58f \*:not(.rwui\_content) {color: #32561F;}.rwui\_text\_box.rwui\_id\_d36f2794-78f1-4c73-9a56-3f2d6f7bd58f span.rwui\_icon {color: #32561F;}

Confirmació de la incidència
----------------------------

Si a l’executar el client de l’Hèstia no apareix la pantalla de login o si l’Hèstia es tanca automàticament en pocs segons, el primer que caldria fer és accedir al portal de l’Hèstia i confirmar si apareix un contingut similar al següent:

![](attachments/41521556/41521579.png)

En cas contrari, hauríem d’aplicar el procediment de resolució que es detalla en l’apartat **Resolució de la incidència**.

2\. El servei Hèstia no permet fer login

Si la pantalla de l’Hèstia es mostra correctament, el següent que caldrà fer és autenticar-nos a l’Hèstia per confirmar si el servei funciona correctament. Per fer-ho abans caldrà tenir instal·lat el client de l’Hèstia al nostre equip. Si no ho tenim instal·lat, podem fer-ho en qualsevol moment descarregant el client  des de la pàgina [https://hestia.aoc.cat](https://hestia.aoc.cat) (recordeu que caldrà tenir instal·lada la versió del .NET framework que indiquem en la pàgina de l’Hèstia!)

  

L’accés a l’Hèstia requereix d’usuaris nominals i també disposar d’un certificat digital o bé d’una contrasenya d’un sol ús que cal enregistrar. Per accedir haurem d’indicar les següents dades a la pantalla de login:

*   Entitat: _FORMACIO_
*   Usuari: el nostre nom d’usuari (es tracta d’un usuari nominal exclusiu per a cada usuari)
*   Contrasenya: la nostra contrasenya (si no la recordem, podem demanar-ne una de nova amb l’opció “_He oblidat la contrasenya_”)

![](attachments/41521556/41521580.png)

  

Finalment si disposem de certificat digital hem de fer clic a l’opció _Accedeix amb certificat_ i en cas contrari a l’opció _Accedeix_.

  

Amb qualsevol d’aquestes 2 opcions, si tot ha anat bé, hauríem de veure una pantalla similar a la següent (aquesta pantalla però, pot trigar 1 ó 2 minuts en carregar per l’actualització en local de les taules mestres)

![](attachments/41521556/41521581.png)

Si apareix aquesta pantalla vol dir que l’Hèstia funciona correctament i que es tracta d’una falsa alarma, no caldrà per tant que fem res més. En cas contrari, hauríem d’aplicar el procediment de resolució que es detalla en l’apartat **Resolució de la incidència**.

Resolució de la incidència
==========================

Resolució de la incidència

En un primer moment s’ha d’intentar provar a reiniciar els serveis IIS dels frontals _hestia-pro-is01_ i _hestia-pro-is02_. En aquest cas sí que estem obligats a accedir per escriptori remot a aquests servidors a través dels servidors de gestió _hestia-pro-gs01_ i _hestia-pro-gs02_.

Una vegada dins el frontal, caldria executar la comanda _iisreset_ des de  la consola executada en mode administrador:

![](attachments/41521556/41521582.png)

També és possible reiniciar-ho executant l’ordre _Restart_ directament a l’IIS:

![](attachments/41521556/41521583.png)

Si una vegada reiniciats els IISs l’Hèstia continua donant els mateixos problemes, s’hauria de fer un reinici dels servidors _hestia-pro-is01_ i _hestia-pro-is02_.

  

Una vegada reiniciat els servidors s’ha d’activar el següent servei:

*   VPN: Activar la VPN tal i com es detalla a l’apartat _Connexió VPN_ d’aquest document.

Connexió VPN
============

Connexió VPN

L’Hèstia requereix per al seu funcionament de 3 connexions VPN amb el CPD corporatiu de l’AOC. Actualment es gestionen aquestes 3 connexions VPN amb un client _OpenVPN_ que està instal·lat en els següents servidors:

  

*   Frontals: **_hestia-pro-is01_** i **_hestia-pro-is02_**. La VPN es fa servir per a la sincronització entre l’Hèstia i Footprints, per a l’enviament dels correus i per a l’accés a la PCI.  
    Tots aquests usos són crítics per al bon funcionament de l’Hèstia i és molt important que les connexions VPN estiguin operatives en tot moment.
*   Servidor de **gestió _hestia-pro-gs01_**. La VPN s’utilitza per sincronitzar el backup de la BD amb l’entorn de DR que tenim al CPD de l’AOC. A diferència de les altres 2 connexions VPN de l’apartat anterior, aquest ús no és crític per al bon funcionament de l’Hèstia tot i que és molt recomanable que també estigui operativa.

Malauradament no és possible iniciar el client VPN de forma automatitzada (tot i que es pot configurar el client _OpenVPN_ com a servei de Windows i configurar-ho per executar-se de forma automatitzada a l’inici del servidor, en la pràctica la targeta de xarxa no acaba d’arrencar correctament i tot i que la connexió VPN s’estableix, no arriba a enrutar cap paquet). Per aquest motiu cada vegada que es reinicia algun d’aquests 3 servidors, caldrà iniciar manualment el client _OpenVPN_ d’acord al procediment que a continuació s’especifica:

  

Executar el client OpenVPN que es troba a l’escriptori, com administrador:

![](attachments/41521556/41521584.png)

  

1.  Connectar la VPN mitjançant la icona que apareix al costat del rellotge de Windows:  
    ![](attachments/41521556/41521585.png)
2.  Apareixerà una nova finestra i caldrà esperar a veure el _Successful_:  
    ![](attachments/41521556/41521586.png)
3.  Comprovar que la connexió VPN estigui establerta:
    1.  Comprovar que el client estigui connectat:  
        ![](attachments/41521556/41521587.png)
    2.  Comprovar el ping a algunes de les IPs següents:
        
        Host
        
        IP
        
        serveis3
        
        10.127.4.60
        
        serveis3
        
        10.127.4.61
        
        relay.aoc.cat
        
        10.127.4.90
        
        Footprints
        
        10.127.1.73
        
        EACAT
        
        10.127.1.251
        
        Hèstia
        
        10.127.1.225
        

**NOTES**: Si hi hagués qualsevol problema amb la connexió, ja sigui perquè no s’obté el _Successful_ o perquè no s’arriba als PING tot i que el client aparegui com a _Connected_, cal seguir els següents passos:

1.  Desconnectar el client VPN:  
    ![](attachments/41521556/41521591.png)
2.  Obrir les Propietats de la targeta de xarxa de la VPN:  
    ![](attachments/41521556/41521590.png)
3.  Tanquem les Propietats, sense fer-hi cap canvi:  
    ![](attachments/41521556/41521589.png)
4.  Connectem de nou el client VPN:  
    ![](attachments/41521556/41521588.png)

Attachments:
------------

![](images/icons/bullet_blue.gif) [image2021-1-18\_13-39-21.png](attachments/41521556/41521557.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2021-1-18\_13-25-16.png](attachments/41521556/41521558.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2021-1-18\_13-25-1.png](attachments/41521556/41521559.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2021-1-18\_13-24-30.png](attachments/41521556/41521560.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2019-3-4\_17-39-16.png](attachments/41521556/41521561.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2019-3-4\_17-39-51.png](attachments/41521556/41521562.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2019-3-4\_17-30-58.png](attachments/41521556/41521563.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2020-2-17\_17-58-41.png](attachments/41521556/41521564.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2020-2-24\_15-23-29.png](attachments/41521556/41521565.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2019-11-12\_16-6-19.png](attachments/41521556/41521566.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2019-11-12\_16-8-3.png](attachments/41521556/41521567.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2019-11-12\_16-7-49.png](attachments/41521556/41521568.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2019-11-12\_16-7-53.png](attachments/41521556/41521569.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2019-11-12\_16-8-13.png](attachments/41521556/41521570.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2020-2-24\_13-7-16.png](attachments/41521556/41521571.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2020-3-12\_20-0-37.png](attachments/41521556/41521572.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2020-3-12\_20-8-32.png](attachments/41521556/41521573.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2020-3-12\_20-16-1.png](attachments/41521556/41521574.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2020-2-24\_13-5-56.png](attachments/41521556/41521575.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2020-2-24\_13-11-56.png](attachments/41521556/41521576.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2021-2-17\_16-45-12.png](attachments/41521556/41521577.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2021-2-17\_16-45-37.png](attachments/41521556/41521578.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2021-2-17\_16-50-7.png](attachments/41521556/41521579.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2021-2-17\_16-51-24.png](attachments/41521556/41521580.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2021-2-17\_16-51-53.png](attachments/41521556/41521581.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2021-2-17\_16-52-29.png](attachments/41521556/41521582.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2021-2-17\_16-52-40.png](attachments/41521556/41521583.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2021-2-17\_16-53-4.png](attachments/41521556/41521584.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2021-2-17\_16-54-26.png](attachments/41521556/41521585.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2021-2-17\_16-54-34.png](attachments/41521556/41521586.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2021-2-17\_16-54-44.png](attachments/41521556/41521587.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2021-2-17\_16-58-17.png](attachments/41521556/41521588.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2021-2-17\_16-58-30.png](attachments/41521556/41521589.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2021-2-17\_16-58-38.png](attachments/41521556/41521590.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2021-2-17\_16-58-46.png](attachments/41521556/41521591.png) (image/png)  

Document generated by Confluence on 02 June 2025 11:12

[Atlassian](http://www.atlassian.com/)