Suport Tècnic : Monitor S.T. - SIRI - Entitats amb més de 30K errors al SIRI en l'últim mes  

1.  [Suport Tècnic](index.html)
2.  [Suport Tècnic](13893782.html)
3.  [03 - Monitorització - Revisions globals](26313327.html)
4.  [Monitors S.T.](Monitors-S.T._41522177.html)

Suport Tècnic : Monitor S.T. - SIRI - Entitats amb més de 30K errors al SIRI en l'últim mes
===========================================================================================

Created by Unknown User (otecjriquelme), last modified by Unknown User (otecobernal) on 05 July 2021

Què mesura aquest monitor?

Mesura les entitats amb més de 30000 consums que el SIRI no ha autoritzat en l'últim mes.

L'objectiu és detectar si alguna entitat està fallant sistemàticament en l'autenticació/autorització al SIRI i tractar-ho directament amb ells.

La sonda s'executa el primer dia de cada mes.

  

**Consulta**
============

* * *

select rr.codi\_organisme, count(rr.id) as "Peticions no autoritzades"
from siri.aoc\_pci\_siri\_registre rr
where rr.data\_entrada >= sysdate -30
and rr.autoritzada = 0
group by rr.codi\_organisme
having count(rr.id) >= 30000
order by count(rr.id) desc

Count de les peticions no autoritzades i s'agrupa per entitat.

**Procediment**
===============

* * *

Per cada entitat que superi el llindar establert, s'obrirà un tiquet JIRA que s'assignarà al botPadró

El procediment serà:

Revisar error concret que està rebent l'entitat
-----------------------------------------------

Per revisar això, podem fer una extracció de les peticions en error d'aquesta entitat i buscar-ne alguna als logs del SIRI.

**Extracció peticions**

select \*
from siri.aoc\_pci\_siri\_registre rr
where rr.data\_entrada >= sysdate -30
and rr.autoritzada = 0
and rr.codi\_organisme = 'XXXXXXXXX' -- INE10 de l'organisme que vulguem revisar
order by rr.data\_entrada desc;

Agafem una petició de les que ha quedat en error i cerquem per id\_Petició als logs del SIRI (indicats al final d'aquesta FAQ) del dia en que haguem rebut la petició.

Revisar les peticions per dia
-----------------------------

Amb la següent consulta podrem veure si els errors d'autorització es concentren en un dia en concret, o si és quelcom recurrent:

select TO\_CHAR(data\_entrada, 'YYYY') "Any",
       TO\_CHAR(data\_entrada, 'MM') "Mes",
       TO\_CHAR(data\_entrada, 'DD') "Dia",
       count(\*) "Peticions no autoritzades"
  from siri.aoc\_pci\_siri\_registre rr
 where rr.data\_entrada >= sysdate - 30
   and rr.autoritzada = 0
   and rr.codi\_organisme = 'XXXXXXXXX' -- INE10 de l'organisme que vulguem revisar
 group by TO\_CHAR(data\_entrada, 'YYYY'),
          TO\_CHAR(data\_entrada, 'MM'),
          TO\_CHAR(data\_entrada, 'DD')
 order by TO\_CHAR(data\_entrada, 'YYYY'),
          TO\_CHAR(data\_entrada, 'MM'),
          TO\_CHAR(data\_entrada, 'DD') desc;

Contactar amb l'entitat
-----------------------

Una vegada hem revisat quin error estan obtenint, comentarem amb ST i haurem de contactar amb l'entitat per avisar-los i demanar que ho corregeixin.

**Missatge tipus**

Bon dia,

Hem detectat que durant l'últim mes heu obtingut un número molt alt d'errors atacant al SIRI: **XXXXX** errors.

Esteu obtenint aquests errors quan intenteu realitzar consums pel servei: **XXXXXX**. I esteu obtenint l'error:

**XXXXXXXXXXX ------- ERROR --------- XXXXXXXXXXXX**

Podeu revisar-ho, si us plau?

Si necessiteu més informació, indiqueu-nos-ho.

Salutacions

És l'entitat qui està enviant els consums erronis contra el SIRI, així que ho han d'arreglar ells. Per la nostra banda només podem donar-los suport en l'error que reben, dates de consums, etc.

**Informació addicional**
=========================

* * *

### 1) Revisió de logs

Podrem trobar els logs a:

EndPoint

Màquina

Rutes

[https://serveis.iop.aoc.cat/siri-proxy/services/Sincron](https://serveis.iop.aoc.cat/siri-proxy/services/Sincron)

aoc-l-app1

10.120.1.20

/apps/aoc/IOP/logs/SWATProxy\_node?-pro.log

[https://serveis.app.aoc.cat/siri-proxy/services/Sincron](https://serveis.app.aoc.cat/siri-proxy/services/Sincron)

/apps/aoc/APP/logs/SWATProxy\_node?-pro.log

[https://serveis3.iop.aoc.cat/siri-proxy/services/Sincron](https://serveis3.iop.aoc.cat/siri-proxy/services/Sincron)

aoc-l-soa01 - pro

10.120.1.163

/apps/aoc/IOP/logs/SWATProxy\_node?-pro.log

[https://serveis3.app.aoc.cat/siri-proxy/services/Sincron](https://serveis3.app.aoc.cat/siri-proxy/services/Sincron)

/apps/aoc/APP/logs/SWATProxy\_node?-pro.log

[https://serveis3.nt.aoc.cat/siri-proxy/services/Sincron](https://serveis3.nt.aoc.cat/siri-proxy/services/Sincron)

/apps/aoc/NT/logs/SWATProxy\_node?-pro.log

_\*\* El més probable és que estiguin apuntant als nous endPoints (serveis3)._

  

2) Model de dades

esquema@bbdd ==> SIRI@ORA12

Taula amb la informació d'accessos: siri.aoc\_pci\_siri\_registre

####   
  

####   
  

Attachments:
------------

![](images/icons/bullet_blue.gif) [cds.gif](attachments/41523598/41523599.gif) (image/gif)  

Document generated by Confluence on 02 June 2025 11:09

[Atlassian](http://www.atlassian.com/)