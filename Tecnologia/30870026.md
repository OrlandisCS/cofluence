Suport Tècnic : VO - VIDA LABORAL- FLUX DEL SERVEI - ERRORS - getSingleResult() did not retrieve any entities  

1.  [Suport Tècnic](index.html)
2.  [Suport Tècnic](13893782.html)
3.  [02 - FAQ's serveis](26313393.html)
4.  [FAQ's VO](28705575.html)
5.  [FAQ's VO - ESTAT](28705579.html)
6.  [VO - TGSS](VO---TGSS_36340977.html)

Suport Tècnic : VO - VIDA LABORAL- FLUX DEL SERVEI - ERRORS - getSingleResult() did not retrieve any entities
=============================================================================================================

Created by Unknown User (oteccmorales), last modified by Cristian Morales on 12 January 2024

  

Cerquem la petició al SIRI:

select \* from siri.aoc\_pci\_siri\_registre r
where r.codi\_producte = 'TGSS\_VIDA\_LABORAL'
and r.codi\_organisme = '824575017'
and r.codi\_modalitat = 'VIDA\_LABORAL'
and r.data\_entrada >= to\_Date ('27/01/2020','dd/mm/yyyy');

Amb el ID\_PETICIO cerquem als logs de TGSS - VIDA LABORAL

IP: SOA PCI3 (_10.120.1.163_)

Ruta:  _/mnt/storage30/aoc/IOP/logs/MC-TGSS-MINHAP\_IOPNODO?\_SOA.log_

Busquem per data i hora/ INE10 de l'ens o ID\_PETICIO que ha fet la petició XML.  Hauríem de **trobar l'XML de petició i l'error**.

L'error que tractem en aquesta FAQ és:

**Error que trobem als logs**

27 Jan 2020 14:55:29,927 ERROR TGSSModalitats : javax.persistence.NoResultException: getSingleResult() did not retrieve any entities.
        at org.eclipse.persistence.internal.jpa.QueryImpl.throwNoResultException(QueryImpl.java:976)
        at org.eclipse.persistence.internal.jpa.QueryImpl.getSingleResult(QueryImpl.java:526)
        at org.eclipse.persistence.internal.jpa.EJBQueryImpl.getSingleResult(EJBQueryImpl.java:400)
        at cat.aoc.pci30.core.entities.DIR3.getDIR3(DIR3.java:45)
        at cat.aoc.pci30.modalitats.tgssminhap.TGSSModalitats.getPeticionSCSP(TGSSModalitats.java:211)
        at cat.aoc.pci30.modalitats.tgssminhap.TGSSModalitats.VIDA\_LABORAL(TGSSModalitats.java:106)
        at cat.aoc.pci30.modalitats.tgssminhap.TGSSModalitats.procesa(TGSSModalitats.java:93)

Podem veure  que es tracta d'un **error el qual no troba dades referent al DIR3.**

Aquest error es deu a que no està l'ens configurat amb el DIR3. Abans d'enviar la petició al MINHAP, es fa una consulta a la taula **dir3.dir3\_2\_ine10\_uo** per tal d'obtenir el DIR3 de l'entitat a partir de l'INE10.

Si aquesta consulta no retorna resultat, la petició fallarà amb l'error dels logs.

Per tant, realitzarem les següents **comprovacions a la Base de Dades del DIR3**:

Username: DIR3  
Database: ORA12PRO  
Password: Keepass

**Comprovem quants DIR3 hi ha associats a l'ens i si estan actius**

SELECT COD\_EXTERNO, CODIGO
  FROM DIR3\_UNIDAD\_ORGANICA
 WHERE COD\_EXTERNO = 'XXXXXXXXXX' -- 10 dígits (CODI INE).
   AND ESTADO IN ('V', 'T');
 
Ex: Codi INE d'exemple 0819445020

Amb aquesta QUERY revisem:

*   Quants DIR3 hi ha associats a un mateix ine10
*   Quin és l'estat d'aquests DIR3 (V/A) (Vigente/Anulado)

Si obtenim dades en la consulta o no, hem de revisar la FAQ → **En el cas de no estar el DIR3 : [DIR3- FLUX DEL SERVEI - Actualitzar el DIR3 amb dades d'un nou ens que no surt#ModificarProceduresDIR3](64980222.html#DIR3FLUXDELSERVEIActualitzarelDIR3ambdadesd'unnouensquenosurt-ModificarProceduresDIR3)**

  

  

**En el cas de no estar el DIR3 : [DIR3- FLUX DEL SERVEI - Actualitzar el DIR3 amb dades d'un nou ens que no surt#ModificarProceduresDIR3](64980222.html#DIR3FLUXDELSERVEIActualitzarelDIR3ambdadesd'unnouensquenosurt-ModificarProceduresDIR3)**

  

A tindre en compte

El funcionament amb aquest servei és:

Agafa el INE10 del XML (en el cas de tindre "0" a l'esquerra els afegeix) i el cerca en la taula :

select \* from dir3.dir3\_2\_ine10\_uo ou
where ou.dir3='A09006701' ;

Una vegada l'ha cercat, valida que estigui en la següent taula i estigui vigent (V):

select \* from dir3.dir3\_unidad\_organica a 
where a.denominacion like '%Generalitat de Cat%'; 

En el cas de PICA, si el INE10 informat es "PICA", el transformarà a l'INE10 de la Gene "000000001" i farà la mateixa cerca.

\---dir3 TGSS\_VIDA\_LABORAL GENE, ha d'estar rel·lacionada la taula dir3.dir3\_unidad\_organica a amb dir3.dir3\_2\_ine10\_uo ou i que estigui Vigent
select \* from dir3.dir3\_unidad\_organica a  -- cerquem si està en aquesta taula i agafem el COD\_UNIDAD\_RAIZ
where a.denominacion like '%Generalitat de Cat%'; --A09006701 (para PRE)  ha d'estar Vigent (V)

select \* from dir3.dir3\_2\_ine10\_uo ou
where ou.dir3='A09006701' ;

query que realitza el codi:

public String getDIR3 (String ine10) throws Exception {  
      EntityManager em = null;  
    try {  
      em = EntityManagerFactoryHolder.getInstance().getEntityManager(DIR3\_PU).createEntityManager();  
      Query qry = em.createNativeQuery("SELECT CODIGO FROM DIR3\_UNIDAD\_ORGANICA WHERE COD\_EXTERNO=? AND ESTADO IN ('V','T')");  
      qry.setParameter(1,"PICA".equals(ine10) ? "0000000001" : String.format("%010d",Long.valueOf(ine10)));  
      return (String)qry.getSingleResult();        
    }  
    finally {  
      if (null != em) em.close();  
    }  
  
  }//getDIR3

  

  

  

  

FP Relacionats: FP #321182 

  

Attachments:
------------

![](images/icons/bullet_blue.gif) [image2020-1-28\_11-18-45.png](attachments/30870026/30870027.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2020-1-28\_11-48-46.png](attachments/30870026/30870028.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2020-8-6\_11-26-40.png](attachments/30870026/41518430.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2020-8-6\_11-27-13.png](attachments/30870026/41518431.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2020-10-8\_10-17-8.png](attachments/30870026/41519302.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2020-10-8\_10-17-24.png](attachments/30870026/41519303.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2020-10-8\_10-19-43.png](attachments/30870026/41519304.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2020-10-8\_10-21-57.png](attachments/30870026/41519305.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2020-10-8\_10-22-43.png](attachments/30870026/41519306.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2020-10-8\_10-23-2.png](attachments/30870026/41519307.png) (image/png)  

Document generated by Confluence on 02 June 2025 11:02

[Atlassian](http://www.atlassian.com/)