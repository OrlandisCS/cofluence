Suport Tècnic : VO - CORPME - FLUX DEL SERVEI - COMUNICACIÓ - Fer un reenviament per recuperar la resposta de Reg. Prop  

1.  [Suport Tècnic](index.md)
2.  [Suport Tècnic](13893782.md)
3.  [02 - FAQ's serveis](26313393.md)
4.  [FAQ's VO](28705575.md)
5.  [FAQ's VO - Col·legis Professionals](28705581.md)
6.  [VO - CORPME](VO---CORPME_36340973.md)

Suport Tècnic : VO - CORPME - FLUX DEL SERVEI - COMUNICACIÓ - Fer un reenviament per recuperar la resposta de Reg. Prop
=======================================================================================================================

Created by Unknown User (oteccmorales), last modified by Cristian Morales on 13 May 2024

Problema
--------

En el cas que es produís una aturada del servei (incidència puntual, error en algún pase amb algún correctiu al respecte...) i consums realitzats finalitzessin abans d'obtenir resposta per part del CORPME. Abans de tornar a fer un consum (no fer-ho ja que és de **_pagament_**), amb la nova versió del servei, es consulta un callback amb les respostes obtingudes del CORPME.

Solución
--------

RDBMS desactivat

Per poder fer el reenviament haurem d'activar l'RDBMS que s'encarrega de processar-ho:

![](attachments/28704791/41518233.png)

Activat:

![](attachments/28704791/41518234.png)

  

Després l'haurem de tornar a deixar _**desactivat**_.

Reiniciar APP si no procesa els consums

10.120.1.163 WL12 PRO

![](attachments/28704791/100010438.png)

![](attachments/28704791/100010439.png).

![](attachments/28704791/100010440.png)

  

Realitzar les següents accions:

1.  Ficar la fila de la taula pròpia de registradors per tal de fer un reenviament:
    
    update aoc\_mcregistradors\_id set reenviar=1 where id\_peticio='1568618047052924';
    
    Hem d'activar el RDBMS perquè l'agafi :
    
2.  ![](attachments/28704791/64981854.png)
3.  Revisar que la resposta que genera el CORPME ens retorna el pdf.
    
4.  select \* from Aoc\_Mcregistradors\_Msg a -- Resposta del CORPME
    where a.id\_peticio = '2512070005\_REGISTRE\_PROPIETAT\_9816125';
    
5.  ![](attachments/28704791/28704792.png)  
    
6.  Si ho retorna correctament, hem d’actualitzar la taula amb el valor de rebut a 1:
    
    update aoc\_mcregistradors\_id set rebuda=1 where id\_peticio='1568618047052924';
    
7.  Actualitzem la PCI correctament per tal que faci el processament de les dades. → Validar el procediment segons estat petició i sol : [Monitor S.T. - CORPME - Sol·licituds\\Peticions en estat inconsistents#EnaquestcasvalidemlapartdelCORPME](64981725.html#MonitorS.T.CORPMESol·licituds\Peticionsenestatinconsistents-EnaquestcasvalidemlapartdelCORPME)
    
    UPDATE
    PCI\_MTI\_PETICIO SET ESTAT=2 WHERE ID\_PETICIO='1568618047052924';
    
    
    UPDATE
    PCI\_MTI\_SOLICITUD SET ESTAT=5, EXECUTADA=0 WHERE ID\_PETICIO=(SELECT ID FROM
    PCI\_MTI\_PETICIO WHERE ID\_PETICIO='1568618047052924');
    
    
    DELETE FROm
    PCI\_MTI\_XML WHERE TIPUS=5 AND ID\_PETICIO=(SELECT ID FROM PCI\_MTI\_PETICIO WHERE
    ID\_PETICIO='1568618047052924');
    
    
    DELETE FROm
    PCI\_MTI\_XML WHERE TIPUS=4 AND ID\_PETICIO=(SELECT ID FROM PCI\_MTI\_PETICIO WHERE
    ID\_PETICIO='1568618047052924');
    
    
    commit;
    
8.  Si va tot bé, hauria de quedar-se en finalitzada a la PCI:
    
    ![](attachments/28704791/28704793.png)  
      
    

Per tal que en EACAT es visualitzin les dades correctament (apartat SIRI/LOTS)

Hi ha un procés en el liferay que actualitza el que es visualitza en EACAT:

Hem de validar en BBDD:

![](attachments/28704791/64981685.png)

Cerquem per usuari (nif funcionari que ha fet els consums)

select count(\*), estat from vo\_peticio where id\_usuari='46944247M' and data\_peticio > sysdate -1 group by estat;

select \* from vo\_peticio where id\_usuari='46944247M' and data\_peticio > sysdate -1;

ZD#[https://aoccat.zendesk.com/agent/tickets/7836](https://aoccat.zendesk.com/agent/tickets/7836)

Exemple
-------

Click here to expand...

FP#364990

  

Una usuària ens comenta que ha rebut una factura d'unes notes simples que no va demanar.

  

1.  Revisem al SIRI les peticions del ens
    
    \-- SIRI: Peticions de la Dip. de NOTA\_SIMPLE
    select \* from siri.aoc\_pci\_siri\_registre r
    where r.codi\_producte = 'REGISTRE\_PROPIETAT'
    and r.codi\_modalitat = 'NOTA\_SIMPLE'
    and r.codi\_organisme = '8001760009'
    and r.frontal = 'Asincron'
    and r.data\_entrada > sysdate - 60
    order by r.data\_entrada desc
    
2.  Revisem les peticions a la PCI, però estan purgades
    
    \-- MTI: Peticions de la Dip. de NOTA\_SIMPLE
    select \* from pci30iop.pci\_mti\_solicitud s,  pci30iop.pci\_mti\_peticio p
    where s.id\_peticio = p.id
    and p.codi\_producte = 'REGISTRE\_PROPIETAT'
    and s.modalitat\_consum = 'NOTA\_SIMPLE'
    and p.codi\_ens = '8001760009'
    
3.  Revisem a la bdd dels registradors per les notes que no tenen constància i veiem que provenen de la mateixa petició.
    
    \-- REGISTRADORS: Factures de la Dip. de NOTA\_SIMPLE
    SELECT \* FROM MCPCIIOP.AOC\_MCREGISTRADORS\_ID 
    where id\_floti in (
    'F14NZ14U0', 'F14QM99P5'
    )
    
4.  Petició purgada
    
    \-- MTI: Peticio purgada
    select \* from pci30iop.pci\_mti\_audit a
    where a.id\_peticio in (
    '8001760009\_REGISTRE\_PROPIETAT\_5134930' -- F14QM99P5, F14NZ14UO
    )
    
5.  A la BBDD dels registradors podem veure com per la petició es disposa de 3 notes simples, dos de les quals no es van enviar (rebuda=0)
    
    \-- MTI: Peticio purgada
    select \* from pci30iop.pci\_mti\_audit a
    where a.id\_peticio in (
    '8001760009\_REGISTRE\_PROPIETAT\_5134930' -- F14QM99P5, F14NZ14UO
    )
    
6.  Reinici (només les afectades → rebuda = 0)
    
    update aoc\_mcregistradors\_id set reenviar=1 
    where id\_peticio='8001760009\_REGISTRE\_PROPIETAT\_5134930'
    and rebuda = '0';
    

  

**Explicació**: La usuària va fer peticions de notes simples al maig. Una de les peticions contenia 3 notes simples i només es va enviar una. Les altres dos es van quedar bloquejades. Al juny es van reiniciar les peticions bloquejades a la MTI i es van processar les factures. La usuària va rebre una factura al maig i una altra al juny (però si tot hagués anat correctament, hauria d'haver rebut una única factura al maig amb l'import de les dues factures rebudes). Es torna a forçar l'enviament de la factura perquè la usuària rebi a Nota Simple que ja ha pagat.

  

  

Artículos Relacionados
----------------------

*   Page:
    
    [Monitors Amposta](/display/SII/Monitors+Amposta)
    
*   Page:
    
    [Informe Preinscripcions escolars](/display/SII/Informe+Preinscripcions+escolars)
    
*   Page:
    
    [PADRO - Canvi IP](/display/SII/PADRO+-+Canvi+IP)
    
*   Page:
    
    [JENKINS](/display/SII/JENKINS)
    
*   Page:
    
    [RDBMS PCIv3 - Recrear](/display/SII/RDBMS+PCIv3+-+Recrear)
    

  

Incidencias similares

JIRA - [https://contacte.aoc.cat/browse/ST-5892](https://contacte.aoc.cat/browse/ST-5892)

  

Attachments:
------------

![](images/icons/bullet_blue.gif) [image2019-9-18\_11-32-1.png](attachments/28704791/28704792.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2019-9-18\_11-33-19.png](attachments/28704791/28704793.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2020-7-23\_13-30-4.png](attachments/28704791/41518233.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2020-7-23\_13-30-44.png](attachments/28704791/41518234.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2022-6-7\_16-32-42.png](attachments/28704791/64981685.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2022-6-20\_12-22-22.png](attachments/28704791/64981854.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2024-5-13\_12-24-1.png](attachments/28704791/100010438.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2024-5-13\_12-24-20.png](attachments/28704791/100010439.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2024-5-13\_12-24-40.png](attachments/28704791/100010440.png) (image/png)  

Document generated by Confluence on 02 June 2025 11:01

[Atlassian](http://www.atlassian.com/)