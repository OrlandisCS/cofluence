Suport Tècnic : VO - AEAT - Càrrega setmanal de certificats  

1.  [Suport Tècnic](index.md)
2.  [Suport Tècnic](13893782.md)
3.  [01 - Gestió Operativa](26313391.md)
4.  [Tasques complementàries](26313409.md)

Suport Tècnic : VO - AEAT - Càrrega setmanal de certificats
===========================================================

Created by Unknown User (obernalp), last modified by Joan Riquelme on 02 April 2025

Els certificats que fan servir les entitats públiques pel servei de l'AEAT són certificats que estan cedits al Consorci AOC, i això vol dir que és l'AOC qui custodia la clau privada d'aquests certificats.

Per a més informació sobre com cedir o renovar aquest certificat es pot consultar les següents FAQs:

*   [https://suport-viaoberta.aoc.cat/hc/ca/articles/4415416792209-Com-renovar-un-certificat-de-Segell-per-fer-%25C3%25BAs-dels-serveis-d-AEAT-](https://suport-viaoberta.aoc.cat/hc/ca/articles/4415416792209-Com-renovar-un-certificat-de-Segell-per-fer-%25C3%25BAs-dels-serveis-d-AEAT-)

Pas 1: Certificats a carregar i informació necessària
-----------------------------------------------------

Cada renovació ha de tenir un tiquet propi a la plataforma del **ZenDesk**.

Aquests tiquets estaran agrupats a la vista: **Càrrega certificats cedits**.

![](attachments/26313467/81856116.png)  

Amb un títol de l'estil: _Renovació certificat per Via Oberta AEAT_.

Aquest procés de càrrega està automatitzat amb una millora, tot i això, a continuació explicarem tant el procés manual com el procés automatitzat.

  

Procés manual

Pas 0: Què necessitem?
----------------------

Per renovar un certificat de l'AEAT, o per carregar-ne un de nou, necessitem:

*   Arxiu P12 que conté clau pública + clau privada del certificat que l'ens ha cedit en exclusivitat a l'AOC. → Podem trobar-lo a la ruta de SharePoint: (Sharepoint) Tecnologia - SUPORT\_TECNIC\\CERTIFICATS\\CERTIFICATS\_CEDITS
*   Password del certificat que l'ens ha cedit en exclusivitat a l'AOC. → Podem trobar-lo al keepass que es troba en la ruta de SharePoint: (Sharepoint) Tecnologia - SUPORT\_TECNIC\\CERTIFICATS\\CERTIFICATS\_CEDITS\\ESTADIS\_CERTIFICATSCEDITS\_25052018.kdbx
*   INE10 de l'ens → Ens l'indicaran en el tiquet ZenDesk associat a la càrrega.
*   CIF de l'ens. → Ens l'indicaran en el tiquet ZenDesk associat a la càrrega.

  

Pas 1: Preparar l'entorn de desplegament.
-----------------------------------------

Prepararem les carpetes en xarxa on deixarem els arxius necessaris per la càrrega de certificats.

Tots els certificats que es carreguen (fitxers .p12) s'hauran de copiar a la carpeta del desplegament. A continuació un exemple que s'ha d'adaptar a la data actual:

*   \\\\192.168.166.33\\Desplegaments\\2018\\10 - Octubre\\24102018\\**PRO-AS@AEAT**

És possible que haguem de crear nosaltres part del path en xarxa.

  

Pas 2: Fer backup del fitxer properties que modificarem.
--------------------------------------------------------

Ens descarregarem el fitxer properties on estan tots els certificats configurats.

Amb el WinsSCP ens connectarem al SOA de PCI3.

Un cop connectats accedirem a la ruta **/mnt/storage30/aoc/certs/AEAT** i descarregarem el fitxer **certificats-pro.properties.**

Dins de la carpeta del desplegament (que hem creat en el pas anterior), crearem una carpeta amb el nom de backup i copiarem aquest fitxer properties.

  

Pas 3: Preparar els possibles canvis en el fitxer properties.
-------------------------------------------------------------

Un cop realitzat el backup, editarem un fitxer que haguem guardat fora de la carpeta backup.

Buscarem dins del fitxer, fent ús del Notepad++, per l'INE10 del ENS:

Si el certificat ja existeix, trobarem el següent:

#P0801100I/801160009: segell ajuntament de avia (ec-sectorpublic)  
P0801100I=801160009  
801160009.cif=P0801100I  
801160009.factory=SUN  
801160009.type=JKS  
801160009.file=/apps/aoc/certs/AEAT/801160009.jks  
801160009.storepass=changeit  
801160009.alias=segell ajuntament de avia (ec-sectorpublic)  
801160009.keypass=changeit

Si no existeix, haurem de crear una entrada nova seguint el mateix format (només haurem de canviar l'INE10, l'àlies i el CIF en tots els llocs on s'informa, comentari inclòs):

![](attachments/26313467/26317594.png)

  

Pas 4: Preparar els certificats per carregar-los.
-------------------------------------------------

Els ens ens han cedit un certificat en format .p12, però nosaltres necessitem convertir-nos en .jks per carregar-lo a les nostres plataformes.

Per tant, per a cada certificat, haurem de fer el següent:

Amb l'ajuda del programa KeyStore Explorer crearem un arxiu nou en format JKS. File→ New:

![](attachments/26313467/26317600.png)

  

Després importarem un certificat en format .p12:

![](attachments/26313467/26317617.png)

  

Al camp Descryption Password escriurem la clau del certificat informada al KeePass. Després buscarem el certificat a la ruta de certificats i l'obrirem:

![](attachments/26313467/26317607.png)

  

Si tot va bé ens carregarà el certificat i ens deixarà modificar el seu àlies:

![](attachments/26313467/26317581.png)

  

Abans d'acceptar haurem d'escriure l'àlies que hi ha informat al fitxer properties.

Després ens demanarà una contrasenya on escriurem **changeit**, ja que és la que hi ha configurada al fitxer properties també:

![](attachments/26313467/26317595.png)

  

Finalment guardarem l'arxiu a la carpeta del desplegament:

![](attachments/26313467/26317588.png)

  

També haurem de guardar el fitxer properties si l'hem modificat. En acabar, hauríem de tenir quelcom tipus (poden haver-hi més certificats .jks):

![](attachments/26313467/26317568.png)

  

Haurem de tenir un .jks per cada certificat a renovar.

  

Pas 4: Aplicar els canvis
-------------------------

Finalment copiarem els nous certificats i l'arxiu properties a la ruta  **/mnt/storage30/aoc/certs/AEAT.**

Un cop hem reemplaçat tots els arxius, els canvis no es veuran reflectits, ja que no es poden realitzar en calent.

Perquè aquests canvis s'apliquin haurem de reiniciar els 3 nodes d'**IOP** del **WebLogic12** de PRO.

Per més informació podem consultar la [PCI3 - WL12 - Reinici](PCI3---WL12---Reinici_41520945.md) [](https://steps.everis.com/confluence/pages/viewpage.action?pageId=1106383121)sobre com reiniciar-lo.

Procés automatitzat.

Podem accedir a la millora: [https://github.com/OTSuportTecnic/carrega-certificats](https://github.com/OTSuportTecnic/carrega-certificats) i clonar-la al nostre IDE, per exemple IntelliJ.

La millora que tenim desenvolupada automatitza tot el procés de preparació de càrrega dels certificats.

Per tant, quan l'executem, hauríem d'obtenir un resultat final d'aquest estil:

![](attachments/26313467/81856117.png)

  

Aqui veiem com la millora:

*   Ha fet backup dels certificats que ja estaven carregats al SOA de PCI3 (que haurien d'estar ja caducats o a punt de caducar).
*   També ha guardat els P12 que ens han cedit en exclusivitat els ens (aquests NO estan a punt de caducar, són els nous).
*   Ha generat els JKS, amb el àlies adequat, la password adequada, etc., i els ha guardat en xarxa perquè nosaltres els pugem al SOA de PCI3.
*   A la foto no ho veiem, però en el cas que hi hagués un nou certificat, la millora també s'hauria descarregat el fitxer properties que hi ha desplegat al SOA (**/mnt/storage30/aoc/certs/AEAT/certificats-pro.properties**) hauria afegit un nou bloc pel certificat nou, i també hauria guardat un backup.

Una vegada la millora ens ha deixat tots els arxius preparats, tan sols ens quedarà aplicar els canvis al SOA.

Copiarem els nous certificats i l'arxiu properties a la ruta  **/mnt/storage30/aoc/certs/AEAT.**

Només si s'ha modificat el fitxer properties, caldrà reiniciar el clúster IOP de WL12.

Per més informació podem consultar la [PCI3 - WL12 - Reinici](PCI3---WL12---Reinici_41520945.md) [](https://steps.everis.com/confluence/pages/viewpage.action?pageId=1106383121)sobre com reiniciar-lo.

Per acabar: Gestionar els tiquets ZD i enregistrar la tasca al JIRA
-------------------------------------------------------------------

Una vegada haguem carregat els certificats, gestionarem els tiquets ZenDesk fent ús de la macro: **Escalat >> Certificat carregat.**

**![](attachments/26313467/81856118.png)**

  

Aquesta tasca s'imputa en un JIRA mensual.

  

Attachments:
------------

![](images/icons/bullet_blue.gif) [image2018-11-9\_14-18-14.png](attachments/26313467/26317684.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2018-11-6\_12-24-8.png](attachments/26313467/26317698.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2018-11-6\_12-29-41.png](attachments/26313467/26317696.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2018-11-6\_12-30-51.png](attachments/26313467/26317694.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2018-11-6\_12-30-54.png](attachments/26313467/26317693.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2018-11-6\_11-34-45.png](attachments/26313467/26317690.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2018-11-6\_11-41-25.png](attachments/26313467/26317688.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2018-11-6\_12-41-1.png](attachments/26313467/26317687.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2018-11-6\_12-50-27.png](attachments/26313467/26317686.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2018-11-6\_15-48-46.png](attachments/26313467/26317685.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2018-12-12\_13-0-44.png](attachments/26313467/26317637.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2018-12-12\_13-3-12.png](attachments/26313467/26317639.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2018-12-12\_13-5-38.png](attachments/26313467/26317603.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2018-12-12\_13-8-33.png](attachments/26313467/26317601.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2018-12-12\_13-9-12.png](attachments/26313467/26317600.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2018-12-12\_13-10-14.png](attachments/26313467/26317617.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2018-12-12\_13-13-40.png](attachments/26313467/26317607.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2018-12-12\_13-17-19.png](attachments/26313467/26317581.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2018-12-12\_13-24-10.png](attachments/26313467/26317594.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2018-12-12\_13-25-36.png](attachments/26313467/26317595.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2018-12-12\_13-27-17.png](attachments/26313467/26317588.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2018-12-12\_13-28-56.png](attachments/26313467/26317568.png) (image/png)  
![](images/icons/bullet_blue.gif) [SCSP\_AEAT-soapui-project.xml](attachments/26313467/26317575.xml) (text/xml)  
![](images/icons/bullet_blue.gif) [image2018-12-12\_13-41-56.png](attachments/26313467/26317576.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2018-12-12\_13-52-26.png](attachments/26313467/26317557.png) (image/png)  
![](images/icons/bullet_blue.gif) [CARREGA-CERTIFICATS-AEAT-soapui-project.xml](attachments/26313467/26315039.xml) (text/xml)  
![](images/icons/bullet_blue.gif) [image2020-7-28\_12-2-11.png](attachments/26313467/41518269.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2020-7-28\_12-3-35.png](attachments/26313467/41518270.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2020-7-28\_12-4-46.png](attachments/26313467/41518271.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2020-7-28\_12-5-47.png](attachments/26313467/41518272.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2020-7-28\_12-9-45.png](attachments/26313467/41518275.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2023-4-14\_13-58-26.png](attachments/26313467/81856116.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2023-4-14\_14-32-6.png](attachments/26313467/81856117.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2023-4-14\_14-42-21.png](attachments/26313467/81856118.png) (image/png)  

Document generated by Confluence on 02 June 2025 10:49

[Atlassian](http://www.atlassian.com/)