Suport Tècnic : 4 - Configuració dels certificats  

1.  [Suport Tècnic](index.html)
2.  [Suport Tècnic](13893782.html)
3.  [04 - Tècnica de sistemes + 24x7 + Padró](26313202.html)
4.  [Revisió de serveis](36340340.html)
5.  [PADRO - Revisions i Restabliment](PADRO---Revisions-i-Restabliment_118554712.html)
6.  [Padró - Instal·lació i manteniment](26313622.html)
7.  [PADRO - Instal·lació de l'aplicació](26313260.html)

Suport Tècnic : 4 - Configuració dels certificats
=================================================

Created by Unknown User (obernalp), last modified by Unknown User (otecobernal) on 24 January 2020

Per tal d'instal·lar els certificats del padró, necessitarem disposar tant de la clau pública com la clau privada en un arxiu .p12 o .jks. També necessitarem les contrasenyes dels certificats.

Si necessitem consultar les dades dels certificats, podem veure la següent FAQ, [NEW - PADRO - Obtenir la data dels certificats CDA i CDS](https://steps.everis.com/confluence/display/AOC/NEW+-+PADRO+-+Obtenir+la+data+dels+certificats+CDA+i+CDS?src=contextnavpagetreemode), on s'explica com extreure la data de caducitat un cop el padró està funcionant (ens pot ser útil per verificar que he instal·lat correctament el certificat).

Instal·lació CDS

Deixarem el certificat CDS a la carpeta _C:\\aoc\_padro\\appHome\\certs_

Una vegada hem deixat el certificat en la carpeta, modificarem les dades en el fitxer server.xml. Dins d'aquest fitxer modificarem o inserirem si no existeix el següent codi:

![](attachments/26313264/26316962.png)

  

<Connector port="\[Port\]" protocol="org.apache.coyote.http11.Http11NioProtocol"
           maxThreads="150" SSLEnabled="true" scheme="https" secure="true"
           clientAuth="false" sslProtocol="TLS"
           sslEnabledProtocols="TLSv1,TLSv1.1,TLSv1.2"
           keystoreFile="\[Ruta al certificat\]"
           keystorePass="\[Password\]"/>

On:

*   **\[Port\]** Inserirem el port pel qual accedirem al servidor, utilitzant el certificat. Habitualment aquest port serà 8443.
*   **\[Ruta al certificat\]** serà la ruta del certificat que hem copiat anteriorment.
*   **\[Password\]** Inserirem la contrasenya del certificat.

Instal·lació CDA

Deixarem el certificat CDA a la carpeta _C:\\aoc\_padro\\appHome\\certs_

Una vegada hem copiat el certificat, modificarem els següents fitxers:

1.  C:/aoc\_padro/appHome/cfg/config.xml
2.  C:/aoc\_padro/appHome/webRoot/WEB-INF/classes/crypto-keystore.properties
3.  C:/aoc\_padro/appHome/webRoot/WEB-INF/server-config.wsdd

#### config.xml

<!-- KEYSTORE -->
 <PluginConfig classname="com.tecsidel.aoc.ayuntamiento.commons.firma.ConfigFirmaFactory">
 <Param key="firmaFactory.id" value="ksPadron"/>
 <Param key="firmaFactory.transforms" value="http://www.w3.org/2001/10/xml-exc-c14n#"/>
 <Param key="firmaFactory.canonicalizer" value="http://www.w3.org/2001/10/xml-exc-c14n#"/>
 <Param key="ks.alias" value="\[Alias\]"/>
 <Param key="ks.factory" value="BC"/> <!-- SUN per JKS i BC per PKCS12 -->
 <Param key="ks.storepass" value="\[Password\]"/>
 <Param key="ks.type" value="PKCS12"/> <!-- JKS, PKCS12 -->
 <Param key="ks.keypass" value="\[Password\]"/>
 <Param key="ks.file" value="\[Ruta al certificat\]"/>
 </PluginConfig>

####   
crypto-keystore.properties

\# Implementación del interface Crypto.
# Merlin está basada en JDK1.(usa keystore)
org.apache.ws.security.crypto.provider=org.apache.ws.security.components.crypto.Merlin

# The path to the keystore file. At first the classloader tries to load this file, 
# if this fails the implementations performs a file system lookup. 
org.apache.ws.security.crypto.merlin.file=\[Ruta al certificat\]

# The keystore type, for example JKS for the Java key store. 
# Other keystore type, such as pkcs12 are also possible but depend on the actual 
# Crypto implementation.
org.apache.ws.security.crypto.merlin.keystore.type=PKCS12

# The password to read the keystore. If this property is not set, 
# then the pwcallbackproperty must be defined.
org.apache.ws.security.crypto.merlin.keystore.password=\[Password\]
org.apache.ws.security.crypto.merlin.keystore.provider=BC
org.apache.ws.security.crypto.merlin.keystore.alias=\[Alias\]
org.apache.ws.security.crypto.merlin.alias.password=\[Password\]
#org.apache.ws.security.crypto.merlin.cert.provider=PKCS12

#org.apache.ws.security.crypto.merlin.keystore.type=JKS
#org.apache.ws.security.crypto.merlin.keystore.provider=SUN
#org.apache.ws.security.crypto.merlin.file=C:/aoc\_padro/appHome/certs/CDA.jks

####   
server-config.wsdd

En aquest fitxer només s'haurà d'introduir l'àlies del certificat 3 cops.

Per fer-ho podem obrir el fitxer amb el Notepad++ i buscar **name="user" value="** Aquesta caden apareixerà 3 cops al document i haurem de posar l'**àlies** del certificat. Normalment l'àlies que posem és **AOC**, per tant quedaria **name="user" value="aoc":**

**![](attachments/26313264/26316992.png)  
**

  
[.rwui\_id\_be21acb2-f6dd-46c4-b5d3-8ae968372bf1 {color: #FFFFFF !important; background: rgb(67,197,208);}.rwui\_id\_be21acb2-f6dd-46c4-b5d3-8ae968372bf1:hover {background: rgb(62,182,192);}.rwui\_id\_be21acb2-f6dd-46c4-b5d3-8ae968372bf1 .rwui\_icon {color: #FFFFFF !important;}Tornar enrere](https://steps.everis.com/confluence/pages/viewpage.action?pageId=1135312608 "Tornar enrere") [.rwui\_id\_52127349-7696-4aba-8140-40bdf3a4d0c5 {color: #FFFFFF !important; background: rgb(67,197,208);}.rwui\_id\_52127349-7696-4aba-8140-40bdf3a4d0c5:hover {background: rgb(62,182,192);}.rwui\_id\_52127349-7696-4aba-8140-40bdf3a4d0c5 .rwui\_icon {color: #FFFFFF !important;}Següent pas](https://steps.everis.com/confluence/pages/viewpage.action?pageId=1136657281 "Següent pas")
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

Attachments:
------------

![](images/icons/bullet_blue.gif) [image2018-5-22\_15-59-52.png](attachments/26313264/26316962.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2019-2-4\_10-45-10.png](attachments/26313264/26316948.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2019-2-4\_10-51-13.png](attachments/26313264/26316992.png) (image/png)  

Document generated by Confluence on 02 June 2025 11:13

[Atlassian](http://www.atlassian.com/)