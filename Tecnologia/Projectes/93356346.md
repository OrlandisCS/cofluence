Projectes : WildFly: monitoritzar Runtime attributes of the Datasource amb jboss-cli.sh  

1.  [Projectes](index.md)
2.  [PSIS](PSIS_24215797.md)
3.  [PSIS - WIKI](PSIS---WIKI_24215598.md)
4.  [Procediments](Procediments_24215610.md)

Projectes : WildFly: monitoritzar Runtime attributes of the Datasource amb jboss-cli.sh
=======================================================================================

Created by Áurea Alcaide on 07 junio 2023

Font:

[https://www.mastertheboss.com/jbossas/jboss-datasource/jboss-datasource-configuration/](https://www.mastertheboss.com/jbossas/jboss-datasource/jboss-datasource-configuration/)

In order to tune your applications, it is essential to monitor the runtime attributes of the Database Pool. This will help you to discover if the Connection pool has enough connections to meet your requirements. It will also be a clue to detect Connection leaks. As a rule of thumb, you have to enable statistics on your Datasource first:

/subsystem=datasources/data-source=PostgrePool:write-attribute(name=statistics-enabled,value=true)

  

Then, you can query the **statistics=pool** Node to investigate the current number of active Database connections:

/subsystem=datasources/data-source=PostgrePool/statistics=pool:read-resource(include-runtime=true)
{
    "outcome" => "success",
    "result" => {
        "ActiveCount" => 3,
        "AvailableCount" => 17,
        "AverageBlockingTime" => 0L,
        "AverageCreationTime" => 32L,
        "AverageGetTime" => 33L,
        "AveragePoolTime" => 0L,
        "AverageUsageTime" => 0L,
        "BlockingFailureCount" => 0,
        "CreatedCount" => 3,
        "DestroyedCount" => 0,
        "IdleCount" => 0,
        "InUseCount" => 3,
. . . .

In this example, we have 3 active Database connections (“**ActiveCount**“) but we also have 3 “**InUseCount**” Connections. What does it mean?

*   **InUseCount** tells us that there are 3 Connection objects which are executing SQL statements _right now._
*   **ActiveCount** tells us that there are 3 Active Database connections. If you see this number is never decreasing, it is a hint that you _might not be closing connections properly._

  

### How to detect Connection leaks

One way to **detect Database connection leaks** is using a combination of settings in the **datasource** and the **jca** subsystem. First, make sure that the **Cached Connection Manager** (use-ccm) is activated for the Datasource:

/subsystem=datasources/data-source=PostgrePool:read-attribute(name=use-ccm)
{
    "outcome" => "success",
    "result" => true
}

The above should be “true” by default.  Then set to “debug” the Cached Connection Manager in the jca subsystem:

/subsystem=jca/cached-connection-manager=cached-connection-manager:write-attribute(name=debug,value=true)

That will instruct the Cached Connection Manager to close connections **automatically for you**. As a result, you will see the following message in your logs:

2020-08-21 13:04:54,946 INFO  \[org.jboss.jca.core.api.connectionmanager.ccm.CachedConnectionManager\] (default task-1) IJ000100: Closing a connection for you. Please close them yourself: org.jboss.jca.adapters.jdbc.jdk8.WrappedConnectionJDK82ba43757: java.lang.Throwable: STACKTRACE
    at org.jboss.ironjacamar.impl1.4.22.Final//org.jboss.jca.core.connectionmanager.ccm.CachedConnectionManagerImpl.registerConnection(CachedConnectionManagerImpl.java:308)
    at org.jboss.ironjacamar.impl1.4.22.Final//org.jboss.jca.core.connectionmanager.AbstractConnectionManager.allocateConnection(AbstractConnectionManager.java:819)
    at org.jboss.ironjacamar.jdbcadapters1.4.22.Final//org.jboss.jca.adapters.jdbc.WrapperDataSource.getConnection(WrapperDataSource.java:151)
    at org.jboss.as.connector20.0.0.Final//org.jboss.as.connector.subsystems.datasources.WildFlyDataSource.getConnection(WildFlyDataSource.java:64)

  

Finally, consider that you can dump the **Datasource runtime statistics** in your server log file by enabling this logger:

/subsystem=logging/logger=org.jboss.jca/:add(level=TRACE)

That will print the full list of static and runtime attributes for your Datasource in the server logs:

Pool:
  Name: PostgrePool
  Class: org.jboss.jca.core.connectionmanager.pool.strategy.OnePool
  Object: 316a6237
  FIFO: false
PoolConfiguration:
  MinSize: 0
  InitialSize: 0
  MaxSize: 20
  BlockingTimeout: 30000
  IdleTimeoutMinutes: 30
  ValidateOnMatch: false
  BackgroundValidation: false
  BackgroundValidationMillis: 0
  StrictMin: false
  UseFastFail: false
  Decrementer: org.jboss.jca.core.connectionmanager.pool.capacity.TimedOutDecrementer
Available (0):
InUse (1):
  668c5c34 (NORMAL) (CheckedOut: 1598007894938) (Validated: 1598007794843) (Usage: 10)
Statistics:
  ActiveCount: 1
  AvailableCount: 19
  AverageBlockingTime: 0
  AverageCreationTime: 17
  AverageGetTime: 9
  AveragePoolTime: 100086
  AverageUsageTime: 9
  BlockingFailureCount: 0
  CreatedCount: 1
  DestroyedCount: 0
  IdleCount: 0
  InUseCount: 1
. . . . .

  

  

  

Document generated by Confluence on 07 junio 2025 00:00

[Atlassian](http://www.atlassian.com/)