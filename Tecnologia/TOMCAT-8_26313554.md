Suport Tècnic : TOMCAT 8  

1.  [Suport Tècnic](index.html)
2.  [Suport Tècnic](13893782.html)
3.  [04 - Tècnica de sistemes + 24x7 + Padró](26313202.html)
4.  [Desplegaments](Desplegaments_26313538.html)

Suport Tècnic : TOMCAT 8
========================

Created by Unknown User (dandreus), last modified by Unknown User (otecjriquelme) on 06 April 2021

Hi ha dues maneres de desplegar en un TOMCAT8:

1.  A través del PROBE
2.  Mitjançant Script de desplegaments → Aquesta manera només és vàlida per les màquines EACAT8

En cas que sigui possible, es recomana fer-ho amb Script, ja que esborra _work_ i _temp_ i a més reinicia el TOMCAT:

PAS 0: Identificar a quina màquina cal desplegar.
-------------------------------------------------

Per saber la màquina on hem de desplegar, ho mirem en el JIRA i cerquem les màquines en el Keepass. Per exemple:

![](attachments/26313554/30870085.png)

![](attachments/26313554/30870086.png)

Una vegada sabem les màquines on cal desplegar, decidim quin dels dos mètodes cal seguir:

  

Tomcat 8 - Desplegament amb PROBE

Pas 0: Fem backup
-----------------

Descarreguem el WAR de la ruta _/apps/tomcat8/webapps/_ i el guardem en una carpeta de backup. En xarxa a la ruta: \\\\192.168.166.33\\Desplegaments\\2020\\....

Pas 1: Esborrar l'aplicació desplegada via PROBE
------------------------------------------------

Accedir al probe de la plataforma on estiguem desplegant (podem trobar la URL i les credencials al Keepass).

Per exemple, si s'ha de desplegar al Tomcat8 - EACAT8, llavors hauríem de anar a aquest PROBE:

![](attachments/26313554/30869441.png)

_Això és només un exemple, potser cal desplegar a BACK8, FRONT8, etc._

Hem de clicar en el status de "running" en l'aplicació, esperar que s'aturi, i després d'eliminar l'aplicació: 

![](attachments/26313554/26313992.png)

Pas 2: Desplegar el nou WAR.
----------------------------

Un cop eliminada l'aplicació, anem per shell al servidor i **copiem el war a desplegar a la ruta** _/apps/tomcat8/webapps/_

Només amb això el tomcat8 ja sap que té una aplicació nova a desplegar. Revisarem el catalina per veure que tot va correctament –> _tail -f /apps/tomcat8/logs/catalina.out_

Pas 3: Desplegar a tots els nodes.
----------------------------------

Caldrà repetir aquest procediment per cada un dels nodes on calgui desplegar l'aplicació, generalment tots.

  

Tomcat 8 - Desplegament amb Script --> NOMÉS PER EACAT8

Pas 0: Backup
-------------

Els paquets a desplegar els trobarem a la ruta: **_\\\\192.168.166.33\\Desplegaments\\2020\\Pendents_**. Agafem els paquets que toca i els copiem en la ruta: **_\\\\192.168.166.33\\Desplegaments\\2020\\mes\\dia_**

Tant la carpeta del mes, com la carpeta del dia poden variar. Normalment l'haurem de crear nosaltres.

**PRO**

*   10.120.1.65 → aoc-l-tomcat8-01-pro  
    
*   10.120.1.67 → aoc-l-tomcat8-02-pro

**PRE**

*   10.120.2.182 → aoc-l-tomcat8-01-pre  
    
*   10.120.2.183 → aoc-l-tomcat8-02-pre

Guardarem el **WAR** que està actualment desplegat en una carpeta a la ruta _**\\\\192.168.166.33\\Desplegaments\\2020\\mes\\dia\\carpetaDesplegament\\backup**_

Backup fitxers addicionals

Es possible que també es demani modificar/eliminar/editar qualsevol altre fitxer de la màquina amb el desplegament. Per tant, també s'haurà de fer _backup_ dels fitxers que toqui. Normalment s'indica a la nota tècnica que adjunten al JIRA.

  

Pas 1: Copiar paquet i desplegar

Una vegada fet el _backup,_ haurem de copiar el paquet a la màquina. Anirem a la ruta(**/mnt/storage30/aoc/desplegaments/tomcat8-EACAT**) i copiarem els wars necessaris pel desplegament.

Un cop copiat tots els paquets, obrirem un terminal per executar l'script desplegar.sh:

cd /mnt/storage30/aoc/desplegaments/tomcat8-EACAT
./desplegar.sh

L'script **atura** el tomcat i **elimina** els fitxers temporals **work** i **temp**, tot seguit apareix un menú amb els diferents paquets a desplegar. Hem d'escriure el número que calgui i prémer enter, d'aquesta manera haurem esborrat el que hi ha desplegat i copiat el que hem posat nosaltres.

Si s’indica un que no toca, no passaria res, ja que es desplegaria l'últim paquet pujat.

Si hi ha, revisar nota tècnica, moltes vegades cal realitzar modificacions d'altres fitxers i la màquina ha d'estar apagada.

Per últim premem el "0" per reiniciar el tomcat.

Si dóna la casualitat que tenim més d'un paquet a desplegar, podem prémer tots els números necessaris abans de prémer el 0, **sempre d'un en un**.

Una vegada hem premut el 0 s'executarà la comanda d'iniciar el tomcat i mostrar els logs del catalina.

  

Pas 2: Revisar si s'ha desplegat correctament

Un cop desplegat, podem realitzar una validació ràpida per comprovar si s'ha realitzat bé el desplegament. Ens dirigim a la ruta: **/apps/versions/apache-tomcat-8.5.11/webapps**. En aquesta ruta haurem de trobar una carpeta amb el nom del paquet que s'ha desplegat i dins tots els fitxers que conté el WAR. Si la carpeta està buida o directament no hi és, haurem de tornar a desplegar el paquet, per algun cas no s'ha desplegat correctament.

  

¿OLD? Desplegament WebAdmin eNotum
==================================

Maquines:

Node 1: 10.120.1.25

Node 2: 10.120.1.30

  

Abans d'executar les següents comandes hem de fer el procediment habitual.

1\. Backup del war anterior.

2\. Copiem el war.

  

sudo systemctl stop tomcat8.service --> Aquesta comanda atura el tomcat


rm -rf /apps/tomcat8/work/\* --> Eliminem tot el contingut de la carpeta work


rm -rf /apps/tomcat8/temp/\* --> Eliminem tot el contingut de la carpeta temp (temporals)


rm -rf /apps/tomcat8/webapps/web-admin\* --> Eliminem carpeta que es genera al desplegar el war


sudo systemctl start tomcat8.service && tail -f /apps/tomcat8/logs/catalina.out --> Aquesta comanda inicia el tomcat

  
  

Attachments:
------------

![](images/icons/bullet_blue.gif) [image2019-5-22\_10-47-44.png](attachments/26313554/26313992.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2020-1-8\_16-4-2.png](attachments/26313554/30869441.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2020-1-29\_16-42-30.png](attachments/26313554/30870085.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2020-1-29\_16-46-41.png](attachments/26313554/30870086.png) (image/png)  
![](images/icons/bullet_blue.gif) [image2020-1-29\_17-19-19.png](attachments/26313554/30870090.png) (image/png)  

Document generated by Confluence on 02 June 2025 11:17

[Atlassian](http://www.atlassian.com/)